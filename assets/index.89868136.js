var rc=Object.defineProperty;var sc=(r,e,t)=>e in r?rc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var cs=(r,e,t)=>(sc(r,typeof e!="symbol"?e+"":e,t),t);const oc=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}};oc();class Ce{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,n){let s=[];return this.decompose(0,e,s,2),n.length&&n.decompose(0,n.length,s,3),this.decompose(t,this.length,s,1),Gt.from(s,this.length-(t-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let n=[];return this.decompose(e,t,n,0),Gt.from(n,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),s=new Dn(this),o=new Dn(e);for(let l=t,h=t;;){if(s.next(l),o.next(l),l=0,s.lineBreak!=o.lineBreak||s.done!=o.done||s.value!=o.value)return!1;if(h+=s.value.length,s.done||h>=n)return!0}}iter(e=1){return new Dn(this,e)}iterRange(e,t=this.length){return new Ja(this,e,t)}iterLines(e,t){let n;if(e==null)n=this.iter();else{t==null&&(t=this.lines+1);let s=this.line(e).from;n=this.iterRange(s,Math.max(s,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new Ga(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Ce.empty:e.length<=32?new Ue(e):Gt.from(Ue.split(e,[]))}}class Ue extends Ce{constructor(e,t=lc(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,n,s){for(let o=0;;o++){let l=this.text[o],h=s+l.length;if((t?n:h)>=e)return new ac(s,h,n,l);s=h+1,n++}}decompose(e,t,n,s){let o=e<=0&&t>=this.length?this:new Ue(kl(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(s&1){let l=n.pop(),h=dr(o.text,l.text.slice(),0,o.length);if(h.length<=32)n.push(new Ue(h,l.length+o.length));else{let f=h.length>>1;n.push(new Ue(h.slice(0,f)),new Ue(h.slice(f)))}}else n.push(o)}replace(e,t,n){if(!(n instanceof Ue))return super.replace(e,t,n);let s=dr(this.text,dr(n.text,kl(this.text,0,e)),t),o=this.length+n.length-(t-e);return s.length<=32?new Ue(s,o):Gt.from(Ue.split(s,[]),o)}sliceString(e,t=this.length,n=`
`){let s="";for(let o=0,l=0;o<=t&&l<this.text.length;l++){let h=this.text[l],f=o+h.length;o>e&&l&&(s+=n),e<f&&t>o&&(s+=h.slice(Math.max(0,e-o),t-o)),o=f+1}return s}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let n=[],s=-1;for(let o of e)n.push(o),s+=o.length+1,n.length==32&&(t.push(new Ue(n,s)),n=[],s=-1);return s>-1&&t.push(new Ue(n,s)),t}}class Gt extends Ce{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,t,n,s){for(let o=0;;o++){let l=this.children[o],h=s+l.length,f=n+l.lines-1;if((t?f:h)>=e)return l.lineInner(e,t,n,s);s=h+1,n=f+1}}decompose(e,t,n,s){for(let o=0,l=0;l<=t&&o<this.children.length;o++){let h=this.children[o],f=l+h.length;if(e<=f&&t>=l){let g=s&((l<=e?1:0)|(f>=t?2:0));l>=e&&f<=t&&!g?n.push(h):h.decompose(e-l,t-l,n,g)}l=f+1}}replace(e,t,n){if(n.lines<this.lines)for(let s=0,o=0;s<this.children.length;s++){let l=this.children[s],h=o+l.length;if(e>=o&&t<=h){let f=l.replace(e-o,t-o,n),g=this.lines-l.lines+f.lines;if(f.lines<g>>5-1&&f.lines>g>>5+1){let p=this.children.slice();return p[s]=f,new Gt(p,this.length-(t-e)+n.length)}return super.replace(o,h,f)}o=h+1}return super.replace(e,t,n)}sliceString(e,t=this.length,n=`
`){let s="";for(let o=0,l=0;o<this.children.length&&l<=t;o++){let h=this.children[o],f=l+h.length;l>e&&o&&(s+=n),e<f&&t>l&&(s+=h.sliceString(e-l,t-l,n)),l=f+1}return s}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Gt))return 0;let n=0,[s,o,l,h]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=t,o+=t){if(s==l||o==h)return n;let f=this.children[s],g=e.children[o];if(f!=g)return n+f.scanIdentical(g,t);n+=f.length+1}}static from(e,t=e.reduce((n,s)=>n+s.length+1,-1)){let n=0;for(let C of e)n+=C.lines;if(n<32){let C=[];for(let D of e)D.flatten(C);return new Ue(C,t)}let s=Math.max(32,n>>5),o=s<<1,l=s>>1,h=[],f=0,g=-1,p=[];function v(C){let D;if(C.lines>o&&C instanceof Gt)for(let F of C.children)v(F);else C.lines>l&&(f>l||!f)?(w(),h.push(C)):C instanceof Ue&&f&&(D=p[p.length-1])instanceof Ue&&C.lines+D.lines<=32?(f+=C.lines,g+=C.length+1,p[p.length-1]=new Ue(D.text.concat(C.text),D.length+1+C.length)):(f+C.lines>s&&w(),f+=C.lines,g+=C.length+1,p.push(C))}function w(){f!=0&&(h.push(p.length==1?p[0]:Gt.from(p,g)),g=-1,f=p.length=0)}for(let C of e)v(C);return w(),h.length==1?h[0]:new Gt(h,t)}}Ce.empty=new Ue([""],0);function lc(r){let e=-1;for(let t of r)e+=t.length+1;return e}function dr(r,e,t=0,n=1e9){for(let s=0,o=0,l=!0;o<r.length&&s<=n;o++){let h=r[o],f=s+h.length;f>=t&&(f>n&&(h=h.slice(0,n-s)),s<t&&(h=h.slice(t-s)),l?(e[e.length-1]+=h,l=!1):e.push(h)),s=f+1}return e}function kl(r,e,t){return dr(r,[""],e,t)}class Dn{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Ue?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,s=this.nodes[n],o=this.offsets[n],l=o>>1,h=s instanceof Ue?s.text.length:s.children.length;if(l==(t>0?h:0)){if(n==0)return this.done=!0,this.value="",this;t>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((o&1)==(t>0?0:1)){if(this.offsets[n]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(s instanceof Ue){let f=s.text[l+(t<0?-1:0)];if(this.offsets[n]+=t,f.length>Math.max(0,e))return this.value=e==0?f:t>0?f.slice(e):f.slice(0,f.length-e),this;e-=f.length}else{let f=s.children[l+(t<0?-1:0)];e>f.length?(e-=f.length,this.offsets[n]+=t):(t<0&&this.offsets[n]--,this.nodes.push(f),this.offsets.push(t>0?1:(f instanceof Ue?f.text.length:f.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class Ja{constructor(e,t,n){this.value="",this.done=!1,this.cursor=new Dn(e,t>n?-1:1),this.pos=t>n?e.length:0,this.from=Math.min(t,n),this.to=Math.max(t,n)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let n=t<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*t,this.value=s.length<=n?s:t<0?s.slice(s.length-n):s.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class Ga{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:n,value:s}=this.inner.next(e);return t?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol!="undefined"&&(Ce.prototype[Symbol.iterator]=function(){return this.iter()},Dn.prototype[Symbol.iterator]=Ja.prototype[Symbol.iterator]=Ga.prototype[Symbol.iterator]=function(){return this});class ac{constructor(e,t,n,s){this.from=e,this.to=t,this.number=n,this.text=s}get length(){return this.to-this.from}}let Qi="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(r=>r?parseInt(r,36):1);for(let r=1;r<Qi.length;r++)Qi[r]+=Qi[r-1];function hc(r){for(let e=1;e<Qi.length;e+=2)if(Qi[e]>r)return Qi[e-1]<=r;return!1}function Cl(r){return r>=127462&&r<=127487}const Sl=8205;function xt(r,e,t=!0,n=!0){return(t?Qa:uc)(r,e,n)}function Qa(r,e,t){if(e==r.length)return e;e&&Xa(r.charCodeAt(e))&&Ya(r.charCodeAt(e-1))&&e--;let n=Xi(r,e);for(e+=br(n);e<r.length;){let s=Xi(r,e);if(n==Sl||s==Sl||t&&hc(s))e+=br(s),n=s;else if(Cl(s)){let o=0,l=e-2;for(;l>=0&&Cl(Xi(r,l));)o++,l-=2;if(o%2==0)break;e+=2}else break}return e}function uc(r,e,t){for(;e>0;){let n=Qa(r,e-2,t);if(n<e)return n;e--}return 0}function Xa(r){return r>=56320&&r<57344}function Ya(r){return r>=55296&&r<56320}function Xi(r,e){let t=r.charCodeAt(e);if(!Ya(t)||e+1==r.length)return t;let n=r.charCodeAt(e+1);return Xa(n)?(t-55296<<10)+(n-56320)+65536:t}function fc(r){return r<=65535?String.fromCharCode(r):(r-=65536,String.fromCharCode((r>>10)+55296,(r&1023)+56320))}function br(r){return r<65536?1:2}const Rs=/\r\n?|\n/;var vt=function(r){return r[r.Simple=0]="Simple",r[r.TrackDel=1]="TrackDel",r[r.TrackBefore=2]="TrackBefore",r[r.TrackAfter=3]="TrackAfter",r}(vt||(vt={}));class Xt{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t+1];e+=n<0?this.sections[t]:n}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,n=0,s=0;t<this.sections.length;){let o=this.sections[t++],l=this.sections[t++];l<0?(e(n,s,o),s+=o):s+=l,n+=o}}iterChangedRanges(e,t=!1){Ns(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let n=this.sections[t++],s=this.sections[t++];s<0?e.push(n,s):e.push(s,n)}return new Xt(e)}composeDesc(e){return this.empty?e:e.empty?this:Za(this,e)}mapDesc(e,t=!1){return e.empty?this:Ps(this,e,t)}mapPos(e,t=-1,n=vt.Simple){let s=0,o=0;for(let l=0;l<this.sections.length;){let h=this.sections[l++],f=this.sections[l++],g=s+h;if(f<0){if(g>e)return o+(e-s);o+=h}else{if(n!=vt.Simple&&g>=e&&(n==vt.TrackDel&&s<e&&g>e||n==vt.TrackBefore&&s<e||n==vt.TrackAfter&&g>e))return null;if(g>e||g==e&&t<0&&!h)return e==s||t<0?o:o+f;o+=f}s=g}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return o}touchesRange(e,t=e){for(let n=0,s=0;n<this.sections.length&&s<=t;){let o=this.sections[n++],l=this.sections[n++],h=s+o;if(l>=0&&s<=t&&h>=e)return s<e&&h>t?"cover":!0;s=h}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let n=this.sections[t++],s=this.sections[t++];e+=(e?" ":"")+n+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Xt(e)}static create(e){return new Xt(e)}}class Ye extends Xt{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Ns(this,(t,n,s,o,l)=>e=e.replace(s,s+(n-t),l),!1),e}mapDesc(e,t=!1){return Ps(this,e,t,!0)}invert(e){let t=this.sections.slice(),n=[];for(let s=0,o=0;s<t.length;s+=2){let l=t[s],h=t[s+1];if(h>=0){t[s]=h,t[s+1]=l;let f=s>>1;for(;n.length<f;)n.push(Ce.empty);n.push(l?e.slice(o,o+l):Ce.empty)}o+=l}return new Ye(t,n)}compose(e){return this.empty?e:e.empty?this:Za(this,e,!0)}map(e,t=!1){return e.empty?this:Ps(this,e,t,!0)}iterChanges(e,t=!1){Ns(this,e,t)}get desc(){return Xt.create(this.sections)}filter(e){let t=[],n=[],s=[],o=new Tn(this);e:for(let l=0,h=0;;){let f=l==e.length?1e9:e[l++];for(;h<f||h==f&&o.len==0;){if(o.done)break e;let p=Math.min(o.len,f-h);ft(s,p,-1);let v=o.ins==-1?-1:o.off==0?o.ins:0;ft(t,p,v),v>0&&mi(n,t,o.text),o.forward(p),h+=p}let g=e[l++];for(;h<g;){if(o.done)break e;let p=Math.min(o.len,g-h);ft(t,p,-1),ft(s,p,o.ins==-1?-1:o.off==0?o.ins:0),o.forward(p),h+=p}}return{changes:new Ye(t,n),filtered:Xt.create(s)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t],s=this.sections[t+1];s<0?e.push(n):s==0?e.push([n]):e.push([n].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,n){let s=[],o=[],l=0,h=null;function f(p=!1){if(!p&&!s.length)return;l<t&&ft(s,t-l,-1);let v=new Ye(s,o);h=h?h.compose(v.map(h)):v,s=[],o=[],l=0}function g(p){if(Array.isArray(p))for(let v of p)g(v);else if(p instanceof Ye){if(p.length!=t)throw new RangeError(`Mismatched change set length (got ${p.length}, expected ${t})`);f(),h=h?h.compose(p.map(h)):p}else{let{from:v,to:w=v,insert:C}=p;if(v>w||v<0||w>t)throw new RangeError(`Invalid change range ${v} to ${w} (in doc of length ${t})`);let D=C?typeof C=="string"?Ce.of(C.split(n||Rs)):C:Ce.empty,F=D.length;if(v==w&&F==0)return;v<l&&f(),v>l&&ft(s,v-l,-1),ft(s,w-v,F),mi(o,s,D),l=w}}return g(e),f(!h),h}static empty(e){return new Ye(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],n=[];for(let s=0;s<e.length;s++){let o=e[s];if(typeof o=="number")t.push(o,-1);else{if(!Array.isArray(o)||typeof o[0]!="number"||o.some((l,h)=>h&&typeof l!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(o.length==1)t.push(o[0],0);else{for(;n.length<s;)n.push(Ce.empty);n[s]=Ce.of(o.slice(1)),t.push(o[0],n[s].length)}}}return new Ye(t,n)}static createSet(e,t){return new Ye(e,t)}}function ft(r,e,t,n=!1){if(e==0&&t<=0)return;let s=r.length-2;s>=0&&t<=0&&t==r[s+1]?r[s]+=e:e==0&&r[s]==0?r[s+1]+=t:n?(r[s]+=e,r[s+1]+=t):r.push(e,t)}function mi(r,e,t){if(t.length==0)return;let n=e.length-2>>1;if(n<r.length)r[r.length-1]=r[r.length-1].append(t);else{for(;r.length<n;)r.push(Ce.empty);r.push(t)}}function Ns(r,e,t){let n=r.inserted;for(let s=0,o=0,l=0;l<r.sections.length;){let h=r.sections[l++],f=r.sections[l++];if(f<0)s+=h,o+=h;else{let g=s,p=o,v=Ce.empty;for(;g+=h,p+=f,f&&n&&(v=v.append(n[l-2>>1])),!(t||l==r.sections.length||r.sections[l+1]<0);)h=r.sections[l++],f=r.sections[l++];e(s,g,o,p,v),s=g,o=p}}}function Ps(r,e,t,n=!1){let s=[],o=n?[]:null,l=new Tn(r),h=new Tn(e);for(let f=-1;;)if(l.ins==-1&&h.ins==-1){let g=Math.min(l.len,h.len);ft(s,g,-1),l.forward(g),h.forward(g)}else if(h.ins>=0&&(l.ins<0||f==l.i||l.off==0&&(h.len<l.len||h.len==l.len&&!t))){let g=h.len;for(ft(s,h.ins,-1);g;){let p=Math.min(l.len,g);l.ins>=0&&f<l.i&&l.len<=p&&(ft(s,0,l.ins),o&&mi(o,s,l.text),f=l.i),l.forward(p),g-=p}h.next()}else if(l.ins>=0){let g=0,p=l.len;for(;p;)if(h.ins==-1){let v=Math.min(p,h.len);g+=v,p-=v,h.forward(v)}else if(h.ins==0&&h.len<p)p-=h.len,h.next();else break;ft(s,g,f<l.i?l.ins:0),o&&f<l.i&&mi(o,s,l.text),f=l.i,l.forward(l.len-p)}else{if(l.done&&h.done)return o?Ye.createSet(s,o):Xt.create(s);throw new Error("Mismatched change set lengths")}}function Za(r,e,t=!1){let n=[],s=t?[]:null,o=new Tn(r),l=new Tn(e);for(let h=!1;;){if(o.done&&l.done)return s?Ye.createSet(n,s):Xt.create(n);if(o.ins==0)ft(n,o.len,0,h),o.next();else if(l.len==0&&!l.done)ft(n,0,l.ins,h),s&&mi(s,n,l.text),l.next();else{if(o.done||l.done)throw new Error("Mismatched change set lengths");{let f=Math.min(o.len2,l.len),g=n.length;if(o.ins==-1){let p=l.ins==-1?-1:l.off?0:l.ins;ft(n,f,p,h),s&&p&&mi(s,n,l.text)}else l.ins==-1?(ft(n,o.off?0:o.len,f,h),s&&mi(s,n,o.textBit(f))):(ft(n,o.off?0:o.len,l.off?0:l.ins,h),s&&!l.off&&mi(s,n,l.text));h=(o.ins>f||l.ins>=0&&l.len>f)&&(h||n.length>g),o.forward2(f),l.forward(f)}}}}class Tn{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?Ce.empty:e[t]}textBit(e){let{inserted:t}=this.set,n=this.i-2>>1;return n>=t.length&&!e?Ce.empty:t[n].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class Pi{constructor(e,t,n){this.from=e,this.to=t,this.flags=n}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let n,s;return this.empty?n=s=e.mapPos(this.from,t):(n=e.mapPos(this.from,1),s=e.mapPos(this.to,-1)),n==this.from&&s==this.to?this:new Pi(n,s,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return $.range(e,t);let n=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return $.range(this.anchor,n)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return $.range(e.anchor,e.head)}static create(e,t,n){return new Pi(e,t,n)}}class ${constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:$.create(this.ranges.map(n=>n.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new $([this.main],0)}addRange(e,t=!0){return $.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let n=this.ranges.slice();return n[t]=e,$.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new $(e.ranges.map(t=>Pi.fromJSON(t)),e.main)}static single(e,t=e){return new $([$.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,s=0;s<e.length;s++){let o=e[s];if(o.empty?o.from<=n:o.from<n)return $.normalized(e.slice(),t);n=o.to}return new $(e,t)}static cursor(e,t=0,n,s){return Pi.create(e,e,(t==0?0:t<0?4:8)|(n==null?3:Math.min(2,n))|(s!=null?s:33554431)<<5)}static range(e,t,n,s){let o=(n!=null?n:33554431)<<5|(s==null?3:Math.min(2,s));return t<e?Pi.create(t,e,24|o):Pi.create(e,t,(t>e?4:0)|o)}static normalized(e,t=0){let n=e[t];e.sort((s,o)=>s.from-o.from),t=e.indexOf(n);for(let s=1;s<e.length;s++){let o=e[s],l=e[s-1];if(o.empty?o.from<=l.to:o.from<l.to){let h=l.from,f=Math.max(o.to,l.to);s<=t&&t--,e.splice(--s,2,o.anchor>o.head?$.range(f,h):$.range(h,f))}}return new $(e,t)}}function eh(r,e){for(let t of r.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let Co=0;class re{constructor(e,t,n,s,o){this.combine=e,this.compareInput=t,this.compare=n,this.isStatic=s,this.id=Co++,this.default=e([]),this.extensions=typeof o=="function"?o(this):o}static define(e={}){return new re(e.combine||(t=>t),e.compareInput||((t,n)=>t===n),e.compare||(e.combine?(t,n)=>t===n:So),!!e.static,e.enables)}of(e){return new pr([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new pr(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new pr(e,this,2,t)}from(e,t){return t||(t=n=>n),this.compute([e],n=>t(n.field(e)))}}function So(r,e){return r==e||r.length==e.length&&r.every((t,n)=>t===e[n])}class pr{constructor(e,t,n,s){this.dependencies=e,this.facet=t,this.type=n,this.value=s,this.id=Co++}dynamicSlot(e){var t;let n=this.value,s=this.facet.compareInput,o=this.id,l=e[o]>>1,h=this.type==2,f=!1,g=!1,p=[];for(let v of this.dependencies)v=="doc"?f=!0:v=="selection"?g=!0:(((t=e[v.id])!==null&&t!==void 0?t:1)&1)==0&&p.push(e[v.id]);return{create(v){return v.values[l]=n(v),1},update(v,w){if(f&&w.docChanged||g&&(w.docChanged||w.selection)||Is(v,p)){let C=n(v);if(h?!Al(C,v.values[l],s):!s(C,v.values[l]))return v.values[l]=C,1}return 0},reconfigure:(v,w)=>{let C,D=w.config.address[o];if(D!=null){let F=Cr(w,D);if(this.dependencies.every(E=>E instanceof re?w.facet(E)===v.facet(E):E instanceof Zt?w.field(E,!1)==v.field(E,!1):!0)||(h?Al(C=n(v),F,s):s(C=n(v),F)))return v.values[l]=F,0}else C=n(v);return v.values[l]=C,1}}}}function Al(r,e,t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function Is(r,e){let t=!1;for(let n of e)On(r,n)&1&&(t=!0);return t}function cc(r,e,t){let n=t.map(f=>r[f.id]),s=t.map(f=>f.type),o=n.filter(f=>!(f&1)),l=r[e.id]>>1;function h(f){let g=[];for(let p=0;p<n.length;p++){let v=Cr(f,n[p]);if(s[p]==2)for(let w of v)g.push(w);else g.push(v)}return e.combine(g)}return{create(f){for(let g of n)On(f,g);return f.values[l]=h(f),1},update(f,g){if(!Is(f,o))return 0;let p=h(f);return e.compare(p,f.values[l])?0:(f.values[l]=p,1)},reconfigure(f,g){let p=Is(f,n),v=g.config.facets[e.id],w=g.facet(e);if(v&&!p&&So(t,v))return f.values[l]=w,0;let C=h(f);return e.compare(C,w)?(f.values[l]=w,0):(f.values[l]=C,1)}}}const Ml=re.define({static:!0});class Zt{constructor(e,t,n,s,o){this.id=e,this.createF=t,this.updateF=n,this.compareF=s,this.spec=o,this.provides=void 0}static define(e){let t=new Zt(Co++,e.create,e.update,e.compare||((n,s)=>n===s),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Ml).find(n=>n.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:n=>(n.values[t]=this.create(n),1),update:(n,s)=>{let o=n.values[t],l=this.updateF(o,s);return this.compareF(o,l)?0:(n.values[t]=l,1)},reconfigure:(n,s)=>s.config.address[this.id]!=null?(n.values[t]=s.field(this),0):(n.values[t]=this.create(n),1)}}init(e){return[this,Ml.of({field:this,create:e})]}get extension(){return this}}const Ri={lowest:4,low:3,default:2,high:1,highest:0};function yn(r){return e=>new th(e,r)}const Fn={highest:yn(Ri.highest),high:yn(Ri.high),default:yn(Ri.default),low:yn(Ri.low),lowest:yn(Ri.lowest)};class th{constructor(e,t){this.inner=e,this.prec=t}}class fn{of(e){return new Fs(this,e)}reconfigure(e){return fn.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Fs{constructor(e,t){this.compartment=e,this.inner=t}}class kr{constructor(e,t,n,s,o,l){for(this.base=e,this.compartments=t,this.dynamicSlots=n,this.address=s,this.staticValues=o,this.facets=l,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,n){let s=[],o=Object.create(null),l=new Map;for(let w of dc(e,t,l))w instanceof Zt?s.push(w):(o[w.facet.id]||(o[w.facet.id]=[])).push(w);let h=Object.create(null),f=[],g=[];for(let w of s)h[w.id]=g.length<<1,g.push(C=>w.slot(C));let p=n==null?void 0:n.config.facets;for(let w in o){let C=o[w],D=C[0].facet,F=p&&p[w]||[];if(C.every(E=>E.type==0))if(h[D.id]=f.length<<1|1,So(F,C))f.push(n.facet(D));else{let E=D.combine(C.map(K=>K.value));f.push(n&&D.compare(E,n.facet(D))?n.facet(D):E)}else{for(let E of C)E.type==0?(h[E.id]=f.length<<1|1,f.push(E.value)):(h[E.id]=g.length<<1,g.push(K=>E.dynamicSlot(K)));h[D.id]=g.length<<1,g.push(E=>cc(E,D,C))}}let v=g.map(w=>w(h));return new kr(e,l,v,h,f,o)}}function dc(r,e,t){let n=[[],[],[],[],[]],s=new Map;function o(l,h){let f=s.get(l);if(f!=null){if(f<=h)return;let g=n[f].indexOf(l);g>-1&&n[f].splice(g,1),l instanceof Fs&&t.delete(l.compartment)}if(s.set(l,h),Array.isArray(l))for(let g of l)o(g,h);else if(l instanceof Fs){if(t.has(l.compartment))throw new RangeError("Duplicate use of compartment in extensions");let g=e.get(l.compartment)||l.inner;t.set(l.compartment,g),o(g,h)}else if(l instanceof th)o(l.inner,l.prec);else if(l instanceof Zt)n[h].push(l),l.provides&&o(l.provides,h);else if(l instanceof pr)n[h].push(l),l.facet.extensions&&o(l.facet.extensions,Ri.default);else{let g=l.extension;if(!g)throw new Error(`Unrecognized extension value in extension set (${l}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);o(g,h)}}return o(r,Ri.default),n.reduce((l,h)=>l.concat(h))}function On(r,e){if(e&1)return 2;let t=e>>1,n=r.status[t];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;r.status[t]=4;let s=r.computeSlot(r,r.config.dynamicSlots[t]);return r.status[t]=2|s}function Cr(r,e){return e&1?r.config.staticValues[e>>1]:r.values[e>>1]}const ih=re.define(),nh=re.define({combine:r=>r.some(e=>e),static:!0}),rh=re.define({combine:r=>r.length?r[0]:void 0,static:!0}),sh=re.define(),oh=re.define(),lh=re.define(),ah=re.define({combine:r=>r.length?r[0]:!1});class Ai{constructor(e,t){this.type=e,this.value=t}static define(){return new pc}}class pc{of(e){return new Ai(this,e)}}class gc{constructor(e){this.map=e}of(e){return new Fe(this,e)}}class Fe{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new Fe(this.type,t)}is(e){return this.type==e}static define(e={}){return new gc(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let n=[];for(let s of e){let o=s.map(t);o&&n.push(o)}return n}}Fe.reconfigure=Fe.define();Fe.appendConfig=Fe.define();class Ze{constructor(e,t,n,s,o,l){this.startState=e,this.changes=t,this.selection=n,this.effects=s,this.annotations=o,this.scrollIntoView=l,this._doc=null,this._state=null,n&&eh(n,t.newLength),o.some(h=>h.type==Ze.time)||(this.annotations=o.concat(Ze.time.of(Date.now())))}static create(e,t,n,s,o,l){return new Ze(e,t,n,s,o,l)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Ze.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Ze.time=Ai.define();Ze.userEvent=Ai.define();Ze.addToHistory=Ai.define();Ze.remote=Ai.define();function mc(r,e){let t=[];for(let n=0,s=0;;){let o,l;if(n<r.length&&(s==e.length||e[s]>=r[n]))o=r[n++],l=r[n++];else if(s<e.length)o=e[s++],l=e[s++];else return t;!t.length||t[t.length-1]<o?t.push(o,l):t[t.length-1]<l&&(t[t.length-1]=l)}}function hh(r,e,t){var n;let s,o,l;return t?(s=e.changes,o=Ye.empty(e.changes.length),l=r.changes.compose(e.changes)):(s=e.changes.map(r.changes),o=r.changes.mapDesc(e.changes,!0),l=r.changes.compose(s)),{changes:l,selection:e.selection?e.selection.map(o):(n=r.selection)===null||n===void 0?void 0:n.map(s),effects:Fe.mapEffects(r.effects,s).concat(Fe.mapEffects(e.effects,o)),annotations:r.annotations.length?r.annotations.concat(e.annotations):e.annotations,scrollIntoView:r.scrollIntoView||e.scrollIntoView}}function Hs(r,e,t){let n=e.selection,s=Yi(e.annotations);return e.userEvent&&(s=s.concat(Ze.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ye?e.changes:Ye.of(e.changes||[],t,r.facet(rh)),selection:n&&(n instanceof $?n:$.single(n.anchor,n.head)),effects:Yi(e.effects),annotations:s,scrollIntoView:!!e.scrollIntoView}}function uh(r,e,t){let n=Hs(r,e.length?e[0]:{},r.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let o=1;o<e.length;o++){e[o].filter===!1&&(t=!1);let l=!!e[o].sequential;n=hh(n,Hs(r,e[o],l?n.changes.newLength:r.doc.length),l)}let s=Ze.create(r,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return vc(t?yc(s):s)}function yc(r){let e=r.startState,t=!0;for(let s of e.facet(sh)){let o=s(r);if(o===!1){t=!1;break}Array.isArray(o)&&(t=t===!0?o:mc(t,o))}if(t!==!0){let s,o;if(t===!1)o=r.changes.invertedDesc,s=Ye.empty(e.doc.length);else{let l=r.changes.filter(t);s=l.changes,o=l.filtered.mapDesc(l.changes).invertedDesc}r=Ze.create(e,s,r.selection&&r.selection.map(o),Fe.mapEffects(r.effects,o),r.annotations,r.scrollIntoView)}let n=e.facet(oh);for(let s=n.length-1;s>=0;s--){let o=n[s](r);o instanceof Ze?r=o:Array.isArray(o)&&o.length==1&&o[0]instanceof Ze?r=o[0]:r=uh(e,Yi(o),!1)}return r}function vc(r){let e=r.startState,t=e.facet(lh),n=r;for(let s=t.length-1;s>=0;s--){let o=t[s](r);o&&Object.keys(o).length&&(n=hh(n,Hs(e,o,r.changes.newLength),!0))}return n==r?r:Ze.create(e,r.changes,r.selection,n.effects,n.annotations,n.scrollIntoView)}const xc=[];function Yi(r){return r==null?xc:Array.isArray(r)?r:[r]}var ot=function(r){return r[r.Word=0]="Word",r[r.Space=1]="Space",r[r.Other=2]="Other",r}(ot||(ot={}));const wc=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Vs;try{Vs=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function bc(r){if(Vs)return Vs.test(r);for(let e=0;e<r.length;e++){let t=r[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||wc.test(t)))return!0}return!1}function kc(r){return e=>{if(!/\S/.test(e))return ot.Space;if(bc(e))return ot.Word;for(let t=0;t<r.length;t++)if(e.indexOf(r[t])>-1)return ot.Word;return ot.Other}}class we{constructor(e,t,n,s,o,l){this.config=e,this.doc=t,this.selection=n,this.values=s,this.status=e.statusTemplate.slice(),this.computeSlot=o,l&&(l._state=this);for(let h=0;h<this.config.dynamicSlots.length;h++)On(this,h<<1);this.computeSlot=null}field(e,t=!0){let n=this.config.address[e.id];if(n==null){if(t)throw new RangeError("Field is not present in this state");return}return On(this,n),Cr(this,n)}update(...e){return uh(this,e,!0)}applyTransaction(e){let t=this.config,{base:n,compartments:s}=t;for(let l of e.effects)l.is(fn.reconfigure)?(t&&(s=new Map,t.compartments.forEach((h,f)=>s.set(f,h)),t=null),s.set(l.value.compartment,l.value.extension)):l.is(Fe.reconfigure)?(t=null,n=l.value):l.is(Fe.appendConfig)&&(t=null,n=Yi(n).concat(l.value));let o;t?o=e.startState.values.slice():(t=kr.resolve(n,s,this),o=new we(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(h,f)=>f.reconfigure(h,this),null).values),new we(t,e.newDoc,e.newSelection,o,(l,h)=>h.update(l,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:$.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,n=e(t.ranges[0]),s=this.changes(n.changes),o=[n.range],l=Yi(n.effects);for(let h=1;h<t.ranges.length;h++){let f=e(t.ranges[h]),g=this.changes(f.changes),p=g.map(s);for(let w=0;w<h;w++)o[w]=o[w].map(p);let v=s.mapDesc(g,!0);o.push(f.range.map(v)),s=s.compose(p),l=Fe.mapEffects(l,p).concat(Fe.mapEffects(Yi(f.effects),v))}return{changes:s,selection:$.create(o,t.mainIndex),effects:l}}changes(e=[]){return e instanceof Ye?e:Ye.of(e,this.doc.length,this.facet(we.lineSeparator))}toText(e){return Ce.of(e.split(this.facet(we.lineSeparator)||Rs))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(On(this,t),Cr(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let n in e){let s=e[n];s instanceof Zt&&this.config.address[s.id]!=null&&(t[n]=s.spec.toJSON(this.field(e[n]),this))}return t}static fromJSON(e,t={},n){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(n){for(let o in n)if(Object.prototype.hasOwnProperty.call(e,o)){let l=n[o],h=e[o];s.push(l.init(f=>l.spec.fromJSON(h,f)))}}return we.create({doc:e.doc,selection:$.fromJSON(e.selection),extensions:t.extensions?s.concat([t.extensions]):s})}static create(e={}){let t=kr.resolve(e.extensions||[],new Map),n=e.doc instanceof Ce?e.doc:Ce.of((e.doc||"").split(t.staticFacet(we.lineSeparator)||Rs)),s=e.selection?e.selection instanceof $?e.selection:$.single(e.selection.anchor,e.selection.head):$.single(0);return eh(s,n.length),t.staticFacet(nh)||(s=s.asSingle()),new we(t,n,s,t.dynamicSlots.map(()=>null),(o,l)=>l.create(o),null)}get tabSize(){return this.facet(we.tabSize)}get lineBreak(){return this.facet(we.lineSeparator)||`
`}get readOnly(){return this.facet(ah)}phrase(e,...t){for(let n of this.facet(we.phrases))if(Object.prototype.hasOwnProperty.call(n,e)){e=n[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(n,s)=>{if(s=="$")return"$";let o=+(s||1);return!o||o>t.length?n:t[o-1]})),e}languageDataAt(e,t,n=-1){let s=[];for(let o of this.facet(ih))for(let l of o(this,t,n))Object.prototype.hasOwnProperty.call(l,e)&&s.push(l[e]);return s}charCategorizer(e){return kc(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:n,length:s}=this.doc.lineAt(e),o=this.charCategorizer(e),l=e-n,h=e-n;for(;l>0;){let f=xt(t,l,!1);if(o(t.slice(f,l))!=ot.Word)break;l=f}for(;h<s;){let f=xt(t,h);if(o(t.slice(h,f))!=ot.Word)break;h=f}return l==h?null:$.range(l+n,h+n)}}we.allowMultipleSelections=nh;we.tabSize=re.define({combine:r=>r.length?r[0]:4});we.lineSeparator=rh;we.readOnly=ah;we.phrases=re.define({compare(r,e){let t=Object.keys(r),n=Object.keys(e);return t.length==n.length&&t.every(s=>r[s]==e[s])}});we.languageData=ih;we.changeFilter=sh;we.transactionFilter=oh;we.transactionExtender=lh;fn.reconfigure=Fe.define();function Hn(r,e,t={}){let n={};for(let s of r)for(let o of Object.keys(s)){let l=s[o],h=n[o];if(h===void 0)n[o]=l;else if(!(h===l||l===void 0))if(Object.hasOwnProperty.call(t,o))n[o]=t[o](h,l);else throw new Error("Config merge conflict for field "+o)}for(let s in e)n[s]===void 0&&(n[s]=e[s]);return n}class rn{eq(e){return this==e}range(e,t=e){return Ln.create(e,t,this)}}rn.prototype.startSide=rn.prototype.endSide=0;rn.prototype.point=!1;rn.prototype.mapMode=vt.TrackDel;class Ln{constructor(e,t,n){this.from=e,this.to=t,this.value=n}static create(e,t,n){return new Ln(e,t,n)}}function Ws(r,e){return r.from-e.from||r.value.startSide-e.value.startSide}class Ao{constructor(e,t,n,s){this.from=e,this.to=t,this.value=n,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,t,n,s=0){let o=n?this.to:this.from;for(let l=s,h=o.length;;){if(l==h)return l;let f=l+h>>1,g=o[f]-e||(n?this.value[f].endSide:this.value[f].startSide)-t;if(f==l)return g>=0?l:h;g>=0?h=f:l=f+1}}between(e,t,n,s){for(let o=this.findIndex(t,-1e9,!0),l=this.findIndex(n,1e9,!1,o);o<l;o++)if(s(this.from[o]+e,this.to[o]+e,this.value[o])===!1)return!1}map(e,t){let n=[],s=[],o=[],l=-1,h=-1;for(let f=0;f<this.value.length;f++){let g=this.value[f],p=this.from[f]+e,v=this.to[f]+e,w,C;if(p==v){let D=t.mapPos(p,g.startSide,g.mapMode);if(D==null||(w=C=D,g.startSide!=g.endSide&&(C=t.mapPos(p,g.endSide),C<w)))continue}else if(w=t.mapPos(p,g.startSide),C=t.mapPos(v,g.endSide),w>C||w==C&&g.startSide>0&&g.endSide<=0)continue;(C-w||g.endSide-g.startSide)<0||(l<0&&(l=w),g.point&&(h=Math.max(h,C-w)),n.push(g),s.push(w-l),o.push(C-l))}return{mapped:n.length?new Ao(s,o,n,h):null,pos:l}}}class Ie{constructor(e,t,n,s){this.chunkPos=e,this.chunk=t,this.nextLayer=n,this.maxPoint=s}static create(e,t,n,s){return new Ie(e,t,n,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:n=!1,filterFrom:s=0,filterTo:o=this.length}=e,l=e.filter;if(t.length==0&&!l)return this;if(n&&(t=t.slice().sort(Ws)),this.isEmpty)return t.length?Ie.of(t):this;let h=new fh(this,null,-1).goto(0),f=0,g=[],p=new Hi;for(;h.value||f<t.length;)if(f<t.length&&(h.from-t[f].from||h.startSide-t[f].value.startSide)>=0){let v=t[f++];p.addInner(v.from,v.to,v.value)||g.push(v)}else h.rangeIndex==1&&h.chunkIndex<this.chunk.length&&(f==t.length||this.chunkEnd(h.chunkIndex)<t[f].from)&&(!l||s>this.chunkEnd(h.chunkIndex)||o<this.chunkPos[h.chunkIndex])&&p.addChunk(this.chunkPos[h.chunkIndex],this.chunk[h.chunkIndex])?h.nextChunk():((!l||s>h.to||o<h.from||l(h.from,h.to,h.value))&&(p.addInner(h.from,h.to,h.value)||g.push(Ln.create(h.from,h.to,h.value))),h.next());return p.finishInner(this.nextLayer.isEmpty&&!g.length?Ie.empty:this.nextLayer.update({add:g,filter:l,filterFrom:s,filterTo:o}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],n=[],s=-1;for(let l=0;l<this.chunk.length;l++){let h=this.chunkPos[l],f=this.chunk[l],g=e.touchesRange(h,h+f.length);if(g===!1)s=Math.max(s,f.maxPoint),t.push(f),n.push(e.mapPos(h));else if(g===!0){let{mapped:p,pos:v}=f.map(h,e);p&&(s=Math.max(s,p.maxPoint),t.push(p),n.push(v))}}let o=this.nextLayer.map(e);return t.length==0?o:new Ie(n,t,o||Ie.empty,s)}between(e,t,n){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let o=this.chunkPos[s],l=this.chunk[s];if(t>=o&&e<=o+l.length&&l.between(o,e-o,t-o,n)===!1)return}this.nextLayer.between(e,t,n)}}iter(e=0){return En.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return En.from(e).goto(t)}static compare(e,t,n,s,o=-1){let l=e.filter(v=>v.maxPoint>0||!v.isEmpty&&v.maxPoint>=o),h=t.filter(v=>v.maxPoint>0||!v.isEmpty&&v.maxPoint>=o),f=Dl(l,h,n),g=new vn(l,f,o),p=new vn(h,f,o);n.iterGaps((v,w,C)=>Ol(g,v,p,w,C,s)),n.empty&&n.length==0&&Ol(g,0,p,0,0,s)}static eq(e,t,n=0,s){s==null&&(s=1e9-1);let o=e.filter(p=>!p.isEmpty&&t.indexOf(p)<0),l=t.filter(p=>!p.isEmpty&&e.indexOf(p)<0);if(o.length!=l.length)return!1;if(!o.length)return!0;let h=Dl(o,l),f=new vn(o,h,0).goto(n),g=new vn(l,h,0).goto(n);for(;;){if(f.to!=g.to||!Ks(f.active,g.active)||f.point&&(!g.point||!f.point.eq(g.point)))return!1;if(f.to>s)return!0;f.next(),g.next()}}static spans(e,t,n,s,o=-1){let l=new vn(e,null,o).goto(t),h=t,f=l.openStart;for(;;){let g=Math.min(l.to,n);if(l.point){let p=l.activeForPoint(l.to),v=l.pointFrom<t?p.length+1:Math.min(p.length,f);s.point(h,g,l.point,p,v,l.pointRank),f=Math.min(l.openEnd(g),p.length)}else g>h&&(s.span(h,g,l.active,f),f=l.openEnd(g));if(l.to>n)return f+(l.point&&l.to>n?1:0);h=l.to,l.next()}}static of(e,t=!1){let n=new Hi;for(let s of e instanceof Ln?[e]:t?Cc(e):e)n.add(s.from,s.to,s.value);return n.finish()}}Ie.empty=new Ie([],[],null,-1);function Cc(r){if(r.length>1)for(let e=r[0],t=1;t<r.length;t++){let n=r[t];if(Ws(e,n)>0)return r.slice().sort(Ws);e=n}return r}Ie.empty.nextLayer=Ie.empty;class Hi{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new Ao(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,n){this.addInner(e,t,n)||(this.nextLayer||(this.nextLayer=new Hi)).add(e,t,n)}addInner(e,t,n){let s=e-this.lastTo||n.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=t,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let n=t.value.length-1;return this.last=t.value[n],this.lastFrom=t.from[n]+e,this.lastTo=t.to[n]+e,!0}finish(){return this.finishInner(Ie.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=Ie.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Dl(r,e,t){let n=new Map;for(let o of r)for(let l=0;l<o.chunk.length;l++)o.chunk[l].maxPoint<=0&&n.set(o.chunk[l],o.chunkPos[l]);let s=new Set;for(let o of e)for(let l=0;l<o.chunk.length;l++){let h=n.get(o.chunk[l]);h!=null&&(t?t.mapPos(h):h)==o.chunkPos[l]&&!(t!=null&&t.touchesRange(h,h+o.chunk[l].length))&&s.add(o.chunk[l])}return s}class fh{constructor(e,t,n,s=0){this.layer=e,this.skip=t,this.minPoint=n,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,n){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<e||s.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!n||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],n=e+t.from[this.rangeIndex];if(this.from=n,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class En{constructor(e){this.heap=e}static from(e,t=null,n=-1){let s=[];for(let o=0;o<e.length;o++)for(let l=e[o];!l.isEmpty;l=l.nextLayer)l.maxPoint>=n&&s.push(new fh(l,t,n,o));return s.length==1?s[0]:new En(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let n of this.heap)n.goto(e,t);for(let n=this.heap.length>>1;n>=0;n--)ds(this.heap,n);return this.next(),this}forward(e,t){for(let n of this.heap)n.forward(e,t);for(let n=this.heap.length>>1;n>=0;n--)ds(this.heap,n);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),ds(this.heap,0)}}}function ds(r,e){for(let t=r[e];;){let n=(e<<1)+1;if(n>=r.length)break;let s=r[n];if(n+1<r.length&&s.compare(r[n+1])>=0&&(s=r[n+1],n++),t.compare(s)<0)break;r[n]=t,r[e]=s,e=n}}class vn{constructor(e,t,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=En.from(e,t,n)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Gn(this.active,e),Gn(this.activeTo,e),Gn(this.activeRank,e),this.minActive=Tl(this.active,this.activeTo)}addActive(e){let t=0,{value:n,to:s,rank:o}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=o;)t++;Qn(this.active,t,n),Qn(this.activeTo,t,s),Qn(this.activeRank,t,o),e&&Qn(e,t,this.cursor.from),this.minActive=Tl(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),n&&Gn(n,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(n),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){this.openStart=0;for(let s=n.length-1;s>=0&&n[s]<e;s--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&t.push(this.active[n]);return t.reverse()}openEnd(e){let t=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)t++;return t}}function Ol(r,e,t,n,s,o){r.goto(e),t.goto(n);let l=n+s,h=n,f=n-e;for(;;){let g=r.to+f-t.to||r.endSide-t.endSide,p=g<0?r.to+f:t.to,v=Math.min(p,l);if(r.point||t.point?r.point&&t.point&&(r.point==t.point||r.point.eq(t.point))&&Ks(r.activeForPoint(r.to+f),t.activeForPoint(t.to))||o.comparePoint(h,v,r.point,t.point):v>h&&!Ks(r.active,t.active)&&o.compareRange(h,v,r.active,t.active),p>l)break;h=p,g<=0&&r.next(),g>=0&&t.next()}}function Ks(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!=e[t]&&!r[t].eq(e[t]))return!1;return!0}function Gn(r,e){for(let t=e,n=r.length-1;t<n;t++)r[t]=r[t+1];r.pop()}function Qn(r,e,t){for(let n=r.length-1;n>=e;n--)r[n+1]=r[n];r[e]=t}function Tl(r,e){let t=-1,n=1e9;for(let s=0;s<e.length;s++)(e[s]-n||r[s].endSide-r[t].endSide)<0&&(t=s,n=e[s]);return t}function Ur(r,e,t=r.length){let n=0;for(let s=0;s<t;)r.charCodeAt(s)==9?(n+=e-n%e,s++):(n++,s=xt(r,s));return n}function Sc(r,e,t,n){for(let s=0,o=0;;){if(o>=e)return s;if(s==r.length)break;o+=r.charCodeAt(s)==9?t-o%t:1,s=xt(r,s)}return n===!0?-1:r.length}const zs="\u037C",Ll=typeof Symbol=="undefined"?"__"+zs:Symbol.for(zs),$s=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),El=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};class bi{constructor(e,t){this.rules=[];let{finish:n}=t||{};function s(l){return/^@/.test(l)?[l]:l.split(/,\s*/)}function o(l,h,f,g){let p=[],v=/^@(\w+)\b/.exec(l[0]),w=v&&v[1]=="keyframes";if(v&&h==null)return f.push(l[0]+";");for(let C in h){let D=h[C];if(/&/.test(C))o(C.split(/,\s*/).map(F=>l.map(E=>F.replace(/&/,E))).reduce((F,E)=>F.concat(E)),D,f);else if(D&&typeof D=="object"){if(!v)throw new RangeError("The value of a property ("+C+") should be a primitive value.");o(s(C),D,p,w)}else D!=null&&p.push(C.replace(/_.*/,"").replace(/[A-Z]/g,F=>"-"+F.toLowerCase())+": "+D+";")}(p.length||w)&&f.push((n&&!v&&!g?l.map(n):l).join(", ")+" {"+p.join(" ")+"}")}for(let l in e)o(s(l),e[l],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=El[Ll]||1;return El[Ll]=e+1,zs+e.toString(36)}static mount(e,t){(e[$s]||new Ac(e)).mount(Array.isArray(t)?t:[t])}}let Bl=new Map;class Ac{constructor(e){let t=e.ownerDocument||e,n=t.defaultView;if(!e.head&&e.adoptedStyleSheets&&n.CSSStyleSheet){let s=Bl.get(t);if(s)return e.adoptedStyleSheets=[s.sheet,...e.adoptedStyleSheets],e[$s]=s;this.sheet=new n.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],Bl.set(t,this)}else{this.styleTag=t.createElement("style");let s=e.head||e;s.insertBefore(this.styleTag,s.firstChild)}this.modules=[],e[$s]=this}mount(e){let t=this.sheet,n=0,s=0;for(let o=0;o<e.length;o++){let l=e[o],h=this.modules.indexOf(l);if(h<s&&h>-1&&(this.modules.splice(h,1),s--,h=-1),h==-1){if(this.modules.splice(s++,0,l),t)for(let f=0;f<l.rules.length;f++)t.insertRule(l.rules[f],n++)}else{for(;s<h;)n+=this.modules[s++].rules.length;n+=l.rules.length,s++}}if(!t){let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o}}}var ki={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Bn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Rl=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent);typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent);var Mc=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),Dc=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Oc=Mc||Rl&&+Rl[1]<57;for(var rt=0;rt<10;rt++)ki[48+rt]=ki[96+rt]=String(rt);for(var rt=1;rt<=24;rt++)ki[rt+111]="F"+rt;for(var rt=65;rt<=90;rt++)ki[rt]=String.fromCharCode(rt+32),Bn[rt]=String.fromCharCode(rt);for(var ps in ki)Bn.hasOwnProperty(ps)||(Bn[ps]=ki[ps]);function Tc(r){var e=Oc&&(r.ctrlKey||r.altKey||r.metaKey)||Dc&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",t=!e&&r.key||(r.shiftKey?Bn:ki)[r.keyCode]||r.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function Sr(r){let e;return r.nodeType==11?e=r.getSelection?r:r.ownerDocument:e=r,e.getSelection()}function sn(r,e){return e?r==e||r.contains(e.nodeType!=1?e.parentNode:e):!1}function Lc(r){let e=r.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function gr(r,e){if(!e.anchorNode)return!1;try{return sn(r,e.anchorNode)}catch{return!1}}function Rn(r){return r.nodeType==3?on(r,0,r.nodeValue.length).getClientRects():r.nodeType==1?r.getClientRects():[]}function Ar(r,e,t,n){return t?Nl(r,e,t,n,-1)||Nl(r,e,t,n,1):!1}function Mr(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e}function Nl(r,e,t,n,s){for(;;){if(r==t&&e==n)return!0;if(e==(s<0?0:Ci(r))){if(r.nodeName=="DIV")return!1;let o=r.parentNode;if(!o||o.nodeType!=1)return!1;e=Mr(r)+(s<0?0:1),r=o}else if(r.nodeType==1){if(r=r.childNodes[e+(s<0?-1:0)],r.nodeType==1&&r.contentEditable=="false")return!1;e=s<0?Ci(r):0}else return!1}}function Ci(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function Mo(r,e){let t=e?r.left:r.right;return{left:t,right:t,top:r.top,bottom:r.bottom}}function Ec(r){return{left:0,right:r.innerWidth,top:0,bottom:r.innerHeight}}function Bc(r,e,t,n,s,o,l,h){let f=r.ownerDocument,g=f.defaultView||window;for(let p=r;p;)if(p.nodeType==1){let v,w=p==f.body;if(w)v=Ec(g);else{if(p.scrollHeight<=p.clientHeight&&p.scrollWidth<=p.clientWidth){p=p.assignedSlot||p.parentNode;continue}let F=p.getBoundingClientRect();v={left:F.left,right:F.left+p.clientWidth,top:F.top,bottom:F.top+p.clientHeight}}let C=0,D=0;if(s=="nearest")e.top<v.top?(D=-(v.top-e.top+l),t>0&&e.bottom>v.bottom+D&&(D=e.bottom-v.bottom+D+l)):e.bottom>v.bottom&&(D=e.bottom-v.bottom+l,t<0&&e.top-D<v.top&&(D=-(v.top+D-e.top+l)));else{let F=e.bottom-e.top,E=v.bottom-v.top;D=(s=="center"&&F<=E?e.top+F/2-E/2:s=="start"||s=="center"&&t<0?e.top-l:e.bottom-E+l)-v.top}if(n=="nearest"?e.left<v.left?(C=-(v.left-e.left+o),t>0&&e.right>v.right+C&&(C=e.right-v.right+C+o)):e.right>v.right&&(C=e.right-v.right+o,t<0&&e.left<v.left+C&&(C=-(v.left+C-e.left+o))):C=(n=="center"?e.left+(e.right-e.left)/2-(v.right-v.left)/2:n=="start"==h?e.left-o:e.right-(v.right-v.left)+o)-v.left,C||D)if(w)g.scrollBy(C,D);else{let F=0,E=0;if(D){let K=p.scrollTop;p.scrollTop+=D,E=p.scrollTop-K}if(C){let K=p.scrollLeft;p.scrollLeft+=C,F=p.scrollLeft-K}e={left:e.left-F,top:e.top-E,right:e.right-F,bottom:e.bottom-E},F&&Math.abs(F-C)<1&&(n="nearest"),E&&Math.abs(E-D)<1&&(s="nearest")}if(w)break;p=p.assignedSlot||p.parentNode}else if(p.nodeType==11)p=p.host;else break}function Rc(r){let e=r.ownerDocument;for(let t=r.parentNode;t&&t!=e.body;)if(t.nodeType==1){if(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)return t;t=t.assignedSlot||t.parentNode}else if(t.nodeType==11)t=t.host;else break;return null}class Nc{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:n}=e;this.set(t,Math.min(e.anchorOffset,t?Ci(t):0),n,Math.min(e.focusOffset,n?Ci(n):0))}set(e,t,n,s){this.anchorNode=e,this.anchorOffset=t,this.focusNode=n,this.focusOffset=s}}let qi=null;function ch(r){if(r.setActive)return r.setActive();if(qi)return r.focus(qi);let e=[];for(let t=r;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(r.focus(qi==null?{get preventScroll(){return qi={preventScroll:!0},!0}}:void 0),!qi){qi=!1;for(let t=0;t<e.length;){let n=e[t++],s=e[t++],o=e[t++];n.scrollTop!=s&&(n.scrollTop=s),n.scrollLeft!=o&&(n.scrollLeft=o)}}}let Pl;function on(r,e,t=e){let n=Pl||(Pl=document.createRange());return n.setEnd(r,t),n.setStart(r,e),n}function Zi(r,e,t){let n={key:e,code:e,keyCode:t,which:t,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,r.dispatchEvent(s);let o=new KeyboardEvent("keyup",n);return o.synthetic=!0,r.dispatchEvent(o),s.defaultPrevented||o.defaultPrevented}function Pc(r){for(;r;){if(r&&(r.nodeType==9||r.nodeType==11&&r.host))return r;r=r.assignedSlot||r.parentNode}return null}function dh(r){for(;r.attributes.length;)r.removeAttributeNode(r.attributes[0])}function Ic(r,e){let t=e.focusNode,n=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=n)return!1;for(n=Math.min(n,Ci(t));;)if(n){if(t.nodeType!=1)return!1;let s=t.childNodes[n-1];s.contentEditable=="false"?n--:(t=s,n=Ci(t))}else{if(t==r)return!0;n=Mr(t),t=t.parentNode}}class lt{constructor(e,t,n=!0){this.node=e,this.offset=t,this.precise=n}static before(e,t){return new lt(e.parentNode,Mr(e),t)}static after(e,t){return new lt(e.parentNode,Mr(e)+1,t)}}const Do=[];class Ee{constructor(){this.parent=null,this.dom=null,this.dirty=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let n of this.children){if(n==e)return t;t+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.dirty&2){let n=this.dom,s=null,o;for(let l of this.children){if(l.dirty){if(!l.dom&&(o=s?s.nextSibling:n.firstChild)){let h=Ee.get(o);(!h||!h.parent&&h.canReuseDOM(l))&&l.reuseDOM(o)}l.sync(e,t),l.dirty=0}if(o=s?s.nextSibling:n.firstChild,t&&!t.written&&t.node==n&&o!=l.dom&&(t.written=!0),l.dom.parentNode==n)for(;o&&o!=l.dom;)o=Il(o);else n.insertBefore(l.dom,o);s=l.dom}for(o=s?s.nextSibling:n.firstChild,o&&t&&t.node==n&&(t.written=!0);o;)o=Il(o)}else if(this.dirty&1)for(let n of this.children)n.dirty&&(n.sync(e,t),n.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let n;if(e==this.dom)n=this.dom.childNodes[t];else{let s=Ci(e)==0?0:t==0?-1:1;for(;;){let o=e.parentNode;if(o==this.dom)break;s==0&&o.firstChild!=o.lastChild&&(e==o.firstChild?s=-1:s=1),e=o}s<0?n=e:n=e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!Ee.get(n);)n=n.nextSibling;if(!n)return this.length;for(let s=0,o=0;;s++){let l=this.children[s];if(l.dom==n)return o;o+=l.length+l.breakAfter}}domBoundsAround(e,t,n=0){let s=-1,o=-1,l=-1,h=-1;for(let f=0,g=n,p=n;f<this.children.length;f++){let v=this.children[f],w=g+v.length;if(g<e&&w>t)return v.domBoundsAround(e,t,g);if(w>=e&&s==-1&&(s=f,o=g),g>t&&v.dom.parentNode==this.dom){l=f,h=p;break}p=w,g=w+v.breakAfter}return{from:o,to:h<0?n+this.length:h,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:l<this.children.length&&l>=0?this.children[l].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,n=Do){this.markDirty();for(let s=e;s<t;s++){let o=this.children[s];o.parent==this&&o.destroy()}this.children.splice(e,t-e,...n);for(let s=0;s<n.length;s++)n[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ph(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,n,s,o,l){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}}Ee.prototype.breakAfter=0;function Il(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}class ph{constructor(e,t,n){this.children=e,this.pos=t,this.i=n,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}}function gh(r,e,t,n,s,o,l,h,f){let{children:g}=r,p=g.length?g[e]:null,v=o.length?o[o.length-1]:null,w=v?v.breakAfter:l;if(!(e==n&&p&&!l&&!w&&o.length<2&&p.merge(t,s,o.length?v:null,t==0,h,f))){if(n<g.length){let C=g[n];C&&s<C.length?(e==n&&(C=C.split(s),s=0),!w&&v&&C.merge(0,s,v,!0,0,f)?o[o.length-1]=C:(s&&C.merge(0,s,null,!1,0,f),o.push(C))):C!=null&&C.breakAfter&&(v?v.breakAfter=1:l=1),n++}for(p&&(p.breakAfter=l,t>0&&(!l&&o.length&&p.merge(t,p.length,o[0],!1,h,0)?p.breakAfter=o.shift().breakAfter:(t<p.length||p.children.length&&p.children[p.children.length-1].length==0)&&p.merge(t,p.length,null,!1,h,0),e++));e<n&&o.length;)if(g[n-1].become(o[o.length-1]))n--,o.pop(),f=o.length?0:h;else if(g[e].become(o[0]))e++,o.shift(),h=o.length?0:f;else break;!o.length&&e&&n<g.length&&!g[e-1].breakAfter&&g[n].merge(0,0,g[e-1],!1,h,f)&&e--,(e<n||o.length)&&r.replaceChildren(e,n,o)}}function mh(r,e,t,n,s,o){let l=r.childCursor(),{i:h,off:f}=l.findPos(t,1),{i:g,off:p}=l.findPos(e,-1),v=e-t;for(let w of n)v+=w.length;r.length+=v,gh(r,g,p,h,f,n,0,s,o)}let At=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},_s=typeof document!="undefined"?document:{documentElement:{style:{}}};const qs=/Edge\/(\d+)/.exec(At.userAgent),yh=/MSIE \d/.test(At.userAgent),Us=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(At.userAgent),jr=!!(yh||Us||qs),Fl=!jr&&/gecko\/(\d+)/i.test(At.userAgent),gs=!jr&&/Chrome\/(\d+)/.exec(At.userAgent),Hl="webkitFontSmoothing"in _s.documentElement.style,vh=!jr&&/Apple Computer/.test(At.vendor),Vl=vh&&(/Mobile\/\w+/.test(At.userAgent)||At.maxTouchPoints>2);var Z={mac:Vl||/Mac/.test(At.platform),windows:/Win/.test(At.platform),linux:/Linux|X11/.test(At.platform),ie:jr,ie_version:yh?_s.documentMode||6:Us?+Us[1]:qs?+qs[1]:0,gecko:Fl,gecko_version:Fl?+(/Firefox\/(\d+)/.exec(At.userAgent)||[0,0])[1]:0,chrome:!!gs,chrome_version:gs?+gs[1]:0,ios:Vl,android:/Android\b/.test(At.userAgent),webkit:Hl,safari:vh,webkit_version:Hl?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:_s.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const Fc=256;class Vi extends Ee{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,n){return n&&(!(n instanceof Vi)||this.length-(t-e)+n.length>Fc)?!1:(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new Vi(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new lt(this.dom,e)}domBoundsAround(e,t,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return js(this.dom,e,t)}}class li extends Ee{constructor(e,t=[],n=0){super(),this.mark=e,this.children=t,this.length=n;for(let s of t)s.setParent(this)}setAttrs(e){if(dh(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e,t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,n,s,o,l){return n&&(!(n instanceof li&&n.mark.eq(this.mark))||e&&o<=0||t<this.length&&l<=0)?!1:(mh(this,e,t,n?n.children:[],o-1,l-1),this.markDirty(),!0)}split(e){let t=[],n=0,s=-1,o=0;for(let h of this.children){let f=n+h.length;f>e&&t.push(n<e?h.split(e-n):h),s<0&&n>=e&&(s=o),n=f,o++}let l=this.length-e;return this.length=e,s>-1&&(this.children.length=s,this.markDirty()),new li(this.mark,t,l)}domAtPos(e){return Ch(this,e)}coordsAt(e,t){return Ah(this,e,t)}}function js(r,e,t){let n=r.nodeValue.length;e>n&&(e=n);let s=e,o=e,l=0;e==0&&t<0||e==n&&t>=0?Z.chrome||Z.gecko||(e?(s--,l=1):o<n&&(o++,l=-1)):t<0?s--:o<n&&o++;let h=on(r,s,o).getClientRects();if(!h.length)return null;let f=h[(l?l<0:t>=0)?0:h.length-1];return Z.safari&&!l&&f.width==0&&(f=Array.prototype.find.call(h,g=>g.width)||f),l?Mo(f,l<0):f||null}class yi extends Ee{constructor(e,t,n){super(),this.widget=e,this.length=t,this.side=n,this.prevWidget=null}static create(e,t,n){return new(e.customView||yi)(e,t,n)}split(e){let t=yi.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,n,s,o,l){return n&&(!(n instanceof yi)||!this.widget.compare(n.widget)||e>0&&o<=0||t<this.length&&l<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}become(e){return e instanceof yi&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Ce.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,n=t&&t.state.doc,s=this.posAtStart;return n?n.slice(s,s+this.length):Ce.empty}domAtPos(e){return(this.length?e==0:this.side>0)?lt.before(this.dom):lt.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let n=this.widget.coordsAt(this.dom,e,t);if(n)return n;let s=this.dom.getClientRects(),o=null;if(!s.length)return null;for(let l=e>0?s.length-1:0;o=s[l],!(e>0?l==0:l==s.length-1||o.top<o.bottom);l+=e>0?-1:1);return this.length?o:Mo(o,this.side>0)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class xh extends yi{domAtPos(e){let{topView:t,text:n}=this.widget;return t?Js(e,0,t,n,this.length-t.length,(s,o)=>s.domAtPos(o),(s,o)=>new lt(s,Math.min(o,s.nodeValue.length))):new lt(n,Math.min(e,n.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:n,text:s}=this.widget;return n?bh(e,t,n,s,this.length-n.length):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:n,text:s}=this.widget;return n?Js(e,t,n,s,this.length-n.length,(o,l,h)=>o.coordsAt(l,h),(o,l,h)=>js(o,l,h)):js(s,e,t)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}canReuseDOM(){return!0}}function Js(r,e,t,n,s,o,l){if(t instanceof li){for(let h=t.dom.firstChild;h;h=h.nextSibling){let f=Ee.get(h);if(f){let g=sn(h,n),p=f.length+(g?s:0);if(r<p||r==p&&f.getSide()<=0)return g?Js(r,e,f,n,s,o,l):o(f,r,e);r-=p}else{let g=wh(r,e,h,l);if(typeof g!="number")return g;r=g}}return o(t,t.length,-1)}else return t.dom==n?l(n,r,e):o(t,r,e)}function wh(r,e,t,n){if(t.nodeType==3){let s=t.nodeValue.length;if(r<=s)return n(t,r,e);r-=s}else if(t.nodeType==1&&t.contentEditable!="false")for(let s=t.firstChild;s;s=s.nextSibling){let o=wh(r,e,s,n);if(typeof o!="number")return o;r=o}return r}function bh(r,e,t,n,s){if(t instanceof li){let o=0;for(let l=t.dom.firstChild;l;l=l.nextSibling){let h=Ee.get(l);if(h){let f=sn(l,n);if(sn(l,r))return o+(f?bh(r,e,h,n,s):h.localPosFromDOM(r,e));o+=h.length+(f?s:0)}else{let f=kh(r,e,l);if(f.result!=null)return o+f.result;o+=f.size}}}else if(t.dom==n)return Math.min(e,n.nodeValue.length);return t.localPosFromDOM(r,e)}function kh(r,e,t){if(t.nodeType==3)return r==t?{result:e}:{size:t.nodeValue.length};if(t.nodeType==1&&t.contentEditable!="false"){let n=0;for(let s=t.firstChild,o=0;;s=s.nextSibling,o++){if(r==t&&o==e)return{result:n};if(!s)return{size:n};let l=kh(r,e,s);if(l.result!=null)return{result:e+l.result};n+=l.size}}else return t.contains(r)?{result:0}:{size:0}}class ln extends Ee{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof ln&&e.side==this.side}split(){return new ln(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?lt.before(this.dom):lt.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Ce.empty}get isHidden(){return!0}}Vi.prototype.children=yi.prototype.children=ln.prototype.children=Do;function Ch(r,e){let t=r.dom,{children:n}=r,s=0;for(let o=0;s<n.length;s++){let l=n[s],h=o+l.length;if(!(h==o&&l.getSide()<=0)){if(e>o&&e<h&&l.dom.parentNode==t)return l.domAtPos(e-o);if(e<=o)break;o=h}}for(let o=s;o>0;o--){let l=n[o-1];if(l.dom.parentNode==t)return l.domAtPos(l.length)}for(let o=s;o<n.length;o++){let l=n[o];if(l.dom.parentNode==t)return l.domAtPos(0)}return new lt(t,0)}function Sh(r,e,t){let n,{children:s}=r;t>0&&e instanceof li&&s.length&&(n=s[s.length-1])instanceof li&&n.mark.eq(e.mark)?Sh(n,e.children[0],t-1):(s.push(e),e.setParent(r)),r.length+=e.length}function Ah(r,e,t){let n=null,s=-1,o=null,l=-1;function h(g,p){for(let v=0,w=0;v<g.children.length&&w<=p;v++){let C=g.children[v],D=w+C.length;D>=p&&(C.children.length?h(C,p-w):(!o||o.isHidden&&t>0)&&(D>p||w==D&&C.getSide()>0)?(o=C,l=p-w):(w<p||w==D&&C.getSide()<0&&!C.isHidden)&&(n=C,s=p-w)),w=D}}h(r,e);let f=(t<0?n:o)||n||o;return f?f.coordsAt(Math.max(0,f==n?s:l),t):Hc(r)}function Hc(r){let e=r.dom.lastChild;if(!e)return r.dom.getBoundingClientRect();let t=Rn(e);return t[t.length-1]||null}function Gs(r,e){for(let t in r)t=="class"&&e.class?e.class+=" "+r.class:t=="style"&&e.style?e.style+=";"+r.style:e[t]=r[t];return e}function Oo(r,e){if(r==e)return!0;if(!r||!e)return!1;let t=Object.keys(r),n=Object.keys(e);if(t.length!=n.length)return!1;for(let s of t)if(n.indexOf(s)==-1||r[s]!==e[s])return!1;return!0}function Qs(r,e,t){let n=null;if(e)for(let s in e)t&&s in t||r.removeAttribute(n=s);if(t)for(let s in t)e&&e[s]==t[s]||r.setAttribute(n=s,t[s]);return!!n}class ai{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}coordsAt(e,t,n){return null}get customView(){return null}get isHidden(){return!1}destroy(e){}}var _e=function(r){return r[r.Text=0]="Text",r[r.WidgetBefore=1]="WidgetBefore",r[r.WidgetAfter=2]="WidgetAfter",r[r.WidgetRange=3]="WidgetRange",r}(_e||(_e={}));class ve extends rn{constructor(e,t,n,s){super(),this.startSide=e,this.endSide=t,this.widget=n,this.spec=s}get heightRelevant(){return!1}static mark(e){return new Jr(e)}static widget(e){let t=e.side||0,n=!!e.block;return t+=n?t>0?3e8:-4e8:t>0?1e8:-1e8,new Wi(e,t,t,n,e.widget||null,!1)}static replace(e){let t=!!e.block,n,s;if(e.isBlockGap)n=-5e8,s=4e8;else{let{start:o,end:l}=Mh(e,t);n=(o?t?-3e8:-1:5e8)-1,s=(l?t?2e8:1:-6e8)+1}return new Wi(e,n,s,t,e.widget||null,!0)}static line(e){return new Vn(e)}static set(e,t=!1){return Ie.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ve.none=Ie.empty;class Jr extends ve{constructor(e){let{start:t,end:n}=Mh(e);super(t?-1:5e8,n?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof Jr&&this.tagName==e.tagName&&this.class==e.class&&Oo(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Jr.prototype.point=!1;class Vn extends ve{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Vn&&this.spec.class==e.spec.class&&Oo(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Vn.prototype.mapMode=vt.TrackBefore;Vn.prototype.point=!0;class Wi extends ve{constructor(e,t,n,s,o,l){super(t,n,o,e),this.block=s,this.isReplace=l,this.mapMode=s?t<=0?vt.TrackBefore:vt.TrackAfter:vt.TrackDel}get type(){return this.startSide<this.endSide?_e.WidgetRange:this.startSide<=0?_e.WidgetBefore:_e.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof Wi&&Vc(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}Wi.prototype.point=!0;function Mh(r,e=!1){let{inclusiveStart:t,inclusiveEnd:n}=r;return t==null&&(t=r.inclusive),n==null&&(n=r.inclusive),{start:t!=null?t:e,end:n!=null?n:e}}function Vc(r,e){return r==e||!!(r&&e&&r.compare(e))}function Xs(r,e,t,n=0){let s=t.length-1;s>=0&&t[s]+n>=r?t[s]=Math.max(t[s],e):t.push(r,e)}class wt extends Ee{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,n,s,o,l){if(n){if(!(n instanceof wt))return!1;this.dom||n.transferDOM(this)}return s&&this.setDeco(n?n.attrs:null),mh(this,e,t,n?n.children:[],o,l),!0}split(e){let t=new wt;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i:n,off:s}=this.childPos(e);s&&(t.append(this.children[n].split(s),0),this.children[n].merge(s,this.children[n].length,null,!1,0,0),n++);for(let o=n;o<this.children.length;o++)t.append(this.children[o],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,t}transferDOM(e){!this.dom||(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Oo(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Sh(this,e,t)}addLineDeco(e){let t=e.spec.attributes,n=e.spec.class;t&&(this.attrs=Gs(t,this.attrs||{})),n&&(this.attrs=Gs({class:n},this.attrs||{}))}domAtPos(e){return Ch(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e,t){var n;this.dom?this.dirty&4&&(dh(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Qs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let s=this.dom.lastChild;for(;s&&Ee.get(s)instanceof li;)s=s.lastChild;if(!s||!this.length||s.nodeName!="BR"&&((n=Ee.get(s))===null||n===void 0?void 0:n.isEditable)==!1&&(!Z.ios||!this.children.some(o=>o instanceof Vi))){let o=document.createElement("BR");o.cmIgnore=!0,this.dom.appendChild(o)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let n of this.children){if(!(n instanceof Vi)||/[^ -~]/.test(n.text))return null;let s=Rn(n.dom);if(s.length!=1)return null;e+=s[0].width,t=s[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let n=Ah(this,e,t);if(!this.children.length&&n&&this.parent){let{heightOracle:s}=this.parent.view.viewState,o=n.bottom-n.top;if(Math.abs(o-s.lineHeight)<2&&s.textHeight<o){let l=(o-s.textHeight)/2;return{top:n.top+l,bottom:n.bottom-l,left:n.left,right:n.left}}}return n}become(e){return!1}get type(){return _e.Text}static find(e,t){for(let n=0,s=0;n<e.children.length;n++){let o=e.children[n],l=s+o.length;if(l>=t){if(o instanceof wt)return o;if(l>t)break}s=l+o.breakAfter}return null}}class Ii extends Ee{constructor(e,t,n){super(),this.widget=e,this.length=t,this.type=n,this.breakAfter=0,this.prevWidget=null}merge(e,t,n,s,o,l){return n&&(!(n instanceof Ii)||!this.widget.compare(n.widget)||e>0&&o<=0||t<this.length&&l<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?lt.before(this.dom):lt.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let n=new Ii(this.widget,t,this.type);return n.breakAfter=this.breakAfter,n}get children(){return Do}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Ce.empty}domBoundsAround(){return null}become(e){return e instanceof Ii&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){return this.widget.coordsAt(this.dom,e,t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class To{constructor(e,t,n,s){this.doc=e,this.pos=t,this.end=n,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof Ii&&e.type==_e.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new wt),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Xn(new ln(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||this.getLine()}buildText(e,t,n){for(;e>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:l,done:h}=this.cursor.next(this.skip);if(this.skip=0,h)throw new Error("Ran out of text content when drawing inline views");if(l){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=o,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-n)),this.getLine().append(Xn(new Vi(this.text.slice(this.textOff,this.textOff+s)),t),n),this.atCursorPos=!0,this.textOff+=s,e-=s,n=0}}span(e,t,n,s){this.buildText(t-e,n,s),this.pos=t,this.openStart<0&&(this.openStart=s)}point(e,t,n,s,o,l){if(this.disallowBlockEffectsFor[l]&&n instanceof Wi){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let h=t-e;if(n instanceof Wi)if(n.block){let{type:f}=n;f==_e.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Ii(n.widget||new Wl("div"),h,f))}else{let f=yi.create(n.widget||new Wl("span"),h,h?0:n.startSide),g=this.atCursorPos&&!f.isEditable&&o<=s.length&&(e<t||n.startSide>0),p=!f.isEditable&&(e<t||o>s.length||n.startSide<=0),v=this.getLine();this.pendingBuffer==2&&!g&&!f.isEditable&&(this.pendingBuffer=0),this.flushBuffer(s),g&&(v.append(Xn(new ln(1),s),o),o=s.length+Math.max(0,o-s.length)),v.append(Xn(f,s),o),this.atCursorPos=p,this.pendingBuffer=p?e<t||o>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);h&&(this.textOff+h<=this.text.length?this.textOff+=h:(this.skip+=h-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=o)}static build(e,t,n,s,o){let l=new To(e,t,n,o);return l.openEnd=Ie.spans(s,t,n,l),l.openStart<0&&(l.openStart=l.openEnd),l.finish(l.openEnd),l}}function Xn(r,e){for(let t of e)r=new li(t,[r],r.length);return r}class Wl extends ai{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}const Dh=re.define(),Oh=re.define(),Th=re.define(),Lh=re.define(),Ys=re.define(),Eh=re.define(),Bh=re.define(),Rh=re.define({combine:r=>r.some(e=>e)}),Nh=re.define({combine:r=>r.some(e=>e)});class Dr{constructor(e,t="nearest",n="nearest",s=5,o=5){this.range=e,this.y=t,this.x=n,this.yMargin=s,this.xMargin=o}map(e){return e.empty?this:new Dr(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const Kl=Fe.define({map:(r,e)=>r.map(e)});function wi(r,e,t){let n=r.facet(Lh);n.length?n[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const Gr=re.define({combine:r=>r.length?r[0]:!0});let Wc=0;const kn=re.define();class Mt{constructor(e,t,n,s){this.id=e,this.create=t,this.domEventHandlers=n,this.extension=s(this)}static define(e,t){const{eventHandlers:n,provide:s,decorations:o}=t||{};return new Mt(Wc++,e,n,l=>{let h=[kn.of(l)];return o&&h.push(Nn.of(f=>{let g=f.plugin(l);return g?o(g):ve.none})),s&&h.push(s(l)),h})}static fromClass(e,t){return Mt.define(n=>new e(n),t)}}class ms{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(n){if(wi(t.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){wi(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(n){wi(e.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Ph=re.define(),Lo=re.define(),Nn=re.define(),Ih=re.define(),Fh=re.define();function Hh(r){let e=0,t=0,n=0,s=0;for(let o of r.state.facet(Fh)){let l=o(r);l&&(l.left!=null&&(e=Math.max(e,l.left)),l.right!=null&&(t=Math.max(t,l.right)),l.top!=null&&(n=Math.max(n,l.top)),l.bottom!=null&&(s=Math.max(s,l.bottom)))}return{left:e,right:t,top:n,bottom:s}}const Cn=re.define();class Yt{constructor(e,t,n,s){this.fromA=e,this.toA=t,this.fromB=n,this.toB=s}join(e){return new Yt(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,n=this;for(;t>0;t--){let s=e[t-1];if(!(s.fromA>n.toA)){if(s.toA<n.fromA)break;n=n.join(s),e.splice(t-1,1)}}return e.splice(t,0,n),e}static extendWithRanges(e,t){if(t.length==0)return e;let n=[];for(let s=0,o=0,l=0,h=0;;s++){let f=s==e.length?null:e[s],g=l-h,p=f?f.fromB:1e9;for(;o<t.length&&t[o]<p;){let v=t[o],w=t[o+1],C=Math.max(h,v),D=Math.min(p,w);if(C<=D&&new Yt(C+g,D+g,C,D).addToSet(n),w>p)break;o+=2}if(!f)return n;new Yt(f.fromA,f.toA,f.fromB,f.toB).addToSet(n),l=f.toA,h=f.toB}}}class Or{constructor(e,t,n){this.view=e,this.state=t,this.transactions=n,this.flags=0,this.startState=e.state,this.changes=Ye.empty(this.startState.doc.length);for(let o of n)this.changes=this.changes.compose(o.changes);let s=[];this.changes.iterChangedRanges((o,l,h,f)=>s.push(new Yt(o,l,h,f))),this.changedRanges=s}static create(e,t,n){return new Or(e,t,n)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var je=function(r){return r[r.LTR=0]="LTR",r[r.RTL=1]="RTL",r}(je||(je={}));const Zs=je.LTR,Kc=je.RTL;function Vh(r){let e=[];for(let t=0;t<r.length;t++)e.push(1<<+r[t]);return e}const zc=Vh("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),$c=Vh("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),eo=Object.create(null),$t=[];for(let r of["()","[]","{}"]){let e=r.charCodeAt(0),t=r.charCodeAt(1);eo[e]=t,eo[t]=-e}function _c(r){return r<=247?zc[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?$c[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203?256:64336<=r&&r<=65023?4:r==8204?256:1}const qc=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class en{constructor(e,t,n){this.from=e,this.to=t,this.level=n}get dir(){return this.level%2?Kc:Zs}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,n,s){let o=-1;for(let l=0;l<e.length;l++){let h=e[l];if(h.from<=t&&h.to>=t){if(h.level==n)return l;(o<0||(s!=0?s<0?h.from<t:h.to>t:e[o].level>h.level))&&(o=l)}}if(o<0)throw new RangeError("Index out of range");return o}}const Ve=[];function Uc(r,e){let t=r.length,n=e==Zs?1:2,s=e==Zs?2:1;if(!r||n==1&&!qc.test(r))return Wh(t);for(let l=0,h=n,f=n;l<t;l++){let g=_c(r.charCodeAt(l));g==512?g=h:g==8&&f==4&&(g=16),Ve[l]=g==4?2:g,g&7&&(f=g),h=g}for(let l=0,h=n,f=n;l<t;l++){let g=Ve[l];if(g==128)l<t-1&&h==Ve[l+1]&&h&24?g=Ve[l]=h:Ve[l]=256;else if(g==64){let p=l+1;for(;p<t&&Ve[p]==64;)p++;let v=l&&h==8||p<t&&Ve[p]==8?f==1?1:8:256;for(let w=l;w<p;w++)Ve[w]=v;l=p-1}else g==8&&f==1&&(Ve[l]=1);h=g,g&7&&(f=g)}for(let l=0,h=0,f=0,g,p,v;l<t;l++)if(p=eo[g=r.charCodeAt(l)])if(p<0){for(let w=h-3;w>=0;w-=3)if($t[w+1]==-p){let C=$t[w+2],D=C&2?n:C&4?C&1?s:n:0;D&&(Ve[l]=Ve[$t[w]]=D),h=w;break}}else{if($t.length==189)break;$t[h++]=l,$t[h++]=g,$t[h++]=f}else if((v=Ve[l])==2||v==1){let w=v==n;f=w?0:1;for(let C=h-3;C>=0;C-=3){let D=$t[C+2];if(D&2)break;if(w)$t[C+2]|=2;else{if(D&4)break;$t[C+2]|=4}}}for(let l=0;l<t;l++)if(Ve[l]==256){let h=l+1;for(;h<t&&Ve[h]==256;)h++;let f=(l?Ve[l-1]:n)==1,g=(h<t?Ve[h]:n)==1,p=f==g?f?1:2:n;for(let v=l;v<h;v++)Ve[v]=p;l=h-1}let o=[];if(n==1)for(let l=0;l<t;){let h=l,f=Ve[l++]!=1;for(;l<t&&f==(Ve[l]!=1);)l++;if(f)for(let g=l;g>h;){let p=g,v=Ve[--g]!=2;for(;g>h&&v==(Ve[g-1]!=2);)g--;o.push(new en(g,p,v?2:1))}else o.push(new en(h,l,0))}else for(let l=0;l<t;){let h=l,f=Ve[l++]==2;for(;l<t&&f==(Ve[l]==2);)l++;o.push(new en(h,l,f?1:2))}return o}function Wh(r){return[new en(0,r,0)]}let Kh="";function jc(r,e,t,n,s){var o;let l=n.head-r.from,h=-1;if(l==0){if(!s||!r.length)return null;e[0].level!=t&&(l=e[0].side(!1,t),h=0)}else if(l==r.length){if(s)return null;let w=e[e.length-1];w.level!=t&&(l=w.side(!0,t),h=e.length-1)}h<0&&(h=en.find(e,l,(o=n.bidiLevel)!==null&&o!==void 0?o:-1,n.assoc));let f=e[h];l==f.side(s,t)&&(f=e[h+=s?1:-1],l=f.side(!s,t));let g=s==(f.dir==t),p=xt(r.text,l,g);if(Kh=r.text.slice(Math.min(l,p),Math.max(l,p)),p!=f.side(s,t))return $.cursor(p+r.from,g?-1:1,f.level);let v=h==(s?e.length-1:0)?null:e[h+(s?1:-1)];return!v&&f.level!=t?$.cursor(s?r.to:r.from,s?-1:1,t):v&&v.level<f.level?$.cursor(v.side(!s,t)+r.from,s?1:-1,v.level):$.cursor(p+r.from,s?-1:1,f.level)}const Ji="\uFFFF";class zh{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(we.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Ji}readRange(e,t){if(!e)return this;let n=e.parentNode;for(let s=e;;){this.findPointBefore(n,s),this.readNode(s);let o=s.nextSibling;if(o==t)break;let l=Ee.get(s),h=Ee.get(o);(l&&h?l.breakAfter:(l?l.breakAfter:zl(s))||zl(o)&&(s.nodeName!="BR"||s.cmIgnore))&&this.lineBreak(),s=o}return this.findPointBefore(n,t),this}readTextNode(e){let t=e.nodeValue;for(let n of this.points)n.node==e&&(n.pos=this.text.length+Math.min(n.offset,t.length));for(let n=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let o=-1,l=1,h;if(this.lineSeparator?(o=t.indexOf(this.lineSeparator,n),l=this.lineSeparator.length):(h=s.exec(t))&&(o=h.index,l=h[0].length),this.append(t.slice(n,o<0?t.length:o)),o<0)break;if(this.lineBreak(),l>1)for(let f of this.points)f.node==e&&f.pos>this.text.length&&(f.pos-=l-1);n=o+l}}readNode(e){if(e.cmIgnore)return;let t=Ee.get(e),n=t&&t.overrideDOMText;if(n!=null){this.findPointInside(e,n.length);for(let s=n.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let n of this.points)n.node==e&&e.childNodes[n.offset]==t&&(n.pos=this.text.length)}findPointInside(e,t){for(let n of this.points)(e.nodeType==3?n.node==e:e.contains(n.node))&&(n.pos=this.text.length+Math.min(t,n.offset))}}function zl(r){return r.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(r.nodeName)}class $l{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class _l extends Ee{constructor(e){super(),this.view=e,this.compositionDeco=ve.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new wt],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Yt(0,0,0,e.state.doc.length)],0)}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:l,toA:h})=>h<this.minWidthFrom||l>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ve.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=Gc(this.view,e.changes)),(Z.ie||Z.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let n=this.decorations,s=this.updateDeco(),o=Zc(n,s,e.changes);return t=Yt.extendWithRanges(t,o),this.dirty==0&&t.length==0?!1:(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=Z.chrome||Z.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.dirty=0,o&&(o.written||n.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""});let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Ii&&o.widget instanceof ql&&s.push(o.dom);n.updateGaps(s)}updateChildren(e,t){let n=this.childCursor(t);for(let s=e.length-1;;s--){let o=s>=0?e[s]:null;if(!o)break;let{fromA:l,toA:h,fromB:f,toB:g}=o,{content:p,breakAtStart:v,openStart:w,openEnd:C}=To.build(this.view.state.doc,f,g,this.decorations,this.dynamicDecorationMap),{i:D,off:F}=n.findPos(h,1),{i:E,off:K}=n.findPos(l,-1);gh(this,E,K,D,F,p,v,w,C)}}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let n=this.view.root.activeElement,s=n==this.dom,o=!s&&gr(this.dom,this.view.observer.selectionRange)&&!(n&&this.dom.contains(n));if(!(s||t||o))return;let l=this.forceSelection;this.forceSelection=!1;let h=this.view.state.selection.main,f=this.domAtPos(h.anchor),g=h.empty?f:this.domAtPos(h.head);if(Z.gecko&&h.empty&&!this.compositionDeco.size&&Jc(f)){let v=document.createTextNode("");this.view.observer.ignore(()=>f.node.insertBefore(v,f.node.childNodes[f.offset]||null)),f=g=new lt(v,0),l=!0}let p=this.view.observer.selectionRange;(l||!p.focusNode||!Ar(f.node,f.offset,p.anchorNode,p.anchorOffset)||!Ar(g.node,g.offset,p.focusNode,p.focusOffset))&&(this.view.observer.ignore(()=>{Z.android&&Z.chrome&&this.dom.contains(p.focusNode)&&ed(p.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let v=Sr(this.view.root);if(v)if(h.empty){if(Z.gecko){let w=Xc(f.node,f.offset);if(w&&w!=3){let C=_h(f.node,f.offset,w==1?1:-1);C&&(f=new lt(C,w==1?0:C.nodeValue.length))}}v.collapse(f.node,f.offset),h.bidiLevel!=null&&p.cursorBidiLevel!=null&&(p.cursorBidiLevel=h.bidiLevel)}else if(v.extend){v.collapse(f.node,f.offset);try{v.extend(g.node,g.offset)}catch{}}else{let w=document.createRange();h.anchor>h.head&&([f,g]=[g,f]),w.setEnd(g.node,g.offset),w.setStart(f.node,f.offset),v.removeAllRanges(),v.addRange(w)}o&&this.view.root.activeElement==this.dom&&(this.dom.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(f,g)),this.impreciseAnchor=f.precise?null:new lt(p.anchorNode,p.anchorOffset),this.impreciseHead=g.precise?null:new lt(p.focusNode,p.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let{view:e}=this,t=e.state.selection.main,n=Sr(e.root),{anchorNode:s,anchorOffset:o}=e.observer.selectionRange;if(!n||!t.empty||!t.assoc||!n.modify)return;let l=wt.find(this,t.head);if(!l)return;let h=l.posAtStart;if(t.head==h||t.head==h+l.length)return;let f=this.coordsAt(t.head,-1),g=this.coordsAt(t.head,1);if(!f||!g||f.bottom>g.top)return;let p=this.domAtPos(t.head+t.assoc);n.collapse(p.node,p.offset),n.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let v=e.observer.selectionRange;e.docView.posFromDOM(v.anchorNode,v.anchorOffset)!=t.from&&n.collapse(s,o)}nearest(e){for(let t=e;t;){let n=Ee.get(t);if(n&&n.rootView==this)return n;t=t.parentNode}return null}posFromDOM(e,t){let n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,t)+n.posAtStart}domAtPos(e){let{i:t,off:n}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let s=this.children[t];if(n<s.length||s instanceof wt)break;t++,n=0}return this.children[t].domAtPos(n)}coordsAt(e,t){for(let n=this.length,s=this.children.length-1;;s--){let o=this.children[s],l=n-o.breakAfter-o.length;if(e>l||e==l&&o.type!=_e.WidgetBefore&&o.type!=_e.WidgetAfter&&(!s||t==2||this.children[s-1].breakAfter||this.children[s-1].type==_e.WidgetBefore&&t>-2))return o.coordsAt(e-l,t);n=l}}measureVisibleLineHeights(e){let t=[],{from:n,to:s}=e,o=this.view.contentDOM.clientWidth,l=o>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,h=-1,f=this.view.textDirection==je.LTR;for(let g=0,p=0;p<this.children.length;p++){let v=this.children[p],w=g+v.length;if(w>s)break;if(g>=n){let C=v.dom.getBoundingClientRect();if(t.push(C.height),l){let D=v.dom.lastChild,F=D?Rn(D):[];if(F.length){let E=F[F.length-1],K=f?E.right-C.left:C.right-E.left;K>h&&(h=K,this.minWidth=o,this.minWidthFrom=g,this.minWidthTo=w)}}}g=w+v.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?je.RTL:je.LTR}measureTextSize(){for(let o of this.children)if(o instanceof wt){let l=o.measureTextSize();if(l)return l}let e=document.createElement("div"),t,n,s;return e.className="cm-line",e.style.width="99999px",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let o=Rn(e.firstChild)[0];t=e.getBoundingClientRect().height,n=o?o.width/27:7,s=o?o.height:t,e.remove()}),{lineHeight:t,charWidth:n,textHeight:s}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new ph(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let n=0,s=0;;s++){let o=s==t.viewports.length?null:t.viewports[s],l=o?o.from-1:this.length;if(l>n){let h=t.lineBlockAt(l).bottom-t.lineBlockAt(n).top;e.push(ve.replace({widget:new ql(h),block:!0,inclusive:!0,isBlockGap:!0}).range(n,l))}if(!o)break;n=o.to+1}return ve.set(e)}updateDeco(){let e=this.view.state.facet(Nn).map((t,n)=>(this.dynamicDecorationMap[n]=typeof t=="function")?t(this.view):t);for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,n=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),s;if(!n)return;!t.empty&&(s=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(n={left:Math.min(n.left,s.left),top:Math.min(n.top,s.top),right:Math.max(n.right,s.right),bottom:Math.max(n.bottom,s.bottom)});let o=Hh(this.view),l={left:n.left-o.left,top:n.top-o.top,right:n.right+o.right,bottom:n.bottom+o.bottom};Bc(this.view.scrollDOM,l,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==je.LTR)}}function Jc(r){return r.node.nodeType==1&&r.node.firstChild&&(r.offset==0||r.node.childNodes[r.offset-1].contentEditable=="false")&&(r.offset==r.node.childNodes.length||r.node.childNodes[r.offset].contentEditable=="false")}class ql extends ai{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function $h(r){let e=r.observer.selectionRange,t=e.focusNode&&_h(e.focusNode,e.focusOffset,0);if(!t)return null;let n=r.docView.nearest(t);if(!n)return null;if(n instanceof wt){let s=t;for(;s.parentNode!=n.dom;)s=s.parentNode;let o=s.previousSibling;for(;o&&!Ee.get(o);)o=o.previousSibling;let l=o?Ee.get(o).posAtEnd:n.posAtStart;return{from:l,to:l,node:s,text:t}}else{for(;;){let{parent:o}=n;if(!o)return null;if(o instanceof wt)break;n=o}let s=n.posAtStart;return{from:s,to:s+n.length,node:n.dom,text:t}}}function Gc(r,e){let t=$h(r);if(!t)return ve.none;let{from:n,to:s,node:o,text:l}=t,h=e.mapPos(n,1),f=Math.max(h,e.mapPos(s,-1)),{state:g}=r,p=o.nodeType==3?o.nodeValue:new zh([],g).readRange(o.firstChild,null).text;if(p.indexOf(Ji)>-1)return ve.none;if(f-h<p.length)if(g.doc.sliceString(h,Math.min(g.doc.length,h+p.length))==p)f=h+p.length;else if(g.doc.sliceString(Math.max(0,f-p.length),f)==p)h=f-p.length;else return ve.none;else if(g.doc.sliceString(h,f)!=p)return ve.none;let v=Ee.get(o);return v instanceof xh?v=v.widget.topView:v&&(v.parent=null),ve.set(ve.replace({widget:new Qc(o,l,v),inclusive:!0}).range(h,f))}class Qc extends ai{constructor(e,t,n){super(),this.top=e,this.text=t,this.topView=n}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return xh}}function _h(r,e,t){if(t<=0)for(let n=r,s=e;;){if(n.nodeType==3)return n;if(n.nodeType==1&&s>0)n=n.childNodes[s-1],s=Ci(n);else break}if(t>=0)for(let n=r,s=e;;){if(n.nodeType==3)return n;if(n.nodeType==1&&s<n.childNodes.length&&t>=0)n=n.childNodes[s],s=0;else break}return null}function Xc(r,e){return r.nodeType!=1?0:(e&&r.childNodes[e-1].contentEditable=="false"?1:0)|(e<r.childNodes.length&&r.childNodes[e].contentEditable=="false"?2:0)}class Yc{constructor(){this.changes=[]}compareRange(e,t){Xs(e,t,this.changes)}comparePoint(e,t){Xs(e,t,this.changes)}}function Zc(r,e,t){let n=new Yc;return Ie.compare(r,e,t,n),n.changes}function ed(r,e){for(let t=r;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function td(r,e,t=1){let n=r.charCategorizer(e),s=r.doc.lineAt(e),o=e-s.from;if(s.length==0)return $.cursor(e);o==0?t=1:o==s.length&&(t=-1);let l=o,h=o;t<0?l=xt(s.text,o,!1):h=xt(s.text,o);let f=n(s.text.slice(l,h));for(;l>0;){let g=xt(s.text,l,!1);if(n(s.text.slice(g,l))!=f)break;l=g}for(;h<s.length;){let g=xt(s.text,h);if(n(s.text.slice(h,g))!=f)break;h=g}return $.range(l+s.from,h+s.from)}function id(r,e){return e.left>r?e.left-r:Math.max(0,r-e.right)}function nd(r,e){return e.top>r?e.top-r:Math.max(0,r-e.bottom)}function ys(r,e){return r.top<e.bottom-1&&r.bottom>e.top+1}function Ul(r,e){return e<r.top?{top:e,left:r.left,right:r.right,bottom:r.bottom}:r}function jl(r,e){return e>r.bottom?{top:r.top,left:r.left,right:r.right,bottom:e}:r}function to(r,e,t){let n,s,o,l,h=!1,f,g,p,v;for(let D=r.firstChild;D;D=D.nextSibling){let F=Rn(D);for(let E=0;E<F.length;E++){let K=F[E];s&&ys(s,K)&&(K=Ul(jl(K,s.bottom),s.top));let X=id(e,K),te=nd(t,K);if(X==0&&te==0)return D.nodeType==3?Jl(D,e,t):to(D,e,t);if(!n||l>te||l==te&&o>X){n=D,s=K,o=X,l=te;let V=te?t<K.top?-1:1:X?e<K.left?-1:1:0;h=!V||(V>0?E<F.length-1:E>0)}X==0?t>K.bottom&&(!p||p.bottom<K.bottom)?(f=D,p=K):t<K.top&&(!v||v.top>K.top)&&(g=D,v=K):p&&ys(p,K)?p=jl(p,K.bottom):v&&ys(v,K)&&(v=Ul(v,K.top))}}if(p&&p.bottom>=t?(n=f,s=p):v&&v.top<=t&&(n=g,s=v),!n)return{node:r,offset:0};let w=Math.max(s.left,Math.min(s.right,e));if(n.nodeType==3)return Jl(n,w,t);if(h&&n.contentEditable!="false")return to(n,w,t);let C=Array.prototype.indexOf.call(r.childNodes,n)+(e>=(s.left+s.right)/2?1:0);return{node:r,offset:C}}function Jl(r,e,t){let n=r.nodeValue.length,s=-1,o=1e9,l=0;for(let h=0;h<n;h++){let f=on(r,h,h+1).getClientRects();for(let g=0;g<f.length;g++){let p=f[g];if(p.top==p.bottom)continue;l||(l=e-p.left);let v=(p.top>t?p.top-t:t-p.bottom)-1;if(p.left-1<=e&&p.right+1>=e&&v<o){let w=e>=(p.left+p.right)/2,C=w;if((Z.chrome||Z.gecko)&&on(r,h).getBoundingClientRect().left==p.right&&(C=!w),v<=0)return{node:r,offset:h+(C?1:0)};s=h+(C?1:0),o=v}}}return{node:r,offset:s>-1?s:l>0?r.nodeValue.length:0}}function qh(r,e,t,n=-1){var s,o;let l=r.contentDOM.getBoundingClientRect(),h=l.top+r.viewState.paddingTop,f,{docHeight:g}=r.viewState,{x:p,y:v}=e,w=v-h;if(w<0)return 0;if(w>g)return r.state.doc.length;for(let V=r.defaultLineHeight/2,Y=!1;f=r.elementAtHeight(w),f.type!=_e.Text;)for(;w=n>0?f.bottom+V:f.top-V,!(w>=0&&w<=g);){if(Y)return t?null:0;Y=!0,n=-n}v=h+w;let C=f.from;if(C<r.viewport.from)return r.viewport.from==0?0:t?null:Gl(r,l,f,p,v);if(C>r.viewport.to)return r.viewport.to==r.state.doc.length?r.state.doc.length:t?null:Gl(r,l,f,p,v);let D=r.dom.ownerDocument,F=r.root.elementFromPoint?r.root:D,E=F.elementFromPoint(p,v);E&&!r.contentDOM.contains(E)&&(E=null),E||(p=Math.max(l.left+1,Math.min(l.right-1,p)),E=F.elementFromPoint(p,v),E&&!r.contentDOM.contains(E)&&(E=null));let K,X=-1;if(E&&((s=r.docView.nearest(E))===null||s===void 0?void 0:s.isEditable)!=!1){if(D.caretPositionFromPoint){let V=D.caretPositionFromPoint(p,v);V&&({offsetNode:K,offset:X}=V)}else if(D.caretRangeFromPoint){let V=D.caretRangeFromPoint(p,v);V&&({startContainer:K,startOffset:X}=V,(!r.contentDOM.contains(K)||Z.safari&&rd(K,X,p)||Z.chrome&&sd(K,X,p))&&(K=void 0))}}if(!K||!r.docView.dom.contains(K)){let V=wt.find(r.docView,C);if(!V)return w>f.top+f.height/2?f.to:f.from;({node:K,offset:X}=to(V.dom,p,v))}let te=r.docView.nearest(K);if(!te)return null;if(te.isWidget&&((o=te.dom)===null||o===void 0?void 0:o.nodeType)==1){let V=te.dom.getBoundingClientRect();return e.y<V.top||e.y<=V.bottom&&e.x<=(V.left+V.right)/2?te.posAtStart:te.posAtEnd}else return te.localPosFromDOM(K,X)+te.posAtStart}function Gl(r,e,t,n,s){let o=Math.round((n-e.left)*r.defaultCharacterWidth);r.lineWrapping&&t.height>r.defaultLineHeight*1.5&&(o+=Math.floor((s-t.top)/r.defaultLineHeight)*r.viewState.heightOracle.lineLength);let l=r.state.sliceDoc(t.from,t.to);return t.from+Sc(l,o,r.state.tabSize)}function rd(r,e,t){let n;if(r.nodeType!=3||e!=(n=r.nodeValue.length))return!1;for(let s=r.nextSibling;s;s=s.nextSibling)if(s.nodeType!=1||s.nodeName!="BR")return!1;return on(r,n-1,n).getBoundingClientRect().left>t}function sd(r,e,t){if(e!=0)return!1;for(let s=r;;){let o=s.parentNode;if(!o||o.nodeType!=1||o.firstChild!=s)return!1;if(o.classList.contains("cm-line"))break;s=o}let n=r.nodeType==1?r.getBoundingClientRect():on(r,0,Math.max(r.nodeValue.length,1)).getBoundingClientRect();return t-n.left>5}function od(r,e,t,n){let s=r.state.doc.lineAt(e.head),o=!n||!r.lineWrapping?null:r.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head);if(o){let f=r.dom.getBoundingClientRect(),g=r.textDirectionAt(s.from),p=r.posAtCoords({x:t==(g==je.LTR)?f.right-1:f.left+1,y:(o.top+o.bottom)/2});if(p!=null)return $.cursor(p,t?-1:1)}let l=wt.find(r.docView,e.head),h=l?t?l.posAtEnd:l.posAtStart:t?s.to:s.from;return $.cursor(h,t?-1:1)}function Ql(r,e,t,n){let s=r.state.doc.lineAt(e.head),o=r.bidiSpans(s),l=r.textDirectionAt(s.from);for(let h=e,f=null;;){let g=jc(s,o,l,h,t),p=Kh;if(!g){if(s.number==(t?r.state.doc.lines:1))return h;p=`
`,s=r.state.doc.line(s.number+(t?1:-1)),o=r.bidiSpans(s),g=$.cursor(t?s.from:s.to)}if(f){if(!f(p))return h}else{if(!n)return g;f=n(p)}h=g}}function ld(r,e,t){let n=r.state.charCategorizer(e),s=n(t);return o=>{let l=n(o);return s==ot.Space&&(s=l),s==l}}function ad(r,e,t,n){let s=e.head,o=t?1:-1;if(s==(t?r.state.doc.length:0))return $.cursor(s,e.assoc);let l=e.goalColumn,h,f=r.contentDOM.getBoundingClientRect(),g=r.coordsAtPos(s),p=r.documentTop;if(g)l==null&&(l=g.left-f.left),h=o<0?g.top:g.bottom;else{let C=r.viewState.lineBlockAt(s);l==null&&(l=Math.min(f.right-f.left,r.defaultCharacterWidth*(s-C.from))),h=(o<0?C.top:C.bottom)+p}let v=f.left+l,w=n!=null?n:r.defaultLineHeight>>1;for(let C=0;;C+=10){let D=h+(w+C)*o,F=qh(r,{x:v,y:D},!1,o);if(D<f.top||D>f.bottom||(o<0?F<s:F>s))return $.cursor(F,e.assoc,void 0,l)}}function vs(r,e,t){let n=r.state.facet(Ih).map(s=>s(r));for(;;){let s=!1;for(let o of n)o.between(t.from-1,t.from+1,(l,h,f)=>{t.from>l&&t.from<h&&(t=e.head>t.from?$.cursor(l,1):$.cursor(h,-1),s=!0)});if(!s)return t}}class hd{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null;let t=(n,s)=>{this.ignoreDuringComposition(s)||s.type=="keydown"&&this.keydown(e,s)||(this.mustFlushObserver(s)&&e.observer.forceFlush(),this.runCustomHandlers(s.type,e,s)?s.preventDefault():n(e,s))};for(let n in Ge){let s=Ge[n];e.contentDOM.addEventListener(n,o=>{Xl(e,o)&&t(s,o)},io[n]),this.registeredEvents.push(n)}e.scrollDOM.addEventListener("mousedown",n=>{if(n.target==e.scrollDOM&&n.clientY>e.contentDOM.getBoundingClientRect().bottom&&(t(Ge.mousedown,n),!n.defaultPrevented&&n.button==2)){let s=e.contentDOM.style.minHeight;e.contentDOM.style.minHeight="100%",setTimeout(()=>e.contentDOM.style.minHeight=s,200)}}),e.scrollDOM.addEventListener("drop",n=>{n.target==e.scrollDOM&&n.clientY>e.contentDOM.getBoundingClientRect().bottom&&t(Ge.drop,n)}),Z.chrome&&Z.chrome_version==102&&e.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=e.hasFocus,Z.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,t){var n;let s;this.customHandlers=[];for(let o of t)if(s=(n=o.update(e).spec)===null||n===void 0?void 0:n.domEventHandlers){this.customHandlers.push({plugin:o.value,handlers:s});for(let l in s)this.registeredEvents.indexOf(l)<0&&l!="scroll"&&(this.registeredEvents.push(l),e.contentDOM.addEventListener(l,h=>{!Xl(e,h)||this.runCustomHandlers(l,e,h)&&h.preventDefault()}))}}runCustomHandlers(e,t,n){for(let s of this.customHandlers){let o=s.handlers[e];if(o)try{if(o.call(s.plugin,n,t)||n.defaultPrevented)return!0}catch(l){wi(t.state,l)}}return!1}runScrollHandlers(e,t){this.lastScrollTop=e.scrollDOM.scrollTop,this.lastScrollLeft=e.scrollDOM.scrollLeft;for(let n of this.customHandlers){let s=n.handlers.scroll;if(s)try{s.call(n.plugin,t,e)}catch(o){wi(e.state,o)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(t.keyCode!=27&&jh.indexOf(t.keyCode)<0&&(e.inputState.lastEscPress=0),Z.android&&Z.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let n;return Z.ios&&!t.synthetic&&!t.altKey&&!t.metaKey&&((n=Uh.find(s=>s.keyCode==t.keyCode))&&!t.ctrlKey||ud.indexOf(t.key)>-1&&t.ctrlKey&&!t.shiftKey)?(this.pendingIOSKey=n||t,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let t=this.pendingIOSKey;return t?(this.pendingIOSKey=void 0,Zi(e.contentDOM,t.key,t.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:Z.safari&&!Z.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Uh=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],ud="dthko",jh=[16,17,18,20,91,92,224,225],Yn=6;function Zn(r){return Math.max(0,r)*.7+8}class fd{constructor(e,t,n,s){this.view=e,this.style=n,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParent=Rc(e.contentDOM);let o=e.contentDOM.ownerDocument;o.addEventListener("mousemove",this.move=this.move.bind(this)),o.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(we.allowMultipleSelections)&&cd(e,t),this.dragMove=dd(e,t),this.dragging=pd(e,t)&&Xh(t)==1?null:!1}start(e){this.dragging===!1&&(e.preventDefault(),this.select(e))}move(e){var t;if(e.buttons==0)return this.destroy();if(this.dragging!==!1)return;this.select(this.lastEvent=e);let n=0,s=0,o=((t=this.scrollParent)===null||t===void 0?void 0:t.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},l=Hh(this.view);e.clientX-l.left<=o.left+Yn?n=-Zn(o.left-e.clientX):e.clientX+l.right>=o.right-Yn&&(n=Zn(e.clientX-o.right)),e.clientY-l.top<=o.top+Yn?s=-Zn(o.top-e.clientY):e.clientY+l.bottom>=o.bottom-Yn&&(s=Zn(e.clientY-o.bottom)),this.setScrollSpeed(n,s)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}select(e){let t=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:t,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function cd(r,e){let t=r.state.facet(Dh);return t.length?t[0](e):Z.mac?e.metaKey:e.ctrlKey}function dd(r,e){let t=r.state.facet(Oh);return t.length?t[0](e):Z.mac?!e.altKey:!e.ctrlKey}function pd(r,e){let{main:t}=r.state.selection;if(t.empty)return!1;let n=Sr(r.root);if(!n||n.rangeCount==0)return!0;let s=n.getRangeAt(0).getClientRects();for(let o=0;o<s.length;o++){let l=s[o];if(l.left<=e.clientX&&l.right>=e.clientX&&l.top<=e.clientY&&l.bottom>=e.clientY)return!0}return!1}function Xl(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,n;t!=r.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(n=Ee.get(t))&&n.ignoreEvent(e))return!1;return!0}const Ge=Object.create(null),io=Object.create(null),Jh=Z.ie&&Z.ie_version<15||Z.ios&&Z.webkit_version<604;function gd(r){let e=r.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{r.focus(),t.remove(),Gh(r,t.value)},50)}function Gh(r,e){let{state:t}=r,n,s=1,o=t.toText(e),l=o.lines==t.selection.ranges.length;if(no!=null&&t.selection.ranges.every(f=>f.empty)&&no==o.toString()){let f=-1;n=t.changeByRange(g=>{let p=t.doc.lineAt(g.from);if(p.from==f)return{range:g};f=p.from;let v=t.toText((l?o.line(s++).text:e)+t.lineBreak);return{changes:{from:p.from,insert:v},range:$.cursor(g.from+v.length)}})}else l?n=t.changeByRange(f=>{let g=o.line(s++);return{changes:{from:f.from,to:f.to,insert:g.text},range:$.cursor(f.from+g.length)}}):n=t.replaceSelection(o);r.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}Ge.keydown=(r,e)=>{r.inputState.setSelectionOrigin("select"),e.keyCode==27&&(r.inputState.lastEscPress=Date.now())};Ge.touchstart=(r,e)=>{r.inputState.lastTouchTime=Date.now(),r.inputState.setSelectionOrigin("select.pointer")};Ge.touchmove=r=>{r.inputState.setSelectionOrigin("select.pointer")};io.touchstart=io.touchmove={passive:!0};Ge.mousedown=(r,e)=>{if(r.observer.flush(),r.inputState.lastTouchTime>Date.now()-2e3)return;let t=null;for(let n of r.state.facet(Th))if(t=n(r,e),t)break;if(!t&&e.button==0&&(t=vd(r,e)),t){let n=r.root.activeElement!=r.contentDOM;r.inputState.startMouseSelection(new fd(r,e,t,n)),n&&r.observer.ignore(()=>ch(r.contentDOM)),r.inputState.mouseSelection&&r.inputState.mouseSelection.start(e)}};function Yl(r,e,t,n){if(n==1)return $.cursor(e,t);if(n==2)return td(r.state,e,t);{let s=wt.find(r.docView,e),o=r.state.doc.lineAt(s?s.posAtEnd:e),l=s?s.posAtStart:o.from,h=s?s.posAtEnd:o.to;return h<r.state.doc.length&&h==o.to&&h++,$.range(l,h)}}let Qh=(r,e)=>r>=e.top&&r<=e.bottom,Zl=(r,e,t)=>Qh(e,t)&&r>=t.left&&r<=t.right;function md(r,e,t,n){let s=wt.find(r.docView,e);if(!s)return 1;let o=e-s.posAtStart;if(o==0)return 1;if(o==s.length)return-1;let l=s.coordsAt(o,-1);if(l&&Zl(t,n,l))return-1;let h=s.coordsAt(o,1);return h&&Zl(t,n,h)?1:l&&Qh(n,l)?-1:1}function ea(r,e){let t=r.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:md(r,t,e.clientX,e.clientY)}}const yd=Z.ie&&Z.ie_version<=11;let ta=null,ia=0,na=0;function Xh(r){if(!yd)return r.detail;let e=ta,t=na;return ta=r,na=Date.now(),ia=!e||t>Date.now()-400&&Math.abs(e.clientX-r.clientX)<2&&Math.abs(e.clientY-r.clientY)<2?(ia+1)%3:1}function vd(r,e){let t=ea(r,e),n=Xh(e),s=r.state.selection;return{update(o){o.docChanged&&(t.pos=o.changes.mapPos(t.pos),s=s.map(o.changes))},get(o,l,h){let f=ea(r,o),g,p=Yl(r,f.pos,f.bias,n);if(t.pos!=f.pos&&!l){let v=Yl(r,t.pos,t.bias,n),w=Math.min(v.from,p.from),C=Math.max(v.to,p.to);p=w<p.from?$.range(w,C):$.range(C,w)}return l?s.replaceRange(s.main.extend(p.from,p.to)):h&&n==1&&s.ranges.length>1&&(g=xd(s,f.pos))?g:h?s.addRange(p):$.create([p])}}}function xd(r,e){for(let t=0;t<r.ranges.length;t++){let{from:n,to:s}=r.ranges[t];if(n<=e&&s>=e)return $.create(r.ranges.slice(0,t).concat(r.ranges.slice(t+1)),r.mainIndex==t?0:r.mainIndex-(r.mainIndex>t?1:0))}return null}Ge.dragstart=(r,e)=>{let{selection:{main:t}}=r.state,{mouseSelection:n}=r.inputState;n&&(n.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",r.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove")};function ra(r,e,t,n){if(!t)return;let s=r.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:o}=r.inputState,l=n&&o&&o.dragging&&o.dragMove?{from:o.dragging.from,to:o.dragging.to}:null,h={from:s,insert:t},f=r.state.changes(l?[l,h]:h);r.focus(),r.dispatch({changes:f,selection:{anchor:f.mapPos(s,-1),head:f.mapPos(s,1)},userEvent:l?"move.drop":"input.drop"})}Ge.drop=(r,e)=>{if(!e.dataTransfer)return;if(r.state.readOnly)return e.preventDefault();let t=e.dataTransfer.files;if(t&&t.length){e.preventDefault();let n=Array(t.length),s=0,o=()=>{++s==t.length&&ra(r,e,n.filter(l=>l!=null).join(r.state.lineBreak),!1)};for(let l=0;l<t.length;l++){let h=new FileReader;h.onerror=o,h.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(h.result)||(n[l]=h.result),o()},h.readAsText(t[l])}}else ra(r,e,e.dataTransfer.getData("Text"),!0)};Ge.paste=(r,e)=>{if(r.state.readOnly)return e.preventDefault();r.observer.flush();let t=Jh?null:e.clipboardData;t?(Gh(r,t.getData("text/plain")||t.getData("text/uri-text")),e.preventDefault()):gd(r)};function wd(r,e){let t=r.dom.parentNode;if(!t)return;let n=t.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout(()=>{n.remove(),r.focus()},50)}function bd(r){let e=[],t=[],n=!1;for(let s of r.selection.ranges)s.empty||(e.push(r.sliceDoc(s.from,s.to)),t.push(s));if(!e.length){let s=-1;for(let{from:o}of r.selection.ranges){let l=r.doc.lineAt(o);l.number>s&&(e.push(l.text),t.push({from:l.from,to:Math.min(r.doc.length,l.to+1)})),s=l.number}n=!0}return{text:e.join(r.lineBreak),ranges:t,linewise:n}}let no=null;Ge.copy=Ge.cut=(r,e)=>{let{text:t,ranges:n,linewise:s}=bd(r.state);if(!t&&!s)return;no=s?t:null;let o=Jh?null:e.clipboardData;o?(e.preventDefault(),o.clearData(),o.setData("text/plain",t)):wd(r,t),e.type=="cut"&&!r.state.readOnly&&r.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})};const Yh=Ai.define();function Zh(r,e){let t=[];for(let n of r.facet(Bh)){let s=n(r,e);s&&t.push(s)}return t?r.update({effects:t,annotations:Yh.of(!0)}):null}function eu(r){setTimeout(()=>{let e=r.hasFocus;if(e!=r.inputState.notifiedFocused){let t=Zh(r.state,e);t?r.dispatch(t):r.update([])}},10)}Ge.focus=r=>{r.inputState.lastFocusTime=Date.now(),!r.scrollDOM.scrollTop&&(r.inputState.lastScrollTop||r.inputState.lastScrollLeft)&&(r.scrollDOM.scrollTop=r.inputState.lastScrollTop,r.scrollDOM.scrollLeft=r.inputState.lastScrollLeft),eu(r)};Ge.blur=r=>{r.observer.clearSelectionRange(),eu(r)};Ge.compositionstart=Ge.compositionupdate=r=>{r.inputState.compositionFirstChange==null&&(r.inputState.compositionFirstChange=!0),r.inputState.composing<0&&(r.inputState.composing=0)};Ge.compositionend=r=>{r.inputState.composing=-1,r.inputState.compositionEndedAt=Date.now(),r.inputState.compositionPendingKey=!0,r.inputState.compositionPendingChange=r.observer.pendingRecords().length>0,r.inputState.compositionFirstChange=null,Z.chrome&&Z.android?r.observer.flushSoon():r.inputState.compositionPendingChange?Promise.resolve().then(()=>r.observer.flush()):setTimeout(()=>{r.inputState.composing<0&&r.docView.compositionDeco.size&&r.update([])},50)};Ge.contextmenu=r=>{r.inputState.lastContextMenu=Date.now()};Ge.beforeinput=(r,e)=>{var t;let n;if(Z.chrome&&Z.android&&(n=Uh.find(s=>s.inputType==e.inputType))&&(r.observer.delayAndroidKey(n.key,n.keyCode),n.key=="Backspace"||n.key=="Delete")){let s=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>s+10&&r.hasFocus&&(r.contentDOM.blur(),r.focus())},100)}};const sa=["pre-wrap","normal","pre-line","break-spaces"];class kd{constructor(e){this.lineWrapping=e,this.doc=Ce.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let n=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(n+=Math.max(0,Math.ceil((t-e-n*this.lineLength*.5)/this.lineLength))),this.lineHeight*n}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return sa.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let n=0;n<e.length;n++){let s=e[n];s<0?n++:this.heightSamples[Math.floor(s*10)]||(t=!0,this.heightSamples[Math.floor(s*10)]=!0)}return t}refresh(e,t,n,s,o,l){let h=sa.indexOf(e)>-1,f=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=h;if(this.lineWrapping=h,this.lineHeight=t,this.charWidth=n,this.textHeight=s,this.lineLength=o,f){this.heightSamples={};for(let g=0;g<l.length;g++){let p=l[g];p<0?g++:this.heightSamples[Math.floor(p*10)]=!0}}return f}}class Cd{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class si{constructor(e,t,n,s,o,l){this.from=e,this.length=t,this.top=n,this.height=s,this.children=o,this.deco=l}get type(){var e,t,n;return(n=(e=this.children)!==null&&e!==void 0?e:(t=this.deco)===null||t===void 0?void 0:t.type)!==null&&n!==void 0?n:_e.Text}get widget(){return this.deco&&this.deco.widget}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(this.children||[this]).concat(e.children||[e]);return new si(this.from,this.length+e.length,this.top,this.height+e.height,t,null)}}var Ne=function(r){return r[r.ByPos=0]="ByPos",r[r.ByHeight=1]="ByHeight",r[r.ByPosNoHeight=2]="ByPosNoHeight",r}(Ne||(Ne={}));const mr=.001;class bt{constructor(e,t,n=2){this.length=e,this.height=t,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>mr&&(e.heightChanged=!0),this.height=t)}replace(e,t,n){return bt.of(n)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,n,s){let o=this,l=n.doc;for(let h=s.length-1;h>=0;h--){let{fromA:f,toA:g,fromB:p,toB:v}=s[h],w=o.lineAt(f,Ne.ByPosNoHeight,n.setDoc(t),0,0),C=w.to>=g?w:o.lineAt(g,Ne.ByPosNoHeight,n,0,0);for(v+=C.to-g,g=C.to;h>0&&w.from<=s[h-1].toA;)f=s[h-1].fromA,p=s[h-1].fromB,h--,f<w.from&&(w=o.lineAt(f,Ne.ByPosNoHeight,n,0,0));p+=w.from-f,f=w.from;let D=Eo.build(n.setDoc(l),e,p,v);o=o.replace(f,g,D)}return o.updateHeight(n,0)}static empty(){return new St(0,0)}static of(e){if(e.length==1)return e[0];let t=0,n=e.length,s=0,o=0;for(;;)if(t==n)if(s>o*2){let h=e[t-1];h.break?e.splice(--t,1,h.left,null,h.right):e.splice(--t,1,h.left,h.right),n+=1+h.break,s-=h.size}else if(o>s*2){let h=e[n];h.break?e.splice(n,1,h.left,null,h.right):e.splice(n,1,h.left,h.right),n+=2+h.break,o-=h.size}else break;else if(s<o){let h=e[t++];h&&(s+=h.size)}else{let h=e[--n];h&&(o+=h.size)}let l=0;return e[t-1]==null?(l=1,t--):e[t]==null&&(l=1,n++),new Sd(bt.of(e.slice(0,t)),l,bt.of(e.slice(n)))}}bt.prototype.size=1;class tu extends bt{constructor(e,t,n){super(e,t),this.deco=n}blockAt(e,t,n,s){return new si(s,this.length,n,this.height,null,this.deco)}lineAt(e,t,n,s,o){return this.blockAt(0,n,s,o)}forEachLine(e,t,n,s,o,l){e<=o+this.length&&t>=o&&l(this.blockAt(0,n,s,o))}updateHeight(e,t=0,n=!1,s){return s&&s.from<=t&&s.more&&this.setHeight(e,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class St extends tu{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0}replace(e,t,n){let s=n[0];return n.length==1&&(s instanceof St||s instanceof nt&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof nt?s=new St(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):bt.of(n)}updateHeight(e,t=0,n=!1,s){return s&&s.from<=t&&s.more?this.setHeight(e,s.heights[s.index++]):(n||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class nt extends bt{constructor(e){super(e,0)}heightMetrics(e,t){let n=e.doc.lineAt(t).number,s=e.doc.lineAt(t+this.length).number,o=s-n+1,l,h=0;if(e.lineWrapping){let f=Math.min(this.height,e.lineHeight*o);l=f/o,this.length>o+1&&(h=(this.height-f)/(this.length-o-1))}else l=this.height/o;return{firstLine:n,lastLine:s,perLine:l,perChar:h}}blockAt(e,t,n,s){let{firstLine:o,lastLine:l,perLine:h,perChar:f}=this.heightMetrics(t,s);if(t.lineWrapping){let g=s+Math.round(Math.max(0,Math.min(1,(e-n)/this.height))*this.length),p=t.doc.lineAt(g),v=h+p.length*f,w=Math.max(n,e-v/2);return new si(p.from,p.length,w,v,null,null)}else{let g=Math.max(0,Math.min(l-o,Math.floor((e-n)/h))),{from:p,length:v}=t.doc.line(o+g);return new si(p,v,n+h*g,h,null,null)}}lineAt(e,t,n,s,o){if(t==Ne.ByHeight)return this.blockAt(e,n,s,o);if(t==Ne.ByPosNoHeight){let{from:C,to:D}=n.doc.lineAt(e);return new si(C,D-C,0,0,null,null)}let{firstLine:l,perLine:h,perChar:f}=this.heightMetrics(n,o),g=n.doc.lineAt(e),p=h+g.length*f,v=g.number-l,w=s+h*v+f*(g.from-o-v);return new si(g.from,g.length,Math.max(s,Math.min(w,s+this.height-p)),p,null,null)}forEachLine(e,t,n,s,o,l){e=Math.max(e,o),t=Math.min(t,o+this.length);let{firstLine:h,perLine:f,perChar:g}=this.heightMetrics(n,o);for(let p=e,v=s;p<=t;){let w=n.doc.lineAt(p);if(p==e){let D=w.number-h;v+=f*D+g*(e-o-D)}let C=f+g*w.length;l(new si(w.from,w.length,v,C,null,null)),v+=C,p=w.to+1}}replace(e,t,n){let s=this.length-t;if(s>0){let o=n[n.length-1];o instanceof nt?n[n.length-1]=new nt(o.length+s):n.push(null,new nt(s-1))}if(e>0){let o=n[0];o instanceof nt?n[0]=new nt(e+o.length):n.unshift(new nt(e-1),null)}return bt.of(n)}decomposeLeft(e,t){t.push(new nt(e-1),null)}decomposeRight(e,t){t.push(null,new nt(this.length-e-1))}updateHeight(e,t=0,n=!1,s){let o=t+this.length;if(s&&s.from<=t+this.length&&s.more){let l=[],h=Math.max(t,s.from),f=-1;for(s.from>t&&l.push(new nt(s.from-t-1).updateHeight(e,t));h<=o&&s.more;){let p=e.doc.lineAt(h).length;l.length&&l.push(null);let v=s.heights[s.index++];f==-1?f=v:Math.abs(v-f)>=mr&&(f=-2);let w=new St(p,v);w.outdated=!1,l.push(w),h+=p+1}h<=o&&l.push(null,new nt(o-h).updateHeight(e,h));let g=bt.of(l);return(f<0||Math.abs(g.height-this.height)>=mr||Math.abs(f-this.heightMetrics(e,t).perLine)>=mr)&&(e.heightChanged=!0),g}else(n||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class Sd extends bt{constructor(e,t,n){super(e.length+t+n.length,e.height+n.height,t|(e.outdated||n.outdated?2:0)),this.left=e,this.right=n,this.size=e.size+n.size}get break(){return this.flags&1}blockAt(e,t,n,s){let o=n+this.left.height;return e<o?this.left.blockAt(e,t,n,s):this.right.blockAt(e,t,o,s+this.left.length+this.break)}lineAt(e,t,n,s,o){let l=s+this.left.height,h=o+this.left.length+this.break,f=t==Ne.ByHeight?e<l:e<h,g=f?this.left.lineAt(e,t,n,s,o):this.right.lineAt(e,t,n,l,h);if(this.break||(f?g.to<h:g.from>h))return g;let p=t==Ne.ByPosNoHeight?Ne.ByPosNoHeight:Ne.ByPos;return f?g.join(this.right.lineAt(h,p,n,l,h)):this.left.lineAt(h,p,n,s,o).join(g)}forEachLine(e,t,n,s,o,l){let h=s+this.left.height,f=o+this.left.length+this.break;if(this.break)e<f&&this.left.forEachLine(e,t,n,s,o,l),t>=f&&this.right.forEachLine(e,t,n,h,f,l);else{let g=this.lineAt(f,Ne.ByPos,n,s,o);e<g.from&&this.left.forEachLine(e,g.from-1,n,s,o,l),g.to>=e&&g.from<=t&&l(g),t>g.to&&this.right.forEachLine(g.to+1,t,n,h,f,l)}}replace(e,t,n){let s=this.left.length+this.break;if(t<s)return this.balanced(this.left.replace(e,t,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,t-s,n));let o=[];e>0&&this.decomposeLeft(e,o);let l=o.length;for(let h of n)o.push(h);if(e>0&&oa(o,l-1),t<this.length){let h=o.length;this.decomposeRight(t,o),oa(o,h)}return bt.of(o)}decomposeLeft(e,t){let n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(n++,e>=n&&t.push(null)),e>n&&this.right.decomposeLeft(e-n,t)}decomposeRight(e,t){let n=this.left.length,s=n+this.break;if(e>=s)return this.right.decomposeRight(e-s,t);e<n&&this.left.decomposeRight(e,t),this.break&&e<s&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?bt.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,n=!1,s){let{left:o,right:l}=this,h=t+o.length+this.break,f=null;return s&&s.from<=t+o.length&&s.more?f=o=o.updateHeight(e,t,n,s):o.updateHeight(e,t,n),s&&s.from<=h+l.length&&s.more?f=l=l.updateHeight(e,h,n,s):l.updateHeight(e,h,n),f?this.balanced(o,l):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function oa(r,e){let t,n;r[e]==null&&(t=r[e-1])instanceof nt&&(n=r[e+1])instanceof nt&&r.splice(e-1,3,new nt(t.length+1+n.length))}const Ad=5;class Eo{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let n=Math.min(t,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof St?s.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new St(n-this.pos,-1)),this.writtenTo=n,t>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,n){if(e<t||n.heightRelevant){let s=n.widget?n.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let o=t-e;n.block?this.addBlock(new tu(o,s,n)):(o||s>=Ad)&&this.addLineDeco(s,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new St(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let n=new nt(t-e);return this.oracle.doc.lineAt(e).to==t&&(n.flags|=4),n}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof St)return e;let t=new St(0,-1);return this.nodes.push(t),t}addBlock(e){var t;this.enterLine();let n=(t=e.deco)===null||t===void 0?void 0:t.type;n==_e.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,n!=_e.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let n=this.ensureLine();n.length+=t,n.collapsed+=t,n.widgetHeight=Math.max(n.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof St)&&!this.isCovered?this.nodes.push(new St(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=e;for(let s of this.nodes)s instanceof St&&s.updateHeight(this.oracle,n),n+=s?s.length:1;return this.nodes}static build(e,t,n,s){let o=new Eo(n,e);return Ie.spans(t,n,s,o,0),o.finish(n)}}function Md(r,e,t){let n=new Dd;return Ie.compare(r,e,t,n,0),n.changes}class Dd{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,n,s){(e<t||n&&n.heightRelevant||s&&s.heightRelevant)&&Xs(e,t,this.changes,5)}}function Od(r,e){let t=r.getBoundingClientRect(),n=r.ownerDocument,s=n.defaultView||window,o=Math.max(0,t.left),l=Math.min(s.innerWidth,t.right),h=Math.max(0,t.top),f=Math.min(s.innerHeight,t.bottom);for(let g=r.parentNode;g&&g!=n.body;)if(g.nodeType==1){let p=g,v=window.getComputedStyle(p);if((p.scrollHeight>p.clientHeight||p.scrollWidth>p.clientWidth)&&v.overflow!="visible"){let w=p.getBoundingClientRect();o=Math.max(o,w.left),l=Math.min(l,w.right),h=Math.max(h,w.top),f=g==r.parentNode?w.bottom:Math.min(f,w.bottom)}g=v.position=="absolute"||v.position=="fixed"?p.offsetParent:p.parentNode}else if(g.nodeType==11)g=g.host;else break;return{left:o-t.left,right:Math.max(o,l)-t.left,top:h-(t.top+e),bottom:Math.max(h,f)-(t.top+e)}}function Td(r,e){let t=r.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class xs{constructor(e,t,n){this.from=e,this.to=t,this.size=n}static same(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++){let s=e[n],o=t[n];if(s.from!=o.from||s.to!=o.to||s.size!=o.size)return!1}return!0}draw(e){return ve.replace({widget:new Ld(this.size,e)}).range(this.from,this.to)}}class Ld extends ai{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class la{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scaler=aa,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=je.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Lo).some(n=>typeof n!="function"&&n.class=="cm-lineWrapping");this.heightOracle=new kd(t),this.stateDeco=e.facet(Nn).filter(n=>typeof n!="function"),this.heightMap=bt.empty().applyChanges(this.stateDeco,Ce.empty,this.heightOracle.setDoc(e.doc),[new Yt(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ve.set(this.lineGaps.map(n=>n.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let n=0;n<=1;n++){let s=n?t.head:t.anchor;if(!e.some(({from:o,to:l})=>s>=o&&s<=l)){let{from:o,to:l}=this.lineBlockAt(s);e.push(new er(o,l))}}this.viewports=e.sort((n,s)=>n.from-s.from),this.scaler=this.heightMap.height<=7e6?aa:new Rd(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:Sn(e,this.scaler))})}update(e,t=null){this.state=e.state;let n=this.stateDeco;this.stateDeco=this.state.facet(Nn).filter(g=>typeof g!="function");let s=e.changedRanges,o=Yt.extendWithRanges(s,Md(n,this.stateDeco,e?e.changes:Ye.empty(this.state.doc.length))),l=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=l&&(e.flags|=2);let h=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<h.from||t.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,t));let f=!e.changes.empty||e.flags&2||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),f&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>2e3<<1)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(Nh)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,n=window.getComputedStyle(t),s=this.heightOracle,o=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?je.RTL:je.LTR;let l=this.heightOracle.mustRefreshForWrapping(o),h=t.getBoundingClientRect(),f=l||this.mustMeasureContent||this.contentDOMHeight!=h.height;this.contentDOMHeight=h.height,this.mustMeasureContent=!1;let g=0,p=0,v=parseInt(n.paddingTop)||0,w=parseInt(n.paddingBottom)||0;(this.paddingTop!=v||this.paddingBottom!=w)&&(this.paddingTop=v,this.paddingBottom=w,g|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(f=!0),this.editorWidth=e.scrollDOM.clientWidth,g|=8);let C=(this.printing?Td:Od)(t,this.paddingTop),D=C.top-this.pixelViewport.top,F=C.bottom-this.pixelViewport.bottom;this.pixelViewport=C;let E=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(E!=this.inView&&(this.inView=E,E&&(f=!0)),!this.inView&&!this.scrollTarget)return 0;let K=h.width;if((this.contentDOMWidth!=K||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=h.width,this.editorHeight=e.scrollDOM.clientHeight,g|=8),f){let te=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(te)&&(l=!0),l||s.lineWrapping&&Math.abs(K-this.contentDOMWidth)>s.charWidth){let{lineHeight:V,charWidth:Y,textHeight:Q}=e.docView.measureTextSize();l=V>0&&s.refresh(o,V,Y,Q,K/Y,te),l&&(e.docView.minWidth=0,g|=8)}D>0&&F>0?p=Math.max(D,F):D<0&&F<0&&(p=Math.min(D,F)),s.heightChanged=!1;for(let V of this.viewports){let Y=V.from==this.viewport.from?te:e.docView.measureVisibleLineHeights(V);this.heightMap=(l?bt.empty().applyChanges(this.stateDeco,Ce.empty,this.heightOracle,[new Yt(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,l,new Cd(V.from,Y))}s.heightChanged&&(g|=2)}let X=!this.viewportIsAppropriate(this.viewport,p)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return X&&(this.viewport=this.getViewport(p,this.scrollTarget)),this.updateForViewport(),(g&2||X)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>2e3<<1)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps,e)),g|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),g}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let n=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,o=this.heightOracle,{visibleTop:l,visibleBottom:h}=this,f=new er(s.lineAt(l-n*1e3,Ne.ByHeight,o,0,0).from,s.lineAt(h+(1-n)*1e3,Ne.ByHeight,o,0,0).to);if(t){let{head:g}=t.range;if(g<f.from||g>f.to){let p=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),v=s.lineAt(g,Ne.ByPos,o,0,0),w;t.y=="center"?w=(v.top+v.bottom)/2-p/2:t.y=="start"||t.y=="nearest"&&g<f.from?w=v.top:w=v.bottom-p,f=new er(s.lineAt(w-1e3/2,Ne.ByHeight,o,0,0).from,s.lineAt(w+p+1e3/2,Ne.ByHeight,o,0,0).to)}}return f}mapViewport(e,t){let n=t.mapPos(e.from,-1),s=t.mapPos(e.to,1);return new er(this.heightMap.lineAt(n,Ne.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,Ne.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},n=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,Ne.ByPos,this.heightOracle,0,0),{bottom:o}=this.heightMap.lineAt(t,Ne.ByPos,this.heightOracle,0,0),{visibleTop:l,visibleBottom:h}=this;return(e==0||s<=l-Math.max(10,Math.min(-n,250)))&&(t==this.state.doc.length||o>=h+Math.max(10,Math.min(n,250)))&&s>l-2*1e3&&o<h+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let n=[];for(let s of e)t.touchesRange(s.from,s.to)||n.push(new xs(t.mapPos(s.from),t.mapPos(s.to),s.size));return n}ensureLineGaps(e,t){let n=this.heightOracle.lineWrapping,s=n?1e4:2e3,o=s>>1,l=s<<1;if(this.defaultTextDirection!=je.LTR&&!n)return[];let h=[],f=(g,p,v,w)=>{if(p-g<o)return;let C=this.state.selection.main,D=[C.from];C.empty||D.push(C.to);for(let E of D)if(E>g&&E<p){f(g,E-10,v,w),f(E+10,p,v,w);return}let F=Bd(e,E=>E.from>=v.from&&E.to<=v.to&&Math.abs(E.from-g)<o&&Math.abs(E.to-p)<o&&!D.some(K=>E.from<K&&E.to>K));if(!F){if(p<v.to&&t&&n&&t.visibleRanges.some(E=>E.from<=p&&E.to>=p)){let E=t.moveToLineBoundary($.cursor(p),!1,!0).head;E>g&&(p=E)}F=new xs(g,p,this.gapSize(v,g,p,w))}h.push(F)};for(let g of this.viewportLines){if(g.length<l)continue;let p=Ed(g.from,g.to,this.stateDeco);if(p.total<l)continue;let v=this.scrollTarget?this.scrollTarget.range.head:null,w,C;if(n){let D=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,F,E;if(v!=null){let K=ir(p,v),X=((this.visibleBottom-this.visibleTop)/2+D)/g.height;F=K-X,E=K+X}else F=(this.visibleTop-g.top-D)/g.height,E=(this.visibleBottom-g.top+D)/g.height;w=tr(p,F),C=tr(p,E)}else{let D=p.total*this.heightOracle.charWidth,F=s*this.heightOracle.charWidth,E,K;if(v!=null){let X=ir(p,v),te=((this.pixelViewport.right-this.pixelViewport.left)/2+F)/D;E=X-te,K=X+te}else E=(this.pixelViewport.left-F)/D,K=(this.pixelViewport.right+F)/D;w=tr(p,E),C=tr(p,K)}w>g.from&&f(g.from,w,g,p),C<g.to&&f(C,g.to,g,p)}return h}gapSize(e,t,n,s){let o=ir(s,n)-ir(s,t);return this.heightOracle.lineWrapping?e.height*o:s.total*this.heightOracle.charWidth*o}updateLineGaps(e){xs.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ve.set(e.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];Ie.spans(e,this.viewport.from,this.viewport.to,{span(s,o){t.push({from:s,to:o})},point(){}},20);let n=t.length!=this.visibleRanges.length||this.visibleRanges.some((s,o)=>s.from!=t[o].from||s.to!=t[o].to);return this.visibleRanges=t,n?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Sn(this.heightMap.lineAt(e,Ne.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return Sn(this.heightMap.lineAt(this.scaler.fromDOM(e),Ne.ByHeight,this.heightOracle,0,0),this.scaler)}elementAtHeight(e){return Sn(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class er{constructor(e,t){this.from=e,this.to=t}}function Ed(r,e,t){let n=[],s=r,o=0;return Ie.spans(t,r,e,{span(){},point(l,h){l>s&&(n.push({from:s,to:l}),o+=l-s),s=h}},20),s<e&&(n.push({from:s,to:e}),o+=e-s),{total:o,ranges:n}}function tr({total:r,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let n=Math.floor(r*t);for(let s=0;;s++){let{from:o,to:l}=e[s],h=l-o;if(n<=h)return o+n;n-=h}}function ir(r,e){let t=0;for(let{from:n,to:s}of r.ranges){if(e<=s){t+=e-n;break}t+=s-n}return t/r.total}function Bd(r,e){for(let t of r)if(e(t))return t}const aa={toDOM(r){return r},fromDOM(r){return r},scale:1};class Rd{constructor(e,t,n){let s=0,o=0,l=0;this.viewports=n.map(({from:h,to:f})=>{let g=t.lineAt(h,Ne.ByPos,e,0,0).top,p=t.lineAt(f,Ne.ByPos,e,0,0).bottom;return s+=p-g,{from:h,to:f,top:g,bottom:p,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(t.height-s);for(let h of this.viewports)h.domTop=l+(h.top-o)*this.scale,l=h.domBottom=h.domTop+(h.bottom-h.top),o=h.bottom}toDOM(e){for(let t=0,n=0,s=0;;t++){let o=t<this.viewports.length?this.viewports[t]:null;if(!o||e<o.top)return s+(e-n)*this.scale;if(e<=o.bottom)return o.domTop+(e-o.top);n=o.bottom,s=o.domBottom}}fromDOM(e){for(let t=0,n=0,s=0;;t++){let o=t<this.viewports.length?this.viewports[t]:null;if(!o||e<o.domTop)return n+(e-s)/this.scale;if(e<=o.domBottom)return o.top+(e-o.domTop);n=o.bottom,s=o.domBottom}}}function Sn(r,e){if(e.scale==1)return r;let t=e.toDOM(r.top),n=e.toDOM(r.bottom);return new si(r.from,r.length,t,n-t,r.children&&r.children.map(s=>Sn(s,e)),r.deco)}const nr=re.define({combine:r=>r.join(" ")}),ro=re.define({combine:r=>r.indexOf(!0)>-1}),so=bi.newName(),iu=bi.newName(),nu=bi.newName(),ru={"&light":"."+iu,"&dark":"."+nu};function oo(r,e,t){return new bi(e,{finish(n){return/&/.test(n)?n.replace(/&\w*/,s=>{if(s=="&")return r;if(!t||!t[s])throw new RangeError(`Unsupported selector: ${s}`);return t[s]}):r+" "+n}})}const Nd=oo("."+so,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},ru);class Pd{constructor(e,t,n,s){this.typeOver=s,this.bounds=null,this.text="";let{impreciseHead:o,impreciseAnchor:l}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,n,0))){let h=o||l?[]:Fd(e),f=new zh(h,e.state);f.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=f.text,this.newSel=Hd(h,this.bounds.from)}else{let h=e.observer.selectionRange,f=o&&o.node==h.focusNode&&o.offset==h.focusOffset||!sn(e.contentDOM,h.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(h.focusNode,h.focusOffset),g=l&&l.node==h.anchorNode&&l.offset==h.anchorOffset||!sn(e.contentDOM,h.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(h.anchorNode,h.anchorOffset);this.newSel=$.single(g,f)}}}function su(r,e){let t,{newSel:n}=e,s=r.state.selection.main,o=r.inputState.lastKeyTime>Date.now()-100?r.inputState.lastKeyCode:-1;if(e.bounds){let{from:l,to:h}=e.bounds,f=s.from,g=null;(o===8||Z.android&&e.text.length<h-l)&&(f=s.to,g="end");let p=Id(r.state.doc.sliceString(l,h,Ji),e.text,f-l,g);p&&(Z.chrome&&o==13&&p.toB==p.from+2&&e.text.slice(p.from,p.toB)==Ji+Ji&&p.toB--,t={from:l+p.from,to:l+p.toA,insert:Ce.of(e.text.slice(p.from,p.toB).split(Ji))})}else n&&(!r.hasFocus&&r.state.facet(Gr)||n.main.eq(s))&&(n=null);if(!t&&!n)return!1;if(!t&&e.typeOver&&!s.empty&&n&&n.main.empty?t={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,s.to)}:t&&t.from>=s.from&&t.to<=s.to&&(t.from!=s.from||t.to!=s.to)&&s.to-s.from-(t.to-t.from)<=4?t={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,t.from).append(t.insert).append(r.state.doc.slice(t.to,s.to))}:(Z.mac||Z.android)&&t&&t.from==t.to&&t.from==s.head-1&&/^\. ?$/.test(t.insert.toString())&&r.contentDOM.getAttribute("autocorrect")=="off"?(n&&t.insert.length==2&&(n=$.single(n.main.anchor-1,n.main.head-1)),t={from:s.from,to:s.to,insert:Ce.of([" "])}):Z.chrome&&t&&t.from==t.to&&t.from==s.head&&t.insert.toString()==`
 `&&r.lineWrapping&&(n&&(n=$.single(n.main.anchor-1,n.main.head-1)),t={from:s.from,to:s.to,insert:Ce.of([" "])}),t){let l=r.state;if(Z.ios&&r.inputState.flushIOSKey(r)||Z.android&&(t.from==s.from&&t.to==s.to&&t.insert.length==1&&t.insert.lines==2&&Zi(r.contentDOM,"Enter",13)||(t.from==s.from-1&&t.to==s.to&&t.insert.length==0||o==8&&t.insert.length<t.to-t.from)&&Zi(r.contentDOM,"Backspace",8)||t.from==s.from&&t.to==s.to+1&&t.insert.length==0&&Zi(r.contentDOM,"Delete",46)))return!0;let h=t.insert.toString();if(r.state.facet(Eh).some(p=>p(r,t.from,t.to,h)))return!0;r.inputState.composing>=0&&r.inputState.composing++;let f;if(t.from>=s.from&&t.to<=s.to&&t.to-t.from>=(s.to-s.from)/3&&(!n||n.main.empty&&n.main.from==t.from+t.insert.length)&&r.inputState.composing<0){let p=s.from<t.from?l.sliceDoc(s.from,t.from):"",v=s.to>t.to?l.sliceDoc(t.to,s.to):"";f=l.replaceSelection(r.state.toText(p+t.insert.sliceString(0,void 0,r.state.lineBreak)+v))}else{let p=l.changes(t),v=n&&n.main.to<=p.newLength?n.main:void 0;if(l.selection.ranges.length>1&&r.inputState.composing>=0&&t.to<=s.to&&t.to>=s.to-10){let w=r.state.sliceDoc(t.from,t.to),C=$h(r)||r.state.doc.lineAt(s.head),D=s.to-t.to,F=s.to-s.from;f=l.changeByRange(E=>{if(E.from==s.from&&E.to==s.to)return{changes:p,range:v||E.map(p)};let K=E.to-D,X=K-w.length;if(E.to-E.from!=F||r.state.sliceDoc(X,K)!=w||C&&E.to>=C.from&&E.from<=C.to)return{range:E};let te=l.changes({from:X,to:K,insert:t.insert}),V=E.to-s.to;return{changes:te,range:v?$.range(Math.max(0,v.anchor+V),Math.max(0,v.head+V)):E.map(te)}})}else f={changes:p,selection:v&&l.selection.replaceRange(v)}}let g="input.type";return(r.composing||r.inputState.compositionPendingChange&&r.inputState.compositionEndedAt>Date.now()-50)&&(r.inputState.compositionPendingChange=!1,g+=".compose",r.inputState.compositionFirstChange&&(g+=".start",r.inputState.compositionFirstChange=!1)),r.dispatch(f,{scrollIntoView:!0,userEvent:g}),!0}else if(n&&!n.main.eq(s)){let l=!1,h="select";return r.inputState.lastSelectionTime>Date.now()-50&&(r.inputState.lastSelectionOrigin=="select"&&(l=!0),h=r.inputState.lastSelectionOrigin),r.dispatch({selection:n,scrollIntoView:l,userEvent:h}),!0}else return!1}function Id(r,e,t,n){let s=Math.min(r.length,e.length),o=0;for(;o<s&&r.charCodeAt(o)==e.charCodeAt(o);)o++;if(o==s&&r.length==e.length)return null;let l=r.length,h=e.length;for(;l>0&&h>0&&r.charCodeAt(l-1)==e.charCodeAt(h-1);)l--,h--;if(n=="end"){let f=Math.max(0,o-Math.min(l,h));t-=l+f-o}return l<o&&r.length<e.length?(o-=t<=o&&t>=l?o-t:0,h=o+(h-l),l=o):h<o&&(o-=t<=o&&t>=h?o-t:0,l=o+(l-h),h=o),{from:o,toA:l,toB:h}}function Fd(r){let e=[];if(r.root.activeElement!=r.contentDOM)return e;let{anchorNode:t,anchorOffset:n,focusNode:s,focusOffset:o}=r.observer.selectionRange;return t&&(e.push(new $l(t,n)),(s!=t||o!=n)&&e.push(new $l(s,o))),e}function Hd(r,e){if(r.length==0)return null;let t=r[0].pos,n=r.length==2?r[1].pos:t;return t>-1&&n>-1?$.single(t+e,n+e):null}const Vd={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},ws=Z.ie&&Z.ie_version<=11;class Wd{constructor(e){this.view=e,this.active=!1,this.selectionRange=new Nc,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.resizeContent=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let n of t)this.queue.push(n);(Z.ie&&Z.ie_version<=11||Z.ios&&e.composing)&&t.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),ws&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM),this.resizeContent=new ResizeObserver(()=>this.view.requestMeasure()),this.resizeContent.observe(e.contentDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runScrollHandlers(this.view,e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,n)=>t!=e[n]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,s=this.selectionRange;if(n.state.facet(Gr)?n.root.activeElement!=this.dom:!gr(n.dom,s))return;let o=s.anchorNode&&n.docView.nearest(s.anchorNode);if(o&&o.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(Z.ie&&Z.ie_version<=11||Z.android&&Z.chrome)&&!n.state.selection.main.empty&&s.focusNode&&Ar(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=Z.safari&&e.root.nodeType==11&&Lc(this.dom.ownerDocument)==this.dom&&Kd(this.view)||Sr(e.root);if(!t||this.selectionRange.eq(t))return!1;let n=gr(this.dom,t);return n&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&Ic(this.dom,t)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(t),n&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let n=this.dom;n;)if(n.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==n?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=t)n.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Vd),ws&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),ws&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var n;if(!this.delayedAndroidKey){let s=()=>{let o=this.delayedAndroidKey;o&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=o.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&o.force&&Zi(this.dom,o.key,o.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((n=this.delayedAndroidKey)===null||n===void 0)&&n.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,n=-1,s=!1;for(let o of e){let l=this.readMutation(o);!l||(l.typeOver&&(s=!0),t==-1?{from:t,to:n}=l:(t=Math.min(l.from,t),n=Math.max(l.to,n)))}return{from:t,to:n,typeOver:s}}readChange(){let{from:e,to:t,typeOver:n}=this.processRecords(),s=this.selectionChanged&&gr(this.dom,this.selectionRange);return e<0&&!s?null:(e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1,new Pd(this.view,e,t,n))}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return!1;let n=this.view.state,s=su(this.view,t);return this.view.state==n&&this.view.update([]),s}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.dirty|=4),e.type=="childList"){let n=ha(t,e.previousSibling||e.target.previousSibling,-1),s=ha(t,e.nextSibling||e.target.nextSibling,1);return{from:n?t.posAfter(n):t.posAtStart,to:s?t.posBefore(s):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,t,n,s;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(n=this.resizeScroll)===null||n===void 0||n.disconnect(),(s=this.resizeContent)===null||s===void 0||s.disconnect();for(let o of this.scrollTargets)o.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function ha(r,e,t){for(;e;){let n=Ee.get(e);if(n&&n.parent==r)return n;let s=e.parentNode;e=s!=r.dom?s:t>0?e.nextSibling:e.previousSibling}return null}function Kd(r){let e=null;function t(f){f.preventDefault(),f.stopImmediatePropagation(),e=f.getTargetRanges()[0]}if(r.contentDOM.addEventListener("beforeinput",t,!0),r.dom.ownerDocument.execCommand("indent"),r.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let n=e.startContainer,s=e.startOffset,o=e.endContainer,l=e.endOffset,h=r.docView.domAtPos(r.state.selection.main.anchor);return Ar(h.node,h.offset,o,l)&&([n,s,o,l]=[o,l,n,s]),{anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:l}}class se{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: fixed; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this._root=e.root||Pc(e.parent)||document,this.viewState=new la(e.state||we.create(e)),this.plugins=this.state.facet(kn).map(t=>new ms(t));for(let t of this.plugins)t.update(this);this.observer=new Wd(this),this.inputState=new hd(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new _l(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof Ze?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,n=!1,s,o=this.state;for(let w of e){if(w.startState!=o)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");o=w.state}if(this.destroyed){this.viewState.state=o;return}let l=this.hasFocus,h=0,f=null;e.some(w=>w.annotation(Yh))?(this.inputState.notifiedFocused=l,h=1):l!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=l,f=Zh(o,l),f||(h=1));let g=this.observer.delayedAndroidKey,p=null;if(g?(this.observer.clearDelayedAndroidKey(),p=this.observer.readChange(),(p&&!this.state.doc.eq(o.doc)||!this.state.selection.eq(o.selection))&&(p=null)):this.observer.clear(),o.facet(we.phrases)!=this.state.facet(we.phrases))return this.setState(o);s=Or.create(this,o,e),s.flags|=h;let v=this.viewState.scrollTarget;try{this.updateState=2;for(let w of e){if(v&&(v=v.map(w.changes)),w.scrollIntoView){let{main:C}=w.state.selection;v=new Dr(C.empty?C:$.cursor(C.head,C.head>C.anchor?-1:1))}for(let C of w.effects)C.is(Kl)&&(v=C.value)}this.viewState.update(s,v),this.bidiCache=Tr.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),t=this.docView.update(s),this.state.facet(Cn)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(w=>w.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(nr)!=s.state.facet(nr)&&(this.viewState.mustMeasureContent=!0),(t||n||v||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!s.empty)for(let w of this.state.facet(Ys))w(s);(f||p)&&Promise.resolve().then(()=>{f&&this.state==f.startState&&this.dispatch(f),p&&!su(this,p)&&g.force&&Zi(this.contentDOM,g.key,g.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new la(e),this.plugins=e.facet(kn).map(n=>new ms(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView=new _l(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(kn),n=e.state.facet(kn);if(t!=n){let s=[];for(let o of n){let l=t.indexOf(o);if(l<0)s.push(new ms(o));else{let h=this.plugins[l];h.mustUpdate=e,s.push(h)}}for(let o of this.plugins)o.mustUpdate!=e&&o.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,{scrollHeight:n,scrollTop:s,clientHeight:o}=this.scrollDOM,l=s>n-o-4?n:s;try{for(let h=0;;h++){this.updateState=1;let f=this.viewport,g=this.viewState.lineBlockAtHeight(l),p=this.viewState.measure(this);if(!p&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(h>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let v=[];p&4||([this.measureRequests,v]=[v,this.measureRequests]);let w=v.map(E=>{try{return E.read(this)}catch(K){return wi(this.state,K),ua}}),C=Or.create(this,this.state,[]),D=!1,F=!1;C.flags|=p,t?t.flags|=p:t=C,this.updateState=2,C.empty||(this.updatePlugins(C),this.inputState.update(C),this.updateAttrs(),D=this.docView.update(C));for(let E=0;E<v.length;E++)if(w[E]!=ua)try{let K=v[E];K.write&&K.write(w[E],this)}catch(K){wi(this.state,K)}if(this.viewState.editorHeight)if(this.viewState.scrollTarget)this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,F=!0;else{let E=this.viewState.lineBlockAt(g.from).top-g.top;(E>1||E<-1)&&(this.scrollDOM.scrollTop+=E,F=!0)}if(D&&this.docView.updateSelection(!0),this.viewport.from==f.from&&this.viewport.to==f.to&&!F&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let h of this.state.facet(Ys))h(t)}get themeClasses(){return so+" "+(this.state.facet(ro)?nu:iu)+" "+this.state.facet(nr)}updateAttrs(){let e=fa(this,Ph,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Gr)?"true":"false",class:"cm-content",style:`${Z.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),fa(this,Lo,t);let n=this.observer.ignore(()=>{let s=Qs(this.contentDOM,this.contentAttrs,t),o=Qs(this.dom,this.editorAttrs,e);return s||o});return this.editorAttrs=e,this.contentAttrs=t,n}showAnnouncements(e){let t=!0;for(let n of e)for(let s of n.effects)if(s.is(se.announce)){t&&(this.announceDOM.textContent=""),t=!1;let o=this.announceDOM.appendChild(document.createElement("div"));o.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(Cn),bi.mount(this.root,this.styleModules.concat(Nd).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(n=>n.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,n){return vs(this,e,Ql(this,e,t,n))}moveByGroup(e,t){return vs(this,e,Ql(this,e,t,n=>ld(this,e.head,n)))}moveToLineBoundary(e,t,n=!0){return od(this,e,t,n)}moveVertically(e,t,n){return vs(this,e,ad(this,e,t,n))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),qh(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let n=this.docView.coordsAt(e,t);if(!n||n.left==n.right)return n;let s=this.state.doc.lineAt(e),o=this.bidiSpans(s),l=o[en.find(o,e-s.from,-1,t)];return Mo(n,l.dir==je.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Rh)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>zd)return Wh(e.length);let t=this.textDirectionAt(e.from);for(let s of this.bidiCache)if(s.from==e.from&&s.dir==t)return s.order;let n=Uc(e.text,t);return this.bidiCache.push(new Tr(e.from,e.to,t,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Z.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{ch(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Kl.of(new Dr(typeof e=="number"?$.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Mt.define(()=>({}),{eventHandlers:e})}static theme(e,t){let n=bi.newName(),s=[nr.of(n),Cn.of(oo(`.${n}`,e))];return t&&t.dark&&s.push(ro.of(!0)),s}static baseTheme(e){return Fn.lowest(Cn.of(oo("."+so,e,ru)))}static findFromDOM(e){var t;let n=e.querySelector(".cm-content"),s=n&&Ee.get(n)||Ee.get(e);return((t=s==null?void 0:s.rootView)===null||t===void 0?void 0:t.view)||null}}se.styleModule=Cn;se.inputHandler=Eh;se.focusChangeEffect=Bh;se.perLineTextDirection=Rh;se.exceptionSink=Lh;se.updateListener=Ys;se.editable=Gr;se.mouseSelectionStyle=Th;se.dragMovesSelection=Oh;se.clickAddsSelectionRange=Dh;se.decorations=Nn;se.atomicRanges=Ih;se.scrollMargins=Fh;se.darkTheme=ro;se.contentAttributes=Lo;se.editorAttributes=Ph;se.lineWrapping=se.contentAttributes.of({class:"cm-lineWrapping"});se.announce=Fe.define();const zd=4096,ua={};class Tr{constructor(e,t,n,s){this.from=e,this.to=t,this.dir=n,this.order=s}static update(e,t){if(t.empty)return e;let n=[],s=e.length?e[e.length-1].dir:je.LTR;for(let o=Math.max(0,e.length-10);o<e.length;o++){let l=e[o];l.dir==s&&!t.touchesRange(l.from,l.to)&&n.push(new Tr(t.mapPos(l.from,1),t.mapPos(l.to,-1),l.dir,l.order))}return n}}function fa(r,e,t){for(let n=r.state.facet(e),s=n.length-1;s>=0;s--){let o=n[s],l=typeof o=="function"?o(r):o;l&&Gs(l,t)}return t}const $d=Z.mac?"mac":Z.windows?"win":Z.linux?"linux":"key";function _d(r,e){const t=r.split(/-(?!$)/);let n=t[t.length-1];n=="Space"&&(n=" ");let s,o,l,h;for(let f=0;f<t.length-1;++f){const g=t[f];if(/^(cmd|meta|m)$/i.test(g))h=!0;else if(/^a(lt)?$/i.test(g))s=!0;else if(/^(c|ctrl|control)$/i.test(g))o=!0;else if(/^s(hift)?$/i.test(g))l=!0;else if(/^mod$/i.test(g))e=="mac"?h=!0:o=!0;else throw new Error("Unrecognized modifier name: "+g)}return s&&(n="Alt-"+n),o&&(n="Ctrl-"+n),h&&(n="Meta-"+n),l&&(n="Shift-"+n),n}function rr(r,e,t){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t!==!1&&e.shiftKey&&(r="Shift-"+r),r}const qd=Fn.default(se.domEventHandlers({keydown(r,e){return Gd(Ud(e.state),r,e,"editor")}})),Qr=re.define({enables:qd}),ca=new WeakMap;function Ud(r){let e=r.facet(Qr),t=ca.get(e);return t||ca.set(e,t=Jd(e.reduce((n,s)=>n.concat(s),[]))),t}let gi=null;const jd=4e3;function Jd(r,e=$d){let t=Object.create(null),n=Object.create(null),s=(l,h)=>{let f=n[l];if(f==null)n[l]=h;else if(f!=h)throw new Error("Key binding "+l+" is used both as a regular binding and as a multi-stroke prefix")},o=(l,h,f,g)=>{var p,v;let w=t[l]||(t[l]=Object.create(null)),C=h.split(/ (?!$)/).map(E=>_d(E,e));for(let E=1;E<C.length;E++){let K=C.slice(0,E).join(" ");s(K,!0),w[K]||(w[K]={preventDefault:!0,run:[X=>{let te=gi={view:X,prefix:K,scope:l};return setTimeout(()=>{gi==te&&(gi=null)},jd),!0}]})}let D=C.join(" ");s(D,!1);let F=w[D]||(w[D]={preventDefault:!1,run:((v=(p=w._any)===null||p===void 0?void 0:p.run)===null||v===void 0?void 0:v.slice())||[]});f&&F.run.push(f),g&&(F.preventDefault=!0)};for(let l of r){let h=l.scope?l.scope.split(" "):["editor"];if(l.any)for(let g of h){let p=t[g]||(t[g]=Object.create(null));p._any||(p._any={preventDefault:!1,run:[]});for(let v in p)p[v].run.push(l.any)}let f=l[e]||l.key;if(!!f)for(let g of h)o(g,f,l.run,l.preventDefault),l.shift&&o(g,"Shift-"+f,l.shift,l.preventDefault)}return t}function Gd(r,e,t,n){let s=Tc(e),o=Xi(s,0),l=br(o)==s.length&&s!=" ",h="",f=!1;gi&&gi.view==t&&gi.scope==n&&(h=gi.prefix+" ",(f=jh.indexOf(e.keyCode)<0)&&(gi=null));let g=new Set,p=D=>{if(D){for(let F of D.run)if(!g.has(F)&&(g.add(F),F(t,e)))return!0;D.preventDefault&&(f=!0)}return!1},v=r[n],w,C;if(v){if(p(v[h+rr(s,e,!l)]))return!0;if(l&&(e.altKey||e.metaKey||e.ctrlKey)&&!(Z.windows&&e.ctrlKey&&e.altKey)&&(w=ki[e.keyCode])&&w!=s){if(p(v[h+rr(w,e,!0)]))return!0;if(e.shiftKey&&(C=Bn[e.keyCode])!=s&&C!=w&&p(v[h+rr(C,e,!1)]))return!0}else if(l&&e.shiftKey&&p(v[h+rr(s,e,!0)]))return!0;if(p(v._any))return!0}return f}class Wn{constructor(e,t,n,s,o){this.className=e,this.left=t,this.top=n,this.width=s,this.height=o}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,n){if(n.empty){let s=e.coordsAtPos(n.head,n.assoc||1);if(!s)return[];let o=ou(e);return[new Wn(t,s.left-o.left,s.top-o.top,null,s.bottom-s.top)]}else return Qd(e,t,n)}}function ou(r){let e=r.scrollDOM.getBoundingClientRect();return{left:(r.textDirection==je.LTR?e.left:e.right-r.scrollDOM.clientWidth)-r.scrollDOM.scrollLeft,top:e.top-r.scrollDOM.scrollTop}}function da(r,e,t){let n=$.cursor(e);return{from:Math.max(t.from,r.moveToLineBoundary(n,!1,!0).from),to:Math.min(t.to,r.moveToLineBoundary(n,!0,!0).from),type:_e.Text}}function pa(r,e){let t=r.lineBlockAt(e);if(Array.isArray(t.type)){for(let n of t.type)if(n.to>e||n.to==e&&(n.to==t.to||n.type==_e.Text))return n}return t}function Qd(r,e,t){if(t.to<=r.viewport.from||t.from>=r.viewport.to)return[];let n=Math.max(t.from,r.viewport.from),s=Math.min(t.to,r.viewport.to),o=r.textDirection==je.LTR,l=r.contentDOM,h=l.getBoundingClientRect(),f=ou(r),g=l.querySelector(".cm-line"),p=g&&window.getComputedStyle(g),v=h.left+(p?parseInt(p.paddingLeft)+Math.min(0,parseInt(p.textIndent)):0),w=h.right-(p?parseInt(p.paddingRight):0),C=pa(r,n),D=pa(r,s),F=C.type==_e.Text?C:null,E=D.type==_e.Text?D:null;if(r.lineWrapping&&(F&&(F=da(r,n,F)),E&&(E=da(r,s,E))),F&&E&&F.from==E.from)return X(te(t.from,t.to,F));{let Y=F?te(t.from,null,F):V(C,!1),Q=E?te(null,t.to,E):V(D,!0),ne=[];return(F||C).to<(E||D).from-1?ne.push(K(v,Y.bottom,w,Q.top)):Y.bottom<Q.top&&r.elementAtHeight((Y.bottom+Q.top)/2).type==_e.Text&&(Y.bottom=Q.top=(Y.bottom+Q.top)/2),X(Y).concat(ne).concat(X(Q))}function K(Y,Q,ne,be){return new Wn(e,Y-f.left,Q-f.top-.01,ne-Y,be-Q+.01)}function X({top:Y,bottom:Q,horizontal:ne}){let be=[];for(let ae=0;ae<ne.length;ae+=2)be.push(K(ne[ae],Y,ne[ae+1],Q));return be}function te(Y,Q,ne){let be=1e9,ae=-1e9,O=[];function z(Te,ce,de,Se,Le){let fe=r.coordsAtPos(Te,Te==ne.to?-2:2),Ae=r.coordsAtPos(de,de==ne.from?2:-2);!fe||!Ae||(be=Math.min(fe.top,Ae.top,be),ae=Math.max(fe.bottom,Ae.bottom,ae),Le==je.LTR?O.push(o&&ce?v:fe.left,o&&Se?w:Ae.right):O.push(!o&&Se?v:Ae.left,!o&&ce?w:fe.right))}let me=Y!=null?Y:ne.from,Me=Q!=null?Q:ne.to;for(let Te of r.visibleRanges)if(Te.to>me&&Te.from<Me)for(let ce=Math.max(Te.from,me),de=Math.min(Te.to,Me);;){let Se=r.state.doc.lineAt(ce);for(let Le of r.bidiSpans(Se)){let fe=Le.from+Se.from,Ae=Le.to+Se.from;if(fe>=de)break;Ae>ce&&z(Math.max(fe,ce),Y==null&&fe<=me,Math.min(Ae,de),Q==null&&Ae>=Me,Le.dir)}if(ce=Se.to+1,ce>=de)break}return O.length==0&&z(me,Y==null,Me,Q==null,r.textDirection),{top:be,bottom:ae,horizontal:O}}function V(Y,Q){let ne=h.top+(Q?Y.top:Y.bottom);return{top:ne,bottom:ne,horizontal:[]}}}function Xd(r,e){return r.constructor==e.constructor&&r.eq(e)}class Yd{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(yr)!=e.state.facet(yr)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&e.view.requestMeasure(this.measureReq)}setOrder(e){let t=0,n=e.facet(yr);for(;t<n.length&&n[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}draw(e){if(e.length!=this.drawn.length||e.some((t,n)=>!Xd(t,this.drawn[n]))){let t=this.dom.firstChild,n=0;for(let s of e)s.update&&t&&s.constructor&&this.drawn[n].constructor&&s.update(t,this.drawn[n])?(t=t.nextSibling,n++):this.dom.insertBefore(s.draw(),t);for(;t;){let s=t.nextSibling;t.remove(),t=s}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const yr=re.define();function lu(r){return[Mt.define(e=>new Yd(e,r)),yr.of(r)]}const au=!Z.ios,Pn=re.define({combine(r){return Hn(r,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function Zd(r={}){return[Pn.of(r),ep,tp,ip,Nh.of(!0)]}function hu(r){return r.startState.facet(Pn)!=r.state.facet(Pn)}const ep=lu({above:!0,markers(r){let{state:e}=r,t=e.facet(Pn),n=[];for(let s of e.selection.ranges){let o=s==e.selection.main;if(s.empty?!o||au:t.drawRangeCursor){let l=o?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",h=s.empty?s:$.cursor(s.head,s.head>s.anchor?-1:1);for(let f of Wn.forRange(r,l,h))n.push(f)}}return n},update(r,e){r.transactions.some(n=>n.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let t=hu(r);return t&&ga(r.state,e),r.docChanged||r.selectionSet||t},mount(r,e){ga(e.state,r)},class:"cm-cursorLayer"});function ga(r,e){e.style.animationDuration=r.facet(Pn).cursorBlinkRate+"ms"}const tp=lu({above:!1,markers(r){return r.state.selection.ranges.map(e=>e.empty?[]:Wn.forRange(r,"cm-selectionBackground",e)).reduce((e,t)=>e.concat(t))},update(r,e){return r.docChanged||r.selectionSet||r.viewportChanged||hu(r)},class:"cm-selectionLayer"}),uu={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};au&&(uu[".cm-line"].caretColor="transparent !important");const ip=Fn.highest(se.theme(uu));function ma(r,e,t,n,s){e.lastIndex=0;for(let o=r.iterRange(t,n),l=t,h;!o.next().done;l+=o.value.length)if(!o.lineBreak)for(;h=e.exec(o.value);)s(l+h.index,h)}function np(r,e){let t=r.visibleRanges;if(t.length==1&&t[0].from==r.viewport.from&&t[0].to==r.viewport.to)return t;let n=[];for(let{from:s,to:o}of t)s=Math.max(r.state.doc.lineAt(s).from,s-e),o=Math.min(r.state.doc.lineAt(o).to,o+e),n.length&&n[n.length-1].to>=s?n[n.length-1].to=o:n.push({from:s,to:o});return n}class Bo{constructor(e){const{regexp:t,decoration:n,decorate:s,boundary:o,maxLength:l=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,s)this.addMatch=(h,f,g,p)=>s(p,g,g+h[0].length,h,f);else if(typeof n=="function")this.addMatch=(h,f,g,p)=>{let v=n(h,f,g);v&&p(g,g+h[0].length,v)};else if(n)this.addMatch=(h,f,g,p)=>p(g,g+h[0].length,n);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=o,this.maxLength=l}createDeco(e){let t=new Hi,n=t.add.bind(t);for(let{from:s,to:o}of np(e,this.maxLength))ma(e.state.doc,this.regexp,s,o,(l,h)=>this.addMatch(h,e,l,n));return t.finish()}updateDeco(e,t){let n=1e9,s=-1;return e.docChanged&&e.changes.iterChanges((o,l,h,f)=>{f>e.view.viewport.from&&h<e.view.viewport.to&&(n=Math.min(h,n),s=Math.max(f,s))}),e.viewportChanged||s-n>1e3?this.createDeco(e.view):s>-1?this.updateRange(e.view,t.map(e.changes),n,s):t}updateRange(e,t,n,s){for(let o of e.visibleRanges){let l=Math.max(o.from,n),h=Math.min(o.to,s);if(h>l){let f=e.state.doc.lineAt(l),g=f.to<h?e.state.doc.lineAt(h):f,p=Math.max(o.from,f.from),v=Math.min(o.to,g.to);if(this.boundary){for(;l>f.from;l--)if(this.boundary.test(f.text[l-1-f.from])){p=l;break}for(;h<g.to;h++)if(this.boundary.test(g.text[h-g.from])){v=h;break}}let w=[],C,D=(F,E,K)=>w.push(K.range(F,E));if(f==g)for(this.regexp.lastIndex=p-f.from;(C=this.regexp.exec(f.text))&&C.index<v-f.from;)this.addMatch(C,e,C.index+f.from,D);else ma(e.state.doc,this.regexp,p,v,(F,E)=>this.addMatch(E,e,F,D));t=t.update({filterFrom:p,filterTo:v,filter:(F,E)=>F<p||E>v,add:w})}}return t}}const lo=/x/.unicode!=null?"gu":"g",rp=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\u2066\u2067\u2069\uFEFF\uFFF9-\uFFFC]`,lo),sp={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let bs=null;function op(){var r;if(bs==null&&typeof document!="undefined"&&document.body){let e=document.body.style;bs=((r=e.tabSize)!==null&&r!==void 0?r:e.MozTabSize)!=null}return bs||!1}const vr=re.define({combine(r){let e=Hn(r,{render:null,specialChars:rp,addSpecialChars:null});return(e.replaceTabs=!op())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,lo)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,lo)),e}});function lp(r={}){return[vr.of(r),ap()]}let ya=null;function ap(){return ya||(ya=Mt.fromClass(class{constructor(r){this.view=r,this.decorations=ve.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(r.state.facet(vr)),this.decorations=this.decorator.createDeco(r)}makeDecorator(r){return new Bo({regexp:r.specialChars,decoration:(e,t,n)=>{let{doc:s}=t.state,o=Xi(e[0],0);if(o==9){let l=s.lineAt(n),h=t.state.tabSize,f=Ur(l.text,h,n-l.from);return ve.replace({widget:new cp((h-f%h)*this.view.defaultCharacterWidth)})}return this.decorationCache[o]||(this.decorationCache[o]=ve.replace({widget:new fp(r,o)}))},boundary:r.replaceTabs?void 0:/[^]/})}update(r){let e=r.state.facet(vr);r.startState.facet(vr)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(r.view)):this.decorations=this.decorator.updateDeco(r,this.decorations)}},{decorations:r=>r.decorations}))}const hp="\u2022";function up(r){return r>=32?hp:r==10?"\u2424":String.fromCharCode(9216+r)}class fp extends ai{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=up(this.code),n=e.state.phrase("Control character")+" "+(sp[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,n,t);if(s)return s;let o=document.createElement("span");return o.textContent=t,o.title=n,o.setAttribute("aria-label",n),o.className="cm-specialChar",o}ignoreEvent(){return!1}}class cp extends ai{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}const va=re.define({combine(r){let e,t;for(let n of r)e=e||n.topContainer,t=t||n.bottomContainer;return{topContainer:e,bottomContainer:t}}}),dp=Mt.fromClass(class{constructor(r){this.input=r.state.facet(Lr),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(r));let e=r.state.facet(va);this.top=new sr(r,!0,e.topContainer),this.bottom=new sr(r,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(r){let e=r.state.facet(va);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new sr(r.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new sr(r.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=r.state.facet(Lr);if(t!=this.input){let n=t.filter(f=>f),s=[],o=[],l=[],h=[];for(let f of n){let g=this.specs.indexOf(f),p;g<0?(p=f(r.view),h.push(p)):(p=this.panels[g],p.update&&p.update(r)),s.push(p),(p.top?o:l).push(p)}this.specs=n,this.panels=s,this.top.sync(o),this.bottom.sync(l);for(let f of h)f.dom.classList.add("cm-panel"),f.mount&&f.mount()}else for(let n of this.panels)n.update&&n.update(r)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:r=>se.scrollMargins.of(e=>{let t=e.plugin(r);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class sr{constructor(e,t,n){this.view=e,this.top=t,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=xa(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=xa(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function xa(r){let e=r.nextSibling;return r.remove(),e}const Lr=re.define({enables:dp});class Ki extends rn{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Ki.prototype.elementClass="";Ki.prototype.toDOM=void 0;Ki.prototype.mapMode=vt.TrackBefore;Ki.prototype.startSide=Ki.prototype.endSide=-1;Ki.prototype.point=!0;const ks=re.define(),xr=re.define(),ao=re.define({combine:r=>r.some(e=>e)});function pp(r){let e=[gp];return r&&r.fixed===!1&&e.push(ao.of(!0)),e}const gp=Mt.fromClass(class{constructor(r){this.view=r,this.prevViewport=r.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=r.state.facet(xr).map(e=>new ba(r,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!r.state.facet(ao),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),r.scrollDOM.insertBefore(this.dom,r.contentDOM)}update(r){if(this.updateGutters(r)){let e=this.prevViewport,t=r.view.viewport,n=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(n<(t.to-t.from)*.8)}r.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(ao)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=r.view.viewport}syncGutters(r){let e=this.dom.nextSibling;r&&this.dom.remove();let t=Ie.iter(this.view.state.facet(ks),this.view.viewport.from),n=[],s=this.gutters.map(o=>new mp(o,this.view.viewport,-this.view.documentPadding.top));for(let o of this.view.viewportLineBlocks)if(n.length&&(n=[]),Array.isArray(o.type)){let l=!0;for(let h of o.type)if(h.type==_e.Text&&l){ho(t,n,h.from);for(let f of s)f.line(this.view,h,n);l=!1}else if(h.widget)for(let f of s)f.widget(this.view,h)}else if(o.type==_e.Text){ho(t,n,o.from);for(let l of s)l.line(this.view,o,n)}for(let o of s)o.finish();r&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(r){let e=r.startState.facet(xr),t=r.state.facet(xr),n=r.docChanged||r.heightChanged||r.viewportChanged||!Ie.eq(r.startState.facet(ks),r.state.facet(ks),r.view.viewport.from,r.view.viewport.to);if(e==t)for(let s of this.gutters)s.update(r)&&(n=!0);else{n=!0;let s=[];for(let o of t){let l=e.indexOf(o);l<0?s.push(new ba(this.view,o)):(this.gutters[l].update(r),s.push(this.gutters[l]))}for(let o of this.gutters)o.dom.remove(),s.indexOf(o)<0&&o.destroy();for(let o of s)this.dom.appendChild(o.dom);this.gutters=s}return n}destroy(){for(let r of this.gutters)r.destroy();this.dom.remove()}},{provide:r=>se.scrollMargins.of(e=>{let t=e.plugin(r);return!t||t.gutters.length==0||!t.fixed?null:e.textDirection==je.LTR?{left:t.dom.offsetWidth}:{right:t.dom.offsetWidth}})});function wa(r){return Array.isArray(r)?r:[r]}function ho(r,e,t){for(;r.value&&r.from<=t;)r.from==t&&e.push(r.value),r.next()}class mp{constructor(e,t,n){this.gutter=e,this.height=n,this.i=0,this.cursor=Ie.iter(e.markers,t.from)}addElement(e,t,n){let{gutter:s}=this,o=t.top-this.height;if(this.i==s.elements.length){let l=new fu(e,t.height,o,n);s.elements.push(l),s.dom.appendChild(l.dom)}else s.elements[this.i].update(e,t.height,o,n);this.height=t.bottom,this.i++}line(e,t,n){let s=[];ho(this.cursor,s,t.from),n.length&&(s=s.concat(n));let o=this.gutter.config.lineMarker(e,t,s);o&&s.unshift(o);let l=this.gutter;s.length==0&&!l.config.renderEmptyElements||this.addElement(e,t,s)}widget(e,t){let n=this.gutter.config.widgetMarker(e,t.widget,t);n&&this.addElement(e,t,[n])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class ba{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in t.domEventHandlers)this.dom.addEventListener(n,s=>{let o=s.target,l;if(o!=this.dom&&this.dom.contains(o)){for(;o.parentNode!=this.dom;)o=o.parentNode;let f=o.getBoundingClientRect();l=(f.top+f.bottom)/2}else l=s.clientY;let h=e.lineBlockAtHeight(l-e.documentTop);t.domEventHandlers[n](e,h,s)&&s.preventDefault()});this.markers=wa(t.markers(e)),t.initialSpacer&&(this.spacer=new fu(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=wa(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],e);s!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[s])}let n=e.view.viewport;return!Ie.eq(this.markers,t,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class fu{constructor(e,t,n,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,n,s)}update(e,t,n,s){this.height!=t&&(this.dom.style.height=(this.height=t)+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),yp(this.markers,s)||this.setMarkers(e,s)}setMarkers(e,t){let n="cm-gutterElement",s=this.dom.firstChild;for(let o=0,l=0;;){let h=l,f=o<t.length?t[o++]:null,g=!1;if(f){let p=f.elementClass;p&&(n+=" "+p);for(let v=l;v<this.markers.length;v++)if(this.markers[v].compare(f)){h=v,g=!0;break}}else h=this.markers.length;for(;l<h;){let p=this.markers[l++];if(p.toDOM){p.destroy(s);let v=s.nextSibling;s.remove(),s=v}}if(!f)break;f.toDOM&&(g?s=s.nextSibling:this.dom.insertBefore(f.toDOM(e),s)),g&&l++}this.dom.className=n,this.markers=t}destroy(){this.setMarkers(null,[])}}function yp(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(!r[t].compare(e[t]))return!1;return!0}const vp=re.define(),Gi=re.define({combine(r){return Hn(r,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let n=Object.assign({},e);for(let s in t){let o=n[s],l=t[s];n[s]=o?(h,f,g)=>o(h,f,g)||l(h,f,g):l}return n}})}});class Cs extends Ki{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function Ss(r,e){return r.state.facet(Gi).formatNumber(e,r.state)}const xp=xr.compute([Gi],r=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(vp)},lineMarker(e,t,n){return n.some(s=>s.toDOM)?null:new Cs(Ss(e,e.state.doc.lineAt(t.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(Gi)!=e.state.facet(Gi),initialSpacer(e){return new Cs(Ss(e,ka(e.state.doc.lines)))},updateSpacer(e,t){let n=Ss(t.view,ka(t.view.state.doc.lines));return n==e.number?e:new Cs(n)},domEventHandlers:r.facet(Gi).domEventHandlers}));function cu(r={}){return[Gi.of(r),pp(),xp]}function ka(r){let e=9;for(;e<r;)e=e*10+9;return e}const wp=1024;let bp=0;class As{constructor(e,t){this.from=e,this.to=t}}class pe{constructor(e={}){this.id=bp++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Et.match(e)),t=>{let n=e(t);return n===void 0?null:[this,n]}}}pe.closedBy=new pe({deserialize:r=>r.split(" ")});pe.openedBy=new pe({deserialize:r=>r.split(" ")});pe.group=new pe({deserialize:r=>r.split(" ")});pe.contextHash=new pe({perNode:!0});pe.lookAhead=new pe({perNode:!0});pe.mounted=new pe({perNode:!0});const kp=Object.create(null);class Et{constructor(e,t,n,s=0){this.name=e,this.props=t,this.id=n,this.flags=s}static define(e){let t=e.props&&e.props.length?Object.create(null):kp,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),s=new Et(e.name||"",t,e.id,n);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(s)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[o[0].id]=o[1]}}return s}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(pe.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let n in e)for(let s of n.split(" "))t[s]=e[n];return n=>{for(let s=n.prop(pe.group),o=-1;o<(s?s.length:0);o++){let l=t[o<0?n.name:s[o]];if(l)return l}}}}Et.none=new Et("",Object.create(null),0,8);const or=new WeakMap,Ca=new WeakMap;var ct;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(ct||(ct={}));class dt{constructor(e,t,n,s,o){if(this.type=e,this.children=t,this.positions=n,this.length=s,this.props=null,o&&o.length){this.props=Object.create(null);for(let[l,h]of o)this.props[typeof l=="number"?l:l.id]=h}}toString(){let e=this.prop(pe.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let n of this.children){let s=n.toString();s&&(t&&(t+=","),t+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Rr(this.topNode,e)}cursorAt(e,t=0,n=0){let s=or.get(this)||this.topNode,o=new Rr(s);return o.moveTo(e,t),or.set(this,o._tree),o}get topNode(){return new oi(this,0,0,null)}resolve(e,t=0){let n=an(or.get(this)||this.topNode,e,t,!1);return or.set(this,n),n}resolveInner(e,t=0){let n=an(Ca.get(this)||this.topNode,e,t,!0);return Ca.set(this,n),n}iterate(e){let{enter:t,leave:n,from:s=0,to:o=this.length}=e;for(let l=this.cursor((e.mode||0)|ct.IncludeAnonymous);;){let h=!1;if(l.from<=o&&l.to>=s&&(l.type.isAnonymous||t(l)!==!1)){if(l.firstChild())continue;h=!0}for(;h&&n&&!l.type.isAnonymous&&n(l),!l.nextSibling();){if(!l.parent())return;h=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Po(Et.none,this.children,this.positions,0,this.children.length,0,this.length,(t,n,s)=>new dt(this.type,t,n,s,this.propValues),e.makeTree||((t,n,s)=>new dt(Et.none,t,n,s)))}static build(e){return Sp(e)}}dt.empty=new dt(Et.none,[],[],0);class Ro{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Ro(this.buffer,this.index)}}class zi{constructor(e,t,n){this.buffer=e,this.length=t,this.set=n}get type(){return Et.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],n=this.buffer[e+3],s=this.set.types[t],o=s.name;if(/\W/.test(o)&&!s.isError&&(o=JSON.stringify(o)),e+=4,n==e)return o;let l=[];for(;e<n;)l.push(this.childString(e)),e=this.buffer[e+3];return o+"("+l.join(",")+")"}findChild(e,t,n,s,o){let{buffer:l}=this,h=-1;for(let f=e;f!=t&&!(du(o,s,l[f+1],l[f+2])&&(h=f,n>0));f=l[f+3]);return h}slice(e,t,n){let s=this.buffer,o=new Uint16Array(t-e),l=0;for(let h=e,f=0;h<t;){o[f++]=s[h++],o[f++]=s[h++]-n;let g=o[f++]=s[h++]-n;o[f++]=s[h++]-e,l=Math.max(l,g)}return new zi(o,l,this.set)}}function du(r,e,t,n){switch(r){case-2:return t<e;case-1:return n>=e&&t<e;case 0:return t<e&&n>e;case 1:return t<=e&&n>e;case 2:return n>e;case 4:return!0}}function pu(r,e){let t=r.childBefore(e);for(;t;){let n=t.lastChild;if(!n||n.to!=t.to)break;n.type.isError&&n.from==n.to?(r=t,t=n.prevSibling):t=n}return r}function an(r,e,t,n){for(var s;r.from==r.to||(t<1?r.from>=e:r.from>e)||(t>-1?r.to<=e:r.to<e);){let l=!n&&r instanceof oi&&r.index<0?null:r.parent;if(!l)return r;r=l}let o=n?0:ct.IgnoreOverlays;if(n)for(let l=r,h=l.parent;h;l=h,h=l.parent)l instanceof oi&&l.index<0&&((s=h.enter(e,t,o))===null||s===void 0?void 0:s.from)!=l.from&&(r=h);for(;;){let l=r.enter(e,t,o);if(!l)return r;r=l}}class oi{constructor(e,t,n,s){this._tree=e,this.from=t,this.index=n,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,n,s,o=0){for(let l=this;;){for(let{children:h,positions:f}=l._tree,g=t>0?h.length:-1;e!=g;e+=t){let p=h[e],v=f[e]+l.from;if(!!du(s,n,v,v+p.length)){if(p instanceof zi){if(o&ct.ExcludeBuffers)continue;let w=p.findChild(0,p.buffer.length,t,n-v,s);if(w>-1)return new vi(new Cp(l,p,e,v),null,w)}else if(o&ct.IncludeAnonymous||!p.type.isAnonymous||No(p)){let w;if(!(o&ct.IgnoreMounts)&&p.props&&(w=p.prop(pe.mounted))&&!w.overlay)return new oi(w.tree,v,e,l);let C=new oi(p,v,e,l);return o&ct.IncludeAnonymous||!C.type.isAnonymous?C:C.nextChild(t<0?p.children.length-1:0,t,n,s)}}}if(o&ct.IncludeAnonymous||!l.type.isAnonymous||(l.index>=0?e=l.index+t:e=t<0?-1:l._parent._tree.children.length,l=l._parent,!l))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,n=0){let s;if(!(n&ct.IgnoreOverlays)&&(s=this._tree.prop(pe.mounted))&&s.overlay){let o=e-this.from;for(let{from:l,to:h}of s.overlay)if((t>0?l<=o:l<o)&&(t<0?h>=o:h>o))return new oi(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,n)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new Rr(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return an(this,e,t,!1)}resolveInner(e,t=0){return an(this,e,t,!0)}enterUnfinishedNodesBefore(e){return pu(this,e)}getChild(e,t=null,n=null){let s=Er(this,e,t,n);return s.length?s[0]:null}getChildren(e,t=null,n=null){return Er(this,e,t,n)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return Br(this,e)}}function Er(r,e,t,n){let s=r.cursor(),o=[];if(!s.firstChild())return o;if(t!=null){for(;!s.type.is(t);)if(!s.nextSibling())return o}for(;;){if(n!=null&&s.type.is(n))return o;if(s.type.is(e)&&o.push(s.node),!s.nextSibling())return n==null?o:[]}}function Br(r,e,t=e.length-1){for(let n=r.parent;t>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(e[t]&&e[t]!=n.name)return!1;t--}}return!0}class Cp{constructor(e,t,n,s){this.parent=e,this.buffer=t,this.index=n,this.start=s}}class vi{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,n){this.context=e,this._parent=t,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}child(e,t,n){let{buffer:s}=this.context,o=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.context.start,n);return o<0?null:new vi(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,n=0){if(n&ct.ExcludeBuffers)return null;let{buffer:s}=this.context,o=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return o<0?null:new vi(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new vi(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new vi(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new Rr(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:n}=this.context,s=this.index+4,o=n.buffer[this.index+3];if(o>s){let l=n.buffer[this.index+1];e.push(n.slice(s,o,l)),t.push(0)}return new dt(this.type,e,t,this.to-this.from)}resolve(e,t=0){return an(this,e,t,!1)}resolveInner(e,t=0){return an(this,e,t,!0)}enterUnfinishedNodesBefore(e){return pu(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,n=null){let s=Er(this,e,t,n);return s.length?s[0]:null}getChildren(e,t=null,n=null){return Er(this,e,t,n)}get node(){return this}matchContext(e){return Br(this,e)}}class Rr{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof oi)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let n=e._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:n,buffer:s}=this.buffer;return this.type=t||s.set.types[s.buffer[e]],this.from=n+s.buffer[e+1],this.to=n+s.buffer[e+2],!0}yield(e){return e?e instanceof oi?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,n,this.mode));let{buffer:s}=this.buffer,o=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.buffer.start,n);return o<0?!1:(this.stack.push(this.index),this.yieldBuf(o))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,n=this.mode){return this.buffer?n&ct.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&ct.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&ct.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,n=this.stack.length-1;if(e<0){let s=n<0?0:this.stack[n]+4;if(this.index!=s)return this.yieldBuf(t.findChild(s,this.index,-1,0,4))}else{let s=t.buffer[this.index+3];if(s<(n<0?t.buffer.length:t.buffer[this.stack[n]+3]))return this.yieldBuf(s)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,n,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let o=0;o<this.index;o++)if(s.buffer.buffer[o+3]<this.index)return!1;({index:t,parent:n}=s)}else({index:t,_parent:n}=this._tree);for(;n;{index:t,_parent:n}=n)if(t>-1)for(let o=t+e,l=e<0?-1:n._tree.children.length;o!=l;o+=e){let h=n._tree.children[o];if(this.mode&ct.IncludeAnonymous||h instanceof zi||!h.type.isAnonymous||No(h))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,n=0;if(e&&e.context==this.buffer){e:for(let s=this.index,o=this.stack.length;o>=0;){for(let l=e;l;l=l._parent)if(l.index==s){if(s==this.index)return l;t=l,n=o+1;break e}s=this.stack[--o]}}for(let s=n;s<this.stack.length;s++)t=new vi(this.buffer,t,this.stack[s]);return this.bufferNode=new vi(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let n=0;;){let s=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(s=!0)}for(;s&&t&&t(this),s=this.type.isAnonymous,!this.nextSibling();){if(!n)return;this.parent(),n--,s=!0}}}matchContext(e){if(!this.buffer)return Br(this.node,e);let{buffer:t}=this.buffer,{types:n}=t.set;for(let s=e.length-1,o=this.stack.length-1;s>=0;o--){if(o<0)return Br(this.node,e,s);let l=n[t.buffer[this.stack[o]]];if(!l.isAnonymous){if(e[s]&&e[s]!=l.name)return!1;s--}}return!0}}function No(r){return r.children.some(e=>e instanceof zi||!e.type.isAnonymous||No(e))}function Sp(r){var e;let{buffer:t,nodeSet:n,maxBufferLength:s=wp,reused:o=[],minRepeatType:l=n.types.length}=r,h=Array.isArray(t)?new Ro(t,t.length):t,f=n.types,g=0,p=0;function v(V,Y,Q,ne,be){let{id:ae,start:O,end:z,size:me}=h,Me=p;for(;me<0;)if(h.next(),me==-1){let Le=o[ae];Q.push(Le),ne.push(O-V);return}else if(me==-3){g=ae;return}else if(me==-4){p=ae;return}else throw new RangeError(`Unrecognized record size: ${me}`);let Te=f[ae],ce,de,Se=O-V;if(z-O<=s&&(de=F(h.pos-Y,be))){let Le=new Uint16Array(de.size-de.skip),fe=h.pos-de.size,Ae=Le.length;for(;h.pos>fe;)Ae=E(de.start,Le,Ae);ce=new zi(Le,z-de.start,n),Se=de.start-V}else{let Le=h.pos-me;h.next();let fe=[],Ae=[],at=ae>=l?ae:-1,et=0,We=z;for(;h.pos>Le;)at>=0&&h.id==at&&h.size>=0?(h.end<=We-s&&(C(fe,Ae,O,et,h.end,We,at,Me),et=fe.length,We=h.end),h.next()):v(O,Le,fe,Ae,at);if(at>=0&&et>0&&et<fe.length&&C(fe,Ae,O,et,O,We,at,Me),fe.reverse(),Ae.reverse(),at>-1&&et>0){let Di=w(Te);ce=Po(Te,fe,Ae,0,fe.length,0,z-O,Di,Di)}else ce=D(Te,fe,Ae,z-O,Me-z)}Q.push(ce),ne.push(Se)}function w(V){return(Y,Q,ne)=>{let be=0,ae=Y.length-1,O,z;if(ae>=0&&(O=Y[ae])instanceof dt){if(!ae&&O.type==V&&O.length==ne)return O;(z=O.prop(pe.lookAhead))&&(be=Q[ae]+O.length+z)}return D(V,Y,Q,ne,be)}}function C(V,Y,Q,ne,be,ae,O,z){let me=[],Me=[];for(;V.length>ne;)me.push(V.pop()),Me.push(Y.pop()+Q-be);V.push(D(n.types[O],me,Me,ae-be,z-ae)),Y.push(be-Q)}function D(V,Y,Q,ne,be=0,ae){if(g){let O=[pe.contextHash,g];ae=ae?[O].concat(ae):[O]}if(be>25){let O=[pe.lookAhead,be];ae=ae?[O].concat(ae):[O]}return new dt(V,Y,Q,ne,ae)}function F(V,Y){let Q=h.fork(),ne=0,be=0,ae=0,O=Q.end-s,z={size:0,start:0,skip:0};e:for(let me=Q.pos-V;Q.pos>me;){let Me=Q.size;if(Q.id==Y&&Me>=0){z.size=ne,z.start=be,z.skip=ae,ae+=4,ne+=4,Q.next();continue}let Te=Q.pos-Me;if(Me<0||Te<me||Q.start<O)break;let ce=Q.id>=l?4:0,de=Q.start;for(Q.next();Q.pos>Te;){if(Q.size<0)if(Q.size==-3)ce+=4;else break e;else Q.id>=l&&(ce+=4);Q.next()}be=de,ne+=Me,ae+=ce}return(Y<0||ne==V)&&(z.size=ne,z.start=be,z.skip=ae),z.size>4?z:void 0}function E(V,Y,Q){let{id:ne,start:be,end:ae,size:O}=h;if(h.next(),O>=0&&ne<l){let z=Q;if(O>4){let me=h.pos-(O-4);for(;h.pos>me;)Q=E(V,Y,Q)}Y[--Q]=z,Y[--Q]=ae-V,Y[--Q]=be-V,Y[--Q]=ne}else O==-3?g=ne:O==-4&&(p=ne);return Q}let K=[],X=[];for(;h.pos>0;)v(r.start||0,r.bufferStart||0,K,X,-1);let te=(e=r.length)!==null&&e!==void 0?e:K.length?X[0]+K[0].length:0;return new dt(f[r.topID],K.reverse(),X.reverse(),te)}const Sa=new WeakMap;function wr(r,e){if(!r.isAnonymous||e instanceof zi||e.type!=r)return 1;let t=Sa.get(e);if(t==null){t=1;for(let n of e.children){if(n.type!=r||!(n instanceof dt)){t=1;break}t+=wr(r,n)}Sa.set(e,t)}return t}function Po(r,e,t,n,s,o,l,h,f){let g=0;for(let D=n;D<s;D++)g+=wr(r,e[D]);let p=Math.ceil(g*1.5/8),v=[],w=[];function C(D,F,E,K,X){for(let te=E;te<K;){let V=te,Y=F[te],Q=wr(r,D[te]);for(te++;te<K;te++){let ne=wr(r,D[te]);if(Q+ne>=p)break;Q+=ne}if(te==V+1){if(Q>p){let ne=D[V];C(ne.children,ne.positions,0,ne.children.length,F[V]+X);continue}v.push(D[V])}else{let ne=F[te-1]+D[te-1].length-Y;v.push(Po(r,D,F,V,te,Y,ne,null,f))}w.push(Y+X-o)}}return C(e,t,n,s,0),(h||f)(v,w,l)}class Fi{constructor(e,t,n,s,o=!1,l=!1){this.from=e,this.to=t,this.tree=n,this.offset=s,this.open=(o?1:0)|(l?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],n=!1){let s=[new Fi(0,e.length,e,0,!1,n)];for(let o of t)o.to>e.length&&s.push(o);return s}static applyChanges(e,t,n=128){if(!t.length)return e;let s=[],o=1,l=e.length?e[0]:null;for(let h=0,f=0,g=0;;h++){let p=h<t.length?t[h]:null,v=p?p.fromA:1e9;if(v-f>=n)for(;l&&l.from<v;){let w=l;if(f>=w.from||v<=w.to||g){let C=Math.max(w.from,f)-g,D=Math.min(w.to,v)-g;w=C>=D?null:new Fi(C,D,w.tree,w.offset+g,h>0,!!p)}if(w&&s.push(w),l.to>v)break;l=o<e.length?e[o++]:null}if(!p)break;f=p.toA,g=p.toA-p.toB}return s}}class Ap{startParse(e,t,n){return typeof e=="string"&&(e=new Mp(e)),n=n?n.length?n.map(s=>new As(s.from,s.to)):[new As(0,0)]:[new As(0,e.length)],this.createParse(e,t||[],n)}parse(e,t,n){let s=this.startParse(e,t,n);for(;;){let o=s.advance();if(o)return o}}}class Mp{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new pe({perNode:!0});let Dp=0;class Jt{constructor(e,t,n){this.set=e,this.base=t,this.modified=n,this.id=Dp++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let t=new Jt([],null,[]);if(t.set.push(t),e)for(let n of e.set)t.set.push(n);return t}static defineModifier(){let e=new Nr;return t=>t.modified.indexOf(e)>-1?t:Nr.get(t.base||t,t.modified.concat(e).sort((n,s)=>n.id-s.id))}}let Op=0;class Nr{constructor(){this.instances=[],this.id=Op++}static get(e,t){if(!t.length)return e;let n=t[0].instances.find(h=>h.base==e&&Tp(t,h.modified));if(n)return n;let s=[],o=new Jt(s,e,t);for(let h of t)h.instances.push(o);let l=Lp(t);for(let h of e.set)if(!h.modified.length)for(let f of l)s.push(Nr.get(h,f));return o}}function Tp(r,e){return r.length==e.length&&r.every((t,n)=>t==e[n])}function Lp(r){let e=[[]];for(let t=0;t<r.length;t++)for(let n=0,s=e.length;n<s;n++)e.push(e[n].concat(r[t]));return e.sort((t,n)=>n.length-t.length)}function Ep(r){let e=Object.create(null);for(let t in r){let n=r[t];Array.isArray(n)||(n=[n]);for(let s of t.split(" "))if(s){let o=[],l=2,h=s;for(let v=0;;){if(h=="..."&&v>0&&v+3==s.length){l=1;break}let w=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(h);if(!w)throw new RangeError("Invalid path: "+s);if(o.push(w[0]=="*"?"":w[0][0]=='"'?JSON.parse(w[0]):w[0]),v+=w[0].length,v==s.length)break;let C=s[v++];if(v==s.length&&C=="!"){l=0;break}if(C!="/")throw new RangeError("Invalid path: "+s);h=s.slice(v)}let f=o.length-1,g=o[f];if(!g)throw new RangeError("Invalid path: "+s);let p=new Pr(n,l,f>0?o.slice(0,f):null);e[g]=p.sort(e[g])}}return gu.add(e)}const gu=new pe;class Pr{constructor(e,t,n,s){this.tags=e,this.mode=t,this.context=n,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Pr.empty=new Pr([],2,null);function mu(r,e){let t=Object.create(null);for(let o of r)if(!Array.isArray(o.tag))t[o.tag.id]=o.class;else for(let l of o.tag)t[l.id]=o.class;let{scope:n,all:s=null}=e||{};return{style:o=>{let l=s;for(let h of o)for(let f of h.set){let g=t[f.id];if(g){l=l?l+" "+g:g;break}}return l},scope:n}}function Bp(r,e){let t=null;for(let n of r){let s=n.style(e);s&&(t=t?t+" "+s:s)}return t}function Rp(r,e,t,n=0,s=r.length){let o=new Np(n,Array.isArray(e)?e:[e],t);o.highlightRange(r.cursor(),n,s,"",o.highlighters),o.flush(s)}class Np{constructor(e,t,n){this.at=e,this.highlighters=t,this.span=n,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,n,s,o){let{type:l,from:h,to:f}=e;if(h>=n||f<=t)return;l.isTop&&(o=this.highlighters.filter(C=>!C.scope||C.scope(l)));let g=s,p=Pp(e)||Pr.empty,v=Bp(o,p.tags);if(v&&(g&&(g+=" "),g+=v,p.mode==1&&(s+=(s?" ":"")+v)),this.startSpan(e.from,g),p.opaque)return;let w=e.tree&&e.tree.prop(pe.mounted);if(w&&w.overlay){let C=e.node.enter(w.overlay[0].from+h,1),D=this.highlighters.filter(E=>!E.scope||E.scope(w.tree.type)),F=e.firstChild();for(let E=0,K=h;;E++){let X=E<w.overlay.length?w.overlay[E]:null,te=X?X.from+h:f,V=Math.max(t,K),Y=Math.min(n,te);if(V<Y&&F)for(;e.from<Y&&(this.highlightRange(e,V,Y,s,o),this.startSpan(Math.min(Y,e.to),g),!(e.to>=te||!e.nextSibling())););if(!X||te>n)break;K=X.to+h,K>t&&(this.highlightRange(C.cursor(),Math.max(t,X.from+h),Math.min(n,K),s,D),this.startSpan(K,g))}F&&e.parent()}else if(e.firstChild()){do if(!(e.to<=t)){if(e.from>=n)break;this.highlightRange(e,t,n,s,o),this.startSpan(Math.min(n,e.to),g)}while(e.nextSibling());e.parent()}}}function Pp(r){let e=r.type.prop(gu);for(;e&&e.context&&!r.matchContext(e.context);)e=e.next;return e||null}const q=Jt.define,lr=q(),ci=q(),Aa=q(ci),Ma=q(ci),di=q(),ar=q(di),Ms=q(di),Ut=q(),Bi=q(Ut),_t=q(),qt=q(),uo=q(),xn=q(uo),hr=q(),J={comment:lr,lineComment:q(lr),blockComment:q(lr),docComment:q(lr),name:ci,variableName:q(ci),typeName:Aa,tagName:q(Aa),propertyName:Ma,attributeName:q(Ma),className:q(ci),labelName:q(ci),namespace:q(ci),macroName:q(ci),literal:di,string:ar,docString:q(ar),character:q(ar),attributeValue:q(ar),number:Ms,integer:q(Ms),float:q(Ms),bool:q(di),regexp:q(di),escape:q(di),color:q(di),url:q(di),keyword:_t,self:q(_t),null:q(_t),atom:q(_t),unit:q(_t),modifier:q(_t),operatorKeyword:q(_t),controlKeyword:q(_t),definitionKeyword:q(_t),moduleKeyword:q(_t),operator:qt,derefOperator:q(qt),arithmeticOperator:q(qt),logicOperator:q(qt),bitwiseOperator:q(qt),compareOperator:q(qt),updateOperator:q(qt),definitionOperator:q(qt),typeOperator:q(qt),controlOperator:q(qt),punctuation:uo,separator:q(uo),bracket:xn,angleBracket:q(xn),squareBracket:q(xn),paren:q(xn),brace:q(xn),content:Ut,heading:Bi,heading1:q(Bi),heading2:q(Bi),heading3:q(Bi),heading4:q(Bi),heading5:q(Bi),heading6:q(Bi),contentSeparator:q(Ut),list:q(Ut),quote:q(Ut),emphasis:q(Ut),strong:q(Ut),link:q(Ut),monospace:q(Ut),strikethrough:q(Ut),inserted:q(),deleted:q(),changed:q(),invalid:q(),meta:hr,documentMeta:q(hr),annotation:q(hr),processingInstruction:q(hr),definition:Jt.defineModifier(),constant:Jt.defineModifier(),function:Jt.defineModifier(),standard:Jt.defineModifier(),local:Jt.defineModifier(),special:Jt.defineModifier()};mu([{tag:J.link,class:"tok-link"},{tag:J.heading,class:"tok-heading"},{tag:J.emphasis,class:"tok-emphasis"},{tag:J.strong,class:"tok-strong"},{tag:J.keyword,class:"tok-keyword"},{tag:J.atom,class:"tok-atom"},{tag:J.bool,class:"tok-bool"},{tag:J.url,class:"tok-url"},{tag:J.labelName,class:"tok-labelName"},{tag:J.inserted,class:"tok-inserted"},{tag:J.deleted,class:"tok-deleted"},{tag:J.literal,class:"tok-literal"},{tag:J.string,class:"tok-string"},{tag:J.number,class:"tok-number"},{tag:[J.regexp,J.escape,J.special(J.string)],class:"tok-string2"},{tag:J.variableName,class:"tok-variableName"},{tag:J.local(J.variableName),class:"tok-variableName tok-local"},{tag:J.definition(J.variableName),class:"tok-variableName tok-definition"},{tag:J.special(J.variableName),class:"tok-variableName2"},{tag:J.definition(J.propertyName),class:"tok-propertyName tok-definition"},{tag:J.typeName,class:"tok-typeName"},{tag:J.namespace,class:"tok-namespace"},{tag:J.className,class:"tok-className"},{tag:J.macroName,class:"tok-macroName"},{tag:J.propertyName,class:"tok-propertyName"},{tag:J.operator,class:"tok-operator"},{tag:J.comment,class:"tok-comment"},{tag:J.meta,class:"tok-meta"},{tag:J.invalid,class:"tok-invalid"},{tag:J.punctuation,class:"tok-punctuation"}]);var Ds;const An=new pe,Ip=new pe;class Ht{constructor(e,t,n=[],s=""){this.data=e,this.name=s,we.prototype.hasOwnProperty("tree")||Object.defineProperty(we.prototype,"tree",{get(){return Vt(this)}}),this.parser=t,this.extension=[un.of(this),we.languageData.of((o,l,h)=>{let f=Da(o,l,h),g=f.type.prop(An);if(!g)return[];let p=o.facet(g),v=f.type.prop(Ip);if(v){let w=f.resolve(l-f.from,h);for(let C of v)if(C.test(w,o)){let D=o.facet(C.facet);return C.type=="replace"?D:D.concat(p)}}return p})].concat(n)}isActiveAt(e,t,n=-1){return Da(e,t,n).type.prop(An)==this.data}findRegions(e){let t=e.facet(un);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let n=[],s=(o,l)=>{if(o.prop(An)==this.data){n.push({from:l,to:l+o.length});return}let h=o.prop(pe.mounted);if(h){if(h.tree.prop(An)==this.data){if(h.overlay)for(let f of h.overlay)n.push({from:f.from+l,to:f.to+l});else n.push({from:l,to:l+o.length});return}else if(h.overlay){let f=n.length;if(s(h.tree,h.overlay[0].from+l),n.length>f)return}}for(let f=0;f<o.children.length;f++){let g=o.children[f];g instanceof dt&&s(g,o.positions[f]+l)}};return s(Vt(e),0),n}get allowsNesting(){return!0}}Ht.setState=Fe.define();function Da(r,e,t){let n=r.facet(un),s=Vt(r).topNode;if(!n||n.allowsNesting)for(let o=s;o;o=o.enter(e,t,ct.ExcludeBuffers))o.type.isTop&&(s=o);return s}function Vt(r){let e=r.field(Ht.state,!1);return e?e.tree:dt.empty}function yu(r,e,t=50){var n;let s=(n=r.field(Ht.state,!1))===null||n===void 0?void 0:n.context;if(!s)return null;let o=s.viewport;s.updateViewport({from:0,to:e});let l=s.isDone(e)||s.work(t,e)?s.tree:null;return s.updateViewport(o),l}class Fp{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let n=this.cursorPos-this.string.length;return e<n||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-n,t-n)}}let wn=null;class Ir{constructor(e,t,n=[],s,o,l,h,f){this.parser=e,this.state=t,this.fragments=n,this.tree=s,this.treeLen=o,this.viewport=l,this.skipped=h,this.scheduleOn=f,this.parse=null,this.tempSkipped=[]}static create(e,t,n){return new Ir(e,t,[],dt.empty,0,n,[],null)}startParse(){return this.parser.startParse(new Fp(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=dt.empty&&this.isDone(t!=null?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof e=="number"){let s=Date.now()+e;e=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(Fi.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(t!=null?t:this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Fi.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=wn;wn=this;try{return e()}finally{wn=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Oa(e,t.from,t.to);return e}changes(e,t){let{fragments:n,tree:s,treeLen:o,viewport:l,skipped:h}=this;if(this.takeTree(),!e.empty){let f=[];if(e.iterChangedRanges((g,p,v,w)=>f.push({fromA:g,toA:p,fromB:v,toB:w})),n=Fi.applyChanges(n,f),s=dt.empty,o=0,l={from:e.mapPos(l.from,-1),to:e.mapPos(l.to,1)},this.skipped.length){h=[];for(let g of this.skipped){let p=e.mapPos(g.from,1),v=e.mapPos(g.to,-1);p<v&&h.push({from:p,to:v})}}}return new Ir(this.parser,t,n,s,o,l,h,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:s,to:o}=this.skipped[n];s<e.to&&o>e.from&&(this.fragments=Oa(this.fragments,s,o),this.skipped.splice(n--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Ap{createParse(t,n,s){let o=s[0].from,l=s[s.length-1].to;return{parsedPos:o,advance(){let f=wn;if(f){for(let g of s)f.tempSkipped.push(g);e&&(f.scheduleOn=f.scheduleOn?Promise.all([f.scheduleOn,e]):e)}return this.parsedPos=l,new dt(Et.none,[],[],l-o)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return wn}}function Oa(r,e,t){return Fi.applyChanges(r,[{fromA:e,toA:t,fromB:e,toB:t}])}class hn{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),n=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,n)||t.takeTree(),new hn(t)}static init(e){let t=Math.min(3e3,e.doc.length),n=Ir.create(e.facet(un).parser,e,{from:0,to:t});return n.work(20,t)||n.takeTree(),new hn(n)}}Ht.state=Zt.define({create:hn.init,update(r,e){for(let t of e.effects)if(t.is(Ht.setState))return t.value;return e.startState.facet(un)!=e.state.facet(un)?hn.init(e.state):r.apply(e)}});let vu=r=>{let e=setTimeout(()=>r(),500);return()=>clearTimeout(e)};typeof requestIdleCallback!="undefined"&&(vu=r=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(r,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Os=typeof navigator!="undefined"&&((Ds=navigator.scheduling)===null||Ds===void 0?void 0:Ds.isInputPending)?()=>navigator.scheduling.isInputPending():null,Hp=Mt.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Ht.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Ht.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=vu(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:s}}=this.view,o=n.field(Ht.state);if(o.tree==o.context.tree&&o.context.isDone(s+1e5))return;let l=Date.now()+Math.min(this.chunkBudget,100,e&&!Os?Math.max(25,e.timeRemaining()-5):1e9),h=o.context.treeLen<s&&n.doc.length>s+1e3,f=o.context.work(()=>Os&&Os()||Date.now()>l,s+(h?0:1e5));this.chunkBudget-=Date.now()-t,(f||this.chunkBudget<=0)&&(o.context.takeTree(),this.view.dispatch({effects:Ht.setState.of(new hn(o.context))})),this.chunkBudget>0&&!(f&&!h)&&this.scheduleWork(),this.checkAsyncSchedule(o.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>wi(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),un=re.define({combine(r){return r.length?r[0]:null},enables:r=>[Ht.state,Hp,se.contentAttributes.compute([r],e=>{let t=e.facet(r);return t&&t.name?{"data-language":t.name}:{}})]}),Vp=re.define(),In=re.define({combine:r=>{if(!r.length)return"  ";let e=r[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(r[0]));return e}});function Fr(r){let e=r.facet(In);return e.charCodeAt(0)==9?r.tabSize*e.length:e.length}function Hr(r,e){let t="",n=r.tabSize,s=r.facet(In)[0];if(s=="	"){for(;e>=n;)t+="	",e-=n;s=" "}for(let o=0;o<e;o++)t+=s;return t}function xu(r,e){r instanceof we&&(r=new Xr(r));for(let n of r.state.facet(Vp)){let s=n(r,e);if(s!==void 0)return s}let t=Vt(r.state);return t?Kp(r,t,e):null}class Xr{constructor(e,t={}){this.state=e,this.options=t,this.unit=Fr(e)}lineAt(e,t=1){let n=this.state.doc.lineAt(e),{simulateBreak:s,simulateDoubleBreak:o}=this.options;return s!=null&&s>=n.from&&s<=n.to?o&&s==e?{text:"",from:e}:(t<0?s<e:s<=e)?{text:n.text.slice(s-n.from),from:s}:{text:n.text.slice(0,s-n.from),from:n.from}:n}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:n,from:s}=this.lineAt(e,t);return n.slice(e-s,Math.min(n.length,e+100-s))}column(e,t=1){let{text:n,from:s}=this.lineAt(e,t),o=this.countColumn(n,e-s),l=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return l>-1&&(o+=l-this.countColumn(n,n.search(/\S|$/))),o}countColumn(e,t=e.length){return Ur(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:n,from:s}=this.lineAt(e,t),o=this.options.overrideIndentation;if(o){let l=o(s);if(l>-1)return l}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Wp=new pe;function Kp(r,e,t){return wu(e.resolveInner(t).enterUnfinishedNodesBefore(t),t,r)}function zp(r){return r.pos==r.options.simulateBreak&&r.options.simulateDoubleBreak}function $p(r){let e=r.type.prop(Wp);if(e)return e;let t=r.firstChild,n;if(t&&(n=t.type.prop(pe.closedBy))){let s=r.lastChild,o=s&&n.indexOf(s.name)>-1;return l=>jp(l,!0,1,void 0,o&&!zp(l)?s.from:void 0)}return r.parent==null?_p:null}function wu(r,e,t){for(;r;r=r.parent){let n=$p(r);if(n)return n(Io.create(t,e,r))}return null}function _p(){return 0}class Io extends Xr{constructor(e,t,n){super(e.state,e.options),this.base=e,this.pos=t,this.node=n}static create(e,t,n){return new Io(e,t,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(qp(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?wu(e,this.pos,this.base):0}}function qp(r,e){for(let t=e;t;t=t.parent)if(r==t)return!0;return!1}function Up(r){let e=r.node,t=e.childAfter(e.from),n=e.lastChild;if(!t)return null;let s=r.options.simulateBreak,o=r.state.doc.lineAt(t.from),l=s==null||s<=o.from?o.to:Math.min(o.to,s);for(let h=t.to;;){let f=e.childAfter(h);if(!f||f==n)return null;if(!f.type.isSkipped)return f.from<l?t:null;h=f.to}}function jp(r,e,t,n,s){let o=r.textAfter,l=o.match(/^\s*/)[0].length,h=n&&o.slice(l,l+n.length)==n||s==r.pos+l,f=e?Up(r):null;return f?h?r.column(f.from):r.column(f.to):r.baseIndent+(h?0:r.unit*t)}const Jp=re.define(),Gp=new pe;function Qp(r,e,t){let n=Vt(r);if(n.length<t)return null;let s=n.resolveInner(t,1),o=null;for(let l=s;l;l=l.parent){if(l.to<=t||l.from>t)continue;if(o&&l.from<e)break;let h=l.type.prop(Gp);if(h&&(l.to<n.length-50||n.length==r.doc.length||!Xp(l))){let f=h(l,r);f&&f.from<=t&&f.from>=e&&f.to>t&&(o=f)}}return o}function Xp(r){let e=r.lastChild;return e&&e.to==r.to&&e.type.isError}function Yp(r,e,t){for(let n of r.facet(Jp)){let s=n(r,e,t);if(s)return s}return Qp(r,e,t)}function bu(r,e){let t=e.mapPos(r.from,1),n=e.mapPos(r.to,-1);return t>=n?void 0:{from:t,to:n}}const ku=Fe.define({map:bu}),Cu=Fe.define({map:bu});function Zp(r){let e=[];for(let{head:t}of r.state.selection.ranges)e.some(n=>n.from<=t&&n.to>=t)||e.push(r.lineBlockAt(t));return e}const Fo=Zt.define({create(){return ve.none},update(r,e){r=r.map(e.changes);for(let t of e.effects)t.is(ku)&&!tg(r,t.value.from,t.value.to)?r=r.update({add:[Ta.range(t.value.from,t.value.to)]}):t.is(Cu)&&(r=r.update({filter:(n,s)=>t.value.from!=n||t.value.to!=s,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:n}=e.selection.main;r.between(n,n,(s,o)=>{s<n&&o>n&&(t=!0)}),t&&(r=r.update({filterFrom:n,filterTo:n,filter:(s,o)=>o<=n||s>=n}))}return r},provide:r=>se.decorations.from(r),toJSON(r,e){let t=[];return r.between(0,e.doc.length,(n,s)=>{t.push(n,s)}),t},fromJSON(r){if(!Array.isArray(r)||r.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<r.length;){let n=r[t++],s=r[t++];if(typeof n!="number"||typeof s!="number")throw new RangeError("Invalid JSON for fold state");e.push(Ta.range(n,s))}return ve.set(e,!0)}});function eg(r,e,t){var n;let s=null;return(n=r.field(Fo,!1))===null||n===void 0||n.between(e,t,(o,l)=>{(!s||s.from>o)&&(s={from:o,to:l})}),s}function tg(r,e,t){let n=!1;return r.between(e,e,(s,o)=>{s==e&&o==t&&(n=!0)}),n}function ig(r,e){return r.field(Fo,!1)?e:e.concat(Fe.appendConfig.of(og()))}const ng=r=>{for(let e of Zp(r)){let t=Yp(r.state,e.from,e.to);if(t)return r.dispatch({effects:ig(r.state,[ku.of(t),rg(r,t)])}),!0}return!1};function rg(r,e,t=!0){let n=r.state.doc.lineAt(e.from).number,s=r.state.doc.lineAt(e.to).number;return se.announce.of(`${r.state.phrase(t?"Folded lines":"Unfolded lines")} ${n} ${r.state.phrase("to")} ${s}.`)}const sg={placeholderDOM:null,placeholderText:"\u2026"},Su=re.define({combine(r){return Hn(r,sg)}});function og(r){let e=[Fo,lg];return r&&e.push(Su.of(r)),e}const Ta=ve.replace({widget:new class extends ai{toDOM(r){let{state:e}=r,t=e.facet(Su),n=o=>{let l=r.lineBlockAt(r.posAtDOM(o.target)),h=eg(r.state,l.from,l.to);h&&r.dispatch({effects:Cu.of(h)}),o.preventDefault()};if(t.placeholderDOM)return t.placeholderDOM(r,n);let s=document.createElement("span");return s.textContent=t.placeholderText,s.setAttribute("aria-label",e.phrase("folded code")),s.title=e.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=n,s}}}),lg=se.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Yr{constructor(e,t){this.specs=e;let n;function s(h){let f=bi.newName();return(n||(n=Object.create(null)))["."+f]=h,f}const o=typeof t.all=="string"?t.all:t.all?s(t.all):void 0,l=t.scope;this.scope=l instanceof Ht?h=>h.prop(An)==l.data:l?h=>h==l:void 0,this.style=mu(e.map(h=>({tag:h.tag,class:h.class||s(Object.assign({},h,{tag:null}))})),{all:o}).style,this.module=n?new bi(n):null,this.themeType=t.themeType}static define(e,t){return new Yr(e,t||{})}}const fo=re.define(),Au=re.define({combine(r){return r.length?[r[0]]:null}});function Ts(r){let e=r.facet(fo);return e.length?e:r.facet(Au)}function ag(r,e){let t=[ug],n;return r instanceof Yr&&(r.module&&t.push(se.styleModule.of(r.module)),n=r.themeType),e!=null&&e.fallback?t.push(Au.of(r)):n?t.push(fo.computeN([se.darkTheme],s=>s.facet(se.darkTheme)==(n=="dark")?[r]:[])):t.push(fo.of(r)),t}class hg{constructor(e){this.markCache=Object.create(null),this.tree=Vt(e.state),this.decorations=this.buildDeco(e,Ts(e.state))}update(e){let t=Vt(e.state),n=Ts(e.state),s=n!=Ts(e.startState);t.length<e.view.viewport.to&&!s&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||s)&&(this.tree=t,this.decorations=this.buildDeco(e.view,n))}buildDeco(e,t){if(!t||!this.tree.length)return ve.none;let n=new Hi;for(let{from:s,to:o}of e.visibleRanges)Rp(this.tree,t,(l,h,f)=>{n.add(l,h,this.markCache[f]||(this.markCache[f]=ve.mark({class:f})))},s,o);return n.finish()}}const ug=Fn.high(Mt.fromClass(hg,{decorations:r=>r.decorations})),fg=Yr.define([{tag:J.meta,color:"#404740"},{tag:J.link,textDecoration:"underline"},{tag:J.heading,textDecoration:"underline",fontWeight:"bold"},{tag:J.emphasis,fontStyle:"italic"},{tag:J.strong,fontWeight:"bold"},{tag:J.strikethrough,textDecoration:"line-through"},{tag:J.keyword,color:"#708"},{tag:[J.atom,J.bool,J.url,J.contentSeparator,J.labelName],color:"#219"},{tag:[J.literal,J.inserted],color:"#164"},{tag:[J.string,J.deleted],color:"#a11"},{tag:[J.regexp,J.escape,J.special(J.string)],color:"#e40"},{tag:J.definition(J.variableName),color:"#00f"},{tag:J.local(J.variableName),color:"#30a"},{tag:[J.typeName,J.namespace],color:"#085"},{tag:J.className,color:"#167"},{tag:[J.special(J.variableName),J.macroName],color:"#256"},{tag:J.definition(J.propertyName),color:"#00c"},{tag:J.comment,color:"#940"},{tag:J.invalid,color:"#f00"}]),cg=1e4,dg="()[]{}",pg=new pe;function co(r,e,t){let n=r.prop(e<0?pe.openedBy:pe.closedBy);if(n)return n;if(r.name.length==1){let s=t.indexOf(r.name);if(s>-1&&s%2==(e<0?1:0))return[t[s+e]]}return null}function po(r){let e=r.type.prop(pg);return e?e(r.node):r}function xi(r,e,t,n={}){let s=n.maxScanDistance||cg,o=n.brackets||dg,l=Vt(r),h=l.resolveInner(e,t);for(let f=h;f;f=f.parent){let g=co(f.type,t,o);if(g&&f.from<f.to){let p=po(f);if(p&&(t>0?e>=p.from&&e<p.to:e>p.from&&e<=p.to))return gg(r,e,t,f,p,g,o)}}return mg(r,e,t,l,h.type,s,o)}function gg(r,e,t,n,s,o,l){let h=n.parent,f={from:s.from,to:s.to},g=0,p=h==null?void 0:h.cursor();if(p&&(t<0?p.childBefore(n.from):p.childAfter(n.to)))do if(t<0?p.to<=n.from:p.from>=n.to){if(g==0&&o.indexOf(p.type.name)>-1&&p.from<p.to){let v=po(p);return{start:f,end:v?{from:v.from,to:v.to}:void 0,matched:!0}}else if(co(p.type,t,l))g++;else if(co(p.type,-t,l)){if(g==0){let v=po(p);return{start:f,end:v&&v.from<v.to?{from:v.from,to:v.to}:void 0,matched:!1}}g--}}while(t<0?p.prevSibling():p.nextSibling());return{start:f,matched:!1}}function mg(r,e,t,n,s,o,l){let h=t<0?r.sliceDoc(e-1,e):r.sliceDoc(e,e+1),f=l.indexOf(h);if(f<0||f%2==0!=t>0)return null;let g={from:t<0?e-1:e,to:t>0?e+1:e},p=r.doc.iterRange(e,t>0?r.doc.length:0),v=0;for(let w=0;!p.next().done&&w<=o;){let C=p.value;t<0&&(w+=C.length);let D=e+w*t;for(let F=t>0?0:C.length-1,E=t>0?C.length:-1;F!=E;F+=t){let K=l.indexOf(C[F]);if(!(K<0||n.resolveInner(D+F,1).type!=s))if(K%2==0==t>0)v++;else{if(v==1)return{start:g,end:{from:D+F,to:D+F+1},matched:K>>1==f>>1};v--}}t>0&&(w+=C.length)}return p.done?{start:g,matched:!1}:null}function La(r,e,t,n=0,s=0){e==null&&(e=r.search(/[^\s\u00a0]/),e==-1&&(e=r.length));let o=s;for(let l=n;l<e;l++)r.charCodeAt(l)==9?o+=t-o%t:o++;return o}class yg{constructor(e,t,n,s){this.string=e,this.tabSize=t,this.indentUnit=n,this.overrideIndent=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t=this.string.charAt(this.pos),n;if(typeof e=="string"?n=t==e:n=t&&(e instanceof RegExp?e.test(t):e(t)),n)return++this.pos,t}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=La(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return(e=this.overrideIndent)!==null&&e!==void 0?e:La(this.string,null,this.tabSize)}match(e,t,n){if(typeof e=="string"){let s=l=>n?l.toLowerCase():l,o=this.string.substr(this.pos,e.length);return s(o)==s(e)?(t!==!1&&(this.pos+=e.length),!0):null}else{let s=this.string.slice(this.pos).match(e);return s&&s.index>0?null:(s&&t!==!1&&(this.pos+=s[0].length),s)}}current(){return this.string.slice(this.start,this.pos)}}const vg=Object.create(null),Ea=[Et.none],Ba=[],xg=Object.create(null);for(let[r,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])xg[r]=wg(vg,e);function Ls(r,e){Ba.indexOf(r)>-1||(Ba.push(r),console.warn(e))}function wg(r,e){let t=null;for(let o of e.split(".")){let l=r[o]||J[o];l?typeof l=="function"?t?t=l(t):Ls(o,`Modifier ${o} used at start of tag`):t?Ls(o,`Tag ${o} used as modifier`):t=l:Ls(o,`Unknown highlighting tag ${o}`)}if(!t)return 0;let n=e.replace(/ /g,"_"),s=Et.define({id:Ea.length,name:n,props:[Ep({[n]:t})]});return Ea.push(s),s.id}const bg=r=>{let{state:e}=r,t=e.doc.lineAt(e.selection.main.from),n=Vo(r.state,t.from);return n.line?kg(r):n.block?Sg(r):!1};function Ho(r,e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let s=r(e,t);return s?(n(t.update(s)),!0):!1}}const kg=Ho(Dg,0),Cg=Ho(Mu,0),Sg=Ho((r,e)=>Mu(r,e,Mg(e)),0);function Vo(r,e){let t=r.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const bn=50;function Ag(r,{open:e,close:t},n,s){let o=r.sliceDoc(n-bn,n),l=r.sliceDoc(s,s+bn),h=/\s*$/.exec(o)[0].length,f=/^\s*/.exec(l)[0].length,g=o.length-h;if(o.slice(g-e.length,g)==e&&l.slice(f,f+t.length)==t)return{open:{pos:n-h,margin:h&&1},close:{pos:s+f,margin:f&&1}};let p,v;s-n<=2*bn?p=v=r.sliceDoc(n,s):(p=r.sliceDoc(n,n+bn),v=r.sliceDoc(s-bn,s));let w=/^\s*/.exec(p)[0].length,C=/\s*$/.exec(v)[0].length,D=v.length-C-t.length;return p.slice(w,w+e.length)==e&&v.slice(D,D+t.length)==t?{open:{pos:n+w+e.length,margin:/\s/.test(p.charAt(w+e.length))?1:0},close:{pos:s-C-t.length,margin:/\s/.test(v.charAt(D-1))?1:0}}:null}function Mg(r){let e=[];for(let t of r.selection.ranges){let n=r.doc.lineAt(t.from),s=t.to<=n.to?n:r.doc.lineAt(t.to),o=e.length-1;o>=0&&e[o].to>n.from?e[o].to=s.to:e.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:s.to})}return e}function Mu(r,e,t=e.selection.ranges){let n=t.map(o=>Vo(e,o.from).block);if(!n.every(o=>o))return null;let s=t.map((o,l)=>Ag(e,n[l],o.from,o.to));if(r!=2&&!s.every(o=>o))return{changes:e.changes(t.map((o,l)=>s[l]?[]:[{from:o.from,insert:n[l].open+" "},{from:o.to,insert:" "+n[l].close}]))};if(r!=1&&s.some(o=>o)){let o=[];for(let l=0,h;l<s.length;l++)if(h=s[l]){let f=n[l],{open:g,close:p}=h;o.push({from:g.pos-f.open.length,to:g.pos+g.margin},{from:p.pos-p.margin,to:p.pos+f.close.length})}return{changes:o}}return null}function Dg(r,e,t=e.selection.ranges){let n=[],s=-1;for(let{from:o,to:l}of t){let h=n.length,f=1e9,g=Vo(e,o).line;if(!!g){for(let p=o;p<=l;){let v=e.doc.lineAt(p);if(v.from>s&&(o==l||l>v.from)){s=v.from;let w=/^\s*/.exec(v.text)[0].length,C=w==v.length,D=v.text.slice(w,w+g.length)==g?w:-1;w<v.text.length&&w<f&&(f=w),n.push({line:v,comment:D,token:g,indent:w,empty:C,single:!1})}p=v.to+1}if(f<1e9)for(let p=h;p<n.length;p++)n[p].indent<n[p].line.text.length&&(n[p].indent=f);n.length==h+1&&(n[h].single=!0)}}if(r!=2&&n.some(o=>o.comment<0&&(!o.empty||o.single))){let o=[];for(let{line:h,token:f,indent:g,empty:p,single:v}of n)(v||!p)&&o.push({from:h.from+g,insert:f+" "});let l=e.changes(o);return{changes:l,selection:e.selection.map(l,1)}}else if(r!=1&&n.some(o=>o.comment>=0)){let o=[];for(let{line:l,comment:h,token:f}of n)if(h>=0){let g=l.from+h,p=g+f.length;l.text[p-l.from]==" "&&p++,o.push({from:g,to:p})}return{changes:o}}return null}const go=Ai.define(),Og=Ai.define(),Tg=re.define(),Du=re.define({combine(r){return Hn(r,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(n,s)=>e(n,s)||t(n,s)})}});function Lg(r){let e=0;return r.iterChangedRanges((t,n)=>e=n),e}const Ou=Zt.define({create(){return Qt.empty},update(r,e){let t=e.state.facet(Du),n=e.annotation(go);if(n){let f=e.docChanged?$.single(Lg(e.changes)):void 0,g=kt.fromTransaction(e,f),p=n.side,v=p==0?r.undone:r.done;return g?v=Wr(v,v.length,t.minDepth,g):v=Lu(v,e.startState.selection),new Qt(p==0?n.rest:v,p==0?v:n.rest)}let s=e.annotation(Og);if((s=="full"||s=="before")&&(r=r.isolate()),e.annotation(Ze.addToHistory)===!1)return e.changes.empty?r:r.addMapping(e.changes.desc);let o=kt.fromTransaction(e),l=e.annotation(Ze.time),h=e.annotation(Ze.userEvent);return o?r=r.addChanges(o,l,h,t,e):e.selection&&(r=r.addSelection(e.startState.selection,l,h,t.newGroupDelay)),(s=="full"||s=="after")&&(r=r.isolate()),r},toJSON(r){return{done:r.done.map(e=>e.toJSON()),undone:r.undone.map(e=>e.toJSON())}},fromJSON(r){return new Qt(r.done.map(kt.fromJSON),r.undone.map(kt.fromJSON))}});function Eg(r={}){return[Ou,Du.of(r),se.domEventHandlers({beforeinput(e,t){let n=e.inputType=="historyUndo"?Wo:e.inputType=="historyRedo"?Vr:null;return n?(e.preventDefault(),n(t)):!1}})]}function Zr(r,e){return function({state:t,dispatch:n}){if(!e&&t.readOnly)return!1;let s=t.field(Ou,!1);if(!s)return!1;let o=s.pop(r,t,e);return o?(n(o),!0):!1}}const Wo=Zr(0,!1),Vr=Zr(1,!1),Bg=Zr(0,!0),Rg=Zr(1,!0);class kt{constructor(e,t,n,s,o){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=s,this.selectionsAfter=o}setSelAfter(e){return new kt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(s=>s.toJSON())}}static fromJSON(e){return new kt(e.changes&&Ye.fromJSON(e.changes),[],e.mapped&&Xt.fromJSON(e.mapped),e.startSelection&&$.fromJSON(e.startSelection),e.selectionsAfter.map($.fromJSON))}static fromTransaction(e,t){let n=Lt;for(let s of e.startState.facet(Tg)){let o=s(e);o.length&&(n=n.concat(o))}return!n.length&&e.changes.empty?null:new kt(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,Lt)}static selection(e){return new kt(void 0,Lt,void 0,void 0,e)}}function Wr(r,e,t,n){let s=e+1>t+20?e-t-1:0,o=r.slice(s,e);return o.push(n),o}function Ng(r,e){let t=[],n=!1;return r.iterChangedRanges((s,o)=>t.push(s,o)),e.iterChangedRanges((s,o,l,h)=>{for(let f=0;f<t.length;){let g=t[f++],p=t[f++];h>=g&&l<=p&&(n=!0)}}),n}function Pg(r,e){return r.ranges.length==e.ranges.length&&r.ranges.filter((t,n)=>t.empty!=e.ranges[n].empty).length===0}function Tu(r,e){return r.length?e.length?r.concat(e):r:e}const Lt=[],Ig=200;function Lu(r,e){if(r.length){let t=r[r.length-1],n=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-Ig));return n.length&&n[n.length-1].eq(e)?r:(n.push(e),Wr(r,r.length-1,1e9,t.setSelAfter(n)))}else return[kt.selection([e])]}function Fg(r){let e=r[r.length-1],t=r.slice();return t[r.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Es(r,e){if(!r.length)return r;let t=r.length,n=Lt;for(;t;){let s=Hg(r[t-1],e,n);if(s.changes&&!s.changes.empty||s.effects.length){let o=r.slice(0,t);return o[t-1]=s,o}else e=s.mapped,t--,n=s.selectionsAfter}return n.length?[kt.selection(n)]:Lt}function Hg(r,e,t){let n=Tu(r.selectionsAfter.length?r.selectionsAfter.map(h=>h.map(e)):Lt,t);if(!r.changes)return kt.selection(n);let s=r.changes.map(e),o=e.mapDesc(r.changes,!0),l=r.mapped?r.mapped.composeDesc(o):o;return new kt(s,Fe.mapEffects(r.effects,e),l,r.startSelection.map(o),n)}const Vg=/^(input\.type|delete)($|\.)/;class Qt{constructor(e,t,n=0,s=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=s}isolate(){return this.prevTime?new Qt(this.done,this.undone):this}addChanges(e,t,n,s,o){let l=this.done,h=l[l.length-1];return h&&h.changes&&!h.changes.empty&&e.changes&&(!n||Vg.test(n))&&(!h.selectionsAfter.length&&t-this.prevTime<s.newGroupDelay&&s.joinToEvent(o,Ng(h.changes,e.changes))||n=="input.type.compose")?l=Wr(l,l.length-1,s.minDepth,new kt(e.changes.compose(h.changes),Tu(e.effects,h.effects),h.mapped,h.startSelection,Lt)):l=Wr(l,l.length,s.minDepth,e),new Qt(l,Lt,t,n)}addSelection(e,t,n,s){let o=this.done.length?this.done[this.done.length-1].selectionsAfter:Lt;return o.length>0&&t-this.prevTime<s&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&Pg(o[o.length-1],e)?this:new Qt(Lu(this.done,e),this.undone,t,n)}addMapping(e){return new Qt(Es(this.done,e),Es(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let s=e==0?this.done:this.undone;if(s.length==0)return null;let o=s[s.length-1];if(n&&o.selectionsAfter.length)return t.update({selection:o.selectionsAfter[o.selectionsAfter.length-1],annotations:go.of({side:e,rest:Fg(s)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(o.changes){let l=s.length==1?Lt:s.slice(0,s.length-1);return o.mapped&&(l=Es(l,o.mapped)),t.update({changes:o.changes,selection:o.startSelection,effects:o.effects,annotations:go.of({side:e,rest:l}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}Qt.empty=new Qt(Lt,Lt);const Wg=[{key:"Mod-z",run:Wo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Vr,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Vr,preventDefault:!0},{key:"Mod-u",run:Bg,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Rg,preventDefault:!0}];function cn(r,e){return $.create(r.ranges.map(e),r.mainIndex)}function ei(r,e){return r.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Wt({state:r,dispatch:e},t){let n=cn(r.selection,t);return n.eq(r.selection)?!1:(e(ei(r,n)),!0)}function es(r,e){return $.cursor(e?r.to:r.from)}function Ko(r,e){return Wt(r,t=>t.empty?r.moveByChar(t,e):es(t,e))}function pt(r){return r.textDirectionAt(r.state.selection.main.head)==je.LTR}const zo=r=>Ko(r,!pt(r)),Eu=r=>Ko(r,pt(r)),Kg=r=>Ko(r,!1);function Bu(r,e){return Wt(r,t=>t.empty?r.moveByGroup(t,e):es(t,e))}const zg=r=>Bu(r,!pt(r)),$g=r=>Bu(r,pt(r));function _g(r,e,t){if(e.type.prop(t))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(r.sliceDoc(e.from,e.to)))||e.firstChild}function ts(r,e,t){let n=Vt(r).resolveInner(e.head),s=t?pe.closedBy:pe.openedBy;for(let f=e.head;;){let g=t?n.childAfter(f):n.childBefore(f);if(!g)break;_g(r,g,s)?n=g:f=t?g.to:g.from}let o=n.type.prop(s),l,h;return o&&(l=t?xi(r,n.from,1):xi(r,n.to,-1))&&l.matched?h=t?l.end.to:l.end.from:h=t?n.to:n.from,$.cursor(h,t?-1:1)}const qg=r=>Wt(r,e=>ts(r.state,e,!pt(r))),Ug=r=>Wt(r,e=>ts(r.state,e,pt(r)));function Ru(r,e){return Wt(r,t=>{if(!t.empty)return es(t,e);let n=r.moveVertically(t,e);return n.head!=t.head?n:r.moveToLineBoundary(t,e)})}const Nu=r=>Ru(r,!1),Pu=r=>Ru(r,!0);function Iu(r){let e=r.scrollDOM.clientHeight<r.scrollDOM.scrollHeight-2,t=0,n=0,s;if(e){for(let o of r.state.facet(se.scrollMargins)){let l=o(r);l!=null&&l.top&&(t=Math.max(l==null?void 0:l.top,t)),l!=null&&l.bottom&&(n=Math.max(l==null?void 0:l.bottom,n))}s=r.scrollDOM.clientHeight-t-n}else s=(r.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:n,selfScroll:e,height:Math.max(r.defaultLineHeight,s-5)}}function Fu(r,e){let t=Iu(r),{state:n}=r,s=cn(n.selection,l=>l.empty?r.moveVertically(l,e,t.height):es(l,e));if(s.eq(n.selection))return!1;let o;if(t.selfScroll){let l=r.coordsAtPos(n.selection.main.head),h=r.scrollDOM.getBoundingClientRect(),f=h.top+t.marginTop,g=h.bottom-t.marginBottom;l&&l.top>f&&l.bottom<g&&(o=se.scrollIntoView(s.main.head,{y:"start",yMargin:l.top-f}))}return r.dispatch(ei(n,s),{effects:o}),!0}const Ra=r=>Fu(r,!1),mo=r=>Fu(r,!0);function Mi(r,e,t){let n=r.lineBlockAt(e.head),s=r.moveToLineBoundary(e,t);if(s.head==e.head&&s.head!=(t?n.to:n.from)&&(s=r.moveToLineBoundary(e,t,!1)),!t&&s.head==n.from&&n.length){let o=/^\s*/.exec(r.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;o&&e.head!=n.from+o&&(s=$.cursor(n.from+o))}return s}const Hu=r=>Wt(r,e=>Mi(r,e,!0)),Vu=r=>Wt(r,e=>Mi(r,e,!1)),jg=r=>Wt(r,e=>Mi(r,e,!pt(r))),Jg=r=>Wt(r,e=>Mi(r,e,pt(r))),Gg=r=>Wt(r,e=>$.cursor(r.lineBlockAt(e.head).from,1)),Qg=r=>Wt(r,e=>$.cursor(r.lineBlockAt(e.head).to,-1));function Xg(r,e,t){let n=!1,s=cn(r.selection,o=>{let l=xi(r,o.head,-1)||xi(r,o.head,1)||o.head>0&&xi(r,o.head-1,1)||o.head<r.doc.length&&xi(r,o.head+1,-1);if(!l||!l.end)return o;n=!0;let h=l.start.from==o.head?l.end.to:l.end.from;return t?$.range(o.anchor,h):$.cursor(h)});return n?(e(ei(r,s)),!0):!1}const Yg=({state:r,dispatch:e})=>Xg(r,e,!1);function Bt(r,e){let t=cn(r.state.selection,n=>{let s=e(n);return $.range(n.anchor,s.head,s.goalColumn,s.bidiLevel||void 0)});return t.eq(r.state.selection)?!1:(r.dispatch(ei(r.state,t)),!0)}function Wu(r,e){return Bt(r,t=>r.moveByChar(t,e))}const Ku=r=>Wu(r,!pt(r)),zu=r=>Wu(r,pt(r));function $u(r,e){return Bt(r,t=>r.moveByGroup(t,e))}const Zg=r=>$u(r,!pt(r)),em=r=>$u(r,pt(r)),tm=r=>Bt(r,e=>ts(r.state,e,!pt(r))),im=r=>Bt(r,e=>ts(r.state,e,pt(r)));function _u(r,e){return Bt(r,t=>r.moveVertically(t,e))}const qu=r=>_u(r,!1),Uu=r=>_u(r,!0);function ju(r,e){return Bt(r,t=>r.moveVertically(t,e,Iu(r).height))}const Na=r=>ju(r,!1),Pa=r=>ju(r,!0),nm=r=>Bt(r,e=>Mi(r,e,!0)),rm=r=>Bt(r,e=>Mi(r,e,!1)),sm=r=>Bt(r,e=>Mi(r,e,!pt(r))),om=r=>Bt(r,e=>Mi(r,e,pt(r))),lm=r=>Bt(r,e=>$.cursor(r.lineBlockAt(e.head).from)),am=r=>Bt(r,e=>$.cursor(r.lineBlockAt(e.head).to)),Ia=({state:r,dispatch:e})=>(e(ei(r,{anchor:0})),!0),Fa=({state:r,dispatch:e})=>(e(ei(r,{anchor:r.doc.length})),!0),Ha=({state:r,dispatch:e})=>(e(ei(r,{anchor:r.selection.main.anchor,head:0})),!0),Va=({state:r,dispatch:e})=>(e(ei(r,{anchor:r.selection.main.anchor,head:r.doc.length})),!0),hm=({state:r,dispatch:e})=>(e(r.update({selection:{anchor:0,head:r.doc.length},userEvent:"select"})),!0),um=({state:r,dispatch:e})=>{let t=ns(r).map(({from:n,to:s})=>$.range(n,Math.min(s+1,r.doc.length)));return e(r.update({selection:$.create(t),userEvent:"select"})),!0},fm=({state:r,dispatch:e})=>{let t=cn(r.selection,n=>{var s;let o=Vt(r).resolveInner(n.head,1);for(;!(o.from<n.from&&o.to>=n.to||o.to>n.to&&o.from<=n.from||!(!((s=o.parent)===null||s===void 0)&&s.parent));)o=o.parent;return $.range(o.to,o.from)});return e(ei(r,t)),!0},cm=({state:r,dispatch:e})=>{let t=r.selection,n=null;return t.ranges.length>1?n=$.create([t.main]):t.main.empty||(n=$.create([$.cursor(t.main.head)])),n?(e(ei(r,n)),!0):!1};function is(r,e){if(r.state.readOnly)return!1;let t="delete.selection",{state:n}=r,s=n.changeByRange(o=>{let{from:l,to:h}=o;if(l==h){let f=e(l);f<l?(t="delete.backward",f=ur(r,f,!1)):f>l&&(t="delete.forward",f=ur(r,f,!0)),l=Math.min(l,f),h=Math.max(h,f)}else l=ur(r,l,!1),h=ur(r,h,!0);return l==h?{range:o}:{changes:{from:l,to:h},range:$.cursor(l)}});return s.changes.empty?!1:(r.dispatch(n.update(s,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?se.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function ur(r,e,t){if(r instanceof se)for(let n of r.state.facet(se.atomicRanges).map(s=>s(r)))n.between(e,e,(s,o)=>{s<e&&o>e&&(e=t?o:s)});return e}const Ju=(r,e)=>is(r,t=>{let{state:n}=r,s=n.doc.lineAt(t),o,l;if(!e&&t>s.from&&t<s.from+200&&!/[^ \t]/.test(o=s.text.slice(0,t-s.from))){if(o[o.length-1]=="	")return t-1;let h=Ur(o,n.tabSize),f=h%Fr(n)||Fr(n);for(let g=0;g<f&&o[o.length-1-g]==" ";g++)t--;l=t}else l=xt(s.text,t-s.from,e,e)+s.from,l==t&&s.number!=(e?n.doc.lines:1)&&(l+=e?1:-1);return l}),yo=r=>Ju(r,!1),Gu=r=>Ju(r,!0),Qu=(r,e)=>is(r,t=>{let n=t,{state:s}=r,o=s.doc.lineAt(n),l=s.charCategorizer(n);for(let h=null;;){if(n==(e?o.to:o.from)){n==t&&o.number!=(e?s.doc.lines:1)&&(n+=e?1:-1);break}let f=xt(o.text,n-o.from,e)+o.from,g=o.text.slice(Math.min(n,f)-o.from,Math.max(n,f)-o.from),p=l(g);if(h!=null&&p!=h)break;(g!=" "||n!=t)&&(h=p),n=f}return n}),Xu=r=>Qu(r,!1),dm=r=>Qu(r,!0),Yu=r=>is(r,e=>{let t=r.lineBlockAt(e).to;return e<t?t:Math.min(r.state.doc.length,e+1)}),pm=r=>is(r,e=>{let t=r.lineBlockAt(e).from;return e>t?t:Math.max(0,e-1)}),gm=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let t=r.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:Ce.of(["",""])},range:$.cursor(n.from)}));return e(r.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},mm=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let t=r.changeByRange(n=>{if(!n.empty||n.from==0||n.from==r.doc.length)return{range:n};let s=n.from,o=r.doc.lineAt(s),l=s==o.from?s-1:xt(o.text,s-o.from,!1)+o.from,h=s==o.to?s+1:xt(o.text,s-o.from,!0)+o.from;return{changes:{from:l,to:h,insert:r.doc.slice(s,h).append(r.doc.slice(l,s))},range:$.cursor(h)}});return t.changes.empty?!1:(e(r.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function ns(r){let e=[],t=-1;for(let n of r.selection.ranges){let s=r.doc.lineAt(n.from),o=r.doc.lineAt(n.to);if(!n.empty&&n.to==o.from&&(o=r.doc.lineAt(n.to-1)),t>=s.number){let l=e[e.length-1];l.to=o.to,l.ranges.push(n)}else e.push({from:s.from,to:o.to,ranges:[n]});t=o.number+1}return e}function Zu(r,e,t){if(r.readOnly)return!1;let n=[],s=[];for(let o of ns(r)){if(t?o.to==r.doc.length:o.from==0)continue;let l=r.doc.lineAt(t?o.to+1:o.from-1),h=l.length+1;if(t){n.push({from:o.to,to:l.to},{from:o.from,insert:l.text+r.lineBreak});for(let f of o.ranges)s.push($.range(Math.min(r.doc.length,f.anchor+h),Math.min(r.doc.length,f.head+h)))}else{n.push({from:l.from,to:o.from},{from:o.to,insert:r.lineBreak+l.text});for(let f of o.ranges)s.push($.range(f.anchor-h,f.head-h))}}return n.length?(e(r.update({changes:n,scrollIntoView:!0,selection:$.create(s,r.selection.mainIndex),userEvent:"move.line"})),!0):!1}const ym=({state:r,dispatch:e})=>Zu(r,e,!1),vm=({state:r,dispatch:e})=>Zu(r,e,!0);function ef(r,e,t){if(r.readOnly)return!1;let n=[];for(let s of ns(r))t?n.push({from:s.from,insert:r.doc.slice(s.from,s.to)+r.lineBreak}):n.push({from:s.to,insert:r.lineBreak+r.doc.slice(s.from,s.to)});return e(r.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const xm=({state:r,dispatch:e})=>ef(r,e,!1),wm=({state:r,dispatch:e})=>ef(r,e,!0),bm=r=>{if(r.state.readOnly)return!1;let{state:e}=r,t=e.changes(ns(e).map(({from:s,to:o})=>(s>0?s--:o<e.doc.length&&o++,{from:s,to:o}))),n=cn(e.selection,s=>r.moveVertically(s,!0)).map(t);return r.dispatch({changes:t,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function km(r,e){if(/\(\)|\[\]|\{\}/.test(r.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=Vt(r).resolveInner(e),n=t.childBefore(e),s=t.childAfter(e),o;return n&&s&&n.to<=e&&s.from>=e&&(o=n.type.prop(pe.closedBy))&&o.indexOf(s.name)>-1&&r.doc.lineAt(n.to).from==r.doc.lineAt(s.from).from?{from:n.to,to:s.from}:null}const tf=nf(!1),Cm=nf(!0);function nf(r){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(s=>{let{from:o,to:l}=s,h=e.doc.lineAt(o),f=!r&&o==l&&km(e,o);r&&(o=l=(l<=h.to?h:e.doc.lineAt(l)).to);let g=new Xr(e,{simulateBreak:o,simulateDoubleBreak:!!f}),p=xu(g,o);for(p==null&&(p=/^\s*/.exec(e.doc.lineAt(o).text)[0].length);l<h.to&&/\s/.test(h.text[l-h.from]);)l++;f?{from:o,to:l}=f:o>h.from&&o<h.from+100&&!/\S/.test(h.text.slice(0,o))&&(o=h.from);let v=["",Hr(e,p)];return f&&v.push(Hr(e,g.lineIndent(h.from,-1))),{changes:{from:o,to:l,insert:Ce.of(v)},range:$.cursor(o+1+v[1].length)}});return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function $o(r,e){let t=-1;return r.changeByRange(n=>{let s=[];for(let l=n.from;l<=n.to;){let h=r.doc.lineAt(l);h.number>t&&(n.empty||n.to>h.from)&&(e(h,s,n),t=h.number),l=h.to+1}let o=r.changes(s);return{changes:s,range:$.range(o.mapPos(n.anchor,1),o.mapPos(n.head,1))}})}const rf=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let t=Object.create(null),n=new Xr(r,{overrideIndentation:o=>{let l=t[o];return l==null?-1:l}}),s=$o(r,(o,l,h)=>{let f=xu(n,o.from);if(f==null)return;/\S/.test(o.text)||(f=0);let g=/^\s*/.exec(o.text)[0],p=Hr(r,f);(g!=p||h.from<o.from+g.length)&&(t[o.from]=f,l.push({from:o.from,to:o.from+g.length,insert:p}))});return s.changes.empty||e(r.update(s,{userEvent:"indent"})),!0},_o=({state:r,dispatch:e})=>r.readOnly?!1:(e(r.update($o(r,(t,n)=>{n.push({from:t.from,insert:r.facet(In)})}),{userEvent:"input.indent"})),!0),qo=({state:r,dispatch:e})=>r.readOnly?!1:(e(r.update($o(r,(t,n)=>{let s=/^\s*/.exec(t.text)[0];if(!s)return;let o=Ur(s,r.tabSize),l=0,h=Hr(r,Math.max(0,o-Fr(r)));for(;l<s.length&&l<h.length&&s.charCodeAt(l)==h.charCodeAt(l);)l++;n.push({from:t.from+l,to:t.from+s.length,insert:h.slice(l)})}),{userEvent:"delete.dedent"})),!0),Sm=[{key:"Ctrl-b",run:zo,shift:Ku,preventDefault:!0},{key:"Ctrl-f",run:Eu,shift:zu},{key:"Ctrl-p",run:Nu,shift:qu},{key:"Ctrl-n",run:Pu,shift:Uu},{key:"Ctrl-a",run:Gg,shift:lm},{key:"Ctrl-e",run:Qg,shift:am},{key:"Ctrl-d",run:Gu},{key:"Ctrl-h",run:yo},{key:"Ctrl-k",run:Yu},{key:"Ctrl-Alt-h",run:Xu},{key:"Ctrl-o",run:gm},{key:"Ctrl-t",run:mm},{key:"Ctrl-v",run:mo}],Am=[{key:"ArrowLeft",run:zo,shift:Ku,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:zg,shift:Zg,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:jg,shift:sm,preventDefault:!0},{key:"ArrowRight",run:Eu,shift:zu,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:$g,shift:em,preventDefault:!0},{mac:"Cmd-ArrowRight",run:Jg,shift:om,preventDefault:!0},{key:"ArrowUp",run:Nu,shift:qu,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Ia,shift:Ha},{mac:"Ctrl-ArrowUp",run:Ra,shift:Na},{key:"ArrowDown",run:Pu,shift:Uu,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Fa,shift:Va},{mac:"Ctrl-ArrowDown",run:mo,shift:Pa},{key:"PageUp",run:Ra,shift:Na},{key:"PageDown",run:mo,shift:Pa},{key:"Home",run:Vu,shift:rm,preventDefault:!0},{key:"Mod-Home",run:Ia,shift:Ha},{key:"End",run:Hu,shift:nm,preventDefault:!0},{key:"Mod-End",run:Fa,shift:Va},{key:"Enter",run:tf},{key:"Mod-a",run:hm},{key:"Backspace",run:yo,shift:yo},{key:"Delete",run:Gu},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Xu},{key:"Mod-Delete",mac:"Alt-Delete",run:dm},{mac:"Mod-Backspace",run:pm},{mac:"Mod-Delete",run:Yu}].concat(Sm.map(r=>({mac:r.key,run:r.run,shift:r.shift}))),Mm=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:qg,shift:tm},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Ug,shift:im},{key:"Alt-ArrowUp",run:ym},{key:"Shift-Alt-ArrowUp",run:xm},{key:"Alt-ArrowDown",run:vm},{key:"Shift-Alt-ArrowDown",run:wm},{key:"Escape",run:cm},{key:"Mod-Enter",run:Cm},{key:"Alt-l",mac:"Ctrl-l",run:um},{key:"Mod-i",run:fm,preventDefault:!0},{key:"Mod-[",run:qo},{key:"Mod-]",run:_o},{key:"Mod-Alt-\\",run:rf},{key:"Shift-Mod-k",run:bm},{key:"Shift-Mod-\\",run:Yg},{key:"Mod-/",run:bg},{key:"Alt-A",run:Cg}].concat(Am),Dm={key:"Tab",run:_o,shift:qo},Wa=typeof String.prototype.normalize=="function"?r=>r.normalize("NFKD"):r=>r;class sf{constructor(e,t,n=0,s=e.length,o,l){this.test=l,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,s),this.bufferStart=n,this.normalize=o?h=>o(Wa(h)):Wa,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Xi(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=fc(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=br(e);let s=this.normalize(t);for(let o=0,l=n;;o++){let h=s.charCodeAt(o),f=this.match(h,l);if(f)return this.value=f,this;if(o==s.length-1)break;l==n&&o<t.length&&t.charCodeAt(o)==h&&l++}}}match(e,t){let n=null;for(let s=0;s<this.matches.length;s+=2){let o=this.matches[s],l=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?n={from:this.matches[s+1],to:t+1}:(this.matches[s]++,l=!0)),l||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:t,to:t+1}:this.matches.push(1,t)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferPos)&&(n=null),n}}typeof Symbol!="undefined"&&(sf.prototype[Symbol.iterator]=function(){return this});const of={from:-1,to:-1,match:/.*/.exec("")},Uo="gm"+(/x/.unicode==null?"":"u");class jo{constructor(e,t,n,s=0,o=e.length){if(this.text=e,this.to=o,this.curLine="",this.done=!1,this.value=of,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new lf(e,t,n,s,o);this.re=new RegExp(t,Uo+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.iter=e.iter();let l=e.lineAt(s);this.curLineStart=l.from,this.matchPos=Kr(e,s),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let n=this.curLineStart+t.index,s=n+t[0].length;if(this.matchPos=Kr(this.text,s+(n==s?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<s||n>this.value.to)&&(!this.test||this.test(n,s,t)))return this.value={from:n,to:s,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const Bs=new WeakMap;class tn{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,n){let s=Bs.get(e);if(!s||s.from>=n||s.to<=t){let h=new tn(t,e.sliceString(t,n));return Bs.set(e,h),h}if(s.from==t&&s.to==n)return s;let{text:o,from:l}=s;return l>t&&(o=e.sliceString(t,l)+o,l=t),s.to<n&&(o+=e.sliceString(s.to,n)),Bs.set(e,new tn(l,o)),new tn(t,o.slice(t-l,n-l))}}class lf{constructor(e,t,n,s,o){this.text=e,this.to=o,this.done=!1,this.value=of,this.matchPos=Kr(e,s),this.re=new RegExp(t,Uo+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.flat=tn.get(e,s,this.chunkEnd(s+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let n=this.flat.from+t.index,s=n+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,s,t)))return this.value={from:n,to:s,match:t},this.matchPos=Kr(this.text,s+(n==s?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=tn.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol!="undefined"&&(jo.prototype[Symbol.iterator]=lf.prototype[Symbol.iterator]=function(){return this});function Om(r){try{return new RegExp(r,Uo),!0}catch{return!1}}function Kr(r,e){if(e>=r.length)return e;let t=r.lineAt(e),n;for(;e<t.to&&(n=t.text.charCodeAt(e-t.from))>=56320&&n<57344;)e++;return e}class Tm{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||Om(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Rm(this):new Em(this)}getCursor(e,t=0,n){let s=e.doc?e:we.create({doc:e});return n==null&&(n=s.doc.length),this.regexp?ji(this,s,t,n):Ui(this,s,t,n)}}class af{constructor(e){this.spec=e}}function Ui(r,e,t,n){return new sf(e.doc,r.unquoted,t,n,r.caseSensitive?void 0:s=>s.toLowerCase(),r.wholeWord?Lm(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Lm(r,e){return(t,n,s,o)=>((o>t||o+s.length<n)&&(o=Math.max(0,t-2),s=r.sliceString(o,Math.min(r.length,n+2))),(e(zr(s,t-o))!=ot.Word||e($r(s,t-o))!=ot.Word)&&(e($r(s,n-o))!=ot.Word||e(zr(s,n-o))!=ot.Word))}class Em extends af{constructor(e){super(e)}nextMatch(e,t,n){let s=Ui(this.spec,e,n,e.doc.length).nextOverlapping();return s.done&&(s=Ui(this.spec,e,0,t).nextOverlapping()),s.done?null:s.value}prevMatchInRange(e,t,n){for(let s=n;;){let o=Math.max(t,s-1e4-this.spec.unquoted.length),l=Ui(this.spec,e,o,s),h=null;for(;!l.nextOverlapping().done;)h=l.value;if(h)return h;if(o==t)return null;s-=1e4}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let n=Ui(this.spec,e,0,e.doc.length),s=[];for(;!n.next().done;){if(s.length>=t)return null;s.push(n.value)}return s}highlight(e,t,n,s){let o=Ui(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!o.next().done;)s(o.value.from,o.value.to)}}function ji(r,e,t,n){return new jo(e.doc,r.search,{ignoreCase:!r.caseSensitive,test:r.wholeWord?Bm(e.charCategorizer(e.selection.main.head)):void 0},t,n)}function zr(r,e){return r.slice(xt(r,e,!1),e)}function $r(r,e){return r.slice(e,xt(r,e))}function Bm(r){return(e,t,n)=>!n[0].length||(r(zr(n.input,n.index))!=ot.Word||r($r(n.input,n.index))!=ot.Word)&&(r($r(n.input,n.index+n[0].length))!=ot.Word||r(zr(n.input,n.index+n[0].length))!=ot.Word)}class Rm extends af{nextMatch(e,t,n){let s=ji(this.spec,e,n,e.doc.length).next();return s.done&&(s=ji(this.spec,e,0,t).next()),s.done?null:s.value}prevMatchInRange(e,t,n){for(let s=1;;s++){let o=Math.max(t,n-s*1e4),l=ji(this.spec,e,o,n),h=null;for(;!l.next().done;)h=l.value;if(h&&(o==t||h.from>o+10))return h;if(o==t)return null}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(t,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:t))}matchAll(e,t){let n=ji(this.spec,e,0,e.doc.length),s=[];for(;!n.next().done;){if(s.length>=t)return null;s.push(n.value)}return s}highlight(e,t,n,s){let o=ji(this.spec,e,Math.max(0,t-250),Math.min(n+250,e.doc.length));for(;!o.next().done;)s(o.value.from,o.value.to)}}const vo=Fe.define(),Nm=(()=>[lp(),Eg(),Zd(),ag(fg,{fallback:!0}),Qr.of([...Mm,...Wg])])();function Pm(r){var e=r.Pos;function t(a,u){var c=a.state.vim;if(!c||c.insertMode)return u.head;var d=c.sel.head;if(!d)return u.head;if(!(c.visualBlock&&u.head.line!=d.line))return u.from()==u.anchor&&!u.empty()&&u.head.line==d.line&&u.head.ch!=d.ch?new e(u.head.line,u.head.ch-1):u.head}function n(a,u,c){if(u.line===c.line&&u.ch>=c.ch-1){var d=a.getLine(u.line),m=d.charCodeAt(u.ch);55296<=m&&m<=55551&&(c.ch+=1)}return{start:u,end:c}}var s=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"<C-r><character>",type:"action",action:"insertRegister",context:"insert",isEdit:!0},{keys:"<C-o>",type:"action",action:"oneNormalCommand",context:"insert"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],o=s.length,l=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"omap",shortName:"om"},{name:"noremap",shortName:"no"},{name:"nnoremap",shortName:"nn"},{name:"vnoremap",shortName:"vn"},{name:"inoremap",shortName:"ino"},{name:"onoremap",shortName:"ono"},{name:"unmap"},{name:"mapclear",shortName:"mapc"},{name:"nmapclear",shortName:"nmapc"},{name:"vmapclear",shortName:"vmapc"},{name:"imapclear",shortName:"imapc"},{name:"omapclear",shortName:"omapc"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"delete",shortName:"d"},{name:"join",shortName:"j"},{name:"normal",shortName:"norm"},{name:"global",shortName:"g"}];function h(a){a.setOption("disableInput",!0),a.setOption("showCursorWhenSelecting",!1),r.signal(a,"vim-mode-change",{mode:"normal"}),a.on("cursorActivity",ml),Oi(a),r.on(a.getInputField(),"paste",E(a))}function f(a){a.setOption("disableInput",!1),a.off("cursorActivity",ml),r.off(a.getInputField(),"paste",E(a)),a.state.vim=null,jn&&clearTimeout(jn)}function g(a,u){this==r.keyMap.vim&&(a.options.$customCursor=null,r.rmClass(a.getWrapperElement(),"cm-fat-cursor")),(!u||u.attach!=p)&&f(a)}function p(a,u){this==r.keyMap.vim&&(a.curOp&&(a.curOp.selectionChanged=!0),a.options.$customCursor=t,r.addClass(a.getWrapperElement(),"cm-fat-cursor")),(!u||u.attach!=p)&&h(a)}r.defineOption("vimMode",!1,function(a,u,c){u&&a.getOption("keyMap")!="vim"?a.setOption("keyMap","vim"):!u&&c!=r.Init&&/^vim/.test(a.getOption("keyMap"))&&a.setOption("keyMap","default")});function v(a,u){if(!!u){if(this[a])return this[a];var c=F(a);if(!c)return!1;var d=Ke.findKey(u,c);return typeof d=="function"&&r.signal(u,"vim-keypress",c),d}}var w={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A",CapsLock:""},C={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"},D={};"Left|Right|Up|Down|End|Home".split("|").concat(Object.keys(C)).forEach(function(a){D[(C[a]||"").toLowerCase()]=D[a.toLowerCase()]=a});function F(a){if(a.charAt(0)=="'")return a.charAt(1);var u=a.split(/-(?!$)/),c=u[u.length-1];if(u.length==1&&u[0].length==1)return!1;if(u.length==2&&u[0]=="Shift"&&c.length==1)return!1;for(var d=!1,m=0;m<u.length;m++){var y=u[m];y in w?u[m]=w[y]:d=!0,y in C&&(u[m]=C[y])}return d?(ce(c)&&(u[u.length-1]=c.toLowerCase()),"<"+u.join("-")+">"):!1}function E(a){var u=a.state.vim;return u.onPasteFn||(u.onPasteFn=function(){u.insertMode||(a.setCursor(j(a.getCursor(),0,1)),P.enterInsertMode(a,{},u))}),u.onPasteFn}var K=/[\d]/,X=[r.isWordChar,function(a){return a&&!r.isWordChar(a)&&!/\s/.test(a)}],te=[function(a){return/\S/.test(a)}];function V(a,u){for(var c=[],d=a;d<a+u;d++)c.push(String.fromCharCode(d));return c}var Y=V(65,26),Q=V(97,26),ne=V(48,10),be=[].concat(Y,Q,ne,["<",">"]),ae=[].concat(Y,Q,ne,["-",'"',".",":","_","/","+"]),O;try{O=new RegExp("^[\\p{Lu}]$","u")}catch{O=/^[A-Z]$/}function z(a,u){return u>=a.firstLine()&&u<=a.lastLine()}function me(a){return/^[a-z]$/.test(a)}function Me(a){return"()[]{}".indexOf(a)!=-1}function Te(a){return K.test(a)}function ce(a){return O.test(a)}function de(a){return/^\s*$/.test(a)}function Se(a){return".?!".indexOf(a)!=-1}function Le(a,u){for(var c=0;c<u.length;c++)if(u[c]==a)return!0;return!1}var fe={};function Ae(a,u,c,d,m){if(u===void 0&&!m)throw Error("defaultValue is required unless callback is provided");if(c||(c="string"),fe[a]={type:c,defaultValue:u,callback:m},d)for(var y=0;y<d.length;y++)fe[d[y]]=fe[a];u&&at(a,u)}function at(a,u,c,d){var m=fe[a];d=d||{};var y=d.scope;if(!m)return new Error("Unknown option: "+a);if(m.type=="boolean"){if(u&&u!==!0)return new Error("Invalid argument: "+a+"="+u);u!==!1&&(u=!0)}m.callback?(y!=="local"&&m.callback(u,void 0),y!=="global"&&c&&m.callback(u,c)):(y!=="local"&&(m.value=m.type=="boolean"?!!u:u),y!=="global"&&c&&(c.state.vim.options[a]={value:u}))}function et(a,u,c){var d=fe[a];c=c||{};var m=c.scope;if(!d)return new Error("Unknown option: "+a);if(d.callback){var y=u&&d.callback(void 0,u);return m!=="global"&&y!==void 0?y:m!=="local"?d.callback():void 0}else{var y=m!=="global"&&u&&u.state.vim.options[a];return(y||m!=="local"&&d||{}).value}}Ae("filetype",void 0,"string",["ft"],function(a,u){if(u!==void 0)if(a===void 0){var c=u.getOption("mode");return c=="null"?"":c}else{var c=a==""?"null":a;u.setOption("mode",c)}});var We=function(){var a=100,u=-1,c=0,d=0,m=new Array(a);function y(b,M,A){var I=u%a,H=m[I];function R(U){var _=++u%a,ie=m[_];ie&&ie.clear(),m[_]=b.setBookmark(U)}if(H){var L=H.find();L&&!ht(L,M)&&R(M)}else R(M);R(A),c=u,d=u-a+1,d<0&&(d=0)}function x(b,M){u+=M,u>c?u=c:u<d&&(u=d);var A=m[(a+u)%a];if(A&&!A.find()){var I=M>0?1:-1,H,R=b.getCursor();do if(u+=I,A=m[(a+u)%a],A&&(H=A.find())&&!ht(R,H))break;while(u<c&&u>d)}return A}function k(b,M){var A=u,I=x(b,M);return u=A,I&&I.find()}return{cachedCursor:void 0,add:y,find:k,move:x}},Di=function(a){return a?{changes:a.changes,expectCursorActivityForChange:a.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};function Dt(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=Di()}Dt.prototype={exitMacroRecordMode:function(){var a=G.macroModeState;a.onRecordingDone&&a.onRecordingDone(),a.onRecordingDone=void 0,a.isRecording=!1},enterMacroRecordMode:function(a,u){var c=G.registerController.getRegister(u);if(c){if(c.clear(),this.latestRegister=u,a.openDialog){var d=hi("span",{class:"cm-vim-message"},"recording @"+u);this.onRecordingDone=a.openDialog(d,null,{bottom:!0})}this.isRecording=!0}}};function Oi(a){return a.state.vim||(a.state.vim={inputState:new ti,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeReturn:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),a.state.vim}var G;function qe(){G={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:We(),macroModeState:new Dt,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new zn({}),searchHistoryController:new gn,exCommandHistoryController:new gn};for(var a in fe){var u=fe[a];u.value=u.defaultValue}}var Ti,Ke={enterVimMode:h,leaveVimMode:f,buildKeyMap:function(){},getRegisterController:function(){return G.registerController},resetVimGlobalState_:qe,getVimGlobalState_:function(){return G},maybeInitVimState_:Oi,suppressErrorLogging:!1,InsertModeKey:hs,map:function(a,u,c){It.map(a,u,c)},unmap:function(a,u){return It.unmap(a,u)},noremap:function(a,u,c){It.map(a,u,c,!0)},mapclear:function(a){var u=s.length,c=o,d=s.slice(0,u-c);if(s=s.slice(u-c),a)for(var m=d.length-1;m>=0;m--){var y=d[m];if(a!==y.context)if(y.context)this._mapCommand(y);else{var x=["normal","insert","visual"];for(var k in x)if(x[k]!==a){var b={};for(var M in y)b[M]=y[M];b.context=x[k],this._mapCommand(b)}}}},setOption:at,getOption:et,defineOption:Ae,defineEx:function(a,u,c){if(!u)u=a;else if(a.indexOf(u)!==0)throw new Error('(Vim.defineEx) "'+u+'" is not a prefix of "'+a+'", command not registered');dl[a]=c,It.commandMap_[u]={name:a,shortName:u,type:"api"}},handleKey:function(a,u,c){var d=this.findKey(a,u,c);if(typeof d=="function")return d()},multiSelectHandleKey:tc,findKey:function(a,u,c){var d=Oi(a);function m(){var M=G.macroModeState;if(M.isRecording){if(u=="q")return M.exitMacroRecordMode(),He(a),!0;c!="mapping"&&Yf(M,u)}}function y(){if(u=="<Esc>"){if(d.visualMode)Kt(a);else if(d.insertMode)ui(a);else return;return He(a),!0}}function x(){if(y())return!0;d.inputState.keyBuffer.push(u);var M=d.inputState.keyBuffer.join(""),A=u.length==1,I=Pt.matchCommand(M,s,d.inputState,"insert"),H=d.inputState.changeQueue;if(I.type=="none")return He(a),!1;if(I.type=="partial"){if(Ti&&window.clearTimeout(Ti),Ti=A&&window.setTimeout(function(){d.insertMode&&d.inputState.keyBuffer.length&&He(a)},et("insertModeEscKeysTimeout")),A){var R=a.listSelections();(!H||H.removed.length!=R.length)&&(H=d.inputState.changeQueue=new pn),H.inserted+=u;for(var L=0;L<R.length;L++){var U=tt(R[L].anchor,R[L].head),_=Ct(R[L].anchor,R[L].head),ie=a.getRange(U,a.state.overwrite?j(_,0,1):_);H.removed[L]=(H.removed[L]||"")+ie}}return!A}if(Ti&&window.clearTimeout(Ti),I.command&&H){for(var R=a.listSelections(),L=0;L<R.length;L++){var le=R[L].head;a.replaceRange(H.removed[L]||"",j(le,0,-H.inserted.length),le,"+input")}G.macroModeState.lastInsertModeChanges.changes.pop()}return I.command||He(a),I.command}function k(){if(m()||y())return!0;d.inputState.keyBuffer.push(u);var M=d.inputState.keyBuffer.join("");if(/^[1-9]\d*$/.test(M))return!0;var A=/^(\d*)(.*)$/.exec(M);if(!A)return He(a),!1;var I=d.visualMode?"visual":"normal",H=A[2]||A[1];d.inputState.operatorShortcut&&d.inputState.operatorShortcut.slice(-1)==H&&(H=d.inputState.operatorShortcut);var R=Pt.matchCommand(H,s,d.inputState,I);return R.type=="none"?(He(a),!1):R.type=="partial"?!0:R.type=="clear"?(He(a),!0):(d.inputState.keyBuffer.length=0,A=/^(\d*)(.*)$/.exec(M),A[1]&&A[1]!="0"&&d.inputState.pushRepeatDigit(A[1]),R.command)}var b;return d.insertMode?b=x():b=k(),b===!1?!d.insertMode&&u.length===1?function(){return!0}:void 0:b===!0?function(){return!0}:function(){return a.operation(function(){a.curOp.isVimOp=!0;try{b.type=="keyToKey"?$i(a,b.toKeys,b):Pt.processCommand(a,d,b)}catch(M){throw a.state.vim=void 0,Oi(a),console.log(M),M}return!0})}},handleEx:function(a,u){It.processCommand(a,u)},defineMotion:Li,defineAction:B,defineOperator:T,mapCommand:Qf,_mapCommand:pl,defineRegister:Kn,exitVisualMode:Kt,exitInsertMode:ui},Rt=[],Nt=!1;function $i(a,u,c){if(c){if(Rt.indexOf(c)!=-1)return;Rt.push(c),Nt=c.noremap}try{for(var d=Oi(a),m=/<(?:[CSMA]-)*\w+>|./gi,y;y=m.exec(u);){var x=y[0],k=d.insertMode,b=Ke.handleKey(a,x,"mapping");if(!b&&k&&d.insertMode){if(x[0]=="<"){var A=x.toLowerCase().slice(1,-1),M=A.split("-"),A=M.pop();if(A=="lt")x="<";else if(A=="space")x=" ";else if(A=="cr")x=`
`;else if(D.hasOwnProperty(A)){x=D[A],wl(a,x);continue}else x=x[0],m.lastIndex=y.index+1}a.replaceSelection(x)}}}finally{Nt=!1,Rt.length=0}}function ti(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null,this.changeQueue=null}ti.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):this.prefixRepeat=this.prefixRepeat.concat(a)},ti.prototype.getRepeat=function(){var a=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(a=1,this.prefixRepeat.length>0&&(a*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(a*=parseInt(this.motionRepeat.join(""),10))),a};function He(a,u){a.state.vim.inputState=new ti,r.signal(a,"vim-command-done",u)}function pn(){this.removed=[],this.inserted=""}function gt(a,u,c){this.clear(),this.keyBuffer=[a||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!u,this.blockwise=!!c}gt.prototype={setText:function(a,u,c){this.keyBuffer=[a||""],this.linewise=!!u,this.blockwise=!!c},pushText:function(a,u){u&&(this.linewise||this.keyBuffer.push(`
`),this.linewise=!0),this.keyBuffer.push(a)},pushInsertModeChanges:function(a){this.insertModeChanges.push(Di(a))},pushSearchQuery:function(a){this.searchQueries.push(a)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}};function Kn(a,u){var c=G.registerController.registers;if(!a||a.length!=1)throw Error("Register name must be 1 character");if(c[a])throw Error("Register already defined "+a);c[a]=u,ae.push(a)}function zn(a){this.registers=a,this.unnamedRegister=a['"']=new gt,a["."]=new gt,a[":"]=new gt,a["/"]=new gt,a["+"]=new gt}zn.prototype={pushText:function(a,u,c,d,m){if(a!=="_"){d&&c.charAt(c.length-1)!==`
`&&(c+=`
`);var y=this.isValidRegister(a)?this.getRegister(a):null;if(!y){switch(u){case"yank":this.registers[0]=new gt(c,d,m);break;case"delete":case"change":c.indexOf(`
`)==-1?this.registers["-"]=new gt(c,d):(this.shiftNumericRegisters_(),this.registers[1]=new gt(c,d));break}this.unnamedRegister.setText(c,d,m);return}var x=ce(a);x?y.pushText(c,d):y.setText(c,d,m),a==="+"&&navigator.clipboard.writeText(c),this.unnamedRegister.setText(y.toString(),d)}},getRegister:function(a){return this.isValidRegister(a)?(a=a.toLowerCase(),this.registers[a]||(this.registers[a]=new gt),this.registers[a]):this.unnamedRegister},isValidRegister:function(a){return a&&Le(a,ae)},shiftNumericRegisters_:function(){for(var a=9;a>=2;a--)this.registers[a]=this.getRegister(""+(a-1))}};function gn(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}gn.prototype={nextMatch:function(a,u){var c=this.historyBuffer,d=u?-1:1;this.initialPrefix===null&&(this.initialPrefix=a);for(var m=this.iterator+d;u?m>=0:m<c.length;m+=d)for(var y=c[m],x=0;x<=y.length;x++)if(this.initialPrefix==y.substring(0,x))return this.iterator=m,y;if(m>=c.length)return this.iterator=c.length,this.initialPrefix;if(m<0)return a},pushInput:function(a){var u=this.historyBuffer.indexOf(a);u>-1&&this.historyBuffer.splice(u,1),a.length&&this.historyBuffer.push(a)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var Pt={matchCommand:function(a,u,c,d){var m=oe(a,u,d,c);if(!m.full&&!m.partial)return{type:"none"};if(!m.full&&m.partial)return{type:"partial"};for(var y,x=0;x<m.full.length;x++){var k=m.full[x];y||(y=k)}if(y.keys.slice(-11)=="<character>"){var b=De(a);if(!b||b.length>1)return{type:"clear"};c.selectedCharacter=b}return{type:"full",command:y}},processCommand:function(a,u,c){switch(u.inputState.repeatOverride=c.repeatOverride,c.type){case"motion":this.processMotion(a,u,c);break;case"operator":this.processOperator(a,u,c);break;case"operatorMotion":this.processOperatorMotion(a,u,c);break;case"action":this.processAction(a,u,c);break;case"search":this.processSearch(a,u,c);break;case"ex":case"keyToEx":this.processEx(a,u,c);break}},processMotion:function(a,u,c){u.inputState.motion=c.motion,u.inputState.motionArgs=W(c.motionArgs),this.evalInput(a,u)},processOperator:function(a,u,c){var d=u.inputState;if(d.operator)if(d.operator==c.operator){d.motion="expandToLine",d.motionArgs={linewise:!0},this.evalInput(a,u);return}else He(a);d.operator=c.operator,d.operatorArgs=W(c.operatorArgs),c.keys.length>1&&(d.operatorShortcut=c.keys),c.exitVisualBlock&&(u.visualBlock=!1,_i(a)),u.visualMode&&this.evalInput(a,u)},processOperatorMotion:function(a,u,c){var d=u.visualMode,m=W(c.operatorMotionArgs);m&&d&&m.visualLine&&(u.visualLine=!0),this.processOperator(a,u,c),d||this.processMotion(a,u,c)},processAction:function(a,u,c){var d=u.inputState,m=d.getRepeat(),y=!!m,x=W(c.actionArgs)||{};d.selectedCharacter&&(x.selectedCharacter=d.selectedCharacter),c.operator&&this.processOperator(a,u,c),c.motion&&this.processMotion(a,u,c),(c.motion||c.operator)&&this.evalInput(a,u),x.repeat=m||1,x.repeatIsExplicit=y,x.registerName=d.registerName,He(a),u.lastMotion=null,c.isEdit&&this.recordLastEdit(u,d,c),P[c.action](a,x,u)},processSearch:function(a,u,c){if(!a.getSearchCursor)return;var d=c.searchArgs.forward,m=c.searchArgs.wholeWordOnly;zt(a).setReversed(!d);var y=d?"/":"?",x=zt(a).getQuery(),k=a.getScrollInfo();function b(_,ie,le){G.searchHistoryController.pushInput(_),G.searchHistoryController.reset();try{mn(a,_,ie,le)}catch{Oe(a,"Invalid regex: "+_),He(a);return}Pt.processMotion(a,u,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:c.searchArgs.toJumplist}})}function M(_){a.scrollTo(k.left,k.top),b(_,!0,!0);var ie=G.macroModeState;ie.isRecording&&ec(ie,_)}function A(_,ie,le){var ee=r.keyName(_),Re,ut;ee=="Up"||ee=="Down"?(Re=ee=="Up",ut=_.target?_.target.selectionEnd:0,ie=G.searchHistoryController.nextMatch(ie,Re)||"",le(ie),ut&&_.target&&(_.target.selectionEnd=_.target.selectionStart=Math.min(ut,_.target.value.length))):ee!="Left"&&ee!="Right"&&ee!="Ctrl"&&ee!="Alt"&&ee!="Shift"&&G.searchHistoryController.reset();var $e;try{$e=mn(a,ie,!0,!0)}catch{}$e?a.scrollIntoView(ul(a,!d,$e),30):(ls(a),a.scrollTo(k.left,k.top))}function I(_,ie,le){var ee=r.keyName(_);ee=="Esc"||ee=="Ctrl-C"||ee=="Ctrl-["||ee=="Backspace"&&ie==""?(G.searchHistoryController.pushInput(ie),G.searchHistoryController.reset(),mn(a,x),ls(a),a.scrollTo(k.left,k.top),r.e_stop(_),He(a),le(),a.focus()):ee=="Up"||ee=="Down"?r.e_stop(_):ee=="Ctrl-U"&&(r.e_stop(_),le(""))}switch(c.searchArgs.querySrc){case"prompt":var H=G.macroModeState;if(H.isPlaying){var U=H.replaySearchQueries.shift();b(U,!0,!1)}else Un(a,{onClose:M,prefix:y,desc:"(JavaScript regexp)",onKeyUp:A,onKeyDown:I});break;case"wordUnderCursor":var R=qn(a,!1,!1,!1,!0),L=!0;if(R||(R=qn(a,!1,!1,!1,!1),L=!1),!R)return;var U=a.getLine(R.start.line).substring(R.start.ch,R.end.ch);L&&m?U="\\b"+U+"\\b":U=_n(U),G.jumpList.cachedCursor=a.getCursor(),a.setCursor(R.start),b(U,!0,!1);break}},processEx:function(a,u,c){function d(y){G.exCommandHistoryController.pushInput(y),G.exCommandHistoryController.reset(),It.processCommand(a,y),a.state.vim&&He(a)}function m(y,x,k){var b=r.keyName(y),M,A;(b=="Esc"||b=="Ctrl-C"||b=="Ctrl-["||b=="Backspace"&&x=="")&&(G.exCommandHistoryController.pushInput(x),G.exCommandHistoryController.reset(),r.e_stop(y),He(a),k(),a.focus()),b=="Up"||b=="Down"?(r.e_stop(y),M=b=="Up",A=y.target?y.target.selectionEnd:0,x=G.exCommandHistoryController.nextMatch(x,M)||"",k(x),A&&y.target&&(y.target.selectionEnd=y.target.selectionStart=Math.min(A,y.target.value.length))):b=="Ctrl-U"?(r.e_stop(y),k("")):b!="Left"&&b!="Right"&&b!="Ctrl"&&b!="Alt"&&b!="Shift"&&G.exCommandHistoryController.reset()}c.type=="keyToEx"?It.processCommand(a,c.exArgs.input):u.visualMode?Un(a,{onClose:d,prefix:":",value:"'<,'>",onKeyDown:m,selectValueOnOpen:!1}):Un(a,{onClose:d,prefix:":",onKeyDown:m})},evalInput:function(a,u){var c=u.inputState,d=c.motion,m=c.motionArgs||{},y=c.operator,x=c.operatorArgs||{},k=c.registerName,b=u.sel,M=he(u.visualMode?N(a,b.head):a.getCursor("head")),A=he(u.visualMode?N(a,b.anchor):a.getCursor("anchor")),I=he(M),H=he(A),R,L,U;if(y&&this.recordLastEdit(u,c),c.repeatOverride!==void 0?U=c.repeatOverride:U=c.getRepeat(),U>0&&m.explicitRepeat?m.repeatIsExplicit=!0:(m.noRepeat||!m.explicitRepeat&&U===0)&&(U=1,m.repeatIsExplicit=!1),c.selectedCharacter&&(m.selectedCharacter=x.selectedCharacter=c.selectedCharacter),m.repeat=U,He(a),d){var _=Ot[d](a,M,m,u,c);if(u.lastMotion=Ot[d],!_)return;if(m.toJumplist){var ie=G.jumpList,le=ie.cachedCursor;le?(Xo(a,le,_),delete ie.cachedCursor):Xo(a,M,_)}_ instanceof Array?(L=_[0],R=_[1]):R=_,R||(R=he(M)),u.visualMode?(u.visualBlock&&R.ch===1/0||(R=N(a,R,I)),L&&(L=N(a,L)),L=L||H,b.anchor=L,b.head=R,_i(a),ri(a,u,"<",xe(L,R)?L:R),ri(a,u,">",xe(L,R)?R:L)):y||(R=N(a,R,I),a.setCursor(R.line,R.ch))}if(y){if(x.lastSel){L=H;var ee=x.lastSel,Re=Math.abs(ee.head.line-ee.anchor.line),ut=Math.abs(ee.head.ch-ee.anchor.ch);ee.visualLine?R=new e(H.line+Re,H.ch):ee.visualBlock?R=new e(H.line+Re,H.ch+ut):ee.head.line==ee.anchor.line?R=new e(H.line,H.ch+ut):R=new e(H.line+Re,H.ch),u.visualMode=!0,u.visualLine=ee.visualLine,u.visualBlock=ee.visualBlock,b=u.sel={anchor:L,head:R},_i(a)}else u.visualMode&&(x.lastSel={anchor:he(b.anchor),head:he(b.head),visualBlock:u.visualBlock,visualLine:u.visualLine});var $e,it,ge,ye,mt;if(u.visualMode){$e=tt(b.head,b.anchor),it=Ct(b.head,b.anchor),ge=u.visualLine||x.linewise,ye=u.visualBlock?"block":ge?"line":"char";var Qe=n(a,$e,it);if(mt=ss(a,{anchor:Qe.start,head:Qe.end},ye),ge){var Xe=mt.ranges;if(ye=="block")for(var fi=0;fi<Xe.length;fi++)Xe[fi].head.ch=Je(a,Xe[fi].head.line);else ye=="line"&&(Xe[0].head=new e(Xe[0].head.line+1,0))}}else{if($e=he(L||H),it=he(R||I),xe(it,$e)){var ic=$e;$e=it,it=ic}ge=m.linewise||x.linewise,ge?Of(a,$e,it):m.forward&&Df(a,$e,it),ye="char";var nc=!m.inclusive||ge,Qe=n(a,$e,it);mt=ss(a,{anchor:Qe.start,head:Qe.end},ye,nc)}a.setSelections(mt.ranges,mt.primary),u.lastMotion=null,x.repeat=U,x.registerName=k,x.linewise=ge;var fs=S[y](a,x,mt.ranges,H,R);u.visualMode&&Kt(a,fs!=null),fs&&a.setCursor(fs)}},recordLastEdit:function(a,u,c){var d=G.macroModeState;d.isPlaying||(a.lastEditInputState=u,a.lastEditActionCommand=c,d.lastInsertModeChanges.changes=[],d.lastInsertModeChanges.expectCursorActivityForChange=!1,d.lastInsertModeChanges.visualBlock=a.visualBlock?a.sel.head.line-a.sel.anchor.line:0)}},Ot={moveToTopLine:function(a,u,c){var d=as(a).top+c.repeat-1;return new e(d,ni(a.getLine(d)))},moveToMiddleLine:function(a){var u=as(a),c=Math.floor((u.top+u.bottom)*.5);return new e(c,ni(a.getLine(c)))},moveToBottomLine:function(a,u,c){var d=as(a).bottom-c.repeat+1;return new e(d,ni(a.getLine(d)))},expandToLine:function(a,u,c){var d=u;return new e(d.line+c.repeat-1,1/0)},findNext:function(a,u,c){var d=zt(a),m=d.getQuery();if(!!m){var y=!c.forward;return y=d.isReversed()?!y:y,hl(a,m),ul(a,y,m,c.repeat)}},findAndSelectNextInclusive:function(a,u,c,d,m){var y=zt(a),x=y.getQuery();if(!!x){var k=!c.forward;k=y.isReversed()?!k:k;var b=jf(a,k,x,c.repeat,d);if(!!b){if(m.operator)return b;var M=b[0],A=new e(b[1].line,b[1].ch-1);if(d.visualMode){(d.visualLine||d.visualBlock)&&(d.visualLine=!1,d.visualBlock=!1,r.signal(a,"vim-mode-change",{mode:"visual",subMode:""}));var I=d.sel.anchor;if(I)return y.isReversed()?c.forward?[I,M]:[I,A]:c.forward?[I,A]:[I,M]}else d.visualMode=!0,d.visualLine=!1,d.visualBlock=!1,r.signal(a,"vim-mode-change",{mode:"visual",subMode:""});return k?[A,M]:[M,A]}}},goToMark:function(a,u,c,d){var m=Jn(a,d,c.selectedCharacter);return m?c.linewise?{line:m.line,ch:ni(a.getLine(m.line))}:m:null},moveToOtherHighlightedEnd:function(a,u,c,d){if(d.visualBlock&&c.sameLine){var m=d.sel;return[N(a,new e(m.anchor.line,m.head.ch)),N(a,new e(m.head.line,m.anchor.ch))]}else return[d.sel.head,d.sel.anchor]},jumpToMark:function(a,u,c,d){for(var m=u,y=0;y<c.repeat;y++){var x=m;for(var k in d.marks)if(!!me(k)){var b=d.marks[k].find(),M=c.forward?xe(b,x):xe(x,b);if(!M&&!(c.linewise&&b.line==x.line)){var A=ht(x,m),I=c.forward?Ei(x,b,m):Ei(m,b,x);(A||I)&&(m=b)}}}return c.linewise&&(m=new e(m.line,ni(a.getLine(m.line)))),m},moveByCharacters:function(a,u,c){var d=u,m=c.repeat,y=c.forward?d.ch+m:d.ch-m;return new e(d.line,y)},moveByLines:function(a,u,c,d){var m=u,y=m.ch;switch(d.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:y=d.lastHPos;break;default:d.lastHPos=y}var x=c.repeat+(c.repeatOffset||0),k=c.forward?m.line+x:m.line-x,b=a.firstLine(),M=a.lastLine(),A=a.findPosV(m,c.forward?x:-x,"line",d.lastHSPos),I=c.forward?A.line>k:A.line<k;return I&&(k=A.line,y=A.ch),k<b&&m.line==b?this.moveToStartOfLine(a,u,c,d):k>M&&m.line==M?el(a,u,c,d,!0):(c.toFirstChar&&(y=ni(a.getLine(k)),d.lastHPos=y),d.lastHSPos=a.charCoords(new e(k,y),"div").left,new e(k,y))},moveByDisplayLines:function(a,u,c,d){var m=u;switch(d.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:d.lastHSPos=a.charCoords(m,"div").left}var y=c.repeat,x=a.findPosV(m,c.forward?y:-y,"line",d.lastHSPos);if(x.hitSide)if(c.forward)var k=a.charCoords(x,"div"),b={top:k.top+8,left:d.lastHSPos},x=a.coordsChar(b,"div");else{var M=a.charCoords(new e(a.firstLine(),0),"div");M.left=d.lastHSPos,x=a.coordsChar(M,"div")}return d.lastHPos=x.ch,x},moveByPage:function(a,u,c){var d=u,m=c.repeat;return a.findPosV(d,c.forward?m:-m,"page")},moveByParagraph:function(a,u,c){var d=c.forward?1:-1;return tl(a,u,c.repeat,d)},moveBySentence:function(a,u,c){var d=c.forward?1:-1;return If(a,u,c.repeat,d)},moveByScroll:function(a,u,c,d){var m=a.getScrollInfo(),y=null,x=c.repeat;x||(x=m.clientHeight/(2*a.defaultTextHeight()));var k=a.charCoords(u,"local");if(c.repeat=x,y=Ot.moveByDisplayLines(a,u,c,d),!y)return null;var b=a.charCoords(y,"local");return a.scrollTo(null,m.top+b.top-k.top),y},moveByWords:function(a,u,c){return Rf(a,u,c.repeat,!!c.forward,!!c.wordEnd,!!c.bigWord)},moveTillCharacter:function(a,u,c){var d=c.repeat,m=os(a,d,c.forward,c.selectedCharacter,u),y=c.forward?-1:1;return Yo(y,c),m?(m.ch+=y,m):null},moveToCharacter:function(a,u,c){var d=c.repeat;return Yo(0,c),os(a,d,c.forward,c.selectedCharacter,u)||u},moveToSymbol:function(a,u,c){var d=c.repeat;return Ef(a,d,c.forward,c.selectedCharacter)||u},moveToColumn:function(a,u,c,d){var m=c.repeat;return d.lastHPos=m-1,d.lastHSPos=a.charCoords(u,"div").left,Nf(a,m)},moveToEol:function(a,u,c,d){return el(a,u,c,d,!1)},moveToFirstNonWhiteSpaceCharacter:function(a,u){var c=u;return new e(c.line,ni(a.getLine(c.line)))},moveToMatchedSymbol:function(a,u){for(var c=u,d=c.line,m=c.ch,y=a.getLine(d),x;m<y.length;m++)if(x=y.charAt(m),x&&Me(x)){var k=a.getTokenTypeAt(new e(d,m+1));if(k!=="string"&&k!=="comment")break}if(m<y.length){var b=m==="<"||m===">"?/[(){}[\]<>]/:/[(){}[\]]/,M=a.findMatchingBracket(new e(d,m),{bracketRegex:b});return M.to}else return c},moveToStartOfLine:function(a,u){return new e(u.line,0)},moveToLineOrEdgeOfDocument:function(a,u,c){var d=c.forward?a.lastLine():a.firstLine();return c.repeatIsExplicit&&(d=c.repeat-a.getOption("firstLineNumber")),new e(d,ni(a.getLine(d)))},moveToStartOfDisplayLine:function(a){return a.execCommand("goLineLeft"),a.getCursor()},moveToEndOfDisplayLine:function(a){a.execCommand("goLineRight");var u=a.getCursor();return u.sticky=="before"&&u.ch--,u},textObjectManipulation:function(a,u,c,d){var m={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"},y={"'":!0,'"':!0,"`":!0},x=c.selectedCharacter;x=="b"?x="(":x=="B"&&(x="{");var k=!c.textObjectInner,b,M;if(m[x]){if(M=!0,b=nl(a,u,x,k),!b){var A=a.getSearchCursor(new RegExp("\\"+x,"g"),u);A.find()&&(b=nl(a,A.from(),x,k))}}else if(y[x])M=!0,b=Ff(a,u,x,k);else if(x==="W")b=qn(a,k,!k,!0);else if(x==="w")b=qn(a,k,!k,!1);else if(x==="p")if(b=tl(a,u,c.repeat,0,k),c.linewise=!0,d.visualMode)d.visualLine||(d.visualLine=!0);else{var I=d.inputState.operatorArgs;I&&(I.linewise=!0),b.end.line--}else if(x==="t")b=Tf(a,u,k);else if(x==="s"){var H=a.getLine(u.line);u.ch>0&&Se(H[u.ch])&&(u.ch-=1);var R=il(a,u,c.repeat,1,k),L=il(a,u,c.repeat,-1,k);de(a.getLine(L.line)[L.ch])&&de(a.getLine(R.line)[R.ch-1])&&(L={line:L.line,ch:L.ch+1}),b={start:L,end:R}}return b?a.state.vim.visualMode?Af(a,b.start,b.end,M):[b.start,b.end]:null},repeatLastCharacterSearch:function(a,u,c){var d=G.lastCharacterSearch,m=c.repeat,y=c.forward===d.forward,x=(d.increment?1:0)*(y?-1:1);a.moveH(-x,"char"),c.inclusive=!!y;var k=os(a,m,y,d.selectedCharacter);return k?(k.ch+=x,k):(a.moveH(x,"char"),u)}};function Li(a,u){Ot[a]=u}function $n(a,u){for(var c=[],d=0;d<u;d++)c.push(a);return c}var S={change:function(a,u,c){var d,m,y=a.state.vim,x=c[0].anchor,k=c[0].head;if(y.visualMode)if(u.fullLine)k.ch=Number.MAX_VALUE,k.line--,a.setSelection(x,k),m=a.getSelection(),a.replaceSelection(""),d=x;else{m=a.getSelection();var H=$n("",c.length);a.replaceSelections(H),d=tt(c[0].head,c[0].anchor)}else{m=a.getRange(x,k);var b=y.lastEditInputState||{};if(b.motion=="moveByWords"&&!de(m)){var M=/\s+$/.exec(m);M&&b.motionArgs&&b.motionArgs.forward&&(k=j(k,0,-M[0].length),m=m.slice(0,-M[0].length))}var A=new e(x.line-1,Number.MAX_VALUE),I=a.firstLine()==a.lastLine();k.line>a.lastLine()&&u.linewise&&!I?a.replaceRange("",A,k):a.replaceRange("",x,k),u.linewise&&(I||(a.setCursor(A),r.commands.newlineAndIndent(a)),x.ch=Number.MAX_VALUE),d=x}G.registerController.pushText(u.registerName,"change",m,u.linewise,c.length>1),P.enterInsertMode(a,{head:d},a.state.vim)},delete:function(a,u,c){var d,m,y=a.state.vim;if(y.visualBlock){m=a.getSelection();var b=$n("",c.length);a.replaceSelections(b),d=tt(c[0].head,c[0].anchor)}else{var x=c[0].anchor,k=c[0].head;u.linewise&&k.line!=a.firstLine()&&x.line==a.lastLine()&&x.line==k.line-1&&(x.line==a.firstLine()?x.ch=0:x=new e(x.line-1,Je(a,x.line-1))),m=a.getRange(x,k),a.replaceRange("",x,k),d=x,u.linewise&&(d=Ot.moveToFirstNonWhiteSpaceCharacter(a,x))}return G.registerController.pushText(u.registerName,"delete",m,u.linewise,y.visualBlock),N(a,d)},indent:function(a,u,c){var d=a.state.vim;if(a.indentMore)for(var m=d.visualMode?u.repeat:1,y=0;y<m;y++)u.indentRight?a.indentMore():a.indentLess();else{var x=c[0].anchor.line,k=d.visualBlock?c[c.length-1].anchor.line:c[0].head.line,m=d.visualMode?u.repeat:1;u.linewise&&k--;for(var b=x;b<=k;b++)for(var y=0;y<m;y++)a.indentLine(b,u.indentRight)}return Ot.moveToFirstNonWhiteSpaceCharacter(a,c[0].anchor)},indentAuto:function(a,u,c){return a.execCommand("indentAuto"),Ot.moveToFirstNonWhiteSpaceCharacter(a,c[0].anchor)},changeCase:function(a,u,c,d,m){for(var y=a.getSelections(),x=[],k=u.toLower,b=0;b<y.length;b++){var M=y[b],A="";if(k===!0)A=M.toLowerCase();else if(k===!1)A=M.toUpperCase();else for(var I=0;I<M.length;I++){var H=M.charAt(I);A+=ce(H)?H.toLowerCase():H.toUpperCase()}x.push(A)}return a.replaceSelections(x),u.shouldMoveCursor?m:!a.state.vim.visualMode&&u.linewise&&c[0].anchor.line+1==c[0].head.line?Ot.moveToFirstNonWhiteSpaceCharacter(a,d):u.linewise?d:tt(c[0].anchor,c[0].head)},yank:function(a,u,c,d){var m=a.state.vim,y=a.getSelection(),x=m.visualMode?tt(m.sel.anchor,m.sel.head,c[0].head,c[0].anchor):d;return G.registerController.pushText(u.registerName,"yank",y,u.linewise,m.visualBlock),x}};function T(a,u){S[a]=u}var P={jumpListWalk:function(a,u,c){if(!c.visualMode){var d=u.repeat,m=u.forward,y=G.jumpList,x=y.move(a,m?d:-d),k=x?x.find():void 0;k=k||a.getCursor(),a.setCursor(k)}},scroll:function(a,u,c){if(!c.visualMode){var d=u.repeat||1,m=a.defaultTextHeight(),y=a.getScrollInfo().top,x=m*d,k=u.forward?y+x:y-x,b=he(a.getCursor()),M=a.charCoords(b,"local");if(u.forward)k>M.top?(b.line+=(k-M.top)/m,b.line=Math.ceil(b.line),a.setCursor(b),M=a.charCoords(b,"local"),a.scrollTo(null,M.top)):a.scrollTo(null,k);else{var A=k+a.getScrollInfo().clientHeight;A<M.bottom?(b.line-=(M.bottom-A)/m,b.line=Math.floor(b.line),a.setCursor(b),M=a.charCoords(b,"local"),a.scrollTo(null,M.bottom-a.getScrollInfo().clientHeight)):a.scrollTo(null,k)}}},scrollToCursor:function(a,u){var c=a.getCursor().line,d=a.charCoords(new e(c,0),"local"),m=a.getScrollInfo().clientHeight,y=d.top;switch(u.position){case"center":y=d.bottom-m/2;break;case"bottom":var x=new e(c,a.getLine(c).length-1),k=a.charCoords(x,"local"),b=k.bottom-y;y=y-m+b;break}a.scrollTo(null,y)},replayMacro:function(a,u,c){var d=u.selectedCharacter,m=u.repeat,y=G.macroModeState;for(d=="@"?d=y.latestRegister:y.latestRegister=d;m--;)Xf(a,c,y,d)},enterMacroRecordMode:function(a,u){var c=G.macroModeState,d=u.selectedCharacter;G.registerController.isValidRegister(d)&&c.enterMacroRecordMode(a,d)},toggleOverwrite:function(a){a.state.overwrite?(a.toggleOverwrite(!1),a.setOption("keyMap","vim-insert"),r.signal(a,"vim-mode-change",{mode:"insert"})):(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),r.signal(a,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(a,u,c){if(!a.getOption("readOnly")){c.insertMode=!0,c.insertModeRepeat=u&&u.repeat||1;var d=u?u.insertAt:null,m=c.sel,y=u.head||a.getCursor("head"),x=a.listSelections().length;if(d=="eol")y=new e(y.line,Je(a,y.line));else if(d=="bol")y=new e(y.line,0);else if(d=="charAfter"){var k=n(a,y,j(y,0,1));y=k.end}else if(d=="firstNonBlank"){var k=n(a,y,Ot.moveToFirstNonWhiteSpaceCharacter(a,y));y=k.end}else if(d=="startOfSelectedArea"){if(!c.visualMode)return;c.visualBlock?(y=new e(Math.min(m.head.line,m.anchor.line),Math.min(m.head.ch,m.anchor.ch)),x=Math.abs(m.head.line-m.anchor.line)+1):m.head.line<m.anchor.line?y=m.head:y=new e(m.anchor.line,0)}else if(d=="endOfSelectedArea"){if(!c.visualMode)return;c.visualBlock?(y=new e(Math.min(m.head.line,m.anchor.line),Math.max(m.head.ch,m.anchor.ch)+1),x=Math.abs(m.head.line-m.anchor.line)+1):m.head.line>=m.anchor.line?y=j(m.head,0,1):y=new e(m.anchor.line,0)}else if(d=="inplace"){if(c.visualMode)return}else d=="lastEdit"&&(y=fl(a)||y);a.setOption("disableInput",!1),u&&u.replace?(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),r.signal(a,"vim-mode-change",{mode:"replace"})):(a.toggleOverwrite(!1),a.setOption("keyMap","vim-insert"),r.signal(a,"vim-mode-change",{mode:"insert"})),G.macroModeState.isPlaying||(a.on("change",gl),c.insertEnd&&c.insertEnd.clear(),c.insertEnd=a.setBookmark(y,{insertLeft:!0}),r.on(a.getInputField(),"keydown",vl)),c.visualMode&&Kt(a),Go(a,y,x)}},toggleVisualMode:function(a,u,c){var d=u.repeat,m=a.getCursor(),y;if(c.visualMode)c.visualLine^u.linewise||c.visualBlock^u.blockwise?(c.visualLine=!!u.linewise,c.visualBlock=!!u.blockwise,r.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""}),_i(a)):Kt(a);else{c.visualMode=!0,c.visualLine=!!u.linewise,c.visualBlock=!!u.blockwise,y=N(a,new e(m.line,m.ch+d-1));var x=n(a,m,y);c.sel={anchor:x.start,head:x.end},r.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""}),_i(a),ri(a,c,"<",tt(m,y)),ri(a,c,">",Ct(m,y))}},reselectLastSelection:function(a,u,c){var d=c.lastSelection;if(c.visualMode&&Qo(a,c),d){var m=d.anchorMark.find(),y=d.headMark.find();if(!m||!y)return;c.sel={anchor:m,head:y},c.visualMode=!0,c.visualLine=d.visualLine,c.visualBlock=d.visualBlock,_i(a),ri(a,c,"<",tt(m,y)),ri(a,c,">",Ct(m,y)),r.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""})}},joinLines:function(a,u,c){var d,m;if(c.visualMode){if(d=a.getCursor("anchor"),m=a.getCursor("head"),xe(m,d)){var y=m;m=d,d=y}m.ch=Je(a,m.line)-1}else{var x=Math.max(u.repeat,2);d=a.getCursor(),m=N(a,new e(d.line+x-1,1/0))}for(var k=0,b=d.line;b<m.line;b++){k=Je(a,d.line);var M="",A=0;if(!u.keepSpaces){var I=a.getLine(d.line+1);A=I.search(/\S/),A==-1?A=I.length:M=" "}a.replaceRange(M,new e(d.line,k),new e(d.line+1,A))}var H=N(a,new e(d.line,k));c.visualMode&&Kt(a,!1),a.setCursor(H)},newLineAndEnterInsertMode:function(a,u,c){c.insertMode=!0;var d=he(a.getCursor());if(d.line===a.firstLine()&&!u.after)a.replaceRange(`
`,new e(a.firstLine(),0)),a.setCursor(a.firstLine(),0);else{d.line=u.after?d.line:d.line-1,d.ch=Je(a,d.line),a.setCursor(d);var m=r.commands.newlineAndIndentContinueComment||r.commands.newlineAndIndent;m(a)}this.enterInsertMode(a,{repeat:u.repeat},c)},paste:function(a,u,c){var d=G.registerController.getRegister(u.registerName);if(u.registerName==="+")navigator.clipboard.readText().then(y=>{this.continuePaste(a,u,c,y,d)});else{var m=d.toString();this.continuePaste(a,u,c,m,d)}},continuePaste:function(a,u,c,d,m){var y=he(a.getCursor());if(!!d){if(u.matchIndent){var x=a.getOption("tabSize"),k=function(Qe){var Xe=Qe.split("	").length-1,fi=Qe.split(" ").length-1;return Xe*x+fi*1},b=a.getLine(a.getCursor().line),M=k(b.match(/^\s*/)[0]),A=d.replace(/\n$/,""),I=d!==A,H=k(d.match(/^\s*/)[0]),d=A.replace(/^\s*/gm,function(Qe){var Xe=M+(k(Qe)-H);if(Xe<0)return"";if(a.getOption("indentWithTabs")){var fi=Math.floor(Xe/x);return Array(fi+1).join("	")}else return Array(Xe+1).join(" ")});d+=I?`
`:""}if(u.repeat>1)var d=Array(u.repeat+1).join(d);var R=m.linewise,L=m.blockwise;if(L){d=d.split(`
`),R&&d.pop();for(var U=0;U<d.length;U++)d[U]=d[U]==""?" ":d[U];y.ch+=u.after?1:0,y.ch=Math.min(Je(a,y.line),y.ch)}else R?c.visualMode?d=c.visualLine?d.slice(0,-1):`
`+d.slice(0,d.length-1)+`
`:u.after?(d=`
`+d.slice(0,d.length-1),y.ch=Je(a,y.line)):y.ch=0:y.ch+=u.after?1:0;var _;if(c.visualMode){c.lastPastedText=d;var ie,le=Sf(a,c),ee=le[0],Re=le[1],ut=a.getSelection(),$e=a.listSelections(),it=new Array($e.length).join("1").split("1");c.lastSelection&&(ie=c.lastSelection.headMark.find()),G.registerController.unnamedRegister.setText(ut),L?(a.replaceSelections(it),Re=new e(ee.line+d.length-1,ee.ch),a.setCursor(ee),Jo(a,Re),a.replaceSelections(d),_=ee):c.visualBlock?(a.replaceSelections(it),a.setCursor(ee),a.replaceRange(d,ee,ee),_=ee):(a.replaceRange(d,ee,Re),_=a.posFromIndex(a.indexFromPos(ee)+d.length-1)),ie&&(c.lastSelection.headMark=a.setBookmark(ie)),R&&(_.ch=0)}else if(L){a.setCursor(y);for(var U=0;U<d.length;U++){var ge=y.line+U;ge>a.lastLine()&&a.replaceRange(`
`,new e(ge,0));var ye=Je(a,ge);ye<y.ch&&kf(a,ge,y.ch)}a.setCursor(y),Jo(a,new e(y.line+d.length-1,y.ch)),a.replaceSelections(d),_=y}else if(a.replaceRange(d,y),R){var ge=u.after?y.line+1:y.line;_=new e(ge,ni(a.getLine(ge)))}else _=he(y),/\n/.test(d)||(_.ch+=d.length-(u.after?1:0));c.visualMode&&Kt(a,!1),a.setCursor(_)}},undo:function(a,u){a.operation(function(){ze(a,r.commands.undo,u.repeat)(),a.setCursor(N(a,a.getCursor("start")))})},redo:function(a,u){ze(a,r.commands.redo,u.repeat)()},setRegister:function(a,u,c){c.inputState.registerName=u.selectedCharacter},insertRegister:function(a,u,c){var d=u.selectedCharacter,m=G.registerController.getRegister(d),y=m&&m.toString();y&&a.replaceSelection(y)},oneNormalCommand:function(a,u,c){ui(a,!0),c.insertModeReturn=!0,r.on(a,"vim-command-done",function d(){c.visualMode||(c.insertModeReturn&&(c.insertModeReturn=!1,c.insertMode||P.enterInsertMode(a,{},c)),r.off(a,"vim-command-done",d))})},setMark:function(a,u,c){var d=u.selectedCharacter;ri(a,c,d,a.getCursor())},replace:function(a,u,c){var d=u.selectedCharacter,m=a.getCursor(),y,x,k=a.listSelections();if(c.visualMode)m=a.getCursor("start"),x=a.getCursor("end");else{var b=a.getLine(m.line);y=m.ch+u.repeat,y>b.length&&(y=b.length),x=new e(m.line,y)}var M=n(a,m,x);if(m=M.start,x=M.end,d==`
`)c.visualMode||a.replaceRange("",m,x),(r.commands.newlineAndIndentContinueComment||r.commands.newlineAndIndent)(a);else{var A=a.getRange(m,x);if(A=A.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,d),A=A.replace(/[^\n]/g,d),c.visualBlock){var I=new Array(a.getOption("tabSize")+1).join(" ");A=a.getSelection(),A=A.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,d),A=A.replace(/\t/g,I).replace(/[^\n]/g,d).split(`
`),a.replaceSelections(A)}else a.replaceRange(A,m,x);c.visualMode?(m=xe(k[0].anchor,k[0].head)?k[0].anchor:k[0].head,a.setCursor(m),Kt(a,!1)):a.setCursor(j(x,0,-1))}},incrementNumberToken:function(a,u){for(var c=a.getCursor(),d=a.getLine(c.line),m=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi,y,x,k,b;(y=m.exec(d))!==null&&(x=y.index,k=x+y[0].length,!(c.ch<k)););if(!(!u.backtrack&&k<=c.ch)){if(y){var M=y[2]||y[4],A=y[3]||y[5],I=u.increase?1:-1,H={"0b":2,0:8,"":10,"0x":16}[M.toLowerCase()],R=parseInt(y[1]+A,H)+I*u.repeat;b=R.toString(H);var L=M?new Array(A.length-b.length+1+y[1].length).join("0"):"";b.charAt(0)==="-"?b="-"+M+L+b.substr(1):b=M+L+b;var U=new e(c.line,x),_=new e(c.line,k);a.replaceRange(b,U,_)}else return;a.setCursor(new e(c.line,x+b.length-1))}},repeatLastEdit:function(a,u,c){var d=c.lastEditInputState;if(!!d){var m=u.repeat;m&&u.repeatIsExplicit?c.lastEditInputState.repeatOverride=m:m=c.lastEditInputState.repeatOverride||m,xl(a,c,m,!1)}},indent:function(a,u){a.indentLine(a.getCursor().line,u.indentRight)},exitInsertMode:ui};function B(a,u){P[a]=u}function N(a,u,c){var d=a.state.vim,m=d.insertMode||d.visualMode,y=Math.min(Math.max(a.firstLine(),u.line),a.lastLine()),x=a.getLine(y),k=x.length-1+Number(!!m),b=Math.min(Math.max(0,u.ch),k),M=x.charCodeAt(b);if(56320<=M&&M<=57343){var A=1;c&&c.line==y&&c.ch>b&&(A=-1),b+=A,b>k&&(b-=2)}return new e(y,b)}function W(a){var u={};for(var c in a)a.hasOwnProperty(c)&&(u[c]=a[c]);return u}function j(a,u,c){return typeof u=="object"&&(c=u.ch,u=u.line),new e(a.line+u,a.ch+c)}function oe(a,u,c,d){for(var m=d.operator,y,x=[],k=[],b=Nt?u.length-o:0,M=b;M<u.length;M++){var A=u[M];c=="insert"&&A.context!="insert"||(A.context=="operatorPending"?!m:A.context&&A.context!=c)||d.operator&&A.type=="action"||!(y=Be(a,A.keys))||(y=="partial"&&x.push(A),y=="full"&&k.push(A))}return{partial:x.length&&x,full:k.length&&k}}function Be(a,u){if(u.slice(-11)=="<character>"){var c=u.length-11,d=a.slice(0,c),m=u.slice(0,c);return d==m&&a.length>c?"full":m.indexOf(d)==0?"partial":!1}else return a==u?"full":u.indexOf(a)==0?"partial":!1}function De(a){var u=/^.*(<[^>]+>)$/.exec(a),c=u?u[1]:a.slice(-1);if(c.length>1)switch(c){case"<CR>":c=`
`;break;case"<Space>":c=" ";break;default:c="";break}return c}function ze(a,u,c){return function(){for(var d=0;d<c;d++)u(a)}}function he(a){return new e(a.line,a.ch)}function ht(a,u){return a.ch==u.ch&&a.line==u.line}function xe(a,u){return a.line<u.line||a.line==u.line&&a.ch<u.ch}function tt(a,u){return arguments.length>2&&(u=tt.apply(void 0,Array.prototype.slice.call(arguments,1))),xe(a,u)?a:u}function Ct(a,u){return arguments.length>2&&(u=Ct.apply(void 0,Array.prototype.slice.call(arguments,1))),xe(a,u)?u:a}function Ei(a,u,c){var d=xe(a,u),m=xe(u,c);return d&&m}function Je(a,u){return a.getLine(u).length}function ii(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function _n(a){return a.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function kf(a,u,c){var d=Je(a,u),m=new Array(c-d+1).join(" ");a.setCursor(new e(u,d)),a.replaceRange(m,a.getCursor())}function Jo(a,u){var c=[],d=a.listSelections(),m=he(a.clipPos(u)),y=!ht(u,m),x=a.getCursor("head"),k=Cf(d,x),b=ht(d[k].head,d[k].anchor),M=d.length-1,A=M-k>k?M:0,I=d[A].anchor,H=Math.min(I.line,m.line),R=Math.max(I.line,m.line),L=I.ch,U=m.ch,_=d[A].head.ch-L,ie=U-L;_>0&&ie<=0?(L++,y||U--):_<0&&ie>=0?(L--,b||U++):_<0&&ie==-1&&(L--,U++);for(var le=H;le<=R;le++){var ee={anchor:new e(le,L),head:new e(le,U)};c.push(ee)}return a.setSelections(c),u.ch=U,I.ch=L,I}function Go(a,u,c){for(var d=[],m=0;m<c;m++){var y=j(u,m,0);d.push({anchor:y,head:y})}a.setSelections(d,0)}function Cf(a,u,c){for(var d=0;d<a.length;d++){var m=c!="head"&&ht(a[d].anchor,u),y=c!="anchor"&&ht(a[d].head,u);if(m||y)return d}return-1}function Sf(a,u){var c=u.lastSelection,d=function(){var y=a.listSelections(),x=y[0],k=y[y.length-1],b=xe(x.anchor,x.head)?x.anchor:x.head,M=xe(k.anchor,k.head)?k.head:k.anchor;return[b,M]},m=function(){var y=a.getCursor(),x=a.getCursor(),k=c.visualBlock;if(k){var b=k.width,M=k.height;x=new e(y.line+M,y.ch+b);for(var A=[],I=y.line;I<x.line;I++){var H=new e(I,y.ch),R=new e(I,x.ch),L={anchor:H,head:R};A.push(L)}a.setSelections(A)}else{var U=c.anchorMark.find(),_=c.headMark.find(),ie=_.line-U.line,le=_.ch-U.ch;x={line:x.line+ie,ch:ie?x.ch:le+x.ch},c.visualLine&&(y=new e(y.line,0),x=new e(x.line,Je(a,x.line))),a.setSelection(y,x)}return[y,x]};return u.visualMode?d():m()}function Qo(a,u){var c=u.sel.anchor,d=u.sel.head;u.lastPastedText&&(d=a.posFromIndex(a.indexFromPos(c)+u.lastPastedText.length),u.lastPastedText=null),u.lastSelection={anchorMark:a.setBookmark(c),headMark:a.setBookmark(d),anchor:he(c),head:he(d),visualMode:u.visualMode,visualLine:u.visualLine,visualBlock:u.visualBlock}}function Af(a,u,c,d){var m=a.state.vim.sel,y=d?u:m.head,x=d?u:m.anchor,k;return xe(c,u)&&(k=c,c=u,u=k),xe(y,x)?(y=tt(u,y),x=Ct(x,c)):(x=tt(u,x),y=Ct(y,c),y=j(y,0,-1),y.ch==-1&&y.line!=a.firstLine()&&(y=new e(y.line-1,Je(a,y.line-1)))),[x,y]}function _i(a,u,m){var d=a.state.vim;u=u||d.sel;var m=m||d.visualLine?"line":d.visualBlock?"block":"char",y=ss(a,u,m);a.setSelections(y.ranges,y.primary)}function ss(a,u,c,d){var m=he(u.head),y=he(u.anchor);if(c=="char"){var x=!d&&!xe(u.head,u.anchor)?1:0,k=xe(u.head,u.anchor)?1:0;return m=j(u.head,0,x),y=j(u.anchor,0,k),{ranges:[{anchor:y,head:m}],primary:0}}else if(c=="line"){if(xe(u.head,u.anchor))m.ch=0,y.ch=Je(a,y.line);else{y.ch=0;var b=a.lastLine();m.line>b&&(m.line=b),m.ch=Je(a,m.line)}return{ranges:[{anchor:y,head:m}],primary:0}}else if(c=="block"){var M=Math.min(y.line,m.line),A=y.ch,I=Math.max(y.line,m.line),H=m.ch;A<H?H+=1:A+=1;for(var R=I-M+1,L=m.line==M?0:R-1,U=[],_=0;_<R;_++)U.push({anchor:new e(M+_,A),head:new e(M+_,H)});return{ranges:U,primary:L}}}function Mf(a){var u=a.getCursor("head");return a.getSelection().length==1&&(u=tt(u,a.getCursor("anchor"))),u}function Kt(a,u){var c=a.state.vim;u!==!1&&a.setCursor(N(a,c.sel.head)),Qo(a,c),c.visualMode=!1,c.visualLine=!1,c.visualBlock=!1,c.insertMode||r.signal(a,"vim-mode-change",{mode:"normal"})}function Df(a,u,c){var d=a.getRange(u,c);if(/\n\s*$/.test(d)){var m=d.split(`
`);m.pop();for(var y,y=m.pop();m.length>0&&y&&de(y);y=m.pop())c.line--,c.ch=0;y?(c.line--,c.ch=Je(a,c.line)):c.ch=0}}function Of(a,u,c){u.ch=0,c.ch=0,c.line++}function ni(a){if(!a)return 0;var u=a.search(/\S/);return u==-1?a.length:u}function qn(a,u,c,d,m){var y=Mf(a),x=a.getLine(y.line),k=y.ch,b=m?X[0]:te[0];if(c&&/\s/.test(x.charAt(k)))b=function(R){return/\s/.test(R)};else{for(;!b(x.charAt(k));)if(k++,k>=x.length)return null;d?b=te[0]:(b=X[0],b(x.charAt(k))||(b=X[1]))}for(var M=k,A=k;b(x.charAt(M))&&M<x.length;)M++;for(;b(x.charAt(A))&&A>=0;)A--;if(A++,u){for(var I=M;/\s/.test(x.charAt(M))&&M<x.length;)M++;if(I==M){for(var H=A;/\s/.test(x.charAt(A-1))&&A>0;)A--;A||(A=H)}}return{start:new e(y.line,A),end:new e(y.line,M)}}function Tf(a,u,c){var d=u;if(!r.findMatchingTag||!r.findEnclosingTag)return{start:d,end:d};var m=r.findMatchingTag(a,u)||r.findEnclosingTag(a,u);return!m||!m.open||!m.close?{start:d,end:d}:c?{start:m.open.from,end:m.close.to}:{start:m.open.to,end:m.close.from}}function Xo(a,u,c){ht(u,c)||G.jumpList.add(a,u,c)}function Yo(a,u){G.lastCharacterSearch.increment=a,G.lastCharacterSearch.forward=u.forward,G.lastCharacterSearch.selectedCharacter=u.selectedCharacter}var Lf={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},Zo={bracket:{isComplete:function(a){if(a.nextCh===a.symb){if(a.depth++,a.depth>=1)return!0}else a.nextCh===a.reverseSymb&&a.depth--;return!1}},section:{init:function(a){a.curMoveThrough=!0,a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return a.index===0&&a.nextCh===a.symb}},comment:{isComplete:function(a){var u=a.lastCh==="*"&&a.nextCh==="/";return a.lastCh=a.nextCh,u}},method:{init:function(a){a.symb=a.symb==="m"?"{":"}",a.reverseSymb=a.symb==="{"?"}":"{"},isComplete:function(a){return a.nextCh===a.symb}},preprocess:{init:function(a){a.index=0},isComplete:function(a){if(a.nextCh==="#"){var u=a.lineText.match(/^#(\w+)/)[1];if(u==="endif"){if(a.forward&&a.depth===0)return!0;a.depth++}else if(u==="if"){if(!a.forward&&a.depth===0)return!0;a.depth--}if(u==="else"&&a.depth===0)return!0}return!1}}};function Ef(a,u,c,d){var m=he(a.getCursor()),y=c?1:-1,x=c?a.lineCount():-1,k=m.ch,b=m.line,M=a.getLine(b),A={lineText:M,nextCh:M.charAt(k),lastCh:null,index:k,symb:d,reverseSymb:(c?{")":"(","}":"{"}:{"(":")","{":"}"})[d],forward:c,depth:0,curMoveThrough:!1},I=Lf[d];if(!I)return m;var H=Zo[I].init,R=Zo[I].isComplete;for(H&&H(A);b!==x&&u;){if(A.index+=y,A.nextCh=A.lineText.charAt(A.index),!A.nextCh){if(b+=y,A.lineText=a.getLine(b)||"",y>0)A.index=0;else{var L=A.lineText.length;A.index=L>0?L-1:0}A.nextCh=A.lineText.charAt(A.index)}R(A)&&(m.line=b,m.ch=A.index,u--)}return A.nextCh||A.curMoveThrough?new e(b,A.index):m}function Bf(a,u,c,d,m){var y=u.line,x=u.ch,k=a.getLine(y),b=c?1:-1,M=d?te:X;if(m&&k==""){if(y+=b,k=a.getLine(y),!z(a,y))return null;x=c?0:k.length}for(;;){if(m&&k=="")return{from:0,to:0,line:y};for(var A=b>0?k.length:-1,I=A,H=A;x!=A;){for(var R=!1,L=0;L<M.length&&!R;++L)if(M[L](k.charAt(x))){for(I=x;x!=A&&M[L](k.charAt(x));)x+=b;if(H=x,R=I!=H,I==u.ch&&y==u.line&&H==I+b)continue;return{from:Math.min(I,H+1),to:Math.max(I,H),line:y}}R||(x+=b)}if(y+=b,!z(a,y))return null;k=a.getLine(y),x=b>0?0:k.length}}function Rf(a,u,c,d,m,y){var x=he(u),k=[];(d&&!m||!d&&m)&&c++;for(var b=!(d&&m),M=0;M<c;M++){var A=Bf(a,u,d,y,b);if(!A){var I=Je(a,a.lastLine());k.push(d?{line:a.lastLine(),from:I,to:I}:{line:0,from:0,to:0});break}k.push(A),u=new e(A.line,d?A.to-1:A.from)}var H=k.length!=c,R=k[0],L=k.pop();return d&&!m?(!H&&(R.from!=x.ch||R.line!=x.line)&&(L=k.pop()),new e(L.line,L.from)):d&&m?new e(L.line,L.to-1):!d&&m?(!H&&(R.to!=x.ch||R.line!=x.line)&&(L=k.pop()),new e(L.line,L.to)):new e(L.line,L.from)}function el(a,u,c,d,m){var y=u,x=new e(y.line+c.repeat-1,1/0),k=a.clipPos(x);return k.ch--,m||(d.lastHPos=1/0,d.lastHSPos=a.charCoords(k,"div").left),x}function os(a,u,c,d,m){for(var y=m||a.getCursor(),x=y.ch,k,b=0;b<u;b++){var M=a.getLine(y.line);if(k=Pf(x,M,d,c,!0),k==-1)return null;x=k}return new e(a.getCursor().line,k)}function Nf(a,u){var c=a.getCursor().line;return N(a,new e(c,u-1))}function ri(a,u,c,d){!Le(c,be)||(u.marks[c]&&u.marks[c].clear(),u.marks[c]=a.setBookmark(d))}function Pf(a,u,c,d,m){var y;return d?(y=u.indexOf(c,a+1),y!=-1&&!m&&(y-=1)):(y=u.lastIndexOf(c,a-1),y!=-1&&!m&&(y+=1)),y}function tl(a,u,c,d,m){var y=u.line,x=a.firstLine(),k=a.lastLine(),b,M,A=y;function I(_){return!a.getLine(_)}function H(_,ie,le){return le?I(_)!=I(_+ie):!I(_)&&I(_+ie)}if(d){for(;x<=A&&A<=k&&c>0;)H(A,d)&&c--,A+=d;return new e(A,0)}var R=a.state.vim;if(R.visualLine&&H(y,1,!0)){var L=R.sel.anchor;H(L.line,-1,!0)&&(!m||L.line!=y)&&(y+=1)}var U=I(y);for(A=y;A<=k&&c;A++)H(A,1,!0)&&(!m||I(A)!=U)&&c--;for(M=new e(A,0),A>k&&!U?U=!0:m=!1,A=y;A>x&&!((!m||I(A)==U||A==y)&&H(A,-1,!0));A--);return b=new e(A,0),{start:b,end:M}}function il(a,u,c,d,m){function y(M){M.pos+M.dir<0||M.pos+M.dir>=M.line.length?M.line=null:M.pos+=M.dir}function x(M,A,I,H){var R=M.getLine(A),L={line:R,ln:A,pos:I,dir:H};if(L.line==="")return{ln:L.ln,pos:L.pos};var U=L.pos;for(y(L);L.line!==null;){if(U=L.pos,Se(L.line[L.pos]))if(m){for(y(L);L.line!==null&&de(L.line[L.pos]);)U=L.pos,y(L);return{ln:L.ln,pos:U+1}}else return{ln:L.ln,pos:L.pos+1};y(L)}return{ln:L.ln,pos:U+1}}function k(M,A,I,H){var R=M.getLine(A),L={line:R,ln:A,pos:I,dir:H};if(L.line==="")return{ln:L.ln,pos:L.pos};var U=L.pos;for(y(L);L.line!==null;){if(!de(L.line[L.pos])&&!Se(L.line[L.pos]))U=L.pos;else if(Se(L.line[L.pos]))return m?de(L.line[L.pos+1])?{ln:L.ln,pos:L.pos+1}:{ln:L.ln,pos:U}:{ln:L.ln,pos:U};y(L)}return L.line=R,m&&de(L.line[L.pos])?{ln:L.ln,pos:L.pos}:{ln:L.ln,pos:U}}for(var b={ln:u.line,pos:u.ch};c>0;)d<0?b=k(a,b.ln,b.pos,d):b=x(a,b.ln,b.pos,d),c--;return new e(b.ln,b.pos)}function If(a,u,c,d){function m(b,M){if(M.pos+M.dir<0||M.pos+M.dir>=M.line.length){if(M.ln+=M.dir,!z(b,M.ln)){M.line=null,M.ln=null,M.pos=null;return}M.line=b.getLine(M.ln),M.pos=M.dir>0?0:M.line.length-1}else M.pos+=M.dir}function y(b,M,A,I){var _=b.getLine(M),H=_==="",R={line:_,ln:M,pos:A,dir:I},L={ln:R.ln,pos:R.pos},U=R.line==="";for(m(b,R);R.line!==null;){if(L.ln=R.ln,L.pos=R.pos,R.line===""&&!U)return{ln:R.ln,pos:R.pos};if(H&&R.line!==""&&!de(R.line[R.pos]))return{ln:R.ln,pos:R.pos};Se(R.line[R.pos])&&!H&&(R.pos===R.line.length-1||de(R.line[R.pos+1]))&&(H=!0),m(b,R)}var _=b.getLine(L.ln);L.pos=0;for(var ie=_.length-1;ie>=0;--ie)if(!de(_[ie])){L.pos=ie;break}return L}function x(b,M,A,I){var U=b.getLine(M),H={line:U,ln:M,pos:A,dir:I},R={ln:H.ln,pos:null},L=H.line==="";for(m(b,H);H.line!==null;){if(H.line===""&&!L)return R.pos!==null?R:{ln:H.ln,pos:H.pos};if(Se(H.line[H.pos])&&R.pos!==null&&!(H.ln===R.ln&&H.pos+1===R.pos))return R;H.line!==""&&!de(H.line[H.pos])&&(L=!1,R={ln:H.ln,pos:H.pos}),m(b,H)}var U=b.getLine(R.ln);R.pos=0;for(var _=0;_<U.length;++_)if(!de(U[_])){R.pos=_;break}return R}for(var k={ln:u.line,pos:u.ch};c>0;)d<0?k=x(a,k.ln,k.pos,d):k=y(a,k.ln,k.pos,d),c--;return new e(k.ln,k.pos)}function nl(a,u,c,d){var m=u,y,x,k={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[c],b={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[c],M=a.getLine(m.line).charAt(m.ch),A=M===b?1:0;if(y=a.scanForBracket(new e(m.line,m.ch+A),-1,void 0,{bracketRegex:k}),x=a.scanForBracket(new e(m.line,m.ch+A),1,void 0,{bracketRegex:k}),!y||!x)return null;if(y=y.pos,x=x.pos,y.line==x.line&&y.ch>x.ch||y.line>x.line){var I=y;y=x,x=I}return d?x.ch+=1:y.ch+=1,{start:y,end:x}}function Ff(a,u,c,d){var m=he(u),y=a.getLine(m.line),x=y.split(""),k,b,M,A,I=x.indexOf(c);if(m.ch<I)m.ch=I;else if(I<m.ch&&x[m.ch]==c){var H=/string/.test(a.getTokenTypeAt(j(u,0,1))),R=/string/.test(a.getTokenTypeAt(u)),L=H&&!R;L||(b=m.ch,--m.ch)}if(x[m.ch]==c&&!b)k=m.ch+1;else for(M=m.ch;M>-1&&!k;M--)x[M]==c&&(k=M+1);if(k&&!b)for(M=k,A=x.length;M<A&&!b;M++)x[M]==c&&(b=M);return!k||!b?{start:m,end:m}:(d&&(--k,++b),{start:new e(m.line,k),end:new e(m.line,b)})}Ae("pcre",!0,"boolean");function rl(){}rl.prototype={getQuery:function(){return G.query},setQuery:function(a){G.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return G.isReversed},setReversed:function(a){G.isReversed=a},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(a){this.annotate=a}};function zt(a){var u=a.state.vim;return u.searchState_||(u.searchState_=new rl)}function Hf(a){return sl(a,"/")}function Vf(a){return ol(a,"/")}function sl(a,u){var c=ol(a,u)||[];if(!c.length)return[];var d=[];if(c[0]===0){for(var m=0;m<c.length;m++)typeof c[m]=="number"&&d.push(a.substring(c[m]+1,c[m+1]));return d}}function ol(a,u){u||(u="/");for(var c=!1,d=[],m=0;m<a.length;m++){var y=a.charAt(m);!c&&y==u&&d.push(m),c=!c&&y=="\\"}return d}function Wf(a){for(var u="|(){",c="}",d=!1,m=[],y=-1;y<a.length;y++){var x=a.charAt(y)||"",k=a.charAt(y+1)||"",b=k&&u.indexOf(k)!=-1;d?((x!=="\\"||!b)&&m.push(x),d=!1):x==="\\"?(d=!0,k&&c.indexOf(k)!=-1&&(b=!0),(!b||k==="\\")&&m.push(x)):(m.push(x),b&&k!=="\\"&&m.push("\\"))}return m.join("")}var ll={"\\n":`
`,"\\r":"\r","\\t":"	"};function Kf(a){for(var u=!1,c=[],d=-1;d<a.length;d++){var m=a.charAt(d)||"",y=a.charAt(d+1)||"";ll[m+y]?(c.push(ll[m+y]),d++):u?(c.push(m),u=!1):m==="\\"?(u=!0,Te(y)||y==="$"?c.push("$"):y!=="/"&&y!=="\\"&&c.push("\\")):(m==="$"&&c.push("$"),c.push(m),y==="/"&&c.push("\\"))}return c.join("")}var al={"\\/":"/","\\\\":"\\","\\n":`
`,"\\r":"\r","\\t":"	","\\&":"&"};function zf(a){for(var u=new r.StringStream(a),c=[];!u.eol();){for(;u.peek()&&u.peek()!="\\";)c.push(u.next());var d=!1;for(var m in al)if(u.match(m,!0)){d=!0,c.push(al[m]);break}d||c.push(u.next())}return c.join("")}function $f(a,u,c){var d=G.registerController.getRegister("/");if(d.setText(a),a instanceof RegExp)return a;var m=Vf(a),y,x;if(!m.length)y=a;else{y=a.substring(0,m[0]);var k=a.substring(m[0]);x=k.indexOf("i")!=-1}if(!y)return null;et("pcre")||(y=Wf(y)),c&&(u=/^[^A-Z]*$/.test(y));var b=new RegExp(y,u||x?"im":"m");return b}function hi(a){typeof a=="string"&&(a=document.createElement(a));for(var u,c=1;c<arguments.length;c++)if(!!(u=arguments[c]))if(typeof u!="object"&&(u=document.createTextNode(u)),u.nodeType)a.appendChild(u);else for(var d in u)!Object.prototype.hasOwnProperty.call(u,d)||(d[0]==="$"?a.style[d.slice(1)]=u[d]:a.setAttribute(d,u[d]));return a}function Oe(a,u){var c=hi("div",{$color:"red",$whiteSpace:"pre",class:"cm-vim-message"},u);a.openNotification?a.openNotification(c,{bottom:!0,duration:5e3}):alert(c.innerText)}function _f(a,u){return hi("div",{$display:"flex"},hi("span",{$fontFamily:"monospace",$whiteSpace:"pre",$flex:1},a,hi("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false",$width:"100%"})),u&&hi("span",{$color:"#888"},u))}function Un(a,u){var c=_f(u.prefix,u.desc);if(a.openDialog)a.openDialog(c,u.onClose,{onKeyDown:u.onKeyDown,onKeyUp:u.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:u.value});else{var d="";typeof u.prefix!="string"&&u.prefix&&(d+=u.prefix.textContent),u.desc&&(d+=" "+u.desc),u.onClose(prompt(d,""))}}function qf(a,u){if(a instanceof RegExp&&u instanceof RegExp){for(var c=["global","multiline","ignoreCase","source"],d=0;d<c.length;d++){var m=c[d];if(a[m]!==u[m])return!1}return!0}return!1}function mn(a,u,c,d){if(!!u){var m=zt(a),y=$f(u,!!c,!!d);if(!!y)return hl(a,y),qf(y,m.getQuery())||m.setQuery(y),y}}function Uf(a){if(a.source.charAt(0)=="^")var u=!0;return{token:function(c){if(u&&!c.sol()){c.skipToEnd();return}var d=c.match(a,!1);if(d)return d[0].length==0?(c.next(),"searching"):!c.sol()&&(c.backUp(1),!a.exec(c.next()+d[0]))?(c.next(),null):(c.match(a),"searching");for(;!c.eol()&&(c.next(),!c.match(a,!1)););},query:a}}var jn=0;function hl(a,u){clearTimeout(jn),jn=setTimeout(function(){if(!!a.state.vim){var c=zt(a),d=c.getOverlay();(!d||u!=d.query)&&(d&&a.removeOverlay(d),d=Uf(u),a.addOverlay(d),a.showMatchesOnScrollbar&&(c.getScrollbarAnnotate()&&c.getScrollbarAnnotate().clear(),c.setScrollbarAnnotate(a.showMatchesOnScrollbar(u))),c.setOverlay(d))}},50)}function ul(a,u,c,d){return d===void 0&&(d=1),a.operation(function(){for(var m=a.getCursor(),y=a.getSearchCursor(c,m),x=0;x<d;x++){var k=y.find(u);if(x==0&&k&&ht(y.from(),m)){var b=u?y.from():y.to();k=y.find(u),k&&!k[0]&&ht(y.from(),b)&&a.getLine(b.line).length==b.ch&&(k=y.find(u))}if(!k&&(y=a.getSearchCursor(c,u?new e(a.lastLine()):new e(a.firstLine(),0)),!y.find(u)))return}return y.from()})}function jf(a,u,c,d,m){return d===void 0&&(d=1),a.operation(function(){var y=a.getCursor(),x=a.getSearchCursor(c,y),k=x.find(!u);!m.visualMode&&k&&ht(x.from(),y)&&x.find(!u);for(var b=0;b<d;b++)if(k=x.find(u),!k&&(x=a.getSearchCursor(c,u?new e(a.lastLine()):new e(a.firstLine(),0)),!x.find(u)))return;return[x.from(),x.to()]})}function ls(a){var u=zt(a);a.removeOverlay(zt(a).getOverlay()),u.setOverlay(null),u.getScrollbarAnnotate()&&(u.getScrollbarAnnotate().clear(),u.setScrollbarAnnotate(null))}function Jf(a,u,c){return typeof a!="number"&&(a=a.line),u instanceof Array?Le(a,u):typeof c=="number"?a>=u&&a<=c:a==u}function as(a){var u=a.getScrollInfo(),c=6,d=10,m=a.coordsChar({left:0,top:c+u.top},"local"),y=u.clientHeight-d+u.top,x=a.coordsChar({left:0,top:y},"local");return{top:m.line,bottom:x.line}}function Jn(a,u,c){if(c=="'"||c=="`")return G.jumpList.find(a,-1)||new e(0,0);if(c==".")return fl(a);var d=u.marks[c];return d&&d.find()}function fl(a){if(a.getLastEditEnd)return a.getLastEditEnd();for(var u=a.doc.history.done,c=u.length;c--;)if(u[c].changes)return he(u[c].changes[0].to)}var cl=function(){this.buildCommandMap_()};cl.prototype={processCommand:function(a,u,c){var d=this;a.operation(function(){a.curOp.isVimOp=!0,d._processCommand(a,u,c)})},_processCommand:function(a,u,c){var d=a.state.vim,m=G.registerController.getRegister(":"),y=m.toString(),x=new r.StringStream(u);m.setText(u);var k=c||{};k.input=u;try{this.parseInput_(a,x,k)}catch(I){throw Oe(a,I.toString()),I}d.visualMode&&Kt(a);var b,M;if(!k.commandName)k.line!==void 0&&(M="move");else if(b=this.matchCommand_(k.commandName),b){if(M=b.name,b.excludeFromCommandHistory&&m.setText(y),this.parseCommandArgs_(x,k,b),b.type=="exToKey"){for(var A=0;A<b.toKeys.length;A++)Ke.handleKey(a,b.toKeys[A],"mapping");return}else if(b.type=="exToEx"){this.processCommand(a,b.toInput);return}}if(!M){Oe(a,'Not an editor command ":'+u+'"');return}try{dl[M](a,k),(!b||!b.possiblyAsync)&&k.callback&&k.callback()}catch(I){throw Oe(a,I.toString()),I}},parseInput_:function(a,u,c){var m,y;u.eatWhile(":"),u.eat("%")?(c.line=a.firstLine(),c.lineEnd=a.lastLine()):(c.line=this.parseLineSpec_(a,u),c.line!==void 0&&u.eat(",")&&(c.lineEnd=this.parseLineSpec_(a,u))),c.line==null?a.state.vim.visualMode?(c.selectionLine=(m=Jn(a,a.state.vim,"<"))==null?void 0:m.line,c.selectionLineEnd=(y=Jn(a,a.state.vim,">"))==null?void 0:y.line):c.selectionLine=a.getCursor().line:(c.selectionLine=c.line,c.selectionLineEnd=c.lineEnd);var d=u.match(/^(\w+|!!|@@|[!#&*<=>@~])/);return d?c.commandName=d[1]:c.commandName=u.match(/.*/)[0],c},parseLineSpec_:function(a,u){var c=u.match(/^(\d+)/);if(c)return parseInt(c[1],10)-1;switch(u.next()){case".":return this.parseLineSpecOffset_(u,a.getCursor().line);case"$":return this.parseLineSpecOffset_(u,a.lastLine());case"'":var d=u.next(),m=Jn(a,a.state.vim,d);if(!m)throw new Error("Mark not set");return this.parseLineSpecOffset_(u,m.line);case"-":case"+":return u.backUp(1),this.parseLineSpecOffset_(u,a.getCursor().line);default:u.backUp(1);return}},parseLineSpecOffset_:function(a,u){var c=a.match(/^([+-])?(\d+)/);if(c){var d=parseInt(c[2],10);c[1]=="-"?u-=d:u+=d}return u},parseCommandArgs_:function(a,u,c){if(!a.eol()){u.argString=a.match(/.*/)[0];var d=c.argDelimiter||/\s+/,m=ii(u.argString).split(d);m.length&&m[0]&&(u.args=m)}},matchCommand_:function(a){for(var u=a.length;u>0;u--){var c=a.substring(0,u);if(this.commandMap_[c]){var d=this.commandMap_[c];if(d.name.indexOf(a)===0)return d}}return null},buildCommandMap_:function(){this.commandMap_={};for(var a=0;a<l.length;a++){var u=l[a],c=u.shortName||u.name;this.commandMap_[c]=u}},map:function(a,u,c,d){if(a!=":"&&a.charAt(0)==":"){if(c)throw Error("Mode not supported for ex mappings");var m=a.substring(1);u!=":"&&u.charAt(0)==":"?this.commandMap_[m]={name:m,type:"exToEx",toInput:u.substring(1),user:!0}:this.commandMap_[m]={name:m,type:"exToKey",toKeys:u,user:!0}}else if(u!=":"&&u.charAt(0)==":"){var y={keys:a,type:"keyToEx",exArgs:{input:u.substring(1)}};c&&(y.context=c),s.unshift(y)}else{var y={keys:a,type:"keyToKey",toKeys:u,noremap:d};c&&(y.context=c),s.unshift(y)}},unmap:function(a,u){if(a!=":"&&a.charAt(0)==":"){if(u)throw Error("Mode not supported for ex mappings");var c=a.substring(1);if(this.commandMap_[c]&&this.commandMap_[c].user)return delete this.commandMap_[c],!0}else for(var d=a,m=0;m<s.length;m++)if(d==s[m].keys&&s[m].context===u)return s.splice(m,1),!0}};var dl={colorscheme:function(a,u){if(!u.args||u.args.length<1){Oe(a,a.getOption("theme"));return}a.setOption("theme",u.args[0])},map:function(a,u,c,d){var m=u.args;if(!m||m.length<2){a&&Oe(a,"Invalid mapping: "+u.input);return}It.map(m[0],m[1],c,d)},imap:function(a,u){this.map(a,u,"insert")},nmap:function(a,u){this.map(a,u,"normal")},vmap:function(a,u){this.map(a,u,"visual")},omap:function(a,u){this.map(a,u,"operatorPending")},noremap:function(a,u){this.map(a,u,void 0,!0)},inoremap:function(a,u){this.map(a,u,"insert",!0)},nnoremap:function(a,u){this.map(a,u,"normal",!0)},vnoremap:function(a,u){this.map(a,u,"visual",!0)},onoremap:function(a,u){this.map(a,u,"operatorPending",!0)},unmap:function(a,u,c){var d=u.args;(!d||d.length<1||!It.unmap(d[0],c))&&a&&Oe(a,"No such mapping: "+u.input)},mapclear:function(a,u){Ke.mapclear()},imapclear:function(a,u){Ke.mapclear("insert")},nmapclear:function(a,u){Ke.mapclear("normal")},vmapclear:function(a,u){Ke.mapclear("visual")},omapclear:function(a,u){Ke.mapclear("operatorPending")},move:function(a,u){Pt.processCommand(a,a.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:u.line+1})},set:function(a,u){var c=u.args,d=u.setCfg||{};if(!c||c.length<1){a&&Oe(a,"Invalid mapping: "+u.input);return}var m=c[0].split("="),y=m[0],x=m[1],k=!1;if(y.charAt(y.length-1)=="?"){if(x)throw Error("Trailing characters: "+u.argString);y=y.substring(0,y.length-1),k=!0}x===void 0&&y.substring(0,2)=="no"&&(y=y.substring(2),x=!1);var b=fe[y]&&fe[y].type=="boolean";if(b&&x==null&&(x=!0),!b&&x===void 0||k){var M=et(y,a,d);M instanceof Error?Oe(a,M.message):M===!0||M===!1?Oe(a," "+(M?"":"no")+y):Oe(a,"  "+y+"="+M)}else{var A=at(y,x,a,d);A instanceof Error&&Oe(a,A.message)}},setlocal:function(a,u){u.setCfg={scope:"local"},this.set(a,u)},setglobal:function(a,u){u.setCfg={scope:"global"},this.set(a,u)},registers:function(a,u){var c=u.args,d=G.registerController.registers,m=`----------Registers----------

`;if(c){var y;c=c.join("");for(var k=0;k<c.length;k++)if(y=c.charAt(k),!!G.registerController.isValidRegister(y)){var b=d[y]||new gt;m+='"'+y+"    "+b.toString()+`
`}}else for(var y in d){var x=d[y].toString();x.length&&(m+='"'+y+"    "+x+`
`)}Oe(a,m)},sort:function(a,u){var c,d,m,y,x;function k(){if(u.argString){var ge=new r.StringStream(u.argString);if(ge.eat("!")&&(c=!0),ge.eol())return;if(!ge.eatSpace())return"Invalid arguments";var ye=ge.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!ye&&!ge.eol())return"Invalid arguments";if(ye[1]){d=ye[1].indexOf("i")!=-1,m=ye[1].indexOf("u")!=-1;var mt=ye[1].indexOf("d")!=-1||ye[1].indexOf("n")!=-1&&1,Qe=ye[1].indexOf("x")!=-1&&1,Xe=ye[1].indexOf("o")!=-1&&1;if(mt+Qe+Xe>1)return"Invalid arguments";y=mt&&"decimal"||Qe&&"hex"||Xe&&"octal"}ye[2]&&(x=new RegExp(ye[2].substr(1,ye[2].length-2),d?"i":""))}}var b=k();if(b){Oe(a,b+": "+u.argString);return}var M=u.line||a.firstLine(),A=u.lineEnd||u.line||a.lastLine();if(M==A)return;var I=new e(M,0),H=new e(A,Je(a,A)),R=a.getRange(I,H).split(`
`),L=x||(y=="decimal"?/(-?)([\d]+)/:y=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:y=="octal"?/([0-7]+)/:null),U=y=="decimal"?10:y=="hex"?16:y=="octal"?8:null,_=[],ie=[];if(y||x)for(var le=0;le<R.length;le++){var ee=x?R[le].match(x):null;ee&&ee[0]!=""?_.push(ee):!x&&L.exec(R[le])?_.push(R[le]):ie.push(R[le])}else ie=R;function Re(ge,ye){if(c){var mt;mt=ge,ge=ye,ye=mt}d&&(ge=ge.toLowerCase(),ye=ye.toLowerCase());var Qe=y&&L.exec(ge),Xe=y&&L.exec(ye);return Qe?(Qe=parseInt((Qe[1]+Qe[2]).toLowerCase(),U),Xe=parseInt((Xe[1]+Xe[2]).toLowerCase(),U),Qe-Xe):ge<ye?-1:1}function ut(ge,ye){if(c){var mt;mt=ge,ge=ye,ye=mt}return d&&(ge[0]=ge[0].toLowerCase(),ye[0]=ye[0].toLowerCase()),ge[0]<ye[0]?-1:1}if(_.sort(x?ut:Re),x)for(var le=0;le<_.length;le++)_[le]=_[le].input;else y||ie.sort(Re);if(R=c?_.concat(ie):ie.concat(_),m){var $e=R,it;R=[];for(var le=0;le<$e.length;le++)$e[le]!=it&&R.push($e[le]),it=$e[le]}a.replaceRange(R.join(`
`),I,H)},vglobal:function(a,u){this.global(a,u)},normal:function(a,u){var c=u.argString&&u.argString.trimStart();if(!c){Oe(a,"Argument is required.");return}var d=u.line;if(typeof d=="number")for(var m=isNaN(u.lineEnd)?d:u.lineEnd,y=d;y<=m;y++)a.setCursor(y,0),$i(a,u.argString.trimStart()),a.state.vim.insertMode&&ui(a,!0);else $i(a,u.argString.trimStart()),a.state.vim.insertMode&&ui(a,!0)},global:function(a,u){var c=u.argString;if(!c){Oe(a,"Regular Expression missing from global");return}var d=u.commandName[0]==="v";c[0]==="!"&&u.commandName[0]==="g"&&(d=!0,c=c.slice(1));var m=u.line!==void 0?u.line:a.firstLine(),y=u.lineEnd||u.line||a.lastLine(),x=Hf(c),k=c,b;if(x.length&&(k=x[0],b=x.slice(1,x.length).join("/")),k)try{mn(a,k,!0,!0)}catch{Oe(a,"Invalid regex: "+k);return}for(var M=zt(a).getQuery(),A=[],I=m;I<=y;I++){var H=a.getLine(I),R=M.test(H);R!==d&&A.push(b?a.getLineHandle(I):H)}if(!b){Oe(a,A.join(`
`));return}var L=0,U=function(){if(L<A.length){var _=A[L++],ie=a.getLineNumber(_);if(ie==null){U();return}var le=ie+1+b;It.processCommand(a,le,{callback:U})}else a.releaseLineHandles&&a.releaseLineHandles()};U()},substitute:function(a,u){if(!a.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var c=u.argString,d=c?sl(c,c[0]):[],m,y="",x,k,b,M=!1,A=!1;if(d.length)m=d[0],et("pcre")&&m!==""&&(m=new RegExp(m).source),y=d[1],y!==void 0&&(et("pcre")?y=zf(y.replace(/([^\\])&/g,"$1$$&")):y=Kf(y),G.lastSubstituteReplacePart=y),x=d[2]?d[2].split(" "):[];else if(c&&c.length){Oe(a,"Substitutions should be of the form :s/pattern/replace/");return}if(x&&(k=x[0],b=parseInt(x[1]),k&&(k.indexOf("c")!=-1&&(M=!0),k.indexOf("g")!=-1&&(A=!0),et("pcre")?m=m+"/"+k:m=m.replace(/\//g,"\\/")+"/"+k)),m)try{mn(a,m,!0,!0)}catch{Oe(a,"Invalid regex: "+m);return}if(y=y||G.lastSubstituteReplacePart,y===void 0){Oe(a,"No previous substitute regular expression");return}var I=zt(a),H=I.getQuery(),R=u.line!==void 0?u.line:a.getCursor().line,L=u.lineEnd||R;R==a.firstLine()&&L==a.lastLine()&&(L=1/0),b&&(R=L,L=R+b-1);var U=N(a,new e(R,0)),_=a.getSearchCursor(H,U);Gf(a,M,A,R,L,_,H,y,u.callback)},redo:r.commands.redo,undo:r.commands.undo,write:function(a){r.commands.save?r.commands.save(a):a.save&&a.save()},nohlsearch:function(a){ls(a)},yank:function(a){var u=he(a.getCursor()),c=u.line,d=a.getLine(c);G.registerController.pushText("0","yank",d,!0,!0)},delete:function(a,u){var c=u.selectionLine,d=isNaN(u.selectionLineEnd)?c:u.selectionLineEnd;S.delete(a,{linewise:!0},[{anchor:new e(c,0),head:new e(d+1,0)}])},join:function(a,u){var c=u.selectionLine,d=isNaN(u.selectionLineEnd)?c:u.selectionLineEnd;a.setCursor(new e(c,0)),P.joinLines(a,{repeat:d-c},a.state.vim)},delmarks:function(a,u){if(!u.argString||!ii(u.argString)){Oe(a,"Argument required");return}for(var c=a.state.vim,d=new r.StringStream(ii(u.argString));!d.eol();){d.eatSpace();var m=d.pos;if(!d.match(/[a-zA-Z]/,!1)){Oe(a,"Invalid argument: "+u.argString.substring(m));return}var y=d.next();if(d.match("-",!0)){if(!d.match(/[a-zA-Z]/,!1)){Oe(a,"Invalid argument: "+u.argString.substring(m));return}var x=y,k=d.next();if(me(x)&&me(k)||ce(x)&&ce(k)){var b=x.charCodeAt(0),M=k.charCodeAt(0);if(b>=M){Oe(a,"Invalid argument: "+u.argString.substring(m));return}for(var A=0;A<=M-b;A++){var I=String.fromCharCode(b+A);delete c.marks[I]}}else{Oe(a,"Invalid argument: "+x+"-");return}}else delete c.marks[y]}}},It=new cl;function Gf(a,u,c,d,m,y,x,k,b){a.state.vim.exMode=!0;var M=!1,A,I,H;function R(){a.operation(function(){for(;!M;)L(),_();ie()})}function L(){var ee=a.getRange(y.from(),y.to()),Re=ee.replace(x,k),ut=y.to().line;y.replace(Re),I=y.to().line,m+=I-ut,H=I<ut}function U(){var ee=A&&he(y.to()),Re=y.findNext();return Re&&!Re[0]&&ee&&ht(y.from(),ee)&&(Re=y.findNext()),Re}function _(){for(;U()&&Jf(y.from(),d,m);)if(!(!c&&y.from().line==I&&!H)){a.scrollIntoView(y.from(),30),a.setSelection(y.from(),y.to()),A=y.from(),M=!1;return}M=!0}function ie(ee){if(ee&&ee(),a.focus(),A){a.setCursor(A);var Re=a.state.vim;Re.exMode=!1,Re.lastHPos=Re.lastHSPos=A.ch}b&&b()}function le(ee,Re,ut){r.e_stop(ee);var $e=r.keyName(ee);switch($e){case"Y":L(),_();break;case"N":_();break;case"A":var it=b;b=void 0,a.operation(R),b=it;break;case"L":L();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":ie(ut);break}return M&&ie(ut),!0}if(_(),M){Oe(a,"No matches for "+x.source);return}if(!u){R(),b&&b();return}Un(a,{prefix:hi("span","replace with ",hi("strong",k)," (y/n/a/q/l)"),onKeyDown:le})}r.keyMap.vim={attach:p,detach:g,call:v};function ui(a,u){var c=a.state.vim,d=G.macroModeState,m=G.registerController.getRegister("."),y=d.isPlaying,x=d.lastInsertModeChanges;y||(a.off("change",gl),c.insertEnd&&c.insertEnd.clear(),c.insertEnd=null,r.off(a.getInputField(),"keydown",vl)),!y&&c.insertModeRepeat>1&&(xl(a,c,c.insertModeRepeat-1,!0),c.lastEditInputState.repeatOverride=c.insertModeRepeat),delete c.insertModeRepeat,c.insertMode=!1,u||a.setCursor(a.getCursor().line,a.getCursor().ch-1),a.setOption("keyMap","vim"),a.setOption("disableInput",!0),a.toggleOverwrite(!1),m.setText(x.changes.join("")),r.signal(a,"vim-mode-change",{mode:"normal"}),d.isRecording&&Zf(d)}function pl(a){s.unshift(a)}function Qf(a,u,c,d,m){var y={keys:a,type:u};y[u]=c,y[u+"Args"]=d;for(var x in m)y[x]=m[x];pl(y)}Ae("insertModeEscKeysTimeout",200,"number"),r.keyMap["vim-insert"]={fallthrough:["default"],attach:p,detach:g,call:v},r.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:p,detach:g};function Xf(a,u,c,d){var m=G.registerController.getRegister(d);if(d==":"){m.keyBuffer[0]&&It.processCommand(a,m.keyBuffer[0]),c.isPlaying=!1;return}var y=m.keyBuffer,x=0;c.isPlaying=!0,c.replaySearchQueries=m.searchQueries.slice(0);for(var k=0;k<y.length;k++)for(var b=y[k],M,A;b;)if(M=/<\w+-.+?>|<\w+>|./.exec(b),A=M[0],b=b.substring(M.index+A.length),Ke.handleKey(a,A,"macro"),u.insertMode){var I=m.insertModeChanges[x++].changes;G.macroModeState.lastInsertModeChanges.changes=I,bl(a,I,1),ui(a)}c.isPlaying=!1}function Yf(a,u){if(!a.isPlaying){var c=a.latestRegister,d=G.registerController.getRegister(c);d&&d.pushText(u)}}function Zf(a){if(!a.isPlaying){var u=a.latestRegister,c=G.registerController.getRegister(u);c&&c.pushInsertModeChanges&&c.pushInsertModeChanges(a.lastInsertModeChanges)}}function ec(a,u){if(!a.isPlaying){var c=a.latestRegister,d=G.registerController.getRegister(c);d&&d.pushSearchQuery&&d.pushSearchQuery(u)}}function gl(a,u){var c=G.macroModeState,d=c.lastInsertModeChanges;if(!c.isPlaying)for(var m=a.state.vim;u;){if(d.expectCursorActivityForChange=!0,d.ignoreCount>1)d.ignoreCount--;else if(u.origin=="+input"||u.origin=="paste"||u.origin===void 0){var y=a.listSelections().length;y>1&&(d.ignoreCount=y);var x=u.text.join(`
`);if(d.maybeReset&&(d.changes=[],d.maybeReset=!1),x)if(a.state.overwrite&&!/\n/.test(x))d.changes.push([x]);else{if(x.length>1){var k=m&&m.insertEnd&&m.insertEnd.find(),b=a.getCursor();if(k&&k.line==b.line){var M=k.ch-b.ch;M>0&&M<x.length&&(d.changes.push([x,M]),x="")}}x&&d.changes.push(x)}}u=u.next}}function ml(a){var u=a.state.vim;if(u.insertMode){var c=G.macroModeState;if(c.isPlaying)return;var d=c.lastInsertModeChanges;d.expectCursorActivityForChange?d.expectCursorActivityForChange=!1:(d.maybeReset=!0,u.insertEnd&&u.insertEnd.clear(),u.insertEnd=a.setBookmark(a.getCursor(),{insertLeft:!0}))}else a.curOp.isVimOp||yl(a,u)}function yl(a,u){var c=a.getCursor("anchor"),d=a.getCursor("head");if(u.visualMode&&!a.somethingSelected()?Kt(a,!1):!u.visualMode&&!u.insertMode&&a.somethingSelected()&&(u.visualMode=!0,u.visualLine=!1,r.signal(a,"vim-mode-change",{mode:"visual"})),u.visualMode){var m=xe(d,c)?0:-1,y=xe(d,c)?-1:0;d=j(d,0,m),c=j(c,0,y),u.sel={anchor:c,head:d},ri(a,u,"<",tt(d,c)),ri(a,u,">",Ct(d,c))}else u.insertMode||(u.lastHPos=a.getCursor().ch)}function hs(a){this.keyName=a}function vl(a){var u=G.macroModeState,c=u.lastInsertModeChanges,d=r.keyName(a);if(!d)return;function m(){return c.maybeReset&&(c.changes=[],c.maybeReset=!1),c.changes.push(new hs(d)),!0}(d.indexOf("Delete")!=-1||d.indexOf("Backspace")!=-1)&&r.lookupKey(d,"vim-insert",m)}function xl(a,u,c,d){var m=G.macroModeState;m.isPlaying=!0;var y=!!u.lastEditActionCommand,x=u.inputState;function k(){y?Pt.processAction(a,u,u.lastEditActionCommand):Pt.evalInput(a,u)}function b(A){if(m.lastInsertModeChanges.changes.length>0){A=u.lastEditActionCommand?A:1;var I=m.lastInsertModeChanges;bl(a,I.changes,A)}}if(u.inputState=u.lastEditInputState,y&&u.lastEditActionCommand.interlaceInsertRepeat)for(var M=0;M<c;M++)k(),b(1);else d||k(),b(c);u.inputState=x,u.insertMode&&!d&&ui(a),m.isPlaying=!1}function wl(a,u){r.lookupKey(u,"vim-insert",function(d){return typeof d=="string"?r.commands[d](a):d(a),!0})}function bl(a,u,c){var d=a.getCursor("head"),m=G.macroModeState.lastInsertModeChanges.visualBlock;m&&(Go(a,d,m+1),c=a.listSelections().length,a.setCursor(d));for(var y=0;y<c;y++){m&&a.setCursor(j(d,y,0));for(var x=0;x<u.length;x++){var k=u[x];if(k instanceof hs)wl(a,k.keyName);else if(typeof k=="string")a.replaceSelection(k);else{var b=a.getCursor(),M=j(b,0,k[0].length-(k[1]||0));a.replaceRange(k[0],b,k[1]?b:M),a.setCursor(M)}}}m&&a.setCursor(j(d,0,1))}function us(a){var u=new a.constructor;return Object.keys(a).forEach(function(c){if(c!="insertEnd"){var d=a[c];Array.isArray(d)?d=d.slice():d&&typeof d=="object"&&d.constructor!=Object&&(d=us(d)),u[c]=d}}),a.sel&&(u.sel={head:a.sel.head&&he(a.sel.head),anchor:a.sel.anchor&&he(a.sel.anchor)}),u}function tc(a,u,c){var d=!1,m=Ke.maybeInitVimState_(a),y=m.visualBlock||m.wasInVisualBlock,x=a.isInMultiSelectMode();if(m.wasInVisualBlock&&!x?m.wasInVisualBlock=!1:x&&m.visualBlock&&(m.wasInVisualBlock=!0),u=="<Esc>"&&!m.insertMode&&!m.visualMode&&x&&m.status=="<Esc>")He(a);else if(y||!x||a.inVirtualSelectionMode)d=Ke.handleKey(a,u,c);else{var k=us(m),b=m.inputState.changeQueueList||[];a.operation(function(){a.curOp.isVimOp=!0;var M=0;a.forEachSelection(function(){a.state.vim.inputState.changeQueue=b[M];var A=a.getCursor("head"),I=a.getCursor("anchor"),H=xe(A,I)?0:-1,R=xe(A,I)?-1:0;A=j(A,0,H),I=j(I,0,R),a.state.vim.sel.head=A,a.state.vim.sel.anchor=I,d=Ke.handleKey(a,u,c),a.virtualSelection&&(b[M]=a.state.vim.inputState.changeQueue,a.state.vim=us(k)),M++}),a.curOp.cursorActivity&&!d&&(a.curOp.cursorActivity=!1),a.state.vim=m,m.inputState.changeQueueList=b,m.inputState.changeQueue=null},!0)}return d&&!m.visualMode&&!m.insert&&m.visualMode!=a.somethingSelected()&&yl(a,m),d}return qe(),Ke}function yt(r,e){var t=e.ch,n=e.line+1;n<1&&(n=1,t=0),n>r.lines&&(n=r.lines,t=Number.MAX_VALUE);var s=r.line(n);return Math.min(s.from+Math.max(0,t),s.to)}function Tt(r,e){let t=r.lineAt(e);return{line:t.number-1,ch:e-t.from}}class _r{constructor(e,t){this.line=e,this.ch=t}}function hf(r,e,t){if(r.addEventListener)r.addEventListener(e,t,!1);else{var n=r._handlers||(r._handlers={});n[e]=(n[e]||[]).concat(t)}}function uf(r,e,t){if(r.removeEventListener)r.removeEventListener(e,t,!1);else{var n=r._handlers,s=n&&n[e];if(s){var o=s.indexOf(t);o>-1&&(n[e]=s.slice(0,o).concat(s.slice(o+1)))}}}function ff(r,e,...t){var n,s=(n=r._handlers)===null||n===void 0?void 0:n[e];if(!!s)for(var o=0;o<s.length;++o)s[o](...t)}function Ka(r,...e){if(!!r)for(var t=0;t<r.length;++t)r[t](...e)}var Im={Return:"CR",Backspace:"BS",Delete:"Del",Escape:"Esc",Insert:"Ins",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"CR"," ":"Space"},cf={Shift:1,Alt:1,Command:1,Control:1,CapsLock:1,AltGraph:1,Dead:1,Unidentified:1};let xo;try{xo=new RegExp("[\\w\\p{Alphabetic}\\p{Number}_]","u")}catch{xo=/[\w]/}function Mn(r,e){var t=r.cm6,n="input.type.compose";if(r.curOp&&(r.curOp.lastChange||(n="input.type.compose.start")),e.annotations)try{e.annotations.some(function(s){s.value=="input"&&(s.value=n)})}catch(s){console.error(s)}else e.userEvent=n;return t.dispatch(e)}function za(r,e){var t;r.curOp&&(r.curOp.$changeStart=void 0),(e?Wo:Vr)(r.cm6);let n=(t=r.curOp)===null||t===void 0?void 0:t.$changeStart;n!=null&&r.cm6.dispatch({selection:{anchor:n}})}var Fm={};class ue{constructor(e){this.state={},this.marks=Object.create(null),this.$mid=0,this.options={},this._handlers={},this.$lastChangeEndOffset=0,this.virtualSelection=null,this.cm6=e,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this)}openDialog(e,t,n){return Vm(this,e,t,n)}openNotification(e,t){return Hm(this,e,t)}on(e,t){hf(this,e,t)}off(e,t){uf(this,e,t)}signal(e,t,n){ff(this,e,t,n)}indexFromPos(e){return yt(this.cm6.state.doc,e)}posFromIndex(e){return Tt(this.cm6.state.doc,e)}foldCode(e){let t=this.cm6,n=t.state.selection.ranges,s=this.cm6.state.doc,o=yt(s,e),l=$.create([$.range(o,o)],0).ranges;t.state.selection.ranges=l,ng(t),t.state.selection.ranges=n}firstLine(){return 0}lastLine(){return this.cm6.state.doc.lines-1}lineCount(){return this.cm6.state.doc.lines}setCursor(e,t){typeof e=="object"&&(t=e.ch,e=e.line);var n=yt(this.cm6.state.doc,{line:e,ch:t});this.cm6.dispatch({selection:{anchor:n}},{scrollIntoView:!this.curOp}),this.curOp&&!this.curOp.isVimOp&&this.onBeforeEndOperation()}getCursor(e){var t=this.cm6.state.selection.main,n=e=="head"||!e?t.head:e=="anchor"?t.anchor:e=="start"?t.from:e=="end"?t.to:null;if(n==null)throw new Error("Invalid cursor type");return this.posFromIndex(n)}listSelections(){var e=this.cm6.state.doc;return this.cm6.state.selection.ranges.map(t=>({anchor:Tt(e,t.anchor),head:Tt(e,t.head)}))}setSelections(e,t){var n=this.cm6.state.doc,s=e.map(o=>$.range(yt(n,o.anchor),yt(n,o.head)));this.cm6.dispatch({selection:$.create(s,t)})}setSelection(e,t,n){var s=this.cm6.state.doc,o=[$.range(yt(s,e),yt(s,t))];this.cm6.dispatch({selection:$.create(o,0)}),n&&n.origin=="*mouse"&&this.onBeforeEndOperation()}getLine(e){var t=this.cm6.state.doc;return e<0||e>=t.lines?"":this.cm6.state.doc.line(e+1).text}getLineHandle(e){return this.$lineHandleChanges||(this.$lineHandleChanges=[]),{row:e,index:this.indexFromPos(new _r(e,0))}}getLineNumber(e){var t=this.$lineHandleChanges;if(!t)return null;for(var n=e.index,s=0;s<t.length;s++)if(n=t[s].changes.mapPos(n,1,vt.TrackAfter),n==null)return null;var o=this.posFromIndex(n);return o.ch==0?o.line:null}releaseLineHandles(){this.$lineHandleChanges=void 0}getRange(e,t){var n=this.cm6.state.doc;return this.cm6.state.sliceDoc(yt(n,e),yt(n,t))}replaceRange(e,t,n){n||(n=t);var s=this.cm6.state.doc,o=yt(s,t),l=yt(s,n);Mn(this,{changes:{from:o,to:l,insert:e}})}replaceSelection(e){Mn(this,this.cm6.state.replaceSelection(e))}replaceSelections(e){var t=this.cm6.state.selection.ranges,n=t.map((s,o)=>({from:s.from,to:s.to,insert:e[o]||""}));Mn(this,{changes:n})}getSelection(){return this.getSelections().join(`
`)}getSelections(){var e=this.cm6;return e.state.selection.ranges.map(t=>e.state.sliceDoc(t.from,t.to))}somethingSelected(){return this.cm6.state.selection.ranges.some(e=>!e.empty)}getInputField(){return this.cm6.contentDOM}clipPos(e){var t=this.cm6.state.doc,n=e.ch,s=e.line+1;s<1&&(s=1,n=0),s>t.lines&&(s=t.lines,n=Number.MAX_VALUE);var o=t.line(s);return n=Math.min(Math.max(0,n),o.to-o.from),new _r(s-1,n)}getValue(){return this.cm6.state.doc.toString()}setValue(e){var t=this.cm6;return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:e},selection:$.range(0,0)})}focus(){return this.cm6.focus()}blur(){return this.cm6.contentDOM.blur()}defaultTextHeight(){return this.cm6.defaultLineHeight}findMatchingBracket(e){var t=this.cm6.state,n=yt(t.doc,e),s=xi(t,n+1,-1);return s&&s.end?{to:Tt(t.doc,s.end.from)}:(s=xi(t,n,1),s&&s.end?{to:Tt(t.doc,s.end.from)}:{to:void 0})}scanForBracket(e,t,n,s){return zm(this,e,t,n,s)}indentLine(e,t){t?this.indentMore():this.indentLess()}indentMore(){_o(this.cm6)}indentLess(){qo(this.cm6)}execCommand(e){e=="indentAuto"?ue.commands.indentAuto(this):e=="goLineLeft"?Vu(this.cm6):e=="goLineRight"?(Hu(this.cm6),Kg(this.cm6)):console.log(e+" is not implemented")}setBookmark(e,t){var n=t!=null&&t.insertLeft?1:-1,s=this.indexFromPos(e),o=new qm(this,s,n);return o}addOverlay({query:e}){let t=new Tm({regexp:!0,search:e.source,caseSensitive:!/i/.test(e.flags)});if(t.valid){t.forVim=!0,this.cm6Query=t;let n=vo.of(t);return this.cm6.dispatch({effects:n}),t}}removeOverlay(e){if(!this.cm6Query)return;this.cm6Query.forVim=!1;let t=vo.of(this.cm6Query);this.cm6.dispatch({effects:t})}getSearchCursor(e,t){var n=this,s=null,o=null;t.ch==null&&(t.ch=Number.MAX_VALUE);var l=yt(n.cm6.state.doc,t),h=e.source.replace(/(\\.|{(?:\d+(?:,\d*)?|,\d+)})|[{}]/g,function(w,C){return C||"\\"+w});function f(w,C=0,D=w.length){return new jo(w,h,{ignoreCase:e.ignoreCase},C,D)}function g(w){var C=n.cm6.state.doc;if(w>C.length)return null;let D=f(C,w).next();return D.done?null:D.value}var p=1e4;function v(w,C){var D=n.cm6.state.doc;for(let F=1;;F++){let E=Math.max(w,C-F*p),K=f(D,E,C),X=null;for(;!K.next().done;)X=K.value;if(X&&(E==w||X.from>E+10))return X;if(E==w)return null}}return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(w){var C=n.cm6.state.doc;if(w){let D=s?s.from==s.to?s.to-1:s.from:l;s=v(0,D)}else{let D=s?s.from==s.to?s.to+1:s.to:l;s=g(D)}return o=s&&{from:Tt(C,s.from),to:Tt(C,s.to),match:s.match},s&&s.match},from:function(){return o==null?void 0:o.from},to:function(){return o==null?void 0:o.to},replace:function(w){s&&(Mn(n,{changes:{from:s.from,to:s.to,insert:w}}),s.to=s.from+w.length,o&&(o.to=Tt(n.cm6.state.doc,s.to)))}}}findPosV(e,t,n,s){let{cm6:o}=this;const l=o.state.doc;let h=n=="page"?o.dom.clientHeight:0;const f=yt(l,e);let g=$.range(f,f,s),p=Math.round(Math.abs(t));for(let w=0;w<p;w++)n=="page"?g=o.moveVertically(g,t>0,h):n=="line"&&(g=o.moveVertically(g,t>0));let v=Tt(l,g.head);return(t<0&&g.head==0&&s!=0&&e.line==0&&e.ch!=0||t>0&&g.head==l.length&&v.ch!=s&&e.line==v.line)&&(v.hitSide=!0),v}charCoords(e,t){var n=this.cm6.contentDOM.getBoundingClientRect(),s=yt(this.cm6.state.doc,e),o=this.cm6.coordsAtPos(s),l=-n.top;return{left:((o==null?void 0:o.left)||0)-n.left,top:((o==null?void 0:o.top)||0)+l,bottom:((o==null?void 0:o.bottom)||0)+l}}coordsChar(e,t){var n=this.cm6.contentDOM.getBoundingClientRect(),s=this.cm6.posAtCoords({x:e.left+n.left,y:e.top+n.top})||0;return Tt(this.cm6.state.doc,s)}getScrollInfo(){var e=this.cm6.scrollDOM;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight,width:e.scrollWidth,clientHeight:e.clientHeight,clientWidth:e.clientWidth}}scrollTo(e,t){e!=null&&(this.cm6.scrollDOM.scrollLeft=e),t!=null&&(this.cm6.scrollDOM.scrollTop=t)}scrollIntoView(e,t){if(e){var n=this.indexFromPos(e);this.cm6.dispatch({effects:se.scrollIntoView(n)})}else this.cm6.dispatch({scrollIntoView:!0,userEvent:"scroll"})}getWrapperElement(){return this.cm6.dom}getMode(){return{name:this.getOption("mode")}}setSize(e,t){this.cm6.dom.style.width=e+4+"px",this.cm6.dom.style.height=t+"px",this.refresh()}refresh(){this.cm6.measure()}destroy(){this.removeOverlay()}getLastEditEnd(){return this.posFromIndex(this.$lastChangeEndOffset)}onChange(e){this.$lineHandleChanges&&this.$lineHandleChanges.push(e);for(let n in this.marks)this.marks[n].update(e.changes);this.virtualSelection&&(this.virtualSelection.ranges=this.virtualSelection.ranges.map(n=>n.map(e.changes)));var t=this.curOp=this.curOp||{};e.changes.iterChanges((n,s,o,l,h)=>{(t.$changeStart==null||t.$changeStart>o)&&(t.$changeStart=o),this.$lastChangeEndOffset=l;var f={text:h.toJSON()};t.lastChange?t.lastChange.next=t.lastChange=f:t.lastChange=t.change=f},!0),t.changeHandlers||(t.changeHandlers=this._handlers.change&&this._handlers.change.slice())}onSelectionChange(){var e=this.curOp=this.curOp||{};e.cursorActivityHandlers||(e.cursorActivityHandlers=this._handlers.cursorActivity&&this._handlers.cursorActivity.slice()),this.curOp.cursorActivity=!0}operation(e){this.curOp||(this.curOp={$d:0}),this.curOp.$d++;try{var t=e()}finally{this.curOp&&(this.curOp.$d--,this.curOp.$d||this.onBeforeEndOperation())}return t}onBeforeEndOperation(){var e=this.curOp,t=!1;e&&(e.change&&Ka(e.changeHandlers,this,e.change),e&&e.cursorActivity&&(Ka(e.cursorActivityHandlers,this,null),e.isVimOp&&(t=!0)),this.curOp=null),t&&this.scrollIntoView()}moveH(e,t){if(t=="char"){var n=this.getCursor();this.setCursor(n.line,n.ch+e)}}setOption(e,t){switch(e){case"keyMap":this.state.keyMap=t;break}}getOption(e){switch(e){case"firstLineNumber":return 1;case"tabSize":return this.cm6.state.tabSize||4;case"readonly":return this.cm6.state.readOnly;case"indentWithTabs":return this.cm6.state.facet(In)=="	";case"indentUnit":return this.cm6.state.facet(In).length||2;case"keyMap":return this.state.keyMap||"vim"}}toggleOverwrite(e){this.state.overwrite=e}getTokenTypeAt(e){var t,n=this.indexFromPos(e),s=yu(this.cm6.state,n),o=s==null?void 0:s.resolve(n),l=((t=o==null?void 0:o.type)===null||t===void 0?void 0:t.name)||"";return/comment/i.test(l)?"comment":/string/i.test(l)?"string":""}overWriteSelection(e){var t=this.cm6.state.doc,n=this.cm6.state.selection,s=n.ranges.map(o=>{if(o.empty){var l=o.to<t.length?t.sliceString(o.from,o.to+1):"";if(l&&!/\n/.test(l))return $.range(o.from,o.to+1)}return o});this.cm6.dispatch({selection:$.create(s,n.mainIndex)}),this.replaceSelection(e)}isInMultiSelectMode(){return this.cm6.state.selection.ranges.length>1}virtualSelectionMode(){return!!this.virtualSelection}forEachSelection(e){var t=this.cm6.state.selection;this.virtualSelection=$.create(t.ranges,t.mainIndex);for(var n=0;n<this.virtualSelection.ranges.length;n++){var s=this.virtualSelection.ranges[n];!s||(this.cm6.dispatch({selection:$.create([s])}),e(),this.virtualSelection.ranges[n]=this.cm6.state.selection.ranges[0])}this.cm6.dispatch({selection:this.virtualSelection}),this.virtualSelection=null}}ue.isMac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);ue.Pos=_r;ue.StringStream=yg;ue.commands={cursorCharLeft:function(r){zo(r.cm6)},redo:function(r){za(r,!1)},undo:function(r){za(r,!0)},newlineAndIndent:function(r){tf({state:r.cm6.state,dispatch:e=>Mn(r,e)})},indentAuto:function(r){rf(r.cm6)}};ue.defineOption=function(r,e,t){};ue.isWordChar=function(r){return xo.test(r)};ue.keys=Fm;ue.keyMap={};ue.addClass=function(){};ue.rmClass=function(){};ue.e_preventDefault=function(r){r.preventDefault()};ue.e_stop=function(r){var e,t;(e=r==null?void 0:r.stopPropagation)===null||e===void 0||e.call(r),(t=r==null?void 0:r.preventDefault)===null||t===void 0||t.call(r)};ue.keyName=function(r){var e=r.key;if(!cf[e]){e=="Escape"&&(e="Esc"),e==" "&&(e="Space"),e.length>1&&(e=e.replace(/Numpad|Arrow/,"")),e.length==1&&(e=e.toUpperCase());var t="";return r.ctrlKey&&(t+="Ctrl-"),r.altKey&&(t+="Alt-"),(t||e.length>1)&&r.shiftKey&&(t+="Shift-"),t+=e,t}};ue.vimKey=function(e){var t=e.key;if(!cf[t]){t.length>1&&t[0]=="n"&&(t=t.replace("Numpad","")),t=Im[t]||t;var n="";return e.ctrlKey&&(n+="C-"),e.altKey&&(n+="A-"),e.metaKey&&(n+="M-"),ue.isMac&&e.altKey&&!e.metaKey&&!e.ctrlKey&&(n=n.slice(2)),(n||t.length>1)&&e.shiftKey&&(n+="S-"),n+=t,n.length>1&&(n="<"+n+">"),n}};ue.lookupKey=function(e,t,n){var s=ue.keys[e];s&&n(s)};ue.on=hf;ue.off=uf;ue.signal=ff;ue.findMatchingTag=$m;ue.findEnclosingTag=_m;function df(r,e,t){var n=document.createElement("div");return n.appendChild(e),n}function pf(r,e){r.state.currentNotificationClose&&r.state.currentNotificationClose(),r.state.currentNotificationClose=e}function Hm(r,e,t){pf(r,h);var n=df(r,e,t&&t.bottom),s=!1,o,l=t&&typeof t.duration!="undefined"?t.duration:5e3;function h(){s||(s=!0,clearTimeout(o),n.remove(),mf(r,n))}return n.onclick=function(f){f.preventDefault(),h()},gf(r,n),l&&(o=setTimeout(h,l)),h}function gf(r,e){var t=r.state.dialog;r.state.dialog=e,e&&t!==e&&(t&&t.contains(document.activeElement)&&r.focus(),t&&t.parentElement?t.parentElement.replaceChild(e,t):t&&t.remove(),ue.signal(r,"dialog"))}function mf(r,e){r.state.dialog==e&&(r.state.dialog=null,ue.signal(r,"dialog"))}function Vm(r,e,t,n){n||(n={}),pf(r,void 0);var s=df(r,e,n.bottom),o=!1;gf(r,s);function l(f){if(typeof f=="string")h.value=f;else{if(o)return;o=!0,mf(r,s),r.state.dialog||r.focus(),n.onClose&&n.onClose(s)}}var h=s.getElementsByTagName("input")[0];return h&&(n.value&&(h.value=n.value,n.selectValueOnOpen!==!1&&h.select()),n.onInput&&ue.on(h,"input",function(f){n.onInput(f,h.value,l)}),n.onKeyUp&&ue.on(h,"keyup",function(f){n.onKeyUp(f,h.value,l)}),ue.on(h,"keydown",function(f){n&&n.onKeyDown&&n.onKeyDown(f,h.value,l)||(f.keyCode==13&&t(h.value),(f.keyCode==27||n.closeOnEnter!==!1&&f.keyCode==13)&&(h.blur(),ue.e_stop(f),l()))}),n.closeOnBlur!==!1&&ue.on(h,"blur",function(){setTimeout(function(){document.activeElement!==h&&l()})}),h.focus()),l}var Wm={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function Km(r){return r&&r.bracketRegex||/[(){}[\]]/}function zm(r,e,t,n,s){for(var o=s&&s.maxScanLineLength||1e4,l=s&&s.maxScanLines||1e3,h=[],f=Km(s),g=t>0?Math.min(e.line+l,r.lastLine()+1):Math.max(r.firstLine()-1,e.line-l),p=e.line;p!=g;p+=t){var v=r.getLine(p);if(!!v){var w=t>0?0:v.length-1,C=t>0?v.length:-1;if(!(v.length>o))for(p==e.line&&(w=e.ch-(t<0?1:0));w!=C;w+=t){var D=v.charAt(w);if(f.test(D)){var F=Wm[D];if(F&&F.charAt(1)==">"==t>0)h.push(D);else if(h.length)h.pop();else return{pos:new _r(p,w),ch:D}}}}}return p-t==(t>0?r.lastLine():r.firstLine())?!1:null}function $m(r,e){}function _m(r,e){var t,n,s=r.cm6.state,o=r.indexFromPos(e);if(o<s.doc.length){var l=s.sliceDoc(o,o+1);l=="<"&&o++}for(var h=yu(s,o),f=(h==null?void 0:h.resolve(o))||null;f;){if(((t=f.firstChild)===null||t===void 0?void 0:t.type.name)=="OpenTag"&&((n=f.lastChild)===null||n===void 0?void 0:n.type.name)=="CloseTag")return{open:$a(s.doc,f.firstChild),close:$a(s.doc,f.lastChild)};f=f.parent}}function $a(r,e){return{from:Tt(r,e.from),to:Tt(r,e.to)}}class qm{constructor(e,t,n){this.cm=e,this.id=e.$mid++,this.offset=t,this.assoc=n,e.marks[this.id]=this}clear(){delete this.cm.marks[this.id]}find(){return this.offset==null?null:this.cm.posFromIndex(this.offset)}update(e){this.offset!=null&&(this.offset=e.mapPos(this.offset,this.assoc,vt.TrackDel))}}class Um{constructor(e,t,n,s,o,l,h,f,g,p){this.left=e,this.top=t,this.height=n,this.fontFamily=s,this.fontSize=o,this.fontWeight=l,this.color=h,this.className=f,this.letter=g,this.partial=p}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",e.style.height=this.height+"px",e.style.lineHeight=this.height+"px",e.style.fontFamily=this.fontFamily,e.style.fontSize=this.fontSize,e.style.fontWeight=this.fontWeight,e.style.color=this.partial?"transparent":this.color,e.className=this.className,e.textContent=this.letter}eq(e){return this.left==e.left&&this.top==e.top&&this.height==e.height&&this.fontFamily==e.fontFamily&&this.fontSize==e.fontSize&&this.fontWeight==e.fontWeight&&this.color==e.color&&this.className==e.className&&this.letter==e.letter}}class jm{constructor(e,t){this.view=e,this.rangePieces=[],this.cursors=[],this.cm=t,this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.cursorLayer=e.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer cm-vimCursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),e.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=1200+"ms"}update(e){(e.selectionSet||e.geometryChanged||e.viewportChanged)&&(this.view.requestMeasure(this.measureReq),this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink")}scheduleRedraw(){this.view.requestMeasure(this.measureReq)}readPos(){let{state:e}=this.view,t=[];for(let n of e.selection.ranges){let s=n==e.selection.main,o=Xm(this.cm,this.view,n,s);o&&t.push(o)}return{cursors:t}}drawSel({cursors:e}){if(e.length!=this.cursors.length||e.some((t,n)=>!t.eq(this.cursors[n]))){let t=this.cursorLayer.children;if(t.length!==e.length){this.cursorLayer.textContent="";for(const n of e)this.cursorLayer.appendChild(n.draw())}else e.forEach((n,s)=>n.adjust(t[s]));this.cursors=e}}destroy(){this.cursorLayer.remove()}}const Jm={".cm-vimMode .cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-fat-cursor":{position:"absolute",background:"#ff9696",border:"none",whiteSpace:"pre"},"&:not(.cm-focused) .cm-fat-cursor":{background:"none",outline:"solid 1px #ff9696",color:"transparent !important"}},Gm=Fn.highest(se.theme(Jm));function Qm(r){let e=r.scrollDOM.getBoundingClientRect();return{left:(r.textDirection==je.LTR?e.left:e.right-r.scrollDOM.clientWidth)-r.scrollDOM.scrollLeft,top:e.top-r.scrollDOM.scrollTop}}function Xm(r,e,t,n){let s=t.head,o=!1,l=1,h=r.state.vim;if(h&&(!h.insertMode||r.state.overwrite)){if(o=!0,h.visualBlock&&!n)return null;t.anchor<t.head&&s--,r.state.overwrite?l=.2:h.status&&(l=.5)}if(o){let g=s<e.state.doc.length&&e.state.sliceDoc(s,s+1);g&&/[\uDC00-\uDFFF]/.test(g)&&s>1&&(s--,g=e.state.sliceDoc(s,s+1));let p=e.coordsAtPos(s,1);if(!p)return null;let v=Qm(e),w=e.domAtPos(s),C=w?w.node:e.contentDOM;for(;w&&w.node instanceof HTMLElement;)C=w.node,w={node:w.node.childNodes[w.offset],offset:0};if(!(C instanceof HTMLElement)){if(!C.parentNode)return null;C=C.parentNode}let D=getComputedStyle(C),F=p.left;if(!g||g==`
`||g=="\r")g="\xA0";else if(g=="	"){g="\xA0";var f=e.coordsAtPos(s+1,-1);f&&(F=f.left-(f.left-p.left)/parseInt(D.tabSize))}else/[\uD800-\uDBFF]/.test(g)&&s<e.state.doc.length-1&&(g+=e.state.sliceDoc(s+1,s+2));let E=p.bottom-p.top;return new Um(F-v.left,p.top-v.top+E*(1-l),E*l,D.fontFamily,D.fontSize,D.fontWeight,D.color,n?"cm-fat-cursor cm-cursor-primary":"cm-fat-cursor cm-cursor-secondary",g,l!=1)}else return null}var Ym=typeof navigator!="undefined"&&/linux/i.test(navigator.platform)&&/ Gecko\/\d+/.exec(navigator.userAgent);const st=Pm(ue),Zm=250,e0=se.baseTheme({".cm-vimMode .cm-cursorLayer:not(.cm-vimCursorLayer)":{display:"none"},".cm-vim-panel":{padding:"0px 10px",fontFamily:"monospace",minHeight:"1.3em"},".cm-vim-panel input":{border:"none",outline:"none",backgroundColor:"inherit"},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"}}),t0=Mt.fromClass(class{constructor(r){this.status="",this.query=null,this.decorations=ve.none,this.waitForCopy=!1,this.lastKeydown="",this.useNextTextInput=!1,this.view=r;const e=this.cm=new ue(r);st.enterVimMode(this.cm),this.view.cm=this.cm,this.cm.state.vimPlugin=this,this.blockCursor=new jm(r,e),this.updateClass(),this.cm.on("vim-command-done",()=>{e.state.vim&&(e.state.vim.status=""),this.blockCursor.scheduleRedraw(),this.updateStatus()}),this.cm.on("vim-mode-change",t=>{e.state.vim.mode=t.mode,t.subMode&&(e.state.vim.mode+=" block"),e.state.vim.status="",this.blockCursor.scheduleRedraw(),this.updateClass(),this.updateStatus()}),this.cm.on("dialog",()=>{this.cm.state.statusbar?this.updateStatus():r.dispatch({effects:yf.of(!!this.cm.state.dialog)})}),this.dom=document.createElement("span"),this.dom.style.cssText="position: absolute; right: 10px; top: 1px",this.statusButton=document.createElement("span"),this.statusButton.onclick=t=>{st.handleKey(this.cm,"<Esc>","user"),this.cm.focus()},this.statusButton.style.cssText="cursor: pointer"}update(r){var e;if((r.viewportChanged||r.docChanged)&&this.query&&this.highlight(this.query),r.docChanged&&this.cm.onChange(r),r.selectionSet&&this.cm.onSelectionChange(),r.viewportChanged,this.cm.curOp&&!this.cm.curOp.isVimOp&&this.cm.onBeforeEndOperation(),r.transactions){for(let t of r.transactions)for(let n of t.effects)if(n.is(vo))if(!((e=n.value)===null||e===void 0?void 0:e.forVim))this.highlight(null);else{let o=n.value.create();this.highlight(o)}}this.blockCursor.update(r)}updateClass(){const r=this.cm.state;!r.vim||r.vim.insertMode&&!r.overwrite?this.view.scrollDOM.classList.remove("cm-vimMode"):this.view.scrollDOM.classList.add("cm-vimMode")}updateStatus(){let r=this.cm.state.statusbar,e=this.cm.state.vim;if(!r||!e)return;let t=this.cm.state.dialog;if(t)t.parentElement!=r&&(r.textContent="",r.appendChild(t));else{r.textContent="";var n=(e.mode||"normal").toUpperCase();e.insertModeReturn&&(n+="(C-O)"),this.statusButton.textContent=`--${n}--`,r.appendChild(this.statusButton)}this.dom.textContent=e.status,r.appendChild(this.dom)}destroy(){st.leaveVimMode(this.cm),this.updateClass(),this.blockCursor.destroy(),delete this.view.cm}highlight(r){if(this.query=r,!r)return this.decorations=ve.none;let{view:e}=this,t=new Hi;for(let n=0,s=e.visibleRanges,o=s.length;n<o;n++){let{from:l,to:h}=s[n];for(;n<o-1&&h>s[n+1].from-2*Zm;)h=s[++n].to;r.highlight(e.state,l,h,(f,g)=>{t.add(f,g,n0)})}return this.decorations=t.finish()}handleKey(r,e){const t=ue.vimKey(r),n=this.cm;if(!t)return;let s=n.state.vim;if(!s)return;if(t=="<Esc>"&&!s.insertMode&&!s.visualMode&&this.query){const h=s.searchState_;h&&(n.removeOverlay(h.getOverlay()),h.setOverlay(null))}if(t==="<C-c>"&&!ue.isMac&&n.somethingSelected())return this.waitForCopy=!0,!0;s.status=(s.status||"")+t;let l=st.multiSelectHandleKey(n,t,"user");return s=n.state.vim,!l&&s.insertMode&&n.state.overwrite&&(r.key&&r.key.length==1&&!/\n/.test(r.key)?(l=!0,n.overWriteSelection(r.key)):r.key=="Backspace"&&(l=!0,ue.commands.cursorCharLeft(n))),l&&(ue.signal(this.cm,"vim-keypress",t),r.preventDefault(),r.stopPropagation(),this.blockCursor.scheduleRedraw()),this.updateStatus(),!!l}},{eventHandlers:{copy:function(r,e){!this.waitForCopy||(this.waitForCopy=!1,Promise.resolve().then(()=>{var t=this.cm,n=t.state.vim;!n||(n.insertMode?t.setSelection(t.getCursor(),t.getCursor()):t.operation(()=>{t.curOp&&(t.curOp.isVimOp=!0),st.handleKey(t,"<Esc>","user")}))}))},compositionstart:function(r,e){this.useNextTextInput=!0},keypress:function(r,e){this.lastKeydown=="Dead"&&this.handleKey(r,e)},keydown:function(r,e){this.lastKeydown=r.key,this.lastKeydown=="Unidentified"||this.lastKeydown=="Process"||this.lastKeydown=="Dead"?this.useNextTextInput=!0:(this.useNextTextInput=!1,this.handleKey(r,e))}},provide:()=>[se.inputHandler.of((r,e,t,n)=>{var s,o,l=a0(r);if(!l)return!1;var h=(s=l.state)===null||s===void 0?void 0:s.vim,f=l.state.vimPlugin;return h&&!h.insertMode&&!(!((o=l.curOp)===null||o===void 0)&&o.isVimOp)?(n==="\0\0"||(n.length==1&&f.useNextTextInput&&f.handleKey({key:n,preventDefault:()=>{},stopPropagation:()=>{}}),i0(r)),!0):!1})],decorations:r=>r.decorations});function i0(r){var e=r.scrollDOM.parentElement;if(!!e){if(Ym){r.contentDOM.textContent="\0\0",r.contentDOM.dispatchEvent(new CustomEvent("compositionend"));return}var t=r.scrollDOM.nextSibling,n=window.getSelection(),s=n&&{anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset};r.scrollDOM.remove(),e.insertBefore(r.scrollDOM,t);try{s&&n&&(n.setPosition(s.anchorNode,s.anchorOffset),s.focusNode&&n.extend(s.focusNode,s.focusOffset))}catch(o){console.error(o)}r.focus(),r.contentDOM.dispatchEvent(new CustomEvent("compositionend"))}}const n0=ve.mark({class:"cm-searchMatch"}),yf=Fe.define(),r0=Zt.define({create:()=>!1,update(r,e){for(let t of e.effects)t.is(yf)&&(r=t.value);return r},provide:r=>Lr.from(r,e=>e?s0:null)});function s0(r){let e=document.createElement("div");e.className="cm-vim-panel";let t=r.cm;return t.state.dialog&&e.appendChild(t.state.dialog),{top:!1,dom:e}}function o0(r){let e=document.createElement("div");e.className="cm-vim-panel";let t=r.cm;return t.state.statusbar=e,t.state.vimPlugin.updateStatus(),{dom:e}}function l0(r={}){return[e0,t0,Gm,r.status?Lr.of(o0):r0]}function a0(r){return r.cm||null}const Ft=r=>Object.is(r,-0)?"-0":r,pi={"+":{func:(r,e)=>`${Ft(Number(r)+Number(e))}`,precedence:1,associativity:"left",arity:2},"-":{func:(r,e)=>`${Ft(Number(r)-Number(e))}`,precedence:1,associativity:"left",arity:2},"*":{func:(r,e)=>`${Ft(Number(r)*Number(e))}`,precedence:2,associativity:"left",arity:2},"/":{func:(r,e)=>`${Ft(Number(r)/Number(e))}`,precedence:2,associativity:"left",arity:2},"%":{func:(r,e)=>`${Ft(Number(r)%Number(e))}`,precedence:2,associativity:"left",arity:2},"^":{func:(r,e)=>`${Ft(Math.pow(Number(r),Number(e)))}`,precedence:3,associativity:"right",arity:2}},fr=Object.keys(pi),qr={min:{func:(r,e)=>`${Ft(Math.min(Number(r),Number(e)))}`,arity:2},max:{func:(r,e)=>`${Ft(Math.max(Number(r),Number(e)))}`,arity:2},sin:{func:r=>`${Ft(Math.sin(Number(r)))}`,arity:1},cos:{func:r=>`${Ft(Math.cos(Number(r)))}`,arity:1},tan:{func:r=>`${Ft(Math.tan(Number(r)))}`,arity:1},log:{func:r=>`${Math.log(Number(r))}`,arity:1}},_a=Object.keys(qr),jt=r=>r[r.length-1];function h0(r){const e=new Array,t=new Array;for(const n of r)if(qr[n]!==void 0)t.push(n);else if(n===","){for(;t.length>0&&jt(t)!=="(";)e.push(t.pop());if(t.length===0)throw new Error("Misplaced ','")}else if(pi[n]!==void 0){const s=n;for(;t.length>0&&jt(t)!==void 0&&jt(t)!=="("&&(pi[jt(t)].precedence>pi[s].precedence||pi[s].precedence===pi[jt(t)].precedence&&pi[s].associativity==="left");)e.push(t.pop());t.push(s)}else if(n==="(")t.push(n);else if(n===")"){for(;t.length>0&&jt(t)!=="(";)e.push(t.pop());if(t.length>0&&jt(t)==="(")t.pop();else throw new Error("Parentheses mismatch");qr[jt(t)]!==void 0&&e.push(t.pop())}else e.push(n);for(;t.length>0;){if(jt(t)==="(")throw new Error("Parentheses mismatch");e.push(t.pop())}return e}function u0(r){const e=new Array,t={...pi,...qr};for(const n of r){const s=t[n];if(s!==void 0){const o=[];for(let l=0;l<s.arity;l++)o.push(e.pop());e.push(s.func(...o.reverse()))}else e.push(n)}if(e.length>1)throw new Error("Insufficient operators");return Number(e[0])}function f0(r){const e=r.replace(/\s+/g," "),t=[];let n="",s="";for(let o=0;o<e.length;o++){const l=e.charAt(o),h=e.charAt(o-1),f=e.charAt(o+1),g=jt(t),p=s!=="";if(/\d/.test(l)||(l==="+"||l==="-")&&!p&&(g===void 0||g===","||g==="("||fr.includes(g))&&/\d/.test(f))s+=l;else if(l==="."){if(p&&s.includes("."))throw new Error(`Double '.' in number: '${s}${l}'`);s+=l}else if(l===" "){if(/\d/.test(h)&&/\d/.test(f))throw new Error(`Space in number: '${s}${l}${f}'`)}else if(_a.includes(n+l))n+=l,_a.includes(n+f)||(t.push(n),n="");else if(fr.includes(l)||l==="("||l===")"||l===","){if(fr.includes(l)&&!p&&fr.includes(g))throw new Error(`Consecutive operators: '${g}${l}'`);p&&t.push(s),t.push(l),s=""}else n+=l}if(n!=="")throw new Error(`Invalid characters: '${n}'`);return s!==""&&t.push(s),(t[0]==="+"||t[0]==="-")&&t.unshift("0"),t}function c0(r){const e=f0(r),t=h0(e);return u0(t)}async function vf(){return window.showOpenFilePicker().then(r=>r[0])}function d0(){const r={types:[{description:"Text file",accept:{"text/plain":[".njt"]}}]};return window.showSaveFilePicker(r)}function p0(r){return r.text()}async function xf(r,e){const t=await r.createWritable();await t.write(e),await t.close()}function wo(r,e){let t=document.createElement("canvas"),n=t.getContext("2d");t.width=r.width,t.height=r.height,n==null||n.drawImage(r,0,0),t.toBlob(function(s){let o=new FileReader;o.onload=function(){let l=e.state.selection;e.dispatch({changes:{from:l.main.from,to:l.main.to,insert:`\u{1F5BC}{${o.result}}
`}})},o.readAsDataURL(s)},"image/webp")}var Ni={};(function(){var r="#EAEAEA",e="1em",t="serif",n=!1,s=!0,o=".",l="`",h="\\\\`",f="wikitext",g=navigator.appName.slice(0,9)=="Microsoft",p=!1,v=!1;g&&(document.write('<object id="mathplayer"  classid="clsid:32F66A20-7614-11D4-BD11-00104BD3F987"></object>'),document.write('<?import namespace="m" implementation="#mathplayer"?>'));function w(S){var T="AMMLcustomStyleSheet",P=document.getElementById(T);document.createStyleSheet?(P&&P.parentNode.removeChild(P),document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='"+T+"'>"+S+"</style>")):P?P.replaceChild(document.createTextNode(S),P.firstChild):(P=document.createElement("style"),P.type="text/css",P.id=T,P.appendChild(document.createTextNode(S)),document.getElementsByTagName("head")[0].appendChild(P))}w(`#AMMLcloseDiv {font-size:0.8em; padding-top:1em; color:#014}
#AMMLwarningBox {position:absolute; width:100%; top:0; left:0; z-index:200; text-align:center; font-size:1em; font-weight:bold; padding:0.5em 0 0.5em 0; color:#ffc; background:#c30}`);function C(){var S,T=new Array;return document.getElementById==null?(alert("This webpage requires a recent browser such as Mozilla Firefox"),null):((S=D())&&T.push(S),T.length>0&&E(T),p||Oi(),!0)}function D(){if(navigator.appName.slice(0,8)=="Netscape")navigator.appVersion.slice(0,1)>="5"?p=null:p=!0;else if(navigator.appName.slice(0,9)=="Microsoft")try{var S=new ActiveXObject("MathPlayer.Factory.1");p=null}catch{p=!0}else navigator.appName.slice(0,5)=="Opera"&&(navigator.appVersion.slice(0,3)>="9.5"?p=null:p=!0);if(p&&s){var T="To view the ASCIIMathML notation use Internet Explorer + MathPlayer or Mozilla Firefox 2.0 or later.";return T}}function F(){var S=document.getElementsByTagName("body")[0];S.removeChild(document.getElementById("AMMLwarningBox")),S.onclick=null}function E(S){var T,P,B=X("div"),W=document.getElementsByTagName("body")[0];for(W.onclick=F,B.id="AMMLwarningBox",T=0;T<S.length;T++)P=X("div"),P.appendChild(document.createTextNode(S[T])),P.style.paddingBottom="1.0em",B.appendChild(P);B.appendChild(X("p")),B.appendChild(document.createTextNode("For instructions see the "));var N=X("a");N.appendChild(document.createTextNode("ASCIIMathML")),N.setAttribute("href","http://asciimath.org"),B.appendChild(N),B.appendChild(document.createTextNode(" homepage")),N=X("div"),N.id="AMMLcloseDiv",N.appendChild(document.createTextNode("(click anywhere to close this warning)")),B.appendChild(N);var W=document.getElementsByTagName("body")[0];W.insertBefore(B,W.childNodes[0])}function K(S){if(!v){v=!0;var T=document.getElementsByTagName("body")[0],P=document.getElementById(f);Ot(P!=null?P:T,!1,S)}}function X(S){return g?document.createElement(S):document.createElementNS("http://www.w3.org/1999/xhtml",S)}var te="http://www.w3.org/1998/Math/MathML";function V(S,T){var P;return g?P=document.createElement("m:"+S):P=document.createElementNS(te,S),T&&P.appendChild(T),P}function Y(S,T){We.push({input:S,tag:"mo",output:T,tex:null,ttype:Le}),G()}function Q(S){We.push(S),G()}var ne=["\u{1D49C}","\u212C","\u{1D49E}","\u{1D49F}","\u2130","\u2131","\u{1D4A2}","\u210B","\u2110","\u{1D4A5}","\u{1D4A6}","\u2112","\u2133","\u{1D4A9}","\u{1D4AA}","\u{1D4AB}","\u{1D4AC}","\u211B","\u{1D4AE}","\u{1D4AF}","\u{1D4B0}","\u{1D4B1}","\u{1D4B2}","\u{1D4B3}","\u{1D4B4}","\u{1D4B5}","\u{1D4B6}","\u{1D4B7}","\u{1D4B8}","\u{1D4B9}","\u212F","\u{1D4BB}","\u210A","\u{1D4BD}","\u{1D4BE}","\u{1D4BF}","\u{1D4C0}","\u{1D4C1}","\u{1D4C2}","\u{1D4C3}","\u2134","\u{1D4C5}","\u{1D4C6}","\u{1D4C7}","\u{1D4C8}","\u{1D4C9}","\u{1D4CA}","\u{1D4CB}","\u{1D4CC}","\u{1D4CD}","\u{1D4CE}","\u{1D4CF}"],be=["\u{1D504}","\u{1D505}","\u212D","\u{1D507}","\u{1D508}","\u{1D509}","\u{1D50A}","\u210C","\u2111","\u{1D50D}","\u{1D50E}","\u{1D50F}","\u{1D510}","\u{1D511}","\u{1D512}","\u{1D513}","\u{1D514}","\u211C","\u{1D516}","\u{1D517}","\u{1D518}","\u{1D519}","\u{1D51A}","\u{1D51B}","\u{1D51C}","\u2128","\u{1D51E}","\u{1D51F}","\u{1D520}","\u{1D521}","\u{1D522}","\u{1D523}","\u{1D524}","\u{1D525}","\u{1D526}","\u{1D527}","\u{1D528}","\u{1D529}","\u{1D52A}","\u{1D52B}","\u{1D52C}","\u{1D52D}","\u{1D52E}","\u{1D52F}","\u{1D530}","\u{1D531}","\u{1D532}","\u{1D533}","\u{1D534}","\u{1D535}","\u{1D536}","\u{1D537}"],ae=["\u{1D538}","\u{1D539}","\u2102","\u{1D53B}","\u{1D53C}","\u{1D53D}","\u{1D53E}","\u210D","\u{1D540}","\u{1D541}","\u{1D542}","\u{1D543}","\u{1D544}","\u2115","\u{1D546}","\u2119","\u211A","\u211D","\u{1D54A}","\u{1D54B}","\u{1D54C}","\u{1D54D}","\u{1D54E}","\u{1D54F}","\u{1D550}","\u2124","\u{1D552}","\u{1D553}","\u{1D554}","\u{1D555}","\u{1D556}","\u{1D557}","\u{1D558}","\u{1D559}","\u{1D55A}","\u{1D55B}","\u{1D55C}","\u{1D55D}","\u{1D55E}","\u{1D55F}","\u{1D560}","\u{1D561}","\u{1D562}","\u{1D563}","\u{1D564}","\u{1D565}","\u{1D566}","\u{1D567}","\u{1D568}","\u{1D569}","\u{1D56A}","\u{1D56B}"],O=0,z=1,me=2,Me=3,Te=4,ce=5,de=6,Se=7,Le=8,fe=9,Ae=10,at=15,et={input:'"',tag:"mtext",output:"mbox",tex:null,ttype:Ae},We=[{input:"alpha",tag:"mi",output:"\u03B1",tex:null,ttype:O},{input:"beta",tag:"mi",output:"\u03B2",tex:null,ttype:O},{input:"chi",tag:"mi",output:"\u03C7",tex:null,ttype:O},{input:"delta",tag:"mi",output:"\u03B4",tex:null,ttype:O},{input:"Delta",tag:"mo",output:"\u0394",tex:null,ttype:O},{input:"epsi",tag:"mi",output:"\u03B5",tex:"epsilon",ttype:O},{input:"varepsilon",tag:"mi",output:"\u025B",tex:null,ttype:O},{input:"eta",tag:"mi",output:"\u03B7",tex:null,ttype:O},{input:"gamma",tag:"mi",output:"\u03B3",tex:null,ttype:O},{input:"Gamma",tag:"mo",output:"\u0393",tex:null,ttype:O},{input:"iota",tag:"mi",output:"\u03B9",tex:null,ttype:O},{input:"kappa",tag:"mi",output:"\u03BA",tex:null,ttype:O},{input:"lambda",tag:"mi",output:"\u03BB",tex:null,ttype:O},{input:"Lambda",tag:"mo",output:"\u039B",tex:null,ttype:O},{input:"lamda",tag:"mi",output:"\u03BB",tex:null,ttype:O},{input:"Lamda",tag:"mo",output:"\u039B",tex:null,ttype:O},{input:"mu",tag:"mi",output:"\u03BC",tex:null,ttype:O},{input:"nu",tag:"mi",output:"\u03BD",tex:null,ttype:O},{input:"omega",tag:"mi",output:"\u03C9",tex:null,ttype:O},{input:"Omega",tag:"mo",output:"\u03A9",tex:null,ttype:O},{input:"phi",tag:"mi",output:"\u03D5",tex:null,ttype:O},{input:"varphi",tag:"mi",output:"\u03C6",tex:null,ttype:O},{input:"Phi",tag:"mo",output:"\u03A6",tex:null,ttype:O},{input:"pi",tag:"mi",output:"\u03C0",tex:null,ttype:O},{input:"Pi",tag:"mo",output:"\u03A0",tex:null,ttype:O},{input:"psi",tag:"mi",output:"\u03C8",tex:null,ttype:O},{input:"Psi",tag:"mi",output:"\u03A8",tex:null,ttype:O},{input:"rho",tag:"mi",output:"\u03C1",tex:null,ttype:O},{input:"sigma",tag:"mi",output:"\u03C3",tex:null,ttype:O},{input:"Sigma",tag:"mo",output:"\u03A3",tex:null,ttype:O},{input:"tau",tag:"mi",output:"\u03C4",tex:null,ttype:O},{input:"theta",tag:"mi",output:"\u03B8",tex:null,ttype:O},{input:"vartheta",tag:"mi",output:"\u03D1",tex:null,ttype:O},{input:"Theta",tag:"mo",output:"\u0398",tex:null,ttype:O},{input:"upsilon",tag:"mi",output:"\u03C5",tex:null,ttype:O},{input:"xi",tag:"mi",output:"\u03BE",tex:null,ttype:O},{input:"Xi",tag:"mo",output:"\u039E",tex:null,ttype:O},{input:"zeta",tag:"mi",output:"\u03B6",tex:null,ttype:O},{input:"*",tag:"mo",output:"\u22C5",tex:"cdot",ttype:O},{input:"**",tag:"mo",output:"\u2217",tex:"ast",ttype:O},{input:"***",tag:"mo",output:"\u22C6",tex:"star",ttype:O},{input:"//",tag:"mo",output:"/",tex:null,ttype:O},{input:"\\\\",tag:"mo",output:"\\",tex:"backslash",ttype:O},{input:"setminus",tag:"mo",output:"\\",tex:null,ttype:O},{input:"xx",tag:"mo",output:"\xD7",tex:"times",ttype:O},{input:"|><",tag:"mo",output:"\u22C9",tex:"ltimes",ttype:O},{input:"><|",tag:"mo",output:"\u22CA",tex:"rtimes",ttype:O},{input:"|><|",tag:"mo",output:"\u22C8",tex:"bowtie",ttype:O},{input:"-:",tag:"mo",output:"\xF7",tex:"div",ttype:O},{input:"divide",tag:"mo",output:"-:",tex:null,ttype:Le},{input:"@",tag:"mo",output:"\u2218",tex:"circ",ttype:O},{input:"o+",tag:"mo",output:"\u2295",tex:"oplus",ttype:O},{input:"ox",tag:"mo",output:"\u2297",tex:"otimes",ttype:O},{input:"o.",tag:"mo",output:"\u2299",tex:"odot",ttype:O},{input:"sum",tag:"mo",output:"\u2211",tex:null,ttype:Se},{input:"prod",tag:"mo",output:"\u220F",tex:null,ttype:Se},{input:"^^",tag:"mo",output:"\u2227",tex:"wedge",ttype:O},{input:"^^^",tag:"mo",output:"\u22C0",tex:"bigwedge",ttype:Se},{input:"vv",tag:"mo",output:"\u2228",tex:"vee",ttype:O},{input:"vvv",tag:"mo",output:"\u22C1",tex:"bigvee",ttype:Se},{input:"nn",tag:"mo",output:"\u2229",tex:"cap",ttype:O},{input:"nnn",tag:"mo",output:"\u22C2",tex:"bigcap",ttype:Se},{input:"uu",tag:"mo",output:"\u222A",tex:"cup",ttype:O},{input:"uuu",tag:"mo",output:"\u22C3",tex:"bigcup",ttype:Se},{input:"!=",tag:"mo",output:"\u2260",tex:"ne",ttype:O},{input:":=",tag:"mo",output:":=",tex:null,ttype:O},{input:"lt",tag:"mo",output:"<",tex:null,ttype:O},{input:"<=",tag:"mo",output:"\u2264",tex:"le",ttype:O},{input:"lt=",tag:"mo",output:"\u2264",tex:"leq",ttype:O},{input:"gt",tag:"mo",output:">",tex:null,ttype:O},{input:"mlt",tag:"mo",output:"\u226A",tex:"ll",ttype:O},{input:">=",tag:"mo",output:"\u2265",tex:"ge",ttype:O},{input:"gt=",tag:"mo",output:"\u2265",tex:"geq",ttype:O},{input:"mgt",tag:"mo",output:"\u226B",tex:"gg",ttype:O},{input:"-<",tag:"mo",output:"\u227A",tex:"prec",ttype:O},{input:"-lt",tag:"mo",output:"\u227A",tex:null,ttype:O},{input:">-",tag:"mo",output:"\u227B",tex:"succ",ttype:O},{input:"-<=",tag:"mo",output:"\u2AAF",tex:"preceq",ttype:O},{input:">-=",tag:"mo",output:"\u2AB0",tex:"succeq",ttype:O},{input:"in",tag:"mo",output:"\u2208",tex:null,ttype:O},{input:"!in",tag:"mo",output:"\u2209",tex:"notin",ttype:O},{input:"sub",tag:"mo",output:"\u2282",tex:"subset",ttype:O},{input:"sup",tag:"mo",output:"\u2283",tex:"supset",ttype:O},{input:"sube",tag:"mo",output:"\u2286",tex:"subseteq",ttype:O},{input:"supe",tag:"mo",output:"\u2287",tex:"supseteq",ttype:O},{input:"-=",tag:"mo",output:"\u2261",tex:"equiv",ttype:O},{input:"~=",tag:"mo",output:"\u2245",tex:"cong",ttype:O},{input:"~~",tag:"mo",output:"\u2248",tex:"approx",ttype:O},{input:"~",tag:"mo",output:"\u223C",tex:"sim",ttype:O},{input:"prop",tag:"mo",output:"\u221D",tex:"propto",ttype:O},{input:"and",tag:"mtext",output:"and",tex:null,ttype:de},{input:"or",tag:"mtext",output:"or",tex:null,ttype:de},{input:"not",tag:"mo",output:"\xAC",tex:"neg",ttype:O},{input:"=>",tag:"mo",output:"\u21D2",tex:"implies",ttype:O},{input:"if",tag:"mo",output:"if",tex:null,ttype:de},{input:"<=>",tag:"mo",output:"\u21D4",tex:"iff",ttype:O},{input:"AA",tag:"mo",output:"\u2200",tex:"forall",ttype:O},{input:"EE",tag:"mo",output:"\u2203",tex:"exists",ttype:O},{input:"_|_",tag:"mo",output:"\u22A5",tex:"bot",ttype:O},{input:"TT",tag:"mo",output:"\u22A4",tex:"top",ttype:O},{input:"|--",tag:"mo",output:"\u22A2",tex:"vdash",ttype:O},{input:"|==",tag:"mo",output:"\u22A8",tex:"models",ttype:O},{input:"(",tag:"mo",output:"(",tex:"left(",ttype:Te},{input:")",tag:"mo",output:")",tex:"right)",ttype:ce},{input:"[",tag:"mo",output:"[",tex:"left[",ttype:Te},{input:"]",tag:"mo",output:"]",tex:"right]",ttype:ce},{input:"{",tag:"mo",output:"{",tex:null,ttype:Te},{input:"}",tag:"mo",output:"}",tex:null,ttype:ce},{input:"|",tag:"mo",output:"|",tex:null,ttype:fe},{input:":|:",tag:"mo",output:"|",tex:null,ttype:O},{input:"|:",tag:"mo",output:"|",tex:null,ttype:Te},{input:":|",tag:"mo",output:"|",tex:null,ttype:ce},{input:"(:",tag:"mo",output:"\u2329",tex:"langle",ttype:Te},{input:":)",tag:"mo",output:"\u232A",tex:"rangle",ttype:ce},{input:"<<",tag:"mo",output:"\u2329",tex:null,ttype:Te},{input:">>",tag:"mo",output:"\u232A",tex:null,ttype:ce},{input:"{:",tag:"mo",output:"{:",tex:null,ttype:Te,invisible:!0},{input:":}",tag:"mo",output:":}",tex:null,ttype:ce,invisible:!0},{input:"int",tag:"mo",output:"\u222B",tex:null,ttype:O},{input:"dx",tag:"mi",output:"{:d x:}",tex:null,ttype:Le},{input:"dy",tag:"mi",output:"{:d y:}",tex:null,ttype:Le},{input:"dz",tag:"mi",output:"{:d z:}",tex:null,ttype:Le},{input:"dt",tag:"mi",output:"{:d t:}",tex:null,ttype:Le},{input:"oint",tag:"mo",output:"\u222E",tex:null,ttype:O},{input:"del",tag:"mo",output:"\u2202",tex:"partial",ttype:O},{input:"grad",tag:"mo",output:"\u2207",tex:"nabla",ttype:O},{input:"+-",tag:"mo",output:"\xB1",tex:"pm",ttype:O},{input:"-+",tag:"mo",output:"\u2213",tex:"mp",ttype:O},{input:"O/",tag:"mo",output:"\u2205",tex:"emptyset",ttype:O},{input:"oo",tag:"mo",output:"\u221E",tex:"infty",ttype:O},{input:"aleph",tag:"mo",output:"\u2135",tex:null,ttype:O},{input:"...",tag:"mo",output:"...",tex:"ldots",ttype:O},{input:":.",tag:"mo",output:"\u2234",tex:"therefore",ttype:O},{input:":'",tag:"mo",output:"\u2235",tex:"because",ttype:O},{input:"/_",tag:"mo",output:"\u2220",tex:"angle",ttype:O},{input:"/_\\",tag:"mo",output:"\u25B3",tex:"triangle",ttype:O},{input:"'",tag:"mo",output:"\u2032",tex:"prime",ttype:O},{input:"tilde",tag:"mover",output:"~",tex:null,ttype:z,acc:!0},{input:"\\ ",tag:"mo",output:"\xA0",tex:null,ttype:O},{input:"frown",tag:"mo",output:"\u2322",tex:null,ttype:O},{input:"quad",tag:"mo",output:"\xA0\xA0",tex:null,ttype:O},{input:"qquad",tag:"mo",output:"\xA0\xA0\xA0\xA0",tex:null,ttype:O},{input:"cdots",tag:"mo",output:"\u22EF",tex:null,ttype:O},{input:"vdots",tag:"mo",output:"\u22EE",tex:null,ttype:O},{input:"ddots",tag:"mo",output:"\u22F1",tex:null,ttype:O},{input:"diamond",tag:"mo",output:"\u22C4",tex:null,ttype:O},{input:"square",tag:"mo",output:"\u25A1",tex:null,ttype:O},{input:"|__",tag:"mo",output:"\u230A",tex:"lfloor",ttype:O},{input:"__|",tag:"mo",output:"\u230B",tex:"rfloor",ttype:O},{input:"|~",tag:"mo",output:"\u2308",tex:"lceiling",ttype:O},{input:"~|",tag:"mo",output:"\u2309",tex:"rceiling",ttype:O},{input:"CC",tag:"mo",output:"\u2102",tex:null,ttype:O},{input:"NN",tag:"mo",output:"\u2115",tex:null,ttype:O},{input:"QQ",tag:"mo",output:"\u211A",tex:null,ttype:O},{input:"RR",tag:"mo",output:"\u211D",tex:null,ttype:O},{input:"ZZ",tag:"mo",output:"\u2124",tex:null,ttype:O},{input:"f",tag:"mi",output:"f",tex:null,ttype:z,func:!0},{input:"g",tag:"mi",output:"g",tex:null,ttype:z,func:!0},{input:"lim",tag:"mo",output:"lim",tex:null,ttype:Se},{input:"Lim",tag:"mo",output:"Lim",tex:null,ttype:Se},{input:"sin",tag:"mo",output:"sin",tex:null,ttype:z,func:!0},{input:"cos",tag:"mo",output:"cos",tex:null,ttype:z,func:!0},{input:"tan",tag:"mo",output:"tan",tex:null,ttype:z,func:!0},{input:"sinh",tag:"mo",output:"sinh",tex:null,ttype:z,func:!0},{input:"cosh",tag:"mo",output:"cosh",tex:null,ttype:z,func:!0},{input:"tanh",tag:"mo",output:"tanh",tex:null,ttype:z,func:!0},{input:"cot",tag:"mo",output:"cot",tex:null,ttype:z,func:!0},{input:"sec",tag:"mo",output:"sec",tex:null,ttype:z,func:!0},{input:"csc",tag:"mo",output:"csc",tex:null,ttype:z,func:!0},{input:"arcsin",tag:"mo",output:"arcsin",tex:null,ttype:z,func:!0},{input:"arccos",tag:"mo",output:"arccos",tex:null,ttype:z,func:!0},{input:"arctan",tag:"mo",output:"arctan",tex:null,ttype:z,func:!0},{input:"coth",tag:"mo",output:"coth",tex:null,ttype:z,func:!0},{input:"sech",tag:"mo",output:"sech",tex:null,ttype:z,func:!0},{input:"csch",tag:"mo",output:"csch",tex:null,ttype:z,func:!0},{input:"exp",tag:"mo",output:"exp",tex:null,ttype:z,func:!0},{input:"abs",tag:"mo",output:"abs",tex:null,ttype:z,rewriteleftright:["|","|"]},{input:"norm",tag:"mo",output:"norm",tex:null,ttype:z,rewriteleftright:["\u2225","\u2225"]},{input:"floor",tag:"mo",output:"floor",tex:null,ttype:z,rewriteleftright:["\u230A","\u230B"]},{input:"ceil",tag:"mo",output:"ceil",tex:null,ttype:z,rewriteleftright:["\u2308","\u2309"]},{input:"log",tag:"mo",output:"log",tex:null,ttype:z,func:!0},{input:"ln",tag:"mo",output:"ln",tex:null,ttype:z,func:!0},{input:"det",tag:"mo",output:"det",tex:null,ttype:z,func:!0},{input:"dim",tag:"mo",output:"dim",tex:null,ttype:O},{input:"mod",tag:"mo",output:"mod",tex:null,ttype:O},{input:"gcd",tag:"mo",output:"gcd",tex:null,ttype:z,func:!0},{input:"lcm",tag:"mo",output:"lcm",tex:null,ttype:z,func:!0},{input:"lub",tag:"mo",output:"lub",tex:null,ttype:O},{input:"glb",tag:"mo",output:"glb",tex:null,ttype:O},{input:"min",tag:"mo",output:"min",tex:null,ttype:Se},{input:"max",tag:"mo",output:"max",tex:null,ttype:Se},{input:"Sin",tag:"mo",output:"Sin",tex:null,ttype:z,func:!0},{input:"Cos",tag:"mo",output:"Cos",tex:null,ttype:z,func:!0},{input:"Tan",tag:"mo",output:"Tan",tex:null,ttype:z,func:!0},{input:"Arcsin",tag:"mo",output:"Arcsin",tex:null,ttype:z,func:!0},{input:"Arccos",tag:"mo",output:"Arccos",tex:null,ttype:z,func:!0},{input:"Arctan",tag:"mo",output:"Arctan",tex:null,ttype:z,func:!0},{input:"Sinh",tag:"mo",output:"Sinh",tex:null,ttype:z,func:!0},{input:"Cosh",tag:"mo",output:"Cosh",tex:null,ttype:z,func:!0},{input:"Tanh",tag:"mo",output:"Tanh",tex:null,ttype:z,func:!0},{input:"Cot",tag:"mo",output:"Cot",tex:null,ttype:z,func:!0},{input:"Sec",tag:"mo",output:"Sec",tex:null,ttype:z,func:!0},{input:"Csc",tag:"mo",output:"Csc",tex:null,ttype:z,func:!0},{input:"Log",tag:"mo",output:"Log",tex:null,ttype:z,func:!0},{input:"Ln",tag:"mo",output:"Ln",tex:null,ttype:z,func:!0},{input:"Abs",tag:"mo",output:"abs",tex:null,ttype:z,notexcopy:!0,rewriteleftright:["|","|"]},{input:"uarr",tag:"mo",output:"\u2191",tex:"uparrow",ttype:O},{input:"darr",tag:"mo",output:"\u2193",tex:"downarrow",ttype:O},{input:"rarr",tag:"mo",output:"\u2192",tex:"rightarrow",ttype:O},{input:"->",tag:"mo",output:"\u2192",tex:"to",ttype:O},{input:">->",tag:"mo",output:"\u21A3",tex:"rightarrowtail",ttype:O},{input:"->>",tag:"mo",output:"\u21A0",tex:"twoheadrightarrow",ttype:O},{input:">->>",tag:"mo",output:"\u2916",tex:"twoheadrightarrowtail",ttype:O},{input:"|->",tag:"mo",output:"\u21A6",tex:"mapsto",ttype:O},{input:"larr",tag:"mo",output:"\u2190",tex:"leftarrow",ttype:O},{input:"harr",tag:"mo",output:"\u2194",tex:"leftrightarrow",ttype:O},{input:"rArr",tag:"mo",output:"\u21D2",tex:"Rightarrow",ttype:O},{input:"lArr",tag:"mo",output:"\u21D0",tex:"Leftarrow",ttype:O},{input:"hArr",tag:"mo",output:"\u21D4",tex:"Leftrightarrow",ttype:O},{input:"sqrt",tag:"msqrt",output:"sqrt",tex:null,ttype:z},{input:"root",tag:"mroot",output:"root",tex:null,ttype:me},{input:"frac",tag:"mfrac",output:"/",tex:null,ttype:me},{input:"/",tag:"mfrac",output:"/",tex:null,ttype:Me},{input:"stackrel",tag:"mover",output:"stackrel",tex:null,ttype:me},{input:"overset",tag:"mover",output:"stackrel",tex:null,ttype:me},{input:"underset",tag:"munder",output:"stackrel",tex:null,ttype:me},{input:"_",tag:"msub",output:"_",tex:null,ttype:Me},{input:"^",tag:"msup",output:"^",tex:null,ttype:Me},{input:"hat",tag:"mover",output:"^",tex:null,ttype:z,acc:!0},{input:"bar",tag:"mover",output:"\xAF",tex:"overline",ttype:z,acc:!0},{input:"vec",tag:"mover",output:"\u2192",tex:null,ttype:z,acc:!0},{input:"dot",tag:"mover",output:".",tex:null,ttype:z,acc:!0},{input:"ddot",tag:"mover",output:"..",tex:null,ttype:z,acc:!0},{input:"overarc",tag:"mover",output:"\u23DC",tex:"overparen",ttype:z,acc:!0},{input:"ul",tag:"munder",output:"\u0332",tex:"underline",ttype:z,acc:!0},{input:"ubrace",tag:"munder",output:"\u23DF",tex:"underbrace",ttype:at,acc:!0},{input:"obrace",tag:"mover",output:"\u23DE",tex:"overbrace",ttype:at,acc:!0},{input:"text",tag:"mtext",output:"text",tex:null,ttype:Ae},{input:"mbox",tag:"mtext",output:"mbox",tex:null,ttype:Ae},{input:"color",tag:"mstyle",ttype:me},{input:"id",tag:"mrow",ttype:me},{input:"class",tag:"mrow",ttype:me},{input:"cancel",tag:"menclose",output:"cancel",tex:null,ttype:z},et,{input:"bb",tag:"mstyle",atname:"mathvariant",atval:"bold",output:"bb",tex:null,ttype:z},{input:"mathbf",tag:"mstyle",atname:"mathvariant",atval:"bold",output:"mathbf",tex:null,ttype:z},{input:"sf",tag:"mstyle",atname:"mathvariant",atval:"sans-serif",output:"sf",tex:null,ttype:z},{input:"mathsf",tag:"mstyle",atname:"mathvariant",atval:"sans-serif",output:"mathsf",tex:null,ttype:z},{input:"bbb",tag:"mstyle",atname:"mathvariant",atval:"double-struck",output:"bbb",tex:null,ttype:z,codes:ae},{input:"mathbb",tag:"mstyle",atname:"mathvariant",atval:"double-struck",output:"mathbb",tex:null,ttype:z,codes:ae},{input:"cc",tag:"mstyle",atname:"mathvariant",atval:"script",output:"cc",tex:null,ttype:z,codes:ne},{input:"mathcal",tag:"mstyle",atname:"mathvariant",atval:"script",output:"mathcal",tex:null,ttype:z,codes:ne},{input:"tt",tag:"mstyle",atname:"mathvariant",atval:"monospace",output:"tt",tex:null,ttype:z},{input:"mathtt",tag:"mstyle",atname:"mathvariant",atval:"monospace",output:"mathtt",tex:null,ttype:z},{input:"fr",tag:"mstyle",atname:"mathvariant",atval:"fraktur",output:"fr",tex:null,ttype:z,codes:be},{input:"mathfrak",tag:"mstyle",atname:"mathvariant",atval:"fraktur",output:"mathfrak",tex:null,ttype:z,codes:be}];function Di(S,T){return S.input>T.input?1:-1}var Dt=[];function Oi(){var S,T=We.length;for(S=0;S<T;S++)We[S].tex&&We.push({input:We[S].tex,tag:We[S].tag,output:We[S].output,ttype:We[S].ttype,acc:We[S].acc||!1});G()}function G(){var S;for(We.sort(Di),S=0;S<We.length;S++)Dt[S]=We[S].input}function qe(S,T){var P;S.charAt(T)=="\\"&&S.charAt(T+1)!="\\"&&S.charAt(T+1)!=" "?P=S.slice(T+1):P=S.slice(T);for(var B=0;B<P.length&&P.charCodeAt(B)<=32;B=B+1);return P.slice(B)}function Ti(S,T,P){if(P==0){var B,N;for(P=-1,B=S.length;P+1<B;)N=P+B>>1,S[N]<T?P=N:B=N;return B}else for(var W=P;W<S.length&&S[W]<T;W++);return W}function Ke(S){for(var T=0,P=0,B,N,W,j="",oe=!0,Be=1;Be<=S.length&&oe;Be++)N=S.slice(0,Be),P=T,T=Ti(Dt,N,P),T<Dt.length&&S.slice(0,Dt[T].length)==Dt[T]&&(j=Dt[T],B=T,Be=j.length),oe=T<Dt.length&&S.slice(0,Dt[T].length)>=Dt[T];if($i=ti,j!="")return ti=We[B].ttype,We[B];ti=O,T=1,N=S.slice(0,1);for(var De=!0;"0"<=N&&N<="9"&&T<=S.length;)N=S.slice(T,T+1),T++;if(N==o&&(N=S.slice(T,T+1),"0"<=N&&N<="9"))for(De=!1,T++;"0"<=N&&N<="9"&&T<=S.length;)N=S.slice(T,T+1),T++;return De&&T>1||T>2?(N=S.slice(0,T-1),W="mn"):(T=2,N=S.slice(0,1),W=("A">N||N>"Z")&&("a">N||N>"z")?"mo":"mi"),N=="-"&&S.charAt(1)!==" "&&$i==Me?(ti=Me,{input:N,tag:W,output:N,ttype:z,func:!0}):{input:N,tag:W,output:N,ttype:O}}function Rt(S){var T;if(!!S.hasChildNodes()){if(S.firstChild.hasChildNodes()&&(S.nodeName=="mrow"||S.nodeName=="M:MROW")){if(S.firstChild.nextSibling&&S.firstChild.nextSibling.nodeName=="mtable")return;T=S.firstChild.firstChild.nodeValue,(T=="("||T=="["||T=="{")&&S.removeChild(S.firstChild)}S.lastChild.hasChildNodes()&&(S.nodeName=="mrow"||S.nodeName=="M:MROW")&&(T=S.lastChild.firstChild.nodeValue,(T==")"||T=="]"||T=="}")&&S.removeChild(S.lastChild))}}var Nt,$i,ti;function He(S){var T,P,B,N,W,j=document.createDocumentFragment();if(S=qe(S,0),T=Ke(S),T==null||T.ttype==ce&&Nt>0)return[null,S];switch(T.ttype==Le&&(S=T.output+qe(S,T.input.length),T=Ke(S)),T.ttype){case Se:case O:return S=qe(S,T.input.length),[V(T.tag,document.createTextNode(T.output)),S];case Te:return Nt++,S=qe(S,T.input.length),B=gt(S,!0),Nt--,typeof T.invisible=="boolean"&&T.invisible?P=V("mrow",B[0]):(P=V("mo",document.createTextNode(T.output)),P=V("mrow",P),P.appendChild(B[0])),[P,B[1]];case Ae:return T!=et&&(S=qe(S,T.input.length)),S.charAt(0)=="{"?N=S.indexOf("}"):S.charAt(0)=="("?N=S.indexOf(")"):S.charAt(0)=="["?N=S.indexOf("]"):T==et?N=S.slice(1).indexOf('"')+1:N=0,N==-1&&(N=S.length),W=S.slice(1,N),W.charAt(0)==" "&&(P=V("mspace"),P.setAttribute("width","1ex"),j.appendChild(P)),j.appendChild(V(T.tag,document.createTextNode(W))),W.charAt(W.length-1)==" "&&(P=V("mspace"),P.setAttribute("width","1ex"),j.appendChild(P)),S=qe(S,N+1),[V("mrow",j),S];case at:case z:if(S=qe(S,T.input.length),B=He(S),B[0]==null){if(T.tag=="mi"||T.tag=="mo")return[V(T.tag,document.createTextNode(T.output)),S];B[0]=V("mi","")}if(typeof T.func=="boolean"&&T.func)return W=S.charAt(0),W=="^"||W=="_"||W=="/"||W=="|"||W==","||T.input.length==1&&T.input.match(/\w/)&&W!="("?[V(T.tag,document.createTextNode(T.output)),S]:(P=V("mrow",V(T.tag,document.createTextNode(T.output))),P.appendChild(B[0]),[P,B[1]]);if(Rt(B[0]),T.input=="sqrt")return[V(T.tag,B[0]),B[1]];if(typeof T.rewriteleftright!="undefined")return P=V("mrow",V("mo",document.createTextNode(T.rewriteleftright[0]))),P.appendChild(B[0]),P.appendChild(V("mo",document.createTextNode(T.rewriteleftright[1]))),[P,B[1]];if(T.input=="cancel")return P=V(T.tag,B[0]),P.setAttribute("notation","updiagonalstrike"),[P,B[1]];if(typeof T.acc=="boolean"&&T.acc){P=V(T.tag,B[0]);var oe=V("mo",document.createTextNode(T.output));return T.input=="vec"&&(B[0].nodeName=="mrow"&&B[0].childNodes.length==1&&B[0].firstChild.firstChild.nodeValue!==null&&B[0].firstChild.firstChild.nodeValue.length==1||B[0].firstChild&&B[0].firstChild.nodeValue!==null&&B[0].firstChild.nodeValue.length==1)&&oe.setAttribute("stretchy",!1),P.appendChild(oe),[P,B[1]]}else{if(!g&&typeof T.codes!="undefined"){for(N=0;N<B[0].childNodes.length;N++)if(B[0].childNodes[N].nodeName=="mi"||B[0].nodeName=="mi"){W=B[0].nodeName=="mi"?B[0].firstChild.nodeValue:B[0].childNodes[N].firstChild.nodeValue;for(var Be=[],De=0;De<W.length;De++)W.charCodeAt(De)>64&&W.charCodeAt(De)<91?Be=Be+T.codes[W.charCodeAt(De)-65]:W.charCodeAt(De)>96&&W.charCodeAt(De)<123?Be=Be+T.codes[W.charCodeAt(De)-71]:Be=Be+W.charAt(De);B[0].nodeName=="mi"?B[0]=V("mo").appendChild(document.createTextNode(Be)):B[0].replaceChild(V("mo").appendChild(document.createTextNode(Be)),B[0].childNodes[N])}}return P=V(T.tag,B[0]),P.setAttribute(T.atname,T.atval),[P,B[1]]}case me:if(S=qe(S,T.input.length),B=He(S),B[0]==null)return[V("mo",document.createTextNode(T.input)),S];Rt(B[0]);var ze=He(B[1]);return ze[0]==null?[V("mo",document.createTextNode(T.input)),S]:(Rt(ze[0]),["color","class","id"].indexOf(T.input)>=0?(S.charAt(0)=="{"?N=S.indexOf("}"):S.charAt(0)=="("?N=S.indexOf(")"):S.charAt(0)=="["&&(N=S.indexOf("]")),W=S.slice(1,N),P=V(T.tag,ze[0]),T.input==="color"?P.setAttribute("mathcolor",W):T.input==="class"?P.setAttribute("class",W):T.input==="id"&&P.setAttribute("id",W),[P,ze[1]]):((T.input=="root"||T.output=="stackrel")&&j.appendChild(ze[0]),j.appendChild(B[0]),T.input=="frac"&&j.appendChild(ze[0]),[V(T.tag,j),ze[1]]));case Me:return S=qe(S,T.input.length),[V("mo",document.createTextNode(T.output)),S];case de:return S=qe(S,T.input.length),P=V("mspace"),P.setAttribute("width","1ex"),j.appendChild(P),j.appendChild(V(T.tag,document.createTextNode(T.output))),P=V("mspace"),P.setAttribute("width","1ex"),j.appendChild(P),[V("mrow",j),S];case fe:return Nt++,S=qe(S,T.input.length),B=gt(S,!1),Nt--,W="",B[0].lastChild!=null&&(W=B[0].lastChild.firstChild.nodeValue),W=="|"&&S.charAt(0)!==","?(P=V("mo",document.createTextNode(T.output)),P=V("mrow",P),P.appendChild(B[0]),[P,B[1]]):(P=V("mo",document.createTextNode("\u2223")),P=V("mrow",P),[P,S]);default:return S=qe(S,T.input.length),[V(T.tag,document.createTextNode(T.output)),S]}}function pn(S){var T,P,B,N,W,j;if(S=qe(S,0),P=Ke(S),W=He(S),N=W[0],S=W[1],T=Ke(S),T.ttype==Me&&T.input!="/"){if(S=qe(S,T.input.length),W=He(S),W[0]==null?W[0]=V("mo",document.createTextNode("\u25A1")):Rt(W[0]),S=W[1],j=P.ttype==Se||P.ttype==at,T.input=="_")if(B=Ke(S),B.input=="^"){S=qe(S,B.input.length);var oe=He(S);Rt(oe[0]),S=oe[1],N=V(j?"munderover":"msubsup",N),N.appendChild(W[0]),N.appendChild(oe[0]),N=V("mrow",N)}else N=V(j?"munder":"msub",N),N.appendChild(W[0]);else T.input=="^"&&j?(N=V("mover",N),N.appendChild(W[0])):(N=V(T.tag,N),N.appendChild(W[0]));typeof P.func!="undefined"&&P.func&&(B=Ke(S),B.ttype!=Me&&B.ttype!=ce&&(P.input.length>1||B.ttype==Te)&&(W=pn(S),N=V("mrow",N),N.appendChild(W[0]),S=W[1]))}return[N,S]}function gt(S,T){var P,B,N,W,j=document.createDocumentFragment();do S=qe(S,0),N=pn(S),B=N[0],S=N[1],P=Ke(S),P.ttype==Me&&P.input=="/"?(S=qe(S,P.input.length),N=pn(S),N[0]==null?N[0]=V("mo",document.createTextNode("\u25A1")):Rt(N[0]),S=N[1],Rt(B),B=V(P.tag,B),B.appendChild(N[0]),j.appendChild(B),P=Ke(S)):B!=null&&j.appendChild(B);while((P.ttype!=ce&&(P.ttype!=fe||T)||Nt==0)&&P!=null&&P.output!="");if(P.ttype==ce||P.ttype==fe){var oe=j.childNodes.length;if(oe>0&&j.childNodes[oe-1].nodeName=="mrow"&&j.childNodes[oe-1].lastChild&&j.childNodes[oe-1].lastChild.firstChild){var Be=j.childNodes[oe-1].lastChild.firstChild.nodeValue;if(Be==")"||Be=="]"){var De=j.childNodes[oe-1].firstChild.firstChild.nodeValue;if(De=="("&&Be==")"&&P.output!="}"||De=="["&&Be=="]"){var ze=[],he=!0,ht=j.childNodes.length;for(W=0;he&&W<ht;W=W+2){if(ze[W]=[],B=j.childNodes[W],he&&(he=B.nodeName=="mrow"&&(W==ht-1||B.nextSibling.nodeName=="mo"&&B.nextSibling.firstChild.nodeValue==",")&&B.firstChild.firstChild&&B.firstChild.firstChild.nodeValue==De&&B.lastChild.firstChild&&B.lastChild.firstChild.nodeValue==Be),he)for(var xe=0;xe<B.childNodes.length;xe++)B.childNodes[xe].firstChild.nodeValue==","&&(ze[W][ze[W].length]=xe);he&&W>1&&(he=ze[W].length==ze[W-2].length)}he=he&&(ze.length>1||ze[0].length>0);var tt=[];if(he){var Ct,Ei,Je,ii,_n=document.createDocumentFragment();for(W=0;W<ht;W=W+2){for(Ct=document.createDocumentFragment(),Ei=document.createDocumentFragment(),B=j.firstChild,Je=B.childNodes.length,ii=0,B.removeChild(B.firstChild),xe=1;xe<Je-1;xe++)typeof ze[W][ii]!="undefined"&&xe==ze[W][ii]?(B.removeChild(B.firstChild),B.firstChild.nodeName=="mrow"&&B.firstChild.childNodes.length==1&&B.firstChild.firstChild.firstChild.nodeValue=="\u2223"?(W==0&&tt.push("solid"),B.removeChild(B.firstChild),B.removeChild(B.firstChild),xe+=2,ii++):W==0&&tt.push("none"),Ct.appendChild(V("mtd",Ei)),ii++):Ei.appendChild(B.firstChild);Ct.appendChild(V("mtd",Ei)),W==0&&tt.push("none"),j.childNodes.length>2&&(j.removeChild(j.firstChild),j.removeChild(j.firstChild)),_n.appendChild(V("mtr",Ct))}B=V("mtable",_n),B.setAttribute("columnlines",tt.join(" ")),typeof P.invisible=="boolean"&&P.invisible&&B.setAttribute("columnalign","left"),j.replaceChild(B,j.firstChild)}}}}S=qe(S,P.input.length),(typeof P.invisible!="boolean"||!P.invisible)&&(B=V("mo",document.createTextNode(P.output)),j.appendChild(B))}return[j,S]}function Kn(S,T){var P,B;return Nt=0,S=S.replace(/&nbsp;/g,""),S=S.replace(/&gt;/g,">"),S=S.replace(/&lt;/g,"<"),P=gt(S.replace(/^\s+/g,""),!1)[0],B=V("mstyle",P),B.setAttribute("mathcolor",r),B.setAttribute("fontsize",e),B.setAttribute("mathsize",e),B.setAttribute("fontfamily",t),B.setAttribute("mathvariant",t),B.setAttribute("displaystyle","true"),B=V("math",B),B.setAttribute("title",S.replace(/\s+/g," ")),B}function zn(S,T,P){for(var B=document.createDocumentFragment(),N=!1,W=0;W<S.length;W++){if(N)B.appendChild(Kn(S[W]));else{var j=T?S[W].split(`

`):[S[W]];B.appendChild(X("span").appendChild(document.createTextNode(j[0])));for(var oe=1;oe<j.length;oe++)B.appendChild(X("p")),B.appendChild(X("span").appendChild(document.createTextNode(j[oe])))}N=!N}return B}function gn(S){var T="\\\\[a-zA-Z]+|\\\\\\s|",P="\\b(?:oo|lim|ln|int|oint|del|grad|aleph|prod|prop|sinh|cosh|tanh|cos|sec|pi|tt|fr|sf|sube|supe|sub|sup|det|mod|gcd|lcm|min|max|vec|ddot|ul|chi|eta|nu|mu)(?![a-z])|",B="\\b(?:sum|ox|log|sin|tan|dim|hat|bar|dot)(?![a-z])|",N="|\\bI\\b|\\bin\\b|\\btext\\b",W="NN|ZZ|QQ|RR|CC|TT|AA|EE|sqrt|dx|dy|dz|dt|xx|vv|uu|nn|bb|cc|csc|cot|alpha|beta|delta|Delta|epsilon|gamma|Gamma|kappa|lambda|Lambda|omega|phi|Phi|Pi|psi|Psi|rho|sigma|Sigma|tau|theta|Theta|xi|Xi|zeta",j="[a-zA-HJ-Z](?=(?:[^a-zA-Z]|$|"+P+B+W+"))|",oe=j+T+"\\d+|[-()[\\]{}+=*&^_%\\@/<>,\\|!:;'~]|\\.(?!(?: |$))|"+P+B+W,Be=new RegExp("(^|\\s)((("+oe+")\\s?)(("+oe+N+")\\s?)+)([,.?]?(?=\\s|$))","g");S=S.replace(Be," `$2`$7");var De=S.split(l),ze=new RegExp("(^|\\s)([b-zB-HJ-Z+*<>]|"+T+P+W+")(\\s|\\n|$)","g"),he=new RegExp("(^|\\s)([a-z]|"+T+P+W+")([,.])","g");for(i=0;i<De.length;i++)i%2==0&&(De[i]=De[i].replace(ze," `$2`$3"),De[i]=De[i].replace(he," `$2`$3"),De[i]=De[i].replace(/([{}[\]])/,"`$1`"));return S=De.join(l),S=S.replace(/((^|\s)\([a-zA-Z]{2,}.*?)\)`/g,"$1`)"),S=S.replace(/`(\((a\s|in\s))(.*?[a-zA-Z]{2,}\))/g,"$1`$3"),S=S.replace(/\sin`/g,"` in"),S=S.replace(/`(\(\w\)[,.]?(\s|\n|$))/g,"$1`"),S=S.replace(/`([0-9.]+|e.g|i.e)`(\.?)/gi,"$1$2"),S=S.replace(/`([0-9.]+:)`/g,"$1"),S}function Pt(S,T,P){var B,N,W,j,oe;if(S.childNodes.length==0)if((S.nodeType!=8||T)&&S.parentNode.nodeName!="form"&&S.parentNode.nodeName!="FORM"&&S.parentNode.nodeName!="textarea"&&S.parentNode.nodeName!="TEXTAREA"){if(N=S.nodeValue,N!=null){if(N=N.replace(/\r\n\r\n/g,`

`),N=N.replace(/\x20+/g," "),N=N.replace(/\s*\r\n/g," "),P)for(B=N.indexOf("$")!=-1,N=N.replace(/([^\\])\$/g,"$1 $"),N=N.replace(/^\$/," $"),W=N.split(" $"),oe=0;oe<W.length;oe++)W[oe]=W[oe].replace(/\\\$/g,"$");else{if(B=!1,N=N.replace(new RegExp(h,"g"),function(){return B=!0,"AMescape1"}),N=N.replace(/\\?end{?a?math}?/i,function(){return n=!1,B=!0,""}),N=N.replace(/amath\b|\\begin{a?math}/i,function(){return n=!0,B=!0,""}),W=N.split(l),n)for(oe=0;oe<W.length;oe++)oe%2==0&&(W[oe]=gn(W[oe]));for(N=W.join(l),W=N.split(l),oe=0;oe<W.length;oe++)W[oe]=W[oe].replace(/AMescape1/g,l)}if(W.length>1||B){if(p)return 0;j=zn(W,S.nodeType==8);var Be=j.childNodes.length;return S.parentNode.replaceChild(j,S),Be-1}}}else return 0;else if(S.nodeName!="math")for(oe=0;oe<S.childNodes.length;oe++)oe+=Pt(S.childNodes[oe],T,P);return 0}function Ot(S,T,P){var B,N;if(P!=null){B=document.getElementsByTagName("span");for(var W=0;W<B.length;W++)B[W].className=="AM"&&Pt(B[W],T,!1)}else{try{N=S.innerHTML}catch{}(N==null||/amath\b|\\begin{a?math}/i.test(N)||N.indexOf(l+" ")!=-1||N.slice(-1)==l||N.indexOf(l+"<")!=-1||N.indexOf(l+`
`)!=-1)&&Pt(S,T,!1)}}function Li(){!C()||K()}if(typeof window.addEventListener!="undefined")window.addEventListener("load",Li,!1);else if(typeof document.addEventListener!="undefined")document.addEventListener("load",Li,!1);else if(typeof window.attachEvent!="undefined")window.attachEvent("onload",Li);else if(typeof window.onload=="function"){var $n=onload;window.onload=function(){$n(),Li()}}else window.onload=Li;Ni.newcommand=Y,Ni.newsymbol=Q,Ni.AMprocesssNode=Ot,Ni.parseMath=Kn,Ni.translate=K})();const g0=document.querySelector("#editor");let bo=new fn,ko=new fn;function m0(r){const e=r.state.selection;let t=r.state.doc.slice(e.main.from,e.main.to),n=" = "+c0(t.text[0]).toString();return r.dispatch({changes:{from:e.main.to,to:e.main.to,insert:n},selection:{anchor:e.main.to+n.length-1}}),!0}const y0=Qr.of([{key:"Mod-q",preventDefault:!0,run:m0}]);class v0 extends ai{constructor(e){super(),this.src=e}toDOM(){let e=document.createElement("img");return e.src=this.src,e}}const qa=new Bo({regexp:/🖼{([^}]+)}/g,decoration:r=>ve.replace({widget:new v0(r[1])}),maxLength:1/0}),x0=Mt.fromClass(class{constructor(r){cs(this,"image");this.image=qa.createDeco(r)}update(r){this.image=qa.updateDeco(r,this.image)}},{decorations:r=>r.image,provide:r=>se.atomicRanges.of(e=>{var t;return((t=e.plugin(r))==null?void 0:t.image)||ve.none})});class w0 extends ai{constructor(e){super(),this.mathml=e}toDOM(){let e=document.createElement("span");return e.innerHTML=this.mathml,e}}const Ua=new Bo({regexp:/➕{(.*)}/g,decoration:r=>ve.replace({widget:new w0(r[1])}),maxLength:1/0}),b0=Mt.fromClass(class{constructor(r){cs(this,"mathMl");this.mathMl=Ua.createDeco(r)}update(r){this.mathMl=Ua.updateDeco(r,this.mathMl)}},{decorations:r=>r.mathMl,provide:r=>se.atomicRanges.of(e=>{var t;return((t=e.plugin(r))==null?void 0:t.mathMl)||ve.none})});let k0=se.domEventHandlers({paste(r,e){var n;var t=(n=r.clipboardData)==null?void 0:n.items;console.log(t);for(const s of t)if(s.type.startsWith("image/")){console.log("lmao");let o=s.getAsFile(),l=new FileReader,h=new Image;l.readAsDataURL(o),l.onload=function(){h.src=l.result,h.onload=()=>{wo(h,e)}},l.onerror=function(f){console.log("Error: ",f)}}}}),C0=se.theme({"&":{backgroundColor:"#161616",color:"#EAEAEA",fontSize:"var(--editor-font-size)",height:"calc(100dvh - 3rem)"},"&.cm-focused":{outline:"none"},".cm-line":{paddingLeft:"0.2rem"},".cm-cursor, .cm-dropCursor":{borderLeftColor:"#EAEAEA"},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{backgroundColor:"#404040"},".cm-vim-panel input":{width:"unset !important",fontSize:"var(--editor-font-size)"},".cm-gutters":{backgroundColor:"#161616",color:"#464646",border:"none"}});function S0(r){return se.updateListener.of(e=>{ke[r].newState&&(ke[r].state=e.state),e.docChanged&&(ke[r].saved&&(ke[r].saved=!1,dn()),ke[r].state=e.state)})}function wf(r){return[l0(),Nm,C0,Qr.of([Dm]),y0,S0(r),x0,k0,bo.of(JSON.parse(localStorage.wrap||"true")?se.lineWrapping:[]),ko.of(JSON.parse(localStorage.numbers||"true")?cu():[]),b0]}function rs(r){return we.create({doc:"",extensions:wf(r)})}function A0(r,e){return we.create({doc:e,extensions:wf(r)})}async function bf(){let r;try{r=await d0()}catch(e){if(e.name==="AbortError")return;const t="An error occured trying to open the file.";console.error(t,e),alert(t);return}try{await xf(r,Si.state.doc.toString()),ke[Pe].fsHandle=r,ke[Pe].saved=!0,ke[Pe].name=ke[Pe].fsHandle.name,dn()}catch(e){const t="Unable to save file.";console.error(t,e),alert(t);return}Si.focus()}st.defineEx("new","n",function(){ke.push({name:"No Name",saved:!1,fsHandle:null,state:rs(ke.length),newState:!1}),nn(ke.length-1)});st.defineEx("write","w",async function(){try{if(!ke[Pe].fsHandle)return await bf();await xf(ke[Pe].fsHandle,Si.state.doc.toString()),ke[Pe].saved=!0,dn()}catch(r){const e="Unable to save file";console.error(e,r),alert(e)}Si.focus()});st.defineEx("writeTo","",async function(){return await bf()});st.defineEx("quit","q",function(){if(ke.splice(Pe,1),ke.length===0){ke=[{name:"No Name",saved:!1,fsHandle:null,state:rs(0),newState:!1}],nn(0);return}Pe==ke.length&&nn(Pe-1),nn(Pe)});function cr(r,e,t){r.cm6.dispatch({effects:t.reconfigure(e)})}st.defineEx("set","",function(r,e){switch(console.log(r),e.args[0]){case"numbers":localStorage.numbers=!0,cr(r,cu(),ko);break;case"nonumbers":localStorage.numbers=!1,cr(r,[],ko);break;case"wrap":localStorage.wrap=!0,cr(r,se.lineWrapping,bo);break;case"nowrap":localStorage.wrap=!1,cr(r,[],bo);break}});st.defineEx("insertimg","i",async function(r,e){let t=e.args;if(t===void 0){let s=await(await vf()).getFile(),o=new FileReader,l=new Image;o.readAsDataURL(s),o.onload=function(){l.src=o.result,l.onload=h=>{wo(h,r.cm6)}},o.onerror=function(h){console.log("Error: ",h)}}else{let n=new Image;n.onload=function(){wo(n,r.cm6)},n.setAttribute("crossorigin","anonymous"),n.src=t[0]}});st.defineEx("inserteq","",function(r,e){let t=e.args;Ni.parseMath(t.join(" ")).outerHTML,r.cm6.dispatch({changes:{from:r.cm6.state.selection.main.from,to:r.cm6.state.selection.main.to,insert:"\u2795{"+Ni.parseMath(t.join(" ")).outerHTML+"}"}})});st.defineAction("bufferCycleNext",()=>{let r=Pe;r++,r>=ke.length&&(r=0),nn(r)});st.defineAction("bufferCyclePrev",()=>{let r=Pe;r--,r<0&&(r=ke.length-1),nn(r)});st.mapCommand("L","action","bufferCycleNext");st.mapCommand("H","action","bufferCyclePrev");let Si=new se({parent:g0,state:rs(0)});const ja=document.querySelector("#tabs");let Pe=0,ke=[{name:"No Name",saved:!1,fsHandle:null,state:rs(0),newState:!1}];function nn(r){Pe=r,Si.setState(ke[Pe].state),dn()}function dn(){ja.replaceChildren();for(let r=0;r<ke.length;r++){const e=ke[r];console.log(e.state.doc.toString());let t=document.createElement("div");t.classList.add("tab"),t.innerHTML=e.name+(e.saved?"":"\u2022"),Pe==r&&t.classList.add("selected-tab"),ja.appendChild(t)}}st.defineEx("edit","e",async function(){try{ke[Pe].fsHandle=await vf()}catch(e){if(e.name==="AbortError")return;const t="An error occured trying to open the file.";console.error(t,e),alert(t)}if(!ke[Pe].fsHandle)return;const r=await ke[Pe].fsHandle.getFile();ke[Pe].name=ke[Pe].fsHandle.name,ke[Pe].saved=!0,ke[Pe].newState=!0,Si.setState(A0(Pe,await p0(r))),dn()});const M0=setInterval(()=>{Si.focus(),Si.hasFocus&&clearInterval(M0)},100);dn();
